import { SERVER_REQUEST_ORIGIN, SERVER_REQUEST_URL } from './ssr.providers';
/**
 * The wrapper over the standard ngExpressEngine, that provides tokens for Spartacus
 * @param ngExpressEngine
 */
export class NgExpressEngineDecorator {
    /**
     * Returns the higher order ngExpressEngine with provided tokens for Spartacus
     *
     * @param ngExpressEngine
     */
    static get(ngExpressEngine) {
        const result = function cxNgExpressEngine(setupOptions) {
            return (filePath, options, callback) => {
                const engineInstance = ngExpressEngine(Object.assign(Object.assign({}, setupOptions), { providers: [
                        ...getServerRequestProviders(options),
                        ...(setupOptions.providers || []),
                    ] }));
                return engineInstance(filePath, options, callback);
            };
        };
        return result;
    }
}
/**
 * Returns Spartacus' providers to be passed to the Angular express engine (in SSR)
 *
 * @param options
 */
export function getServerRequestProviders(options) {
    return [
        {
            provide: SERVER_REQUEST_URL,
            useValue: getRequestUrl(options.req),
        },
        {
            provide: SERVER_REQUEST_ORIGIN,
            useValue: getRequestOrigin(options.req),
        },
    ];
}
function getRequestUrl(req) {
    return getRequestOrigin(req) + req.originalUrl;
}
function getRequestOrigin(req) {
    return req.protocol + '://' + req.get('host');
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctZXhwcmVzcy1lbmdpbmUtZGVjb3JhdG9yLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHNwYXJ0YWN1cy9jb3JlLyIsInNvdXJjZXMiOlsic3JjL3Nzci9uZy1leHByZXNzLWVuZ2luZS1kZWNvcmF0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLHFCQUFxQixFQUFFLGtCQUFrQixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFrQzVFOzs7R0FHRztBQUNILE1BQU0sT0FBTyx3QkFBd0I7SUFDbkM7Ozs7T0FJRztJQUNILE1BQU0sQ0FBQyxHQUFHLENBQUMsZUFBZ0M7UUFDekMsTUFBTSxNQUFNLEdBQUcsU0FBUyxpQkFBaUIsQ0FDdkMsWUFBNEI7WUFFNUIsT0FBTyxDQUFDLFFBQVEsRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLEVBQUU7Z0JBQ3JDLE1BQU0sY0FBYyxHQUFHLGVBQWUsaUNBQ2pDLFlBQVksS0FDZixTQUFTLEVBQUU7d0JBQ1QsR0FBRyx5QkFBeUIsQ0FBQyxPQUFPLENBQUM7d0JBQ3JDLEdBQUcsQ0FBQyxZQUFZLENBQUMsU0FBUyxJQUFJLEVBQUUsQ0FBQztxQkFDbEMsSUFDRCxDQUFDO2dCQUNILE9BQU8sY0FBYyxDQUFDLFFBQVEsRUFBRSxPQUFPLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFDckQsQ0FBQyxDQUFDO1FBQ0osQ0FBQyxDQUFDO1FBQ0YsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQztDQUNGO0FBRUQ7Ozs7R0FJRztBQUNILE1BQU0sVUFBVSx5QkFBeUIsQ0FDdkMsT0FBc0I7SUFFdEIsT0FBTztRQUNMO1lBQ0UsT0FBTyxFQUFFLGtCQUFrQjtZQUMzQixRQUFRLEVBQUUsYUFBYSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUM7U0FDckM7UUFDRDtZQUNFLE9BQU8sRUFBRSxxQkFBcUI7WUFDOUIsUUFBUSxFQUFFLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUM7U0FDeEM7S0FDRixDQUFDO0FBQ0osQ0FBQztBQUVELFNBQVMsYUFBYSxDQUFDLEdBQVE7SUFDN0IsT0FBTyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUMsV0FBVyxDQUFDO0FBQ2pELENBQUM7QUFFRCxTQUFTLGdCQUFnQixDQUFDLEdBQVE7SUFDaEMsT0FBTyxHQUFHLENBQUMsUUFBUSxHQUFHLEtBQUssR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQ2hELENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZ01vZHVsZUZhY3RvcnksIFN0YXRpY1Byb3ZpZGVyLCBUeXBlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBTRVJWRVJfUkVRVUVTVF9PUklHSU4sIFNFUlZFUl9SRVFVRVNUX1VSTCB9IGZyb20gJy4vc3NyLnByb3ZpZGVycyc7XG5cbi8qKlxuICogVGhlc2UgYXJlIHRoZSBhbGxvd2VkIG9wdGlvbnMgZm9yIHRoZSBlbmdpbmVcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBOZ1NldHVwT3B0aW9ucyB7XG4gIGJvb3RzdHJhcDogVHlwZTx7fT4gfCBOZ01vZHVsZUZhY3Rvcnk8e30+O1xuICBwcm92aWRlcnM/OiBTdGF0aWNQcm92aWRlcltdO1xufVxuXG4vKipcbiAqIFRoZXNlIGFyZSB0aGUgYWxsb3dlZCBvcHRpb25zIGZvciB0aGUgcmVuZGVyXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgUmVuZGVyT3B0aW9ucyBleHRlbmRzIE5nU2V0dXBPcHRpb25zIHtcbiAgcmVxOiB7XG4gICAgcHJvdG9jb2w6IHN0cmluZztcbiAgICBvcmlnaW5hbFVybDogc3RyaW5nO1xuICAgIGdldDogKF86IHN0cmluZykgPT4gc3RyaW5nO1xuICB9OyAvLyBSZXF1ZXN0O1xuICByZXM/OiBhbnk7IC8vIFJlc3BvbnNlO1xuICB1cmw/OiBzdHJpbmc7XG4gIGRvY3VtZW50Pzogc3RyaW5nO1xufVxuXG5leHBvcnQgdHlwZSBOZ0V4cHJlc3NFbmdpbmVJbnN0YW5jZSA9IChcbiAgZmlsZVBhdGg6IHN0cmluZyxcbiAgb3B0aW9uczogUmVuZGVyT3B0aW9ucyxcbiAgY2FsbGJhY2s6IChlcnI/OiBFcnJvciB8IG51bGwgfCB1bmRlZmluZWQsIGh0bWw/OiBzdHJpbmcgfCB1bmRlZmluZWQpID0+IHZvaWRcbikgPT4gdm9pZDtcblxuZXhwb3J0IHR5cGUgTmdFeHByZXNzRW5naW5lID0gKFxuICBzZXR1cE9wdGlvbnM6IE5nU2V0dXBPcHRpb25zXG4pID0+IE5nRXhwcmVzc0VuZ2luZUluc3RhbmNlO1xuXG4vKipcbiAqIFRoZSB3cmFwcGVyIG92ZXIgdGhlIHN0YW5kYXJkIG5nRXhwcmVzc0VuZ2luZSwgdGhhdCBwcm92aWRlcyB0b2tlbnMgZm9yIFNwYXJ0YWN1c1xuICogQHBhcmFtIG5nRXhwcmVzc0VuZ2luZVxuICovXG5leHBvcnQgY2xhc3MgTmdFeHByZXNzRW5naW5lRGVjb3JhdG9yIHtcbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGhpZ2hlciBvcmRlciBuZ0V4cHJlc3NFbmdpbmUgd2l0aCBwcm92aWRlZCB0b2tlbnMgZm9yIFNwYXJ0YWN1c1xuICAgKlxuICAgKiBAcGFyYW0gbmdFeHByZXNzRW5naW5lXG4gICAqL1xuICBzdGF0aWMgZ2V0KG5nRXhwcmVzc0VuZ2luZTogTmdFeHByZXNzRW5naW5lKTogTmdFeHByZXNzRW5naW5lIHtcbiAgICBjb25zdCByZXN1bHQgPSBmdW5jdGlvbiBjeE5nRXhwcmVzc0VuZ2luZShcbiAgICAgIHNldHVwT3B0aW9uczogTmdTZXR1cE9wdGlvbnNcbiAgICApOiBOZ0V4cHJlc3NFbmdpbmVJbnN0YW5jZSB7XG4gICAgICByZXR1cm4gKGZpbGVQYXRoLCBvcHRpb25zLCBjYWxsYmFjaykgPT4ge1xuICAgICAgICBjb25zdCBlbmdpbmVJbnN0YW5jZSA9IG5nRXhwcmVzc0VuZ2luZSh7XG4gICAgICAgICAgLi4uc2V0dXBPcHRpb25zLFxuICAgICAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICAgICAgLi4uZ2V0U2VydmVyUmVxdWVzdFByb3ZpZGVycyhvcHRpb25zKSxcbiAgICAgICAgICAgIC4uLihzZXR1cE9wdGlvbnMucHJvdmlkZXJzIHx8IFtdKSxcbiAgICAgICAgICBdLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGVuZ2luZUluc3RhbmNlKGZpbGVQYXRoLCBvcHRpb25zLCBjYWxsYmFjayk7XG4gICAgICB9O1xuICAgIH07XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxufVxuXG4vKipcbiAqIFJldHVybnMgU3BhcnRhY3VzJyBwcm92aWRlcnMgdG8gYmUgcGFzc2VkIHRvIHRoZSBBbmd1bGFyIGV4cHJlc3MgZW5naW5lIChpbiBTU1IpXG4gKlxuICogQHBhcmFtIG9wdGlvbnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFNlcnZlclJlcXVlc3RQcm92aWRlcnMoXG4gIG9wdGlvbnM6IFJlbmRlck9wdGlvbnNcbik6IFN0YXRpY1Byb3ZpZGVyW10ge1xuICByZXR1cm4gW1xuICAgIHtcbiAgICAgIHByb3ZpZGU6IFNFUlZFUl9SRVFVRVNUX1VSTCxcbiAgICAgIHVzZVZhbHVlOiBnZXRSZXF1ZXN0VXJsKG9wdGlvbnMucmVxKSxcbiAgICB9LFxuICAgIHtcbiAgICAgIHByb3ZpZGU6IFNFUlZFUl9SRVFVRVNUX09SSUdJTixcbiAgICAgIHVzZVZhbHVlOiBnZXRSZXF1ZXN0T3JpZ2luKG9wdGlvbnMucmVxKSxcbiAgICB9LFxuICBdO1xufVxuXG5mdW5jdGlvbiBnZXRSZXF1ZXN0VXJsKHJlcTogYW55KTogc3RyaW5nIHtcbiAgcmV0dXJuIGdldFJlcXVlc3RPcmlnaW4ocmVxKSArIHJlcS5vcmlnaW5hbFVybDtcbn1cblxuZnVuY3Rpb24gZ2V0UmVxdWVzdE9yaWdpbihyZXE6IGFueSk6IHN0cmluZyB7XG4gIHJldHVybiByZXEucHJvdG9jb2wgKyAnOi8vJyArIHJlcS5nZXQoJ2hvc3QnKTtcbn1cbiJdfQ==