import { __spread, __decorate, __assign, __values, __extends, __param, __read, __rest, __awaiter, __generator } from 'tslib';
import { InjectionToken, Optional, NgModule, isDevMode, ɵɵdefineInjectable, ɵɵinject, Injectable, Inject, PLATFORM_ID, Injector, INJECTOR, APP_INITIALIZER, Pipe, inject, NgZone, TemplateRef, ViewContainerRef, Input, Directive, ChangeDetectorRef } from '@angular/core';
import { CommonModule, DOCUMENT, isPlatformBrowser, isPlatformServer, Location, getLocaleId, DatePipe } from '@angular/common';
import { createFeatureSelector, createSelector, select, Store, INIT, UPDATE, META_REDUCERS, combineReducers, StoreModule, ActionsSubject } from '@ngrx/store';
import { of, fromEvent, throwError, EMPTY, iif, combineLatest, forkJoin, Observable, Subject, Subscription, BehaviorSubject, NEVER, timer, from, queueScheduler, using, merge, defer } from 'rxjs';
import { map, take, filter, switchMap, debounceTime, startWith, distinctUntilChanged, tap, catchError, exhaustMap, mergeMap, withLatestFrom, pluck, shareReplay, share, concatMap, mapTo, switchMapTo, bufferCount, delay, debounce, groupBy, observeOn, distinctUntilKeyChanged, takeWhile, auditTime } from 'rxjs/operators';
import { HttpHeaders, HttpErrorResponse, HttpParams, HTTP_INTERCEPTORS, HttpClient, HttpClientModule, HttpResponse } from '@angular/common/http';
import { PRIMARY_OUTLET, Router, DefaultUrlSerializer, NavigationStart, NavigationEnd, NavigationError, NavigationCancel, UrlSerializer, ActivatedRoute, RouterModule } from '@angular/router';
import { ofType, Actions, Effect, EffectsModule, createEffect } from '@ngrx/effects';
import { makeStateKey, TransferState, Meta } from '@angular/platform-browser';
import { ROUTER_NAVIGATED, ROUTER_CANCEL, ROUTER_ERROR, ROUTER_NAVIGATION, RouterStateSerializer, StoreRouterConnectingModule } from '@ngrx/router-store';
import i18next from 'i18next';
import i18nextXhrBackend from 'i18next-xhr-backend';

function isObject(item) {
    return item && typeof item === 'object' && !Array.isArray(item);
}
function deepMerge(target) {
    var _a, _b, _c;
    if (target === void 0) { target = {}; }
    var sources = [];
    for (var _i = 1; _i < arguments.length; _i++) {
        sources[_i - 1] = arguments[_i];
    }
    if (!sources.length) {
        return target;
    }
    var source = sources.shift() || {};
    if (isObject(target) && isObject(source)) {
        for (var key in source) {
            if (source[key] instanceof Date) {
                Object.assign(target, (_a = {}, _a[key] = source[key], _a));
            }
            else if (isObject(source[key])) {
                if (!target[key]) {
                    Object.assign(target, (_b = {}, _b[key] = {}, _b));
                }
                deepMerge(target[key], source[key]);
            }
            else {
                Object.assign(target, (_c = {}, _c[key] = source[key], _c));
            }
        }
    }
    return deepMerge.apply(void 0, __spread([target], sources));
}

/**
 * Global Configuration injection token, can be used to inject configuration to any part of the app
 */
var Config = new InjectionToken('Configuration');
/**
 * Config chunk token, can be used to provide configuration chunk and contribute to the global configuration object.
 * Should not be used directly, use `provideConfig` or import `ConfigModule.withConfig` instead.
 */
var ConfigChunk = new InjectionToken('ConfigurationChunk');
/**
 * Config chunk token, can be used to provide configuration chunk and contribute to the default configuration.
 * Should not be used directly, use `provideDefaultConfig` or `provideDefaultConfigFactory` instead.
 *
 * General rule is, that all config provided in libraries should be provided as default config.
 */
var DefaultConfigChunk = new InjectionToken('DefaultConfigurationChunk');
/**
 * Helper function to provide configuration chunk using ConfigChunk token
 *
 * To provide default configuration in libraries provideDefaultConfig should be used instead.
 *
 * @param config Config object to merge with the global configuration
 */
function provideConfig(config, defaultConfig) {
    if (config === void 0) { config = {}; }
    if (defaultConfig === void 0) { defaultConfig = false; }
    return {
        provide: defaultConfig ? DefaultConfigChunk : ConfigChunk,
        useValue: config,
        multi: true,
    };
}
/**
 * Helper function to provide configuration with factory function, using ConfigChunk token
 *
 * To provide default configuration in libraries provideDefaultConfigFactory should be used instead.
 *
 * @param configFactory Factory Function that will generate config object
 * @param deps Optional dependencies to a factory function
 */
function provideConfigFactory(configFactory, deps, defaultConfig) {
    if (defaultConfig === void 0) { defaultConfig = false; }
    return {
        provide: defaultConfig ? DefaultConfigChunk : ConfigChunk,
        useFactory: configFactory,
        multi: true,
        deps: deps,
    };
}
/**
 * Helper function to provide default configuration chunk using DefaultConfigChunk token
 *
 * @param config Config object to merge with the default configuration
 */
function provideDefaultConfig(config) {
    if (config === void 0) { config = {}; }
    return {
        provide: DefaultConfigChunk,
        useValue: config,
        multi: true,
    };
}
/**
 * Helper function to provide default configuration with factory function, using DefaultConfigChunk token
 *
 * @param configFactory Factory Function that will generate config object
 * @param deps Optional dependencies to a factory function
 */
function provideDefaultConfigFactory(configFactory, deps) {
    return {
        provide: DefaultConfigChunk,
        useFactory: configFactory,
        multi: true,
        deps: deps,
    };
}
/**
 * Factory function that merges all configurations chunks. Should not be used directly without explicit reason.
 *
 */
function configurationFactory(configChunks, defaultConfigChunks) {
    if (configChunks === void 0) { configChunks = []; }
    if (defaultConfigChunks === void 0) { defaultConfigChunks = []; }
    var config = deepMerge.apply(void 0, __spread([{}], (defaultConfigChunks !== null && defaultConfigChunks !== void 0 ? defaultConfigChunks : []), (configChunks !== null && configChunks !== void 0 ? configChunks : [])));
    return config;
}
var ConfigModule = /** @class */ (function () {
    function ConfigModule() {
    }
    ConfigModule_1 = ConfigModule;
    /**
     * Import ConfigModule and contribute config to the global configuration
     *
     * To provide default configuration in libraries provideDefaultConfig should be used instead.
     *
     * @param config Config object to merge with the global configuration
     */
    ConfigModule.withConfig = function (config) {
        return {
            ngModule: ConfigModule_1,
            providers: [provideConfig(config)],
        };
    };
    /**
     * Import ConfigModule and contribute config to the global configuration using factory function
     *
     * To provide default configuration in libraries provideDefaultConfigFactory should be used instead.
     *
     * @param configFactory Factory function that will generate configuration
     * @param deps Optional dependencies to factory function
     */
    ConfigModule.withConfigFactory = function (configFactory, deps) {
        return {
            ngModule: ConfigModule_1,
            providers: [provideConfigFactory(configFactory, deps)],
        };
    };
    /**
     * Module with providers, should be imported only once, if possible, at the root of the app.
     *
     * @param config
     */
    ConfigModule.forRoot = function (config) {
        if (config === void 0) { config = {}; }
        return {
            ngModule: ConfigModule_1,
            providers: [
                provideConfig(config),
                {
                    provide: Config,
                    useFactory: configurationFactory,
                    deps: [
                        [new Optional(), ConfigChunk],
                        [new Optional(), DefaultConfigChunk],
                    ],
                },
            ],
        };
    };
    var ConfigModule_1;
    ConfigModule = ConfigModule_1 = __decorate([
        NgModule({
            imports: [CommonModule],
            declarations: [],
        })
    ], ConfigModule);
    return ConfigModule;
}());

var defaultAnonymousConsentsConfig = {
    anonymousConsents: {
        registerConsent: 'MARKETING_NEWSLETTER',
        showLegalDescriptionInDialog: true,
        requiredConsents: [],
        consentManagementPage: {
            showAnonymousConsents: true,
            hideConsents: [],
        },
    },
};

var defaultAuthConfig = {
    authentication: {
        client_id: 'mobile_android',
        client_secret: 'secret',
    },
    backend: {
        occ: {
            endpoints: {
                login: '/authorizationserver/oauth/token',
                revoke: '/authorizationserver/oauth/revoke',
            },
        },
    },
};

var USE_CLIENT_TOKEN = 'cx-use-client-token';
var USE_CUSTOMER_SUPPORT_AGENT_TOKEN = 'cx-use-csagent-token';
var TOKEN_REVOCATION_HEADER = 'cx-token-revocation';
var InterceptorUtil = /** @class */ (function () {
    function InterceptorUtil() {
    }
    InterceptorUtil.createHeader = function (headerName, interceptorParam, headers) {
        if (headers) {
            return headers.append(headerName, JSON.stringify(interceptorParam));
        }
        headers = new HttpHeaders().set(headerName, JSON.stringify(interceptorParam));
        return headers;
    };
    InterceptorUtil.removeHeader = function (headerName, request) {
        var updatedHeaders = request.headers.delete(headerName);
        return request.clone({ headers: updatedHeaders });
    };
    InterceptorUtil.getInterceptorParam = function (headerName, headers) {
        var rawValue = headers.get(headerName);
        if (rawValue) {
            return JSON.parse(rawValue);
        }
        return undefined;
    };
    return InterceptorUtil;
}());

var OCC_USER_ID_CURRENT = 'current';
var OCC_USER_ID_ANONYMOUS = 'anonymous';
var OCC_USER_ID_GUEST = 'guest';
var OCC_CART_ID_CURRENT = 'current';

var ENTITY_REMOVE_ACTION = '[ENTITY] REMOVE';
var ENTITY_REMOVE_ALL_ACTION = '[ENTITY] REMOVE ALL';
function entityMeta(type, id) {
    return {
        entityType: type,
        entityId: id,
    };
}
function entityRemoveMeta(type, id) {
    return {
        entityId: id,
        entityType: type,
        entityRemove: true,
    };
}
function entityRemoveAllMeta(type) {
    return {
        entityId: null,
        entityType: type,
        entityRemove: true,
    };
}
var EntityRemoveAction = /** @class */ (function () {
    function EntityRemoveAction(entityType, id) {
        this.type = ENTITY_REMOVE_ACTION;
        this.meta = entityRemoveMeta(entityType, id);
    }
    return EntityRemoveAction;
}());
var EntityRemoveAllAction = /** @class */ (function () {
    function EntityRemoveAllAction(entityType) {
        this.type = ENTITY_REMOVE_ALL_ACTION;
        this.meta = entityRemoveAllMeta(entityType);
    }
    return EntityRemoveAllAction;
}());

var LOADER_LOAD_ACTION = '[LOADER] LOAD';
var LOADER_FAIL_ACTION = '[LOADER] FAIL';
var LOADER_SUCCESS_ACTION = '[LOADER] SUCCESS';
var LOADER_RESET_ACTION = '[LOADER] RESET';
function loadMeta(entityType) {
    return {
        entityType: entityType,
        loader: {
            load: true,
        },
    };
}
function failMeta(entityType, error) {
    return {
        entityType: entityType,
        loader: {
            error: error ? error : true,
        },
    };
}
function successMeta(entityType) {
    return {
        entityType: entityType,
        loader: {
            success: true,
        },
    };
}
function resetMeta(entityType) {
    return {
        entityType: entityType,
        loader: {},
    };
}
var LoaderLoadAction = /** @class */ (function () {
    function LoaderLoadAction(entityType) {
        this.type = LOADER_LOAD_ACTION;
        this.meta = loadMeta(entityType);
    }
    return LoaderLoadAction;
}());
var LoaderFailAction = /** @class */ (function () {
    function LoaderFailAction(entityType, error) {
        this.type = LOADER_FAIL_ACTION;
        this.meta = failMeta(entityType, error);
    }
    return LoaderFailAction;
}());
var LoaderSuccessAction = /** @class */ (function () {
    function LoaderSuccessAction(entityType) {
        this.type = LOADER_SUCCESS_ACTION;
        this.meta = successMeta(entityType);
    }
    return LoaderSuccessAction;
}());
var LoaderResetAction = /** @class */ (function () {
    function LoaderResetAction(entityType) {
        this.type = LOADER_RESET_ACTION;
        this.meta = resetMeta(entityType);
    }
    return LoaderResetAction;
}());

var ENTITY_LOAD_ACTION = '[ENTITY] LOAD';
var ENTITY_FAIL_ACTION = '[ENTITY] LOAD FAIL';
var ENTITY_SUCCESS_ACTION = '[ENTITY] LOAD SUCCESS';
var ENTITY_RESET_ACTION = '[ENTITY] RESET';
function entityLoadMeta(entityType, id) {
    return __assign(__assign({}, loadMeta(entityType)), entityMeta(entityType, id));
}
function entityFailMeta(entityType, id, error) {
    return __assign(__assign({}, failMeta(entityType, error)), entityMeta(entityType, id));
}
function entitySuccessMeta(entityType, id) {
    return __assign(__assign({}, successMeta(entityType)), entityMeta(entityType, id));
}
function entityResetMeta(entityType, id) {
    return __assign(__assign({}, resetMeta(entityType)), entityMeta(entityType, id));
}
var EntityLoadAction = /** @class */ (function () {
    function EntityLoadAction(entityType, id) {
        this.type = ENTITY_LOAD_ACTION;
        this.meta = entityLoadMeta(entityType, id);
    }
    return EntityLoadAction;
}());
var EntityFailAction = /** @class */ (function () {
    function EntityFailAction(entityType, id, error) {
        this.type = ENTITY_FAIL_ACTION;
        this.meta = entityFailMeta(entityType, id, error);
    }
    return EntityFailAction;
}());
var EntitySuccessAction = /** @class */ (function () {
    function EntitySuccessAction(entityType, id, payload) {
        this.payload = payload;
        this.type = ENTITY_SUCCESS_ACTION;
        this.meta = entitySuccessMeta(entityType, id);
    }
    return EntitySuccessAction;
}());
var EntityLoaderResetAction = /** @class */ (function () {
    function EntityLoaderResetAction(entityType, id) {
        this.type = ENTITY_RESET_ACTION;
        this.meta = entityResetMeta(entityType, id);
    }
    return EntityLoaderResetAction;
}());

var initialLoaderState = {
    loading: false,
    error: false,
    success: false,
    value: undefined,
};
/**
 * Higher order reducer that adds generic loading flag to chunk of the state
 *
 * Utilizes "loader" meta field of actions to set specific flags for specific
 * action (LOAD, SUCCESS, FAIL, RESET)
 */
function loaderReducer(entityType, reducer) {
    return function (state, action) {
        if (state === void 0) { state = initialLoaderState; }
        if (action.meta &&
            action.meta.loader &&
            action.meta.entityType === entityType) {
            var entity = action.meta.loader;
            if (entity.load) {
                return __assign(__assign({}, state), { loading: true, value: reducer ? reducer(state.value, action) : state.value });
            }
            else if (entity.error) {
                return __assign(__assign({}, state), { loading: false, error: true, success: false, value: reducer ? reducer(state.value, action) : undefined });
            }
            else if (entity.success) {
                return __assign(__assign({}, state), { value: reducer ? reducer(state.value, action) : action.payload, loading: false, error: false, success: true });
            }
            else {
                // reset state action
                return __assign(__assign({}, initialLoaderState), { value: reducer
                        ? reducer(initialLoaderState.value, action)
                        : initialLoaderState.value });
            }
        }
        if (reducer) {
            var newValue = reducer(state.value, action);
            if (newValue !== state.value) {
                return __assign(__assign({}, state), { value: newValue });
            }
        }
        return state;
    };
}

function loaderValueSelector(state) {
    return state.value;
}
function loaderLoadingSelector(state) {
    return state.loading;
}
function loaderErrorSelector(state) {
    return state.error;
}
function loaderSuccessSelector(state) {
    return state.success;
}

function entityLoaderStateSelector(state, id) {
    return state.entities[id] || initialLoaderState;
}
function entityValueSelector(state, id) {
    var entityState = entityLoaderStateSelector(state, id);
    return loaderValueSelector(entityState);
}
function entityLoadingSelector(state, id) {
    var entityState = entityLoaderStateSelector(state, id);
    return loaderLoadingSelector(entityState);
}
function entityErrorSelector(state, id) {
    var entityState = entityLoaderStateSelector(state, id);
    return loaderErrorSelector(entityState);
}
function entitySuccessSelector(state, id) {
    var entityState = entityLoaderStateSelector(state, id);
    return loaderSuccessSelector(entityState);
}

var initialEntityState = { entities: {} };
/**
 * Higher order reducer for reusing reducer logic for multiple entities
 *
 * Utilizes entityId meta field to target entity by id in actions
 */
function entityReducer(entityType, reducer) {
    return function (state, action) {
        if (state === void 0) { state = initialEntityState; }
        var ids;
        var partitionPayload = false;
        if (action.meta &&
            action.meta.entityType === entityType &&
            action.meta.entityId !== undefined) {
            ids = [].concat(action.meta.entityId);
            // remove selected entities
            if (action.meta.entityRemove) {
                if (action.meta.entityId === null) {
                    return initialEntityState;
                }
                else {
                    var removed_1 = false;
                    var newEntities = Object.keys(state.entities).reduce(function (acc, cur) {
                        if (ids.includes(cur)) {
                            removed_1 = true;
                        }
                        else {
                            acc[cur] = state.entities[cur];
                        }
                        return acc;
                    }, {});
                    return removed_1 ? { entities: newEntities } : state;
                }
            }
            partitionPayload =
                Array.isArray(action.meta.entityId) && Array.isArray(action.payload);
        }
        else {
            ids = Object.keys(state.entities);
        }
        var entityUpdates = {};
        for (var i = 0; i < ids.length; i++) {
            var id = ids[i];
            var subAction = partitionPayload
                ? __assign(__assign({}, action), { payload: action.payload[i] }) : action;
            var newState = reducer(state.entities[id], subAction);
            if (newState) {
                entityUpdates[id] = newState;
            }
        }
        if (Object.keys(entityUpdates).length > 0) {
            return __assign(__assign({}, state), { entities: __assign(__assign({}, state.entities), entityUpdates) });
        }
        return state;
    };
}

/**
 * Higher order reducer that wraps LoaderReducer and EntityReducer enhancing
 * single state reducer to support multiple entities with generic loading flags
 */
function entityLoaderReducer(entityType, reducer) {
    return entityReducer(entityType, loaderReducer(entityType, reducer));
}

var PROCESSES_INCREMENT_ACTION = '[PROCESSES LOADER] INCREMENT';
var PROCESSES_DECREMENT_ACTION = '[PROCESSES LOADER] DECREMENT';
var PROCESSES_LOADER_RESET_ACTION = '[PROCESSES LOADER] RESET';
function processesIncrementMeta(entityType) {
    return {
        entityType: entityType,
        loader: undefined,
        processesCountDiff: 1,
    };
}
function processesDecrementMeta(entityType) {
    return {
        entityType: entityType,
        loader: undefined,
        processesCountDiff: -1,
    };
}
function processesLoaderResetMeta(entityType) {
    // processes reset action is a reset action for loader reducer, but not the other way around
    return __assign(__assign({}, resetMeta(entityType)), { processesCountDiff: null });
}
var ProcessesLoaderResetAction = /** @class */ (function () {
    function ProcessesLoaderResetAction(entityType) {
        this.type = PROCESSES_LOADER_RESET_ACTION;
        this.meta = processesLoaderResetMeta(entityType);
    }
    return ProcessesLoaderResetAction;
}());
var ProcessesIncrementAction = /** @class */ (function () {
    function ProcessesIncrementAction(entityType) {
        this.type = PROCESSES_INCREMENT_ACTION;
        this.meta = processesIncrementMeta(entityType);
    }
    return ProcessesIncrementAction;
}());
var ProcessesDecrementAction = /** @class */ (function () {
    function ProcessesDecrementAction(entityType) {
        this.type = PROCESSES_DECREMENT_ACTION;
        this.meta = processesDecrementMeta(entityType);
    }
    return ProcessesDecrementAction;
}());

var ENTITY_PROCESSES_LOADER_RESET_ACTION = '[ENTITY] PROCESSES LOADER RESET';
var ENTITY_PROCESSES_INCREMENT_ACTION = '[ENTITY] PROCESSES INCREMENT';
var ENTITY_PROCESSES_DECREMENT_ACTION = '[ENTITY] PROCESSES DECREMENT';
function entityProcessesLoaderResetMeta(entityType, id) {
    return __assign(__assign({}, processesLoaderResetMeta(entityType)), entityMeta(entityType, id));
}
function entityProcessesIncrementMeta(entityType, id) {
    return __assign(__assign({}, processesIncrementMeta(entityType)), entityMeta(entityType, id));
}
function entityProcessesDecrementMeta(entityType, id) {
    return __assign(__assign({}, processesDecrementMeta(entityType)), entityMeta(entityType, id));
}
var EntityProcessesLoaderResetAction = /** @class */ (function () {
    function EntityProcessesLoaderResetAction(entityType, id) {
        this.type = ENTITY_PROCESSES_LOADER_RESET_ACTION;
        this.meta = entityProcessesLoaderResetMeta(entityType, id);
    }
    return EntityProcessesLoaderResetAction;
}());
var EntityProcessesIncrementAction = /** @class */ (function () {
    function EntityProcessesIncrementAction(entityType, id) {
        this.type = ENTITY_PROCESSES_INCREMENT_ACTION;
        this.meta = entityProcessesIncrementMeta(entityType, id);
    }
    return EntityProcessesIncrementAction;
}());
var EntityProcessesDecrementAction = /** @class */ (function () {
    function EntityProcessesDecrementAction(entityType, id) {
        this.type = ENTITY_PROCESSES_DECREMENT_ACTION;
        this.meta = entityProcessesDecrementMeta(entityType, id);
    }
    return EntityProcessesDecrementAction;
}());

function isStableSelector(state) {
    return state.processesCount === 0 && !state.loading;
}
function hasPendingProcessesSelector(state) {
    return state.processesCount > 0;
}

var initialProcessesState = {
    processesCount: 0,
};
/**
 * Higher order reducer that adds processes count
 */
function processesLoaderReducer(entityType, reducer) {
    return function (state, action) {
        if (state === void 0) { state = __assign(__assign({}, initialProcessesState), initialLoaderState); }
        var loaderState = loaderReducer(entityType, reducer)(state, action);
        if (action.meta && action.meta.entityType === entityType) {
            var processesCountDiff = action.meta.processesCountDiff;
            if (isDevMode() && state.processesCount + processesCountDiff < 0) {
                console.error("Action '" + action.type + "' sets processesCount to value < 0!\n" +
                    'Make sure to keep processesCount in sync.\n' +
                    'There should always be only one decrement action for each increment action.\n' +
                    "Make sure that you don't reset state in between those actions.\n", action);
            }
            if (processesCountDiff) {
                return __assign(__assign({}, loaderState), { processesCount: state.processesCount
                        ? state.processesCount + processesCountDiff
                        : processesCountDiff });
            }
            else if (processesCountDiff === null) {
                // reset action
                return __assign(__assign({}, loaderState), initialProcessesState);
            }
        }
        return loaderState;
    };
}

var initialProcessesLoaderState = __assign(__assign({}, initialLoaderState), initialProcessesState);
function entityHasPendingProcessesSelector(state, id) {
    var entityState = entityLoaderStateSelector(state, id);
    return hasPendingProcessesSelector(entityState);
}
function entityIsStableSelector(state, id) {
    var entityState = entityLoaderStateSelector(state, id);
    return isStableSelector(entityState);
}
function entityProcessesLoaderStateSelector(state, id) {
    return state.entities[id] || initialProcessesLoaderState;
}

/**
 * Higher order reducer that wraps ProcessesLoaderReducer and EntityReducer enhancing
 * single state reducer to support multiple entities with generic processesCount flag
 */
function entityProcessesLoaderReducer(entityType, reducer) {
    return entityReducer(entityType, processesLoaderReducer(entityType, reducer));
}

function entitySelector(state, id) {
    return state.entities[id] || undefined;
}

var OBJECT_SEPARATOR = '.';
function getStateSliceValue(keys, state) {
    return keys
        .split(OBJECT_SEPARATOR)
        .reduce(function (previous, current) { return (previous ? previous[current] : undefined); }, state);
}
function createShellObject(key, excludeKeys, value) {
    if (!key || !value || Object.keys(value).length === 0) {
        return {};
    }
    var shell = key.split(OBJECT_SEPARATOR).reduceRight(function (acc, previous) {
        var _a;
        return _a = {}, _a[previous] = acc, _a;
    }, value);
    return handleExclusions(key, excludeKeys, shell);
}
function getStateSlice(keys, excludeKeys, state) {
    var e_1, _a;
    if (keys && keys.length === 0) {
        return {};
    }
    var stateSlices = {};
    try {
        for (var keys_1 = __values(keys), keys_1_1 = keys_1.next(); !keys_1_1.done; keys_1_1 = keys_1.next()) {
            var currentKey = keys_1_1.value;
            var stateValue = getStateSliceValue(currentKey, state);
            var shell = createShellObject(currentKey, excludeKeys, stateValue);
            stateSlices = deepMerge(stateSlices, shell);
        }
    }
    catch (e_1_1) { e_1 = { error: e_1_1 }; }
    finally {
        try {
            if (keys_1_1 && !keys_1_1.done && (_a = keys_1.return)) _a.call(keys_1);
        }
        finally { if (e_1) throw e_1.error; }
    }
    return stateSlices;
}
function handleExclusions(key, excludeKeys, value) {
    var e_2, _a;
    var exclusionKeys = getExclusionKeys(key, excludeKeys);
    if (exclusionKeys.length === 0) {
        return value;
    }
    var finalValue = deepMerge({}, value);
    try {
        for (var exclusionKeys_1 = __values(exclusionKeys), exclusionKeys_1_1 = exclusionKeys_1.next(); !exclusionKeys_1_1.done; exclusionKeys_1_1 = exclusionKeys_1.next()) {
            var currentExclusionKey = exclusionKeys_1_1.value;
            var exclusionChunksSplit = currentExclusionKey.split(OBJECT_SEPARATOR);
            var nestedTemp = finalValue;
            for (var i = 0; i < exclusionChunksSplit.length; i++) {
                var currentChunk = exclusionChunksSplit[i];
                // last iteration
                if (i === exclusionChunksSplit.length - 1) {
                    if (nestedTemp && nestedTemp[currentChunk]) {
                        delete nestedTemp[currentChunk];
                    }
                }
                else {
                    nestedTemp = nestedTemp[currentChunk];
                }
            }
        }
    }
    catch (e_2_1) { e_2 = { error: e_2_1 }; }
    finally {
        try {
            if (exclusionKeys_1_1 && !exclusionKeys_1_1.done && (_a = exclusionKeys_1.return)) _a.call(exclusionKeys_1);
        }
        finally { if (e_2) throw e_2.error; }
    }
    return finalValue;
}
function getExclusionKeys(key, excludeKeys) {
    var e_3, _a;
    if (!key || !excludeKeys) {
        return [];
    }
    var exclusionKeys = [];
    try {
        for (var excludeKeys_1 = __values(excludeKeys), excludeKeys_1_1 = excludeKeys_1.next(); !excludeKeys_1_1.done; excludeKeys_1_1 = excludeKeys_1.next()) {
            var exclusionKey = excludeKeys_1_1.value;
            if (exclusionKey.includes(key)) {
                exclusionKeys.push(exclusionKey);
            }
        }
    }
    catch (e_3_1) { e_3 = { error: e_3_1 }; }
    finally {
        try {
            if (excludeKeys_1_1 && !excludeKeys_1_1.done && (_a = excludeKeys_1.return)) _a.call(excludeKeys_1);
        }
        finally { if (e_3) throw e_3.error; }
    }
    return exclusionKeys;
}
function filterKeysByType(keys, type) {
    if (!keys) {
        return [];
    }
    return Object.keys(keys).filter(function (key) { return keys[key] === type; });
}



var utilsGroup = /*#__PURE__*/Object.freeze({
    __proto__: null,
    getStateSlice: getStateSlice,
    ENTITY_LOAD_ACTION: ENTITY_LOAD_ACTION,
    ENTITY_FAIL_ACTION: ENTITY_FAIL_ACTION,
    ENTITY_SUCCESS_ACTION: ENTITY_SUCCESS_ACTION,
    ENTITY_RESET_ACTION: ENTITY_RESET_ACTION,
    entityLoadMeta: entityLoadMeta,
    entityFailMeta: entityFailMeta,
    entitySuccessMeta: entitySuccessMeta,
    entityResetMeta: entityResetMeta,
    EntityLoadAction: EntityLoadAction,
    EntityFailAction: EntityFailAction,
    EntitySuccessAction: EntitySuccessAction,
    EntityLoaderResetAction: EntityLoaderResetAction,
    entityLoaderStateSelector: entityLoaderStateSelector,
    entityValueSelector: entityValueSelector,
    entityLoadingSelector: entityLoadingSelector,
    entityErrorSelector: entityErrorSelector,
    entitySuccessSelector: entitySuccessSelector,
    entityLoaderReducer: entityLoaderReducer,
    ENTITY_PROCESSES_LOADER_RESET_ACTION: ENTITY_PROCESSES_LOADER_RESET_ACTION,
    ENTITY_PROCESSES_INCREMENT_ACTION: ENTITY_PROCESSES_INCREMENT_ACTION,
    ENTITY_PROCESSES_DECREMENT_ACTION: ENTITY_PROCESSES_DECREMENT_ACTION,
    entityProcessesLoaderResetMeta: entityProcessesLoaderResetMeta,
    entityProcessesIncrementMeta: entityProcessesIncrementMeta,
    entityProcessesDecrementMeta: entityProcessesDecrementMeta,
    EntityProcessesLoaderResetAction: EntityProcessesLoaderResetAction,
    EntityProcessesIncrementAction: EntityProcessesIncrementAction,
    EntityProcessesDecrementAction: EntityProcessesDecrementAction,
    entityHasPendingProcessesSelector: entityHasPendingProcessesSelector,
    entityIsStableSelector: entityIsStableSelector,
    entityProcessesLoaderStateSelector: entityProcessesLoaderStateSelector,
    entityProcessesLoaderReducer: entityProcessesLoaderReducer,
    ENTITY_REMOVE_ACTION: ENTITY_REMOVE_ACTION,
    ENTITY_REMOVE_ALL_ACTION: ENTITY_REMOVE_ALL_ACTION,
    entityMeta: entityMeta,
    entityRemoveMeta: entityRemoveMeta,
    entityRemoveAllMeta: entityRemoveAllMeta,
    EntityRemoveAction: EntityRemoveAction,
    EntityRemoveAllAction: EntityRemoveAllAction,
    entitySelector: entitySelector,
    initialEntityState: initialEntityState,
    entityReducer: entityReducer,
    LOADER_LOAD_ACTION: LOADER_LOAD_ACTION,
    LOADER_FAIL_ACTION: LOADER_FAIL_ACTION,
    LOADER_SUCCESS_ACTION: LOADER_SUCCESS_ACTION,
    LOADER_RESET_ACTION: LOADER_RESET_ACTION,
    loadMeta: loadMeta,
    failMeta: failMeta,
    successMeta: successMeta,
    resetMeta: resetMeta,
    LoaderLoadAction: LoaderLoadAction,
    LoaderFailAction: LoaderFailAction,
    LoaderSuccessAction: LoaderSuccessAction,
    LoaderResetAction: LoaderResetAction,
    loaderValueSelector: loaderValueSelector,
    loaderLoadingSelector: loaderLoadingSelector,
    loaderErrorSelector: loaderErrorSelector,
    loaderSuccessSelector: loaderSuccessSelector,
    initialLoaderState: initialLoaderState,
    loaderReducer: loaderReducer,
    PROCESSES_INCREMENT_ACTION: PROCESSES_INCREMENT_ACTION,
    PROCESSES_DECREMENT_ACTION: PROCESSES_DECREMENT_ACTION,
    PROCESSES_LOADER_RESET_ACTION: PROCESSES_LOADER_RESET_ACTION,
    processesIncrementMeta: processesIncrementMeta,
    processesDecrementMeta: processesDecrementMeta,
    processesLoaderResetMeta: processesLoaderResetMeta,
    ProcessesLoaderResetAction: ProcessesLoaderResetAction,
    ProcessesIncrementAction: ProcessesIncrementAction,
    ProcessesDecrementAction: ProcessesDecrementAction,
    isStableSelector: isStableSelector,
    hasPendingProcessesSelector: hasPendingProcessesSelector,
    initialProcessesState: initialProcessesState,
    processesLoaderReducer: processesLoaderReducer
});

var AUTH_FEATURE = 'auth';
var CLIENT_TOKEN_DATA = '[Auth] Client Token Data';

var LOAD_CLIENT_TOKEN = '[Token] Load Client Token';
var LOAD_CLIENT_TOKEN_FAIL = '[Token] Load Client Token Fail';
var LOAD_CLIENT_TOKEN_SUCCESS = '[Token] Load Client Token Success';
var LoadClientToken = /** @class */ (function (_super) {
    __extends(LoadClientToken, _super);
    function LoadClientToken() {
        var _this = _super.call(this, CLIENT_TOKEN_DATA) || this;
        _this.type = LOAD_CLIENT_TOKEN;
        return _this;
    }
    return LoadClientToken;
}(LoaderLoadAction));
var LoadClientTokenFail = /** @class */ (function (_super) {
    __extends(LoadClientTokenFail, _super);
    function LoadClientTokenFail(payload) {
        var _this = _super.call(this, CLIENT_TOKEN_DATA, payload) || this;
        _this.payload = payload;
        _this.type = LOAD_CLIENT_TOKEN_FAIL;
        return _this;
    }
    return LoadClientTokenFail;
}(LoaderFailAction));
var LoadClientTokenSuccess = /** @class */ (function (_super) {
    __extends(LoadClientTokenSuccess, _super);
    function LoadClientTokenSuccess(payload) {
        var _this = _super.call(this, CLIENT_TOKEN_DATA) || this;
        _this.payload = payload;
        _this.type = LOAD_CLIENT_TOKEN_SUCCESS;
        return _this;
    }
    return LoadClientTokenSuccess;
}(LoaderSuccessAction));

var LOGIN = '[Auth] Login';
var LOGOUT = '[Auth] Logout';
var LOGOUT_CUSTOMER_SUPPORT_AGENT = '[Auth] Logout Customer Support Agent';
var Login = /** @class */ (function () {
    function Login() {
        this.type = LOGIN;
    }
    return Login;
}());
var Logout = /** @class */ (function () {
    function Logout() {
        this.type = LOGOUT;
    }
    return Logout;
}());

var LOAD_USER_TOKEN = '[Auth] Load User Token';
var LOAD_USER_TOKEN_FAIL = '[Auth] Load User Token Fail';
var LOAD_USER_TOKEN_SUCCESS = '[Auth] Load User Token Success';
var REFRESH_USER_TOKEN = '[Auth] Refresh User Token';
var REFRESH_USER_TOKEN_FAIL = '[Auth] Refresh User Token Fail';
var REFRESH_USER_TOKEN_SUCCESS = '[Auth] Refresh User Token Success';
var REVOKE_USER_TOKEN = '[Auth] Revoke User Token';
var REVOKE_USER_TOKEN_FAIL = '[Auth] Revoke User Token Fail';
var REVOKE_USER_TOKEN_SUCCESS = '[Auth] Revoke User Token Success';
var LoadUserToken = /** @class */ (function () {
    function LoadUserToken(payload) {
        this.payload = payload;
        this.type = LOAD_USER_TOKEN;
    }
    return LoadUserToken;
}());
var LoadUserTokenFail = /** @class */ (function () {
    function LoadUserTokenFail(payload) {
        this.payload = payload;
        this.type = LOAD_USER_TOKEN_FAIL;
    }
    return LoadUserTokenFail;
}());
var LoadUserTokenSuccess = /** @class */ (function () {
    function LoadUserTokenSuccess(payload) {
        this.payload = payload;
        this.type = LOAD_USER_TOKEN_SUCCESS;
    }
    return LoadUserTokenSuccess;
}());
var RefreshUserToken = /** @class */ (function () {
    function RefreshUserToken(payload) {
        this.payload = payload;
        this.type = REFRESH_USER_TOKEN;
    }
    return RefreshUserToken;
}());
var RefreshUserTokenSuccess = /** @class */ (function () {
    function RefreshUserTokenSuccess(payload) {
        this.payload = payload;
        this.type = REFRESH_USER_TOKEN_SUCCESS;
    }
    return RefreshUserTokenSuccess;
}());
var RefreshUserTokenFail = /** @class */ (function () {
    function RefreshUserTokenFail(payload) {
        this.payload = payload;
        this.type = REFRESH_USER_TOKEN_FAIL;
    }
    return RefreshUserTokenFail;
}());
var RevokeUserToken = /** @class */ (function () {
    function RevokeUserToken(payload) {
        this.payload = payload;
        this.type = REVOKE_USER_TOKEN;
    }
    return RevokeUserToken;
}());
var RevokeUserTokenSuccess = /** @class */ (function () {
    function RevokeUserTokenSuccess(payload) {
        this.payload = payload;
        this.type = REVOKE_USER_TOKEN_SUCCESS;
    }
    return RevokeUserTokenSuccess;
}());
var RevokeUserTokenFail = /** @class */ (function () {
    function RevokeUserTokenFail(payload) {
        this.payload = payload;
        this.type = REVOKE_USER_TOKEN_FAIL;
    }
    return RevokeUserTokenFail;
}());



var authGroup_actions = /*#__PURE__*/Object.freeze({
    __proto__: null,
    LOAD_CLIENT_TOKEN: LOAD_CLIENT_TOKEN,
    LOAD_CLIENT_TOKEN_FAIL: LOAD_CLIENT_TOKEN_FAIL,
    LOAD_CLIENT_TOKEN_SUCCESS: LOAD_CLIENT_TOKEN_SUCCESS,
    LoadClientToken: LoadClientToken,
    LoadClientTokenFail: LoadClientTokenFail,
    LoadClientTokenSuccess: LoadClientTokenSuccess,
    LOGIN: LOGIN,
    LOGOUT: LOGOUT,
    LOGOUT_CUSTOMER_SUPPORT_AGENT: LOGOUT_CUSTOMER_SUPPORT_AGENT,
    Login: Login,
    Logout: Logout,
    LOAD_USER_TOKEN: LOAD_USER_TOKEN,
    LOAD_USER_TOKEN_FAIL: LOAD_USER_TOKEN_FAIL,
    LOAD_USER_TOKEN_SUCCESS: LOAD_USER_TOKEN_SUCCESS,
    REFRESH_USER_TOKEN: REFRESH_USER_TOKEN,
    REFRESH_USER_TOKEN_FAIL: REFRESH_USER_TOKEN_FAIL,
    REFRESH_USER_TOKEN_SUCCESS: REFRESH_USER_TOKEN_SUCCESS,
    REVOKE_USER_TOKEN: REVOKE_USER_TOKEN,
    REVOKE_USER_TOKEN_FAIL: REVOKE_USER_TOKEN_FAIL,
    REVOKE_USER_TOKEN_SUCCESS: REVOKE_USER_TOKEN_SUCCESS,
    LoadUserToken: LoadUserToken,
    LoadUserTokenFail: LoadUserTokenFail,
    LoadUserTokenSuccess: LoadUserTokenSuccess,
    RefreshUserToken: RefreshUserToken,
    RefreshUserTokenSuccess: RefreshUserTokenSuccess,
    RefreshUserTokenFail: RefreshUserTokenFail,
    RevokeUserToken: RevokeUserToken,
    RevokeUserTokenSuccess: RevokeUserTokenSuccess,
    RevokeUserTokenFail: RevokeUserTokenFail
});

var getAuthState = createFeatureSelector(AUTH_FEATURE);

var ɵ0 = function (state) { return state.clientToken; };
var getClientTokenState = createSelector(getAuthState, ɵ0);

var getUserTokenSelector = function (state) { return state.token; };
var ɵ0$1 = getUserTokenSelector;
var ɵ1 = function (state) { return state.userToken; };
var getUserTokenState = createSelector(getAuthState, ɵ1);
var getUserToken = createSelector(getUserTokenState, getUserTokenSelector);



var authGroup_selectors = /*#__PURE__*/Object.freeze({
    __proto__: null,
    getClientTokenState: getClientTokenState,
    ɵ0: ɵ0,
    getAuthState: getAuthState,
    getUserTokenState: getUserTokenState,
    getUserToken: getUserToken,
    ɵ1: ɵ1
});

var AuthService = /** @class */ (function () {
    function AuthService(store) {
        this.store = store;
    }
    /**
     * Loads a new user token
     * @param userId
     * @param password
     */
    AuthService.prototype.authorize = function (userId, password) {
        this.store.dispatch(new LoadUserToken({
            userId: userId,
            password: password,
        }));
    };
    /**
     * This function provides the userId the OCC calls should use, depending
     * on whether there is an active storefront session or not.
     *
     * It returns the userId of the current storefront user or 'anonymous'
     * in the case there are no signed in user in the storefront.
     *
     * The user id of a regular customer session is 'current'.  In the case of an
     * asm customer emulation session, the userId will be the customerId.
     */
    AuthService.prototype.getOccUserId = function () {
        return this.getUserToken().pipe(map(function (userToken) {
            if (!!userToken && !!userToken.userId) {
                return userToken.userId;
            }
            else {
                return OCC_USER_ID_ANONYMOUS;
            }
        }));
    };
    /**
     * Calls provided callback with current user id.
     *
     * @param cb callback function to invoke
     */
    AuthService.prototype.invokeWithUserId = function (cb) {
        return this.getOccUserId()
            .pipe(take(1))
            .subscribe(function (id) { return cb(id); });
    };
    /**
     * Returns the user's token
     */
    AuthService.prototype.getUserToken = function () {
        return this.store.pipe(select(getUserToken));
    };
    /**
     * Refreshes the user token
     * @param token a user token to refresh
     */
    AuthService.prototype.refreshUserToken = function (token) {
        this.store.dispatch(new RefreshUserToken({
            refreshToken: token.refresh_token,
        }));
    };
    /**
     * Store the provided token
     */
    AuthService.prototype.authorizeWithToken = function (token) {
        this.store.dispatch(new LoadUserTokenSuccess(token));
    };
    /**
     * Logout a storefront customer
     */
    AuthService.prototype.logout = function () {
        var _this = this;
        this.getUserToken()
            .pipe(take(1))
            .subscribe(function (userToken) {
            _this.store.dispatch(new Logout());
            if (Boolean(userToken) && userToken.userId === OCC_USER_ID_CURRENT) {
                _this.store.dispatch(new RevokeUserToken(userToken));
            }
        });
    };
    /**
     * Returns a client token.  The client token from the store is returned if there is one.
     * Otherwise, an new token is fetched from the backend and saved in the store.
     */
    AuthService.prototype.getClientToken = function () {
        var _this = this;
        return this.store.pipe(select(getClientTokenState), filter(function (state) {
            if (_this.isClientTokenLoaded(state)) {
                return true;
            }
            else {
                if (!state.loading) {
                    _this.store.dispatch(new LoadClientToken());
                }
                return false;
            }
        }), map(function (state) { return state.value; }));
    };
    /**
     * Fetches a clientToken from the backend ans saves it in the store where getClientToken can use it.
     * The new clientToken is returned.
     */
    AuthService.prototype.refreshClientToken = function () {
        var _this = this;
        this.store.dispatch(new LoadClientToken());
        return this.store.pipe(select(getClientTokenState), filter(function (state) {
            return _this.isClientTokenLoaded(state);
        }), map(function (state) { return state.value; }));
    };
    AuthService.prototype.isClientTokenLoaded = function (state) {
        return (state.success || state.error) && !state.loading;
    };
    /**
     * Returns `true` if the user is logged in; and `false` if the user is anonymous.
     */
    AuthService.prototype.isUserLoggedIn = function () {
        return this.getUserToken().pipe(map(function (userToken) { return Boolean(userToken) && Boolean(userToken.access_token); }));
    };
    AuthService.ctorParameters = function () { return [
        { type: Store }
    ]; };
    AuthService.ɵprov = ɵɵdefineInjectable({ factory: function AuthService_Factory() { return new AuthService(ɵɵinject(Store)); }, token: AuthService, providedIn: "root" });
    AuthService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], AuthService);
    return AuthService;
}());

var ClientErrorHandlingService = /** @class */ (function () {
    function ClientErrorHandlingService(authService) {
        this.authService = authService;
    }
    ClientErrorHandlingService.prototype.handleExpiredClientToken = function (request, next) {
        var _this = this;
        return this.authService.refreshClientToken().pipe(take(1), switchMap(function (token) {
            return next.handle(_this.createNewRequestWithNewToken(request, token));
        }));
    };
    ClientErrorHandlingService.prototype.createNewRequestWithNewToken = function (request, token) {
        request = request.clone({
            setHeaders: {
                Authorization: token.token_type + " " + token.access_token,
            },
        });
        return request;
    };
    ClientErrorHandlingService.ctorParameters = function () { return [
        { type: AuthService }
    ]; };
    ClientErrorHandlingService.ɵprov = ɵɵdefineInjectable({ factory: function ClientErrorHandlingService_Factory() { return new ClientErrorHandlingService(ɵɵinject(AuthService)); }, token: ClientErrorHandlingService, providedIn: "root" });
    ClientErrorHandlingService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], ClientErrorHandlingService);
    return ClientErrorHandlingService;
}());

var WindowRef = /** @class */ (function () {
    function WindowRef(document) {
        // it's a workaround to have document property properly typed
        // see: https://github.com/angular/angular/issues/15640
        this.document = document;
    }
    Object.defineProperty(WindowRef.prototype, "nativeWindow", {
        get: function () {
            return typeof window !== 'undefined' ? window : undefined;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(WindowRef.prototype, "sessionStorage", {
        get: function () {
            return this.nativeWindow ? this.nativeWindow.sessionStorage : undefined;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(WindowRef.prototype, "localStorage", {
        get: function () {
            return this.nativeWindow ? this.nativeWindow.localStorage : undefined;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(WindowRef.prototype, "resize$", {
        /**
         * Returns an observable for the window resize event and emits an event
         * every 300ms in case of resizing. An event is simulated initially.
         *
         * If there's no window object availale (i.e. in SSR), a null value is emitted.
         */
        get: function () {
            if (!this.nativeWindow) {
                return of(null);
            }
            else {
                return fromEvent(this.nativeWindow, 'resize').pipe(debounceTime(300), startWith({ target: this.nativeWindow }), distinctUntilChanged());
            }
        },
        enumerable: true,
        configurable: true
    });
    WindowRef.ctorParameters = function () { return [
        { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] }
    ]; };
    WindowRef.ɵprov = ɵɵdefineInjectable({ factory: function WindowRef_Factory() { return new WindowRef(ɵɵinject(DOCUMENT)); }, token: WindowRef, providedIn: "root" });
    WindowRef = __decorate([
        Injectable({
            providedIn: 'root',
        }),
        __param(0, Inject(DOCUMENT))
    ], WindowRef);
    return WindowRef;
}());

var UrlParsingService = /** @class */ (function () {
    function UrlParsingService(router) {
        this.router = router;
    }
    UrlParsingService.prototype.getPrimarySegments = function (url) {
        var urlTree = this.router.parseUrl(url);
        return this._getPrimarySegmentsFromUrlTree(urlTree.root);
    };
    UrlParsingService.prototype._getPrimarySegmentsFromUrlTree = function (tree) {
        var segments = tree.segments.map(function (s) { return s.path; });
        var childrenSegments = tree.children[PRIMARY_OUTLET]
            ? this._getPrimarySegmentsFromUrlTree(tree.children[PRIMARY_OUTLET])
            : [];
        return segments.concat(childrenSegments);
    };
    UrlParsingService.ctorParameters = function () { return [
        { type: Router }
    ]; };
    UrlParsingService.ɵprov = ɵɵdefineInjectable({ factory: function UrlParsingService_Factory() { return new UrlParsingService(ɵɵinject(Router)); }, token: UrlParsingService, providedIn: "root" });
    UrlParsingService = __decorate([
        Injectable({ providedIn: 'root' })
    ], UrlParsingService);
    return UrlParsingService;
}());

var isParam = function (segment) { return segment.startsWith(':'); };
var getParamName = function (segment) { return segment.slice(1); }; // it just removes leading ':'
var ensureLeadingSlash = function (path) {
    return path.startsWith('/') ? path : '/' + path;
};
var removeLeadingSlash = function (path) {
    return path.startsWith('/') ? path.slice(1) : path;
};

var RoutingConfig = /** @class */ (function () {
    function RoutingConfig() {
    }
    RoutingConfig.ɵprov = ɵɵdefineInjectable({ factory: function RoutingConfig_Factory() { return ɵɵinject(Config); }, token: RoutingConfig, providedIn: "root" });
    RoutingConfig = __decorate([
        Injectable({
            providedIn: 'root',
            useExisting: Config,
        })
    ], RoutingConfig);
    return RoutingConfig;
}());

var RoutingConfigService = /** @class */ (function () {
    function RoutingConfigService(config) {
        this.config = config;
    }
    RoutingConfigService.prototype.getRouteConfig = function (routeName) {
        var _a, _b;
        var routeConfig = (_b = (_a = this.config) === null || _a === void 0 ? void 0 : _a.routing) === null || _b === void 0 ? void 0 : _b.routes;
        var result = routeConfig && routeConfig[routeName];
        if (!routeConfig || result === undefined) {
            this.warn("No path was configured for the named route '" + routeName + "'!");
        }
        return result;
    };
    RoutingConfigService.prototype.warn = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        if (isDevMode()) {
            console.warn.apply(console, __spread(args));
        }
    };
    RoutingConfigService.prototype.getLoadStrategy = function () {
        var _a, _b, _c;
        return (_c = (_b = (_a = this.config) === null || _a === void 0 ? void 0 : _a.routing) === null || _b === void 0 ? void 0 : _b.loadStrategy) !== null && _c !== void 0 ? _c : "always" /* ALWAYS */;
    };
    RoutingConfigService.ctorParameters = function () { return [
        { type: RoutingConfig }
    ]; };
    RoutingConfigService.ɵprov = ɵɵdefineInjectable({ factory: function RoutingConfigService_Factory() { return new RoutingConfigService(ɵɵinject(RoutingConfig)); }, token: RoutingConfigService, providedIn: "root" });
    RoutingConfigService = __decorate([
        Injectable({ providedIn: 'root' })
    ], RoutingConfigService);
    return RoutingConfigService;
}());

var SemanticPathService = /** @class */ (function () {
    function SemanticPathService(routingConfigService, urlParser) {
        this.routingConfigService = routingConfigService;
        this.urlParser = urlParser;
        this.ROOT_URL = ['/'];
    }
    /**
     * Returns the first path alias configured for a given route name. It adds `/` at the beginning.
     */
    SemanticPathService.prototype.get = function (routeName) {
        var routeConfig = this.routingConfigService.getRouteConfig(routeName);
        return routeConfig && Array.isArray(routeConfig.paths)
            ? '/' + routeConfig.paths[0]
            : undefined;
    };
    /**
     * Transforms the array of url commands. Each command can be:
     * a) string - will be left untouched
     * b) object { cxRoute: <route name> } - will be replaced with semantic path
     * c) object { cxRoute: <route name>, params: { ... } } - same as above, but with passed params
     *
     * If the first command is the object with the `cxRoute` property, returns an absolute url (with the first element of the array `'/'`)
     */
    SemanticPathService.prototype.transform = function (commands) {
        var e_1, _a;
        if (!Array.isArray(commands)) {
            commands = [commands];
        }
        var result = [];
        try {
            for (var commands_1 = __values(commands), commands_1_1 = commands_1.next(); !commands_1_1.done; commands_1_1 = commands_1.next()) {
                var command = commands_1_1.value;
                if (!this.isRouteCommand(command)) {
                    // don't modify segment that is not route command:
                    result.push(command);
                }
                else {
                    // generate array with url segments for given route command:
                    var partialResult = this.generateUrlPart(command);
                    if (partialResult === null) {
                        return this.ROOT_URL;
                    }
                    result.push.apply(result, __spread(partialResult));
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (commands_1_1 && !commands_1_1.done && (_a = commands_1.return)) _a.call(commands_1);
            }
            finally { if (e_1) throw e_1.error; }
        }
        if (this.shouldOutputAbsolute(commands)) {
            result.unshift('/');
        }
        return result;
    };
    SemanticPathService.prototype.isRouteCommand = function (command) {
        return command && Boolean(command.cxRoute);
    };
    SemanticPathService.prototype.shouldOutputAbsolute = function (commands) {
        return this.isRouteCommand(commands[0]);
    };
    SemanticPathService.prototype.generateUrlPart = function (command) {
        this.standarizeRouteCommand(command);
        if (!command.cxRoute) {
            return null;
        }
        var routeConfig = this.routingConfigService.getRouteConfig(command.cxRoute);
        // if no route translation was configured, return null:
        if (!routeConfig || !routeConfig.paths) {
            return null;
        }
        // find first path that can satisfy it's parameters with given parameters
        var path = this.findPathWithFillableParams(routeConfig, command.params);
        // if there is no configured path that can be satisfied with given params, return null
        if (!path) {
            return null;
        }
        var result = this.provideParamsValues(path, command.params, routeConfig.paramsMapping);
        return result;
    };
    SemanticPathService.prototype.standarizeRouteCommand = function (command) {
        command.params = command.params || {};
    };
    SemanticPathService.prototype.provideParamsValues = function (path, params, paramsMapping) {
        var _this = this;
        return this.urlParser.getPrimarySegments(path).map(function (segment) {
            if (isParam(segment)) {
                var paramName = getParamName(segment);
                var mappedParamName = _this.getMappedParamName(paramName, paramsMapping);
                return params[mappedParamName];
            }
            return segment;
        });
    };
    SemanticPathService.prototype.findPathWithFillableParams = function (routeConfig, params) {
        var _this = this;
        var foundPath = routeConfig.paths.find(function (path) {
            return _this.getParams(path).every(function (paramName) {
                var mappedParamName = _this.getMappedParamName(paramName, routeConfig.paramsMapping);
                return params[mappedParamName] !== undefined;
            });
        });
        if (foundPath === undefined || foundPath === null) {
            this.warn("No configured path matches all its params to given object. ", "Route config: ", routeConfig, "Params object: ", params);
            return null;
        }
        return foundPath;
    };
    SemanticPathService.prototype.getParams = function (path) {
        return this.urlParser
            .getPrimarySegments(path)
            .filter(isParam)
            .map(getParamName);
    };
    SemanticPathService.prototype.getMappedParamName = function (paramName, paramsMapping) {
        if (paramsMapping) {
            return paramsMapping[paramName] || paramName;
        }
        return paramName;
    };
    SemanticPathService.prototype.warn = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        if (isDevMode()) {
            console.warn.apply(console, __spread(args));
        }
    };
    SemanticPathService.ctorParameters = function () { return [
        { type: RoutingConfigService },
        { type: UrlParsingService }
    ]; };
    SemanticPathService.ɵprov = ɵɵdefineInjectable({ factory: function SemanticPathService_Factory() { return new SemanticPathService(ɵɵinject(RoutingConfigService), ɵɵinject(UrlParsingService)); }, token: SemanticPathService, providedIn: "root" });
    SemanticPathService = __decorate([
        Injectable({ providedIn: 'root' })
    ], SemanticPathService);
    return SemanticPathService;
}());

var ROUTER_GO = '[Router] Go';
var ROUTER_GO_BY_URL = '[Router] Go By Url';
var ROUTER_BACK = '[Router] Back';
var ROUTER_FORWARD = '[Router] Forward';
var RouteGoAction = /** @class */ (function () {
    function RouteGoAction(payload) {
        this.payload = payload;
        this.type = ROUTER_GO;
    }
    return RouteGoAction;
}());
var RouteGoByUrlAction = /** @class */ (function () {
    function RouteGoByUrlAction(payload) {
        this.payload = payload;
        this.type = ROUTER_GO_BY_URL;
    }
    return RouteGoByUrlAction;
}());
var RouteBackAction = /** @class */ (function () {
    function RouteBackAction() {
        this.type = ROUTER_BACK;
    }
    return RouteBackAction;
}());
var RouteForwardAction = /** @class */ (function () {
    function RouteForwardAction() {
        this.type = ROUTER_FORWARD;
    }
    return RouteForwardAction;
}());



var routingGroup_actions = /*#__PURE__*/Object.freeze({
    __proto__: null,
    ROUTER_GO: ROUTER_GO,
    ROUTER_GO_BY_URL: ROUTER_GO_BY_URL,
    ROUTER_BACK: ROUTER_BACK,
    ROUTER_FORWARD: ROUTER_FORWARD,
    RouteGoAction: RouteGoAction,
    RouteGoByUrlAction: RouteGoByUrlAction,
    RouteBackAction: RouteBackAction,
    RouteForwardAction: RouteForwardAction
});

var ROUTING_FEATURE = 'router';

var getRouterFeatureState = createFeatureSelector(ROUTING_FEATURE);
var ɵ0$2 = function (state) { return state.router; };
var getRouterState = createSelector(getRouterFeatureState, ɵ0$2);
var ɵ1$1 = function (routingState) {
    return (routingState.state && routingState.state.context) || { id: '' };
};
var getPageContext = createSelector(getRouterState, ɵ1$1);
var ɵ2 = function (routingState) {
    return routingState.nextState && routingState.nextState.context;
};
var getNextPageContext = createSelector(getRouterState, ɵ2);
var ɵ3 = function (context) { return !!context; };
var isNavigating = createSelector(getNextPageContext, ɵ3);



var routingGroup_selectors = /*#__PURE__*/Object.freeze({
    __proto__: null,
    getRouterFeatureState: getRouterFeatureState,
    getRouterState: getRouterState,
    getPageContext: getPageContext,
    getNextPageContext: getNextPageContext,
    isNavigating: isNavigating,
    ɵ0: ɵ0$2,
    ɵ1: ɵ1$1,
    ɵ2: ɵ2,
    ɵ3: ɵ3
});

var RoutingService = /** @class */ (function () {
    function RoutingService(store, winRef, semanticPathService) {
        this.store = store;
        this.winRef = winRef;
        this.semanticPathService = semanticPathService;
    }
    /**
     * Get the current router state
     */
    RoutingService.prototype.getRouterState = function () {
        return this.store.pipe(select(getRouterState));
    };
    /**
     * Get the `PageContext` from the state
     */
    RoutingService.prototype.getPageContext = function () {
        return this.store.pipe(select(getPageContext));
    };
    /**
     * Get the next `PageContext` from the state
     */
    RoutingService.prototype.getNextPageContext = function () {
        return this.store.pipe(select(getNextPageContext));
    };
    /**
     * Get the `isNavigating` info from the state
     */
    RoutingService.prototype.isNavigating = function () {
        return this.store.pipe(select(isNavigating));
    };
    /**
     * Navigation with a new state into history
     * @param commands: url commands
     * @param query
     * @param extras: Represents the extra options used during navigation.
     */
    RoutingService.prototype.go = function (commands, query, extras) {
        var path = this.semanticPathService.transform(commands);
        return this.navigate(path, query, extras);
    };
    /**
     * Navigation using URL
     * @param url
     */
    RoutingService.prototype.goByUrl = function (url) {
        this.store.dispatch(new RouteGoByUrlAction(url));
    };
    /**
     * Navigating back
     */
    RoutingService.prototype.back = function () {
        var isLastPageInApp = this.winRef.document.referrer.includes(this.winRef.nativeWindow.location.origin);
        if (isLastPageInApp) {
            this.store.dispatch(new RouteBackAction());
            return;
        }
        this.go(['/']);
        return;
    };
    /**
     * Navigating forward
     */
    RoutingService.prototype.forward = function () {
        this.store.dispatch(new RouteForwardAction());
    };
    /**
     * Navigation with a new state into history
     * @param path
     * @param query
     * @param extras: Represents the extra options used during navigation.
     */
    RoutingService.prototype.navigate = function (path, query, extras) {
        this.store.dispatch(new RouteGoAction({
            path: path,
            query: query,
            extras: extras,
        }));
    };
    RoutingService.ctorParameters = function () { return [
        { type: Store },
        { type: WindowRef },
        { type: SemanticPathService }
    ]; };
    RoutingService.ɵprov = ɵɵdefineInjectable({ factory: function RoutingService_Factory() { return new RoutingService(ɵɵinject(Store), ɵɵinject(WindowRef), ɵɵinject(SemanticPathService)); }, token: RoutingService, providedIn: "root" });
    RoutingService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], RoutingService);
    return RoutingService;
}());

var UserErrorHandlingService = /** @class */ (function () {
    function UserErrorHandlingService(authService, routingService) {
        this.authService = authService;
        this.routingService = routingService;
    }
    UserErrorHandlingService.prototype.handleExpiredUserToken = function (request, next) {
        var _this = this;
        return this.handleExpiredToken().pipe(switchMap(function (token) {
            return next.handle(_this.createNewRequestWithNewToken(request, token));
        }));
    };
    UserErrorHandlingService.prototype.handleExpiredRefreshToken = function () {
        // Logout user
        this.authService.logout();
    };
    UserErrorHandlingService.prototype.handleExpiredToken = function () {
        var _this = this;
        var oldToken;
        return this.authService.getUserToken().pipe(tap(function (token) {
            if (token.access_token && token.refresh_token && !oldToken) {
                _this.authService.refreshUserToken(token);
            }
            else if (!token.access_token && !token.refresh_token) {
                _this.routingService.go({ cxRoute: 'login' });
            }
            else if (!token.refresh_token) {
                _this.authService.logout();
                _this.routingService.go({ cxRoute: 'login' });
            }
            oldToken = oldToken || token;
        }), filter(function (token) { return oldToken.access_token !== token.access_token; }), take(1));
    };
    UserErrorHandlingService.prototype.createNewRequestWithNewToken = function (request, token) {
        request = request.clone({
            setHeaders: {
                Authorization: token.token_type + " " + token.access_token,
            },
        });
        return request;
    };
    UserErrorHandlingService.ctorParameters = function () { return [
        { type: AuthService },
        { type: RoutingService }
    ]; };
    UserErrorHandlingService.ɵprov = ɵɵdefineInjectable({ factory: function UserErrorHandlingService_Factory() { return new UserErrorHandlingService(ɵɵinject(AuthService), ɵɵinject(RoutingService)); }, token: UserErrorHandlingService, providedIn: "root" });
    UserErrorHandlingService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], UserErrorHandlingService);
    return UserErrorHandlingService;
}());

var OAUTH_ENDPOINT = '/authorizationserver/oauth/token';
var AuthErrorInterceptor = /** @class */ (function () {
    function AuthErrorInterceptor(userErrorHandlingService, clientErrorHandlingService, authService) {
        this.userErrorHandlingService = userErrorHandlingService;
        this.clientErrorHandlingService = clientErrorHandlingService;
        this.authService = authService;
    }
    AuthErrorInterceptor.prototype.intercept = function (request, next) {
        var _this = this;
        var isClientTokenRequest = this.isClientTokenRequest(request);
        if (isClientTokenRequest) {
            request = InterceptorUtil.removeHeader(USE_CLIENT_TOKEN, request);
        }
        return next.handle(request).pipe(catchError(function (errResponse) {
            if (errResponse instanceof HttpErrorResponse) {
                switch (errResponse.status) {
                    case 401: // Unauthorized
                        if (isClientTokenRequest) {
                            if (_this.isExpiredToken(errResponse)) {
                                return _this.clientErrorHandlingService.handleExpiredClientToken(request, next);
                            }
                            // user token request
                        }
                        else {
                            if (_this.isExpiredToken(errResponse)) {
                                return _this.userErrorHandlingService.handleExpiredUserToken(request, next);
                            }
                            else if (
                            // Refresh expired token
                            // Check that the OAUTH endpoint was called and the error is for refresh token is expired
                            errResponse.url.includes(OAUTH_ENDPOINT) &&
                                errResponse.error.error === 'invalid_token') {
                                _this.userErrorHandlingService.handleExpiredRefreshToken();
                                return of();
                            }
                        }
                        break;
                    case 400: // Bad Request
                        if (errResponse.url.includes(OAUTH_ENDPOINT) &&
                            errResponse.error.error === 'invalid_grant') {
                            if (request.body.get('grant_type') === 'refresh_token') {
                                // refresh token fail, force user logout
                                _this.authService.logout();
                            }
                        }
                        break;
                }
            }
            return throwError(errResponse);
        }));
    };
    AuthErrorInterceptor.prototype.isClientTokenRequest = function (request) {
        var isRequestMapping = InterceptorUtil.getInterceptorParam(USE_CLIENT_TOKEN, request.headers);
        return Boolean(isRequestMapping);
    };
    AuthErrorInterceptor.prototype.isExpiredToken = function (resp) {
        if (resp.error &&
            resp.error.errors &&
            resp.error.errors instanceof Array &&
            resp.error.errors[0]) {
            return resp.error.errors[0].type === 'InvalidTokenError';
        }
        return false;
    };
    AuthErrorInterceptor.ctorParameters = function () { return [
        { type: UserErrorHandlingService },
        { type: ClientErrorHandlingService },
        { type: AuthService }
    ]; };
    AuthErrorInterceptor.ɵprov = ɵɵdefineInjectable({ factory: function AuthErrorInterceptor_Factory() { return new AuthErrorInterceptor(ɵɵinject(UserErrorHandlingService), ɵɵinject(ClientErrorHandlingService), ɵɵinject(AuthService)); }, token: AuthErrorInterceptor, providedIn: "root" });
    AuthErrorInterceptor = __decorate([
        Injectable({ providedIn: 'root' })
    ], AuthErrorInterceptor);
    return AuthErrorInterceptor;
}());

var DynamicTemplate = /** @class */ (function () {
    function DynamicTemplate() {
    }
    DynamicTemplate.resolve = function (templateString, templateVariables) {
        var e_1, _a;
        try {
            for (var _b = __values(Object.keys(templateVariables)), _c = _b.next(); !_c.done; _c = _b.next()) {
                var variableLabel = _c.value;
                var placeholder = new RegExp('\\${' + variableLabel + '}', 'g');
                templateString = templateString.replace(placeholder, templateVariables[variableLabel]);
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
        return templateString;
    };
    return DynamicTemplate;
}());

/**
 * Helper function for safely getting context parameter config
 *
 * @param config
 * @param parameter
 */
function getContextParameterValues(config, parameter) {
    return (config.context && config.context[parameter]) || [];
}
/**
 * Helper function for calculating default value for context parameter from config
 *
 * @param config
 * @param parameter
 */
function getContextParameterDefault(config, parameter) {
    var param = getContextParameterValues(config, parameter);
    return param && param.length ? param[0] : undefined;
}

var SiteContextConfig = /** @class */ (function () {
    function SiteContextConfig() {
    }
    SiteContextConfig.ɵprov = ɵɵdefineInjectable({ factory: function SiteContextConfig_Factory() { return ɵɵinject(Config); }, token: SiteContextConfig, providedIn: "root" });
    SiteContextConfig = __decorate([
        Injectable({
            providedIn: 'root',
            useExisting: Config,
        })
    ], SiteContextConfig);
    return SiteContextConfig;
}());

var LANGUAGE_CONTEXT_ID = 'language';
var CURRENCY_CONTEXT_ID = 'currency';
var BASE_SITE_CONTEXT_ID = 'baseSite';

var LOAD_BASE_SITE = '[Site-context] Load BaseSite';
var LOAD_BASE_SITE_FAIL = '[Site-context] Load BaseSite Fail';
var LOAD_BASE_SITE_SUCCESS = '[Site-context] Load BaseSite Success';
var SET_ACTIVE_BASE_SITE = '[Site-context] Set Active BaseSite';
var BASE_SITE_CHANGE = '[Site-context] BaseSite Change';
var LoadBaseSite = /** @class */ (function () {
    function LoadBaseSite() {
        this.type = LOAD_BASE_SITE;
    }
    return LoadBaseSite;
}());
var LoadBaseSiteFail = /** @class */ (function () {
    function LoadBaseSiteFail(payload) {
        this.payload = payload;
        this.type = LOAD_BASE_SITE_FAIL;
    }
    return LoadBaseSiteFail;
}());
var LoadBaseSiteSuccess = /** @class */ (function () {
    function LoadBaseSiteSuccess(payload) {
        this.payload = payload;
        this.type = LOAD_BASE_SITE_SUCCESS;
    }
    return LoadBaseSiteSuccess;
}());
var SetActiveBaseSite = /** @class */ (function () {
    function SetActiveBaseSite(payload) {
        this.payload = payload;
        this.type = SET_ACTIVE_BASE_SITE;
    }
    return SetActiveBaseSite;
}());
var BaseSiteChange = /** @class */ (function () {
    function BaseSiteChange() {
        this.type = BASE_SITE_CHANGE;
    }
    return BaseSiteChange;
}());

var LOAD_CURRENCIES = '[Site-context] Load Currencies';
var LOAD_CURRENCIES_FAIL = '[Site-context] Load Currencies Fail';
var LOAD_CURRENCIES_SUCCESS = '[Site-context] Load Currencies Success';
var SET_ACTIVE_CURRENCY = '[Site-context] Set Active Currency';
var CURRENCY_CHANGE = '[Site-context] Currency Change';
var LoadCurrencies = /** @class */ (function () {
    function LoadCurrencies() {
        this.type = LOAD_CURRENCIES;
    }
    return LoadCurrencies;
}());
var LoadCurrenciesFail = /** @class */ (function () {
    function LoadCurrenciesFail(payload) {
        this.payload = payload;
        this.type = LOAD_CURRENCIES_FAIL;
    }
    return LoadCurrenciesFail;
}());
var LoadCurrenciesSuccess = /** @class */ (function () {
    function LoadCurrenciesSuccess(payload) {
        this.payload = payload;
        this.type = LOAD_CURRENCIES_SUCCESS;
    }
    return LoadCurrenciesSuccess;
}());
var SetActiveCurrency = /** @class */ (function () {
    function SetActiveCurrency(payload) {
        this.payload = payload;
        this.type = SET_ACTIVE_CURRENCY;
    }
    return SetActiveCurrency;
}());
var CurrencyChange = /** @class */ (function () {
    function CurrencyChange(payload) {
        this.payload = payload;
        this.type = CURRENCY_CHANGE;
    }
    return CurrencyChange;
}());

var LOAD_LANGUAGES = '[Site-context] Load Languages';
var LOAD_LANGUAGES_FAIL = '[Site-context] Load Languages Fail';
var LOAD_LANGUAGES_SUCCESS = '[Site-context] Load Languages Success';
var SET_ACTIVE_LANGUAGE = '[Site-context] Set Active Language';
var LANGUAGE_CHANGE = '[Site-context] Language Change';
var LoadLanguages = /** @class */ (function () {
    function LoadLanguages() {
        this.type = LOAD_LANGUAGES;
    }
    return LoadLanguages;
}());
var LoadLanguagesFail = /** @class */ (function () {
    function LoadLanguagesFail(payload) {
        this.payload = payload;
        this.type = LOAD_LANGUAGES_FAIL;
    }
    return LoadLanguagesFail;
}());
var LoadLanguagesSuccess = /** @class */ (function () {
    function LoadLanguagesSuccess(payload) {
        this.payload = payload;
        this.type = LOAD_LANGUAGES_SUCCESS;
    }
    return LoadLanguagesSuccess;
}());
var SetActiveLanguage = /** @class */ (function () {
    function SetActiveLanguage(payload) {
        this.payload = payload;
        this.type = SET_ACTIVE_LANGUAGE;
    }
    return SetActiveLanguage;
}());
var LanguageChange = /** @class */ (function () {
    function LanguageChange(payload) {
        this.payload = payload;
        this.type = LANGUAGE_CHANGE;
    }
    return LanguageChange;
}());



var siteContextGroup_actions = /*#__PURE__*/Object.freeze({
    __proto__: null,
    LOAD_BASE_SITE: LOAD_BASE_SITE,
    LOAD_BASE_SITE_FAIL: LOAD_BASE_SITE_FAIL,
    LOAD_BASE_SITE_SUCCESS: LOAD_BASE_SITE_SUCCESS,
    SET_ACTIVE_BASE_SITE: SET_ACTIVE_BASE_SITE,
    BASE_SITE_CHANGE: BASE_SITE_CHANGE,
    LoadBaseSite: LoadBaseSite,
    LoadBaseSiteFail: LoadBaseSiteFail,
    LoadBaseSiteSuccess: LoadBaseSiteSuccess,
    SetActiveBaseSite: SetActiveBaseSite,
    BaseSiteChange: BaseSiteChange,
    LOAD_CURRENCIES: LOAD_CURRENCIES,
    LOAD_CURRENCIES_FAIL: LOAD_CURRENCIES_FAIL,
    LOAD_CURRENCIES_SUCCESS: LOAD_CURRENCIES_SUCCESS,
    SET_ACTIVE_CURRENCY: SET_ACTIVE_CURRENCY,
    CURRENCY_CHANGE: CURRENCY_CHANGE,
    LoadCurrencies: LoadCurrencies,
    LoadCurrenciesFail: LoadCurrenciesFail,
    LoadCurrenciesSuccess: LoadCurrenciesSuccess,
    SetActiveCurrency: SetActiveCurrency,
    CurrencyChange: CurrencyChange,
    LOAD_LANGUAGES: LOAD_LANGUAGES,
    LOAD_LANGUAGES_FAIL: LOAD_LANGUAGES_FAIL,
    LOAD_LANGUAGES_SUCCESS: LOAD_LANGUAGES_SUCCESS,
    SET_ACTIVE_LANGUAGE: SET_ACTIVE_LANGUAGE,
    LANGUAGE_CHANGE: LANGUAGE_CHANGE,
    LoadLanguages: LoadLanguages,
    LoadLanguagesFail: LoadLanguagesFail,
    LoadLanguagesSuccess: LoadLanguagesSuccess,
    SetActiveLanguage: SetActiveLanguage,
    LanguageChange: LanguageChange
});

var SITE_CONTEXT_FEATURE = 'siteContext';

var getSiteContextState = createFeatureSelector(SITE_CONTEXT_FEATURE);

var ɵ0$3 = function (state) {
    return state && state.baseSite && state.baseSite.activeSite;
};
var getActiveBaseSite = createSelector(getSiteContextState, ɵ0$3);
var ɵ1$2 = function (state) { return state && state.baseSite && state.baseSite.details; };
var getBaseSiteData = createSelector(getSiteContextState, ɵ1$2);

var currenciesEntitiesSelector = function (state) { return state.entities; };
var ɵ0$4 = currenciesEntitiesSelector;
var activeCurrencySelector = function (state) { return state.activeCurrency; };
var ɵ1$3 = activeCurrencySelector;
var ɵ2$1 = function (state) { return state.currencies; };
var getCurrenciesState = createSelector(getSiteContextState, ɵ2$1);
var getCurrenciesEntities = createSelector(getCurrenciesState, currenciesEntitiesSelector);
var getActiveCurrency = createSelector(getCurrenciesState, activeCurrencySelector);
var ɵ3$1 = function (entities) {
    return entities
        ? Object.keys(entities).map(function (isocode) { return entities[isocode]; })
        : null;
};
var getAllCurrencies = createSelector(getCurrenciesEntities, ɵ3$1);

var activeLanguageSelector = function (state) { return state.activeLanguage; };
var ɵ0$5 = activeLanguageSelector;
var languagesEntitiesSelector = function (state) { return state.entities; };
var ɵ1$4 = languagesEntitiesSelector;
var ɵ2$2 = function (state) { return state.languages; };
var getLanguagesState = createSelector(getSiteContextState, ɵ2$2);
var getLanguagesEntities = createSelector(getLanguagesState, languagesEntitiesSelector);
var getActiveLanguage = createSelector(getLanguagesState, activeLanguageSelector);
var ɵ3$2 = function (entities) {
    return entities
        ? Object.keys(entities).map(function (isocode) { return entities[isocode]; })
        : null;
};
var getAllLanguages = createSelector(getLanguagesEntities, ɵ3$2);



var siteContextGroup_selectors = /*#__PURE__*/Object.freeze({
    __proto__: null,
    getActiveBaseSite: getActiveBaseSite,
    getBaseSiteData: getBaseSiteData,
    ɵ0: ɵ0$3,
    ɵ1: ɵ1$2,
    getCurrenciesState: getCurrenciesState,
    getCurrenciesEntities: getCurrenciesEntities,
    getActiveCurrency: getActiveCurrency,
    getAllCurrencies: getAllCurrencies,
    ɵ2: ɵ2$1,
    ɵ3: ɵ3$1,
    getLanguagesState: getLanguagesState,
    getLanguagesEntities: getLanguagesEntities,
    getActiveLanguage: getActiveLanguage,
    getAllLanguages: getAllLanguages,
    getSiteContextState: getSiteContextState
});

var BaseSiteService = /** @class */ (function () {
    function BaseSiteService(store, config) {
        this.store = store;
        this.config = config;
    }
    /**
     * Represents the current baseSite uid.
     */
    BaseSiteService.prototype.getActive = function () {
        return this.store.pipe(select(getActiveBaseSite), filter(function (active) { return Boolean(active); }));
    };
    /**
     * We currently don't support switching baseSite at run time
     */
    BaseSiteService.prototype.getAll = function () {
        return this.getActive().pipe(map(function (baseSite) { return [baseSite]; }));
    };
    BaseSiteService.prototype.setActive = function (baseSite) {
        var _this = this;
        return this.store
            .pipe(select(getActiveBaseSite), take(1))
            .subscribe(function (activeBaseSite) {
            if (baseSite && activeBaseSite !== baseSite) {
                _this.store.dispatch(new SetActiveBaseSite(baseSite));
            }
        });
    };
    /**
     * Initializes the active baseSite.
     */
    BaseSiteService.prototype.initialize = function () {
        var value;
        this.getActive()
            .subscribe(function (val) { return (value = val); })
            .unsubscribe();
        if (value) {
            // don't initialize, if there is already a value (i.e. retrieved from route or transferred from SSR)
            return;
        }
        this.setActive(getContextParameterDefault(this.config, BASE_SITE_CONTEXT_ID));
    };
    /**
     * Get the base site details data
     */
    BaseSiteService.prototype.getBaseSiteData = function () {
        var _this = this;
        return this.store.pipe(select(getBaseSiteData), tap(function (baseSite) {
            if (Object.keys(baseSite).length === 0) {
                _this.store.dispatch(new LoadBaseSite());
            }
        }));
    };
    BaseSiteService.ctorParameters = function () { return [
        { type: Store },
        { type: SiteContextConfig }
    ]; };
    BaseSiteService = __decorate([
        Injectable()
    ], BaseSiteService);
    return BaseSiteService;
}());

var CustomEncoder = /** @class */ (function () {
    function CustomEncoder() {
    }
    CustomEncoder.prototype.encodeKey = function (key) {
        return encodeURIComponent(key);
    };
    CustomEncoder.prototype.encodeValue = function (value) {
        return encodeURIComponent(value);
    };
    CustomEncoder.prototype.decodeKey = function (key) {
        return decodeURIComponent(key);
    };
    CustomEncoder.prototype.decodeValue = function (value) {
        return decodeURIComponent(value);
    };
    return CustomEncoder;
}());

var OccConfig = /** @class */ (function (_super) {
    __extends(OccConfig, _super);
    function OccConfig() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    OccConfig.ɵprov = ɵɵdefineInjectable({ factory: function OccConfig_Factory() { return ɵɵinject(Config); }, token: OccConfig, providedIn: "root" });
    OccConfig = __decorate([
        Injectable({
            providedIn: 'root',
            useExisting: Config,
        })
    ], OccConfig);
    return OccConfig;
}(SiteContextConfig));

var DEFAULT_SCOPE = 'default';

var OccEndpointsService = /** @class */ (function () {
    function OccEndpointsService(config, baseSiteService) {
        var _this = this;
        this.config = config;
        this.baseSiteService = baseSiteService;
        this.activeBaseSite =
            getContextParameterDefault(this.config, BASE_SITE_CONTEXT_ID) || '';
        if (this.baseSiteService) {
            this.baseSiteService
                .getActive()
                .subscribe(function (value) { return (_this.activeBaseSite = value); });
        }
    }
    /**
     * Returns and endpoint starting from the OCC baseUrl (no baseSite)
     * @param endpoint Endpoint suffix
     */
    OccEndpointsService.prototype.getRawEndpoint = function (endpoint) {
        var _a, _b, _c;
        if (!((_b = (_a = this.config) === null || _a === void 0 ? void 0 : _a.backend) === null || _b === void 0 ? void 0 : _b.occ)) {
            return '';
        }
        endpoint = (_c = this.config.backend.occ.endpoints) === null || _c === void 0 ? void 0 : _c[endpoint];
        if (!endpoint.startsWith('/')) {
            endpoint = '/' + endpoint;
        }
        return this.config.backend.occ.baseUrl + endpoint;
    };
    /**
     * Returns base OCC endpoint (baseUrl + prefix + baseSite)
     */
    OccEndpointsService.prototype.getBaseEndpoint = function () {
        var _a, _b;
        if (!((_b = (_a = this.config) === null || _a === void 0 ? void 0 : _a.backend) === null || _b === void 0 ? void 0 : _b.occ)) {
            return '';
        }
        return ((this.config.backend.occ.baseUrl || '') +
            this.config.backend.occ.prefix +
            this.activeBaseSite);
    };
    /**
     * Returns an OCC endpoint including baseUrl and baseSite
     * @param endpoint Endpoint suffix
     */
    OccEndpointsService.prototype.getEndpoint = function (endpoint) {
        if (!endpoint.startsWith('/')) {
            endpoint = '/' + endpoint;
        }
        return this.getBaseEndpoint() + endpoint;
    };
    /**
     * Returns a fully qualified OCC Url (including baseUrl and baseSite)
     * @param endpoint Name of the OCC endpoint key config
     * @param urlParams  URL parameters
     * @param queryParams Query parameters
     * @param scope
     */
    OccEndpointsService.prototype.getUrl = function (endpoint, urlParams, queryParams, scope) {
        var _a;
        endpoint = this.getEndpointForScope(endpoint, scope);
        if (urlParams) {
            Object.keys(urlParams).forEach(function (key) {
                urlParams[key] = encodeURIComponent(urlParams[key]);
            });
            endpoint = DynamicTemplate.resolve(endpoint, urlParams);
        }
        if (queryParams) {
            var httpParamsOptions = { encoder: new CustomEncoder() };
            if (endpoint.includes('?')) {
                var queryParamsFromEndpoint = void 0;
                _a = __read(endpoint.split('?'), 2), endpoint = _a[0], queryParamsFromEndpoint = _a[1];
                httpParamsOptions = __assign(__assign({}, httpParamsOptions), { fromString: queryParamsFromEndpoint });
            }
            var httpParams_1 = new HttpParams(httpParamsOptions);
            Object.keys(queryParams).forEach(function (key) {
                var value = queryParams[key];
                if (value !== undefined) {
                    if (value === null) {
                        httpParams_1 = httpParams_1.delete(key);
                    }
                    else {
                        httpParams_1 = httpParams_1.set(key, value);
                    }
                }
            });
            var params = httpParams_1.toString();
            if (params.length) {
                endpoint += '?' + params;
            }
        }
        return this.getEndpoint(endpoint);
    };
    OccEndpointsService.prototype.getEndpointForScope = function (endpoint, scope) {
        var _a, _b;
        var endpointsConfig = (_b = (_a = this.config.backend) === null || _a === void 0 ? void 0 : _a.occ) === null || _b === void 0 ? void 0 : _b.endpoints;
        var endpointConfig = endpointsConfig[endpoint];
        if (scope) {
            if (endpointConfig === null || endpointConfig === void 0 ? void 0 : endpointConfig[scope]) {
                return endpointConfig === null || endpointConfig === void 0 ? void 0 : endpointConfig[scope];
            }
            if (scope === DEFAULT_SCOPE && typeof endpointConfig === 'string') {
                return endpointConfig;
            }
            if (isDevMode()) {
                console.warn(endpoint + " endpoint configuration missing for scope \"" + scope + "\"");
            }
        }
        return ((typeof endpointConfig === 'string'
            ? endpointConfig
            : endpointConfig === null || endpointConfig === void 0 ? void 0 : endpointConfig[DEFAULT_SCOPE]) || endpoint);
    };
    OccEndpointsService.ctorParameters = function () { return [
        { type: OccConfig },
        { type: BaseSiteService, decorators: [{ type: Optional }] }
    ]; };
    OccEndpointsService.ɵprov = ɵɵdefineInjectable({ factory: function OccEndpointsService_Factory() { return new OccEndpointsService(ɵɵinject(OccConfig), ɵɵinject(BaseSiteService, 8)); }, token: OccEndpointsService, providedIn: "root" });
    OccEndpointsService = __decorate([
        Injectable({
            providedIn: 'root',
        }),
        __param(1, Optional())
    ], OccEndpointsService);
    return OccEndpointsService;
}());

var ClientTokenInterceptor = /** @class */ (function () {
    function ClientTokenInterceptor(authService, occEndpoints) {
        this.authService = authService;
        this.occEndpoints = occEndpoints;
    }
    ClientTokenInterceptor.prototype.intercept = function (request, next) {
        var _this = this;
        return this.getClientToken(request).pipe(take(1), switchMap(function (token) {
            if (token &&
                request.url.includes(_this.occEndpoints.getBaseEndpoint())) {
                request = request.clone({
                    setHeaders: {
                        Authorization: token.token_type + " " + token.access_token,
                    },
                });
            }
            return next.handle(request);
        }));
    };
    ClientTokenInterceptor.prototype.getClientToken = function (request) {
        if (InterceptorUtil.getInterceptorParam(USE_CLIENT_TOKEN, request.headers)) {
            return this.authService.getClientToken();
        }
        return of(null);
    };
    ClientTokenInterceptor.ctorParameters = function () { return [
        { type: AuthService },
        { type: OccEndpointsService }
    ]; };
    ClientTokenInterceptor.ɵprov = ɵɵdefineInjectable({ factory: function ClientTokenInterceptor_Factory() { return new ClientTokenInterceptor(ɵɵinject(AuthService), ɵɵinject(OccEndpointsService)); }, token: ClientTokenInterceptor, providedIn: "root" });
    ClientTokenInterceptor = __decorate([
        Injectable({ providedIn: 'root' })
    ], ClientTokenInterceptor);
    return ClientTokenInterceptor;
}());

var UserTokenInterceptor = /** @class */ (function () {
    function UserTokenInterceptor(authService, occEndpoints) {
        this.authService = authService;
        this.occEndpoints = occEndpoints;
    }
    UserTokenInterceptor.prototype.intercept = function (request, next) {
        var _this = this;
        return this.authService.getUserToken().pipe(take(1), switchMap(function (token) {
            if (token &&
                _this.isOccUrl(request.url) &&
                !request.headers.get('Authorization')) {
                request = request.clone({
                    setHeaders: {
                        Authorization: token.token_type + " " + token.access_token,
                    },
                });
            }
            return next.handle(request);
        }));
    };
    UserTokenInterceptor.prototype.isOccUrl = function (url) {
        return url.includes(this.occEndpoints.getBaseEndpoint());
    };
    UserTokenInterceptor.ctorParameters = function () { return [
        { type: AuthService },
        { type: OccEndpointsService }
    ]; };
    UserTokenInterceptor.ɵprov = ɵɵdefineInjectable({ factory: function UserTokenInterceptor_Factory() { return new UserTokenInterceptor(ɵɵinject(AuthService), ɵɵinject(OccEndpointsService)); }, token: UserTokenInterceptor, providedIn: "root" });
    UserTokenInterceptor = __decorate([
        Injectable({ providedIn: 'root' })
    ], UserTokenInterceptor);
    return UserTokenInterceptor;
}());

var TokenRevocationInterceptor = /** @class */ (function () {
    function TokenRevocationInterceptor() {
    }
    TokenRevocationInterceptor.prototype.intercept = function (request, next) {
        var isTokenRevocationRequest = this.isTokenRevocationRequest(request);
        if (isTokenRevocationRequest) {
            request = InterceptorUtil.removeHeader(TOKEN_REVOCATION_HEADER, request);
        }
        return next.handle(request).pipe(catchError(function (error) {
            if (isTokenRevocationRequest) {
                return EMPTY;
            }
            return throwError(error);
        }));
    };
    TokenRevocationInterceptor.prototype.isTokenRevocationRequest = function (request) {
        var isTokenRevocationHeaderPresent = InterceptorUtil.getInterceptorParam(TOKEN_REVOCATION_HEADER, request.headers);
        return Boolean(isTokenRevocationHeaderPresent);
    };
    TokenRevocationInterceptor.ɵprov = ɵɵdefineInjectable({ factory: function TokenRevocationInterceptor_Factory() { return new TokenRevocationInterceptor(); }, token: TokenRevocationInterceptor, providedIn: "root" });
    TokenRevocationInterceptor = __decorate([
        Injectable({ providedIn: 'root' })
    ], TokenRevocationInterceptor);
    return TokenRevocationInterceptor;
}());

var interceptors = [
    {
        provide: HTTP_INTERCEPTORS,
        useExisting: ClientTokenInterceptor,
        multi: true,
    },
    {
        provide: HTTP_INTERCEPTORS,
        useExisting: UserTokenInterceptor,
        multi: true,
    },
    {
        provide: HTTP_INTERCEPTORS,
        useExisting: AuthErrorInterceptor,
        multi: true,
    },
    {
        provide: HTTP_INTERCEPTORS,
        useExisting: TokenRevocationInterceptor,
        multi: true,
    },
];

var StorageSyncType;
(function (StorageSyncType) {
    StorageSyncType["NO_STORAGE"] = "NO_STORAGE";
    StorageSyncType["LOCAL_STORAGE"] = "LOCAL_STORAGE";
    StorageSyncType["SESSION_STORAGE"] = "SESSION_STORAGE";
})(StorageSyncType || (StorageSyncType = {}));
var StateTransferType;
(function (StateTransferType) {
    StateTransferType["TRANSFER_STATE"] = "SSR";
})(StateTransferType || (StateTransferType = {}));
var StateConfig = /** @class */ (function () {
    function StateConfig() {
    }
    StateConfig.ɵprov = ɵɵdefineInjectable({ factory: function StateConfig_Factory() { return ɵɵinject(Config); }, token: StateConfig, providedIn: "root" });
    StateConfig = __decorate([
        Injectable({
            providedIn: 'root',
            useExisting: Config,
        })
    ], StateConfig);
    return StateConfig;
}());

var DEFAULT_LOCAL_STORAGE_KEY = 'spartacus-local-data';
var DEFAULT_SESSION_STORAGE_KEY = 'spartacus-session-data';
var defaultStateConfig = {
    state: {
        storageSync: {
            localStorageKeyName: DEFAULT_LOCAL_STORAGE_KEY,
            sessionStorageKeyName: DEFAULT_SESSION_STORAGE_KEY,
            keys: {},
            excludeKeys: {},
        },
    },
};

function getStorageSyncReducer(winRef, config) {
    if (!winRef.nativeWindow ||
        !config ||
        !config.state ||
        !config.state.storageSync ||
        !config.state.storageSync.keys) {
        return function (reducer) { return reducer; };
    }
    var storageSyncConfig = config.state.storageSync;
    return function (reducer) {
        return function (state, action) {
            var newState = reducer(state, action);
            if (action.type === INIT || action.type === UPDATE) {
                var rehydratedState = rehydrate(config, winRef);
                return deepMerge({}, newState, rehydratedState);
            }
            if (action.type !== INIT) {
                // handle local storage
                var localStorageKeys = filterKeysByType(storageSyncConfig.keys, StorageSyncType.LOCAL_STORAGE);
                var localStorageExclusionKeys = filterKeysByType(storageSyncConfig.excludeKeys, StorageSyncType.LOCAL_STORAGE);
                var localStorageStateSlices = getStateSlice(localStorageKeys, localStorageExclusionKeys, newState);
                persistToStorage(config.state.storageSync.localStorageKeyName, localStorageStateSlices, winRef.localStorage);
                // handle session storage
                var sessionStorageKeys = filterKeysByType(storageSyncConfig.keys, StorageSyncType.SESSION_STORAGE);
                var sessionStorageExclusionKeys = filterKeysByType(storageSyncConfig.excludeKeys, StorageSyncType.SESSION_STORAGE);
                var sessionStorageStateSlices = getStateSlice(sessionStorageKeys, sessionStorageExclusionKeys, newState);
                persistToStorage(config.state.storageSync.sessionStorageKeyName, sessionStorageStateSlices, winRef.sessionStorage);
            }
            return newState;
        };
    };
}
function rehydrate(config, winRef) {
    var localStorageValue = readFromStorage(winRef.localStorage, config.state.storageSync.localStorageKeyName);
    var sessionStorageValue = readFromStorage(winRef.sessionStorage, config.state.storageSync.sessionStorageKeyName);
    return deepMerge(localStorageValue, sessionStorageValue);
}
function exists(value) {
    if (value != null) {
        if (typeof value === 'object') {
            return Object.keys(value).length !== 0;
        }
        return value !== '';
    }
    return false;
}
function getStorage(storageType, winRef) {
    var storage;
    switch (storageType) {
        case StorageSyncType.LOCAL_STORAGE: {
            storage = winRef.localStorage;
            break;
        }
        case StorageSyncType.SESSION_STORAGE: {
            storage = winRef.sessionStorage;
            break;
        }
        case StorageSyncType.NO_STORAGE: {
            storage = undefined;
            break;
        }
        default: {
            storage = winRef.sessionStorage;
        }
    }
    return storage;
}
function persistToStorage(configKey, value, storage) {
    if (!isSsr(storage) && value) {
        storage.setItem(configKey, JSON.stringify(value));
    }
}
function readFromStorage(storage, key) {
    if (isSsr(storage)) {
        return;
    }
    var storageValue = storage.getItem(key);
    if (!storageValue) {
        return;
    }
    return JSON.parse(storageValue);
}
function isSsr(storage) {
    return !Boolean(storage);
}

var CX_KEY = makeStateKey('cx-state');
function getTransferStateReducer(platformId, transferState, config) {
    if (transferState &&
        config &&
        config.state &&
        config.state.ssrTransfer &&
        config.state.ssrTransfer.keys) {
        if (isPlatformBrowser(platformId)) {
            return getBrowserTransferStateReducer(transferState, config.state.ssrTransfer.keys);
        }
        else if (isPlatformServer(platformId)) {
            return getServerTransferStateReducer(transferState, config.state.ssrTransfer.keys);
        }
    }
    return function (reducer) { return reducer; };
}
function getServerTransferStateReducer(transferState, keys) {
    var transferStateKeys = filterKeysByType(keys, StateTransferType.TRANSFER_STATE);
    return function (reducer) {
        return function (state, action) {
            var newState = reducer(state, action);
            if (newState) {
                var stateSlice = getStateSlice(transferStateKeys, [], newState);
                transferState.set(CX_KEY, stateSlice);
            }
            return newState;
        };
    };
}
function getBrowserTransferStateReducer(transferState, keys) {
    var transferStateKeys = filterKeysByType(keys, StateTransferType.TRANSFER_STATE);
    return function (reducer) {
        return function (state, action) {
            if (action.type === INIT) {
                if (!state) {
                    state = reducer(state, action);
                }
                // we should not utilize transfer state if user is logged in
                var authState = state[AUTH_FEATURE];
                var isLoggedIn = authState && authState.userToken && authState.userToken.token;
                if (!isLoggedIn && transferState.hasKey(CX_KEY)) {
                    var cxKey = transferState.get(CX_KEY, {});
                    var transferredStateSlice = getStateSlice(transferStateKeys, [], cxKey);
                    state = deepMerge({}, state, transferredStateSlice);
                }
                return state;
            }
            return reducer(state, action);
        };
    };
}

var TRANSFER_STATE_META_REDUCER = new InjectionToken('TransferStateMetaReducer');
var STORAGE_SYNC_META_REDUCER = new InjectionToken('StorageSyncMetaReducer');
var ɵ0$6 = getTransferStateReducer, ɵ1$5 = getStorageSyncReducer;
var stateMetaReducers = [
    {
        provide: TRANSFER_STATE_META_REDUCER,
        useFactory: ɵ0$6,
        deps: [
            PLATFORM_ID,
            [new Optional(), TransferState],
            [new Optional(), Config],
        ],
    },
    {
        provide: STORAGE_SYNC_META_REDUCER,
        useFactory: ɵ1$5,
        deps: [WindowRef, [new Optional(), Config]],
    },
    {
        provide: META_REDUCERS,
        useExisting: TRANSFER_STATE_META_REDUCER,
        multi: true,
    },
    {
        provide: META_REDUCERS,
        useExisting: STORAGE_SYNC_META_REDUCER,
        multi: true,
    },
];

var StateModule = /** @class */ (function () {
    function StateModule() {
    }
    StateModule_1 = StateModule;
    StateModule.forRoot = function () {
        return {
            ngModule: StateModule_1,
            providers: __spread(stateMetaReducers, [
                provideDefaultConfig(defaultStateConfig),
            ]),
        };
    };
    var StateModule_1;
    StateModule = StateModule_1 = __decorate([
        NgModule({})
    ], StateModule);
    return StateModule;
}());

var UNKNOWN_ERROR = {
    error: 'unknown error',
};
var circularReplacer = function () {
    var seen = new WeakSet();
    return function (_key, value) {
        if (typeof value === 'object' && value !== null) {
            if (seen.has(value)) {
                return;
            }
            seen.add(value);
        }
        return value;
    };
};
var ɵ0$7 = circularReplacer;
function makeErrorSerializable(error) {
    if (error instanceof Error) {
        return {
            message: error.message,
            type: error.name,
            reason: error.stack,
        };
    }
    if (error instanceof HttpErrorResponse) {
        var serializableError = error.error;
        if (isObject(error.error)) {
            serializableError = JSON.stringify(error.error, circularReplacer());
        }
        return {
            message: error.message,
            error: serializableError,
            status: error.status,
            statusText: error.statusText,
            url: error.url,
        };
    }
    return isObject(error) ? UNKNOWN_ERROR : error;
}

var AuthConfig = /** @class */ (function (_super) {
    __extends(AuthConfig, _super);
    function AuthConfig() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    AuthConfig.ɵprov = ɵɵdefineInjectable({ factory: function AuthConfig_Factory() { return ɵɵinject(Config); }, token: AuthConfig, providedIn: "root" });
    AuthConfig = __decorate([
        Injectable({
            providedIn: 'root',
            useExisting: Config,
        })
    ], AuthConfig);
    return AuthConfig;
}(OccConfig));

var ClientAuthenticationTokenService = /** @class */ (function () {
    function ClientAuthenticationTokenService(config, http, occEndpointsService) {
        this.config = config;
        this.http = http;
        this.occEndpointsService = occEndpointsService;
    }
    ClientAuthenticationTokenService.prototype.loadClientAuthenticationToken = function () {
        var url = this.occEndpointsService.getRawEndpoint('login');
        var params = new HttpParams()
            .set('client_id', encodeURIComponent(this.config.authentication.client_id))
            .set('client_secret', encodeURIComponent(this.config.authentication.client_secret))
            .set('grant_type', 'client_credentials');
        var headers = new HttpHeaders({
            'Content-Type': 'application/x-www-form-urlencoded',
        });
        return this.http.post(url, params, { headers: headers });
    };
    ClientAuthenticationTokenService.ctorParameters = function () { return [
        { type: AuthConfig },
        { type: HttpClient },
        { type: OccEndpointsService }
    ]; };
    ClientAuthenticationTokenService.ɵprov = ɵɵdefineInjectable({ factory: function ClientAuthenticationTokenService_Factory() { return new ClientAuthenticationTokenService(ɵɵinject(AuthConfig), ɵɵinject(HttpClient), ɵɵinject(OccEndpointsService)); }, token: ClientAuthenticationTokenService, providedIn: "root" });
    ClientAuthenticationTokenService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], ClientAuthenticationTokenService);
    return ClientAuthenticationTokenService;
}());

var ClientTokenEffect = /** @class */ (function () {
    function ClientTokenEffect(actions$, clientAuthenticationTokenService) {
        var _this = this;
        this.actions$ = actions$;
        this.clientAuthenticationTokenService = clientAuthenticationTokenService;
        this.loadClientToken$ = this.actions$.pipe(ofType(LOAD_CLIENT_TOKEN), exhaustMap(function () {
            return _this.clientAuthenticationTokenService
                .loadClientAuthenticationToken()
                .pipe(map(function (token) {
                return new LoadClientTokenSuccess(token);
            }), catchError(function (error) {
                return of(new LoadClientTokenFail(makeErrorSerializable(error)));
            }));
        }));
    }
    ClientTokenEffect.ctorParameters = function () { return [
        { type: Actions },
        { type: ClientAuthenticationTokenService }
    ]; };
    __decorate([
        Effect()
    ], ClientTokenEffect.prototype, "loadClientToken$", void 0);
    ClientTokenEffect = __decorate([
        Injectable()
    ], ClientTokenEffect);
    return ClientTokenEffect;
}());

var UserAuthenticationTokenService = /** @class */ (function () {
    function UserAuthenticationTokenService(http, config, occEndpointsService) {
        this.http = http;
        this.config = config;
        this.occEndpointsService = occEndpointsService;
    }
    UserAuthenticationTokenService.prototype.loadToken = function (userId, password) {
        var url = this.occEndpointsService.getRawEndpoint('login');
        var params = new HttpParams()
            .set('client_id', this.config.authentication.client_id)
            .set('client_secret', this.config.authentication.client_secret)
            .set('grant_type', 'password')
            .set('username', userId)
            .set('password', password);
        var headers = new HttpHeaders({
            'Content-Type': 'application/x-www-form-urlencoded',
        });
        return this.http
            .post(url, params, { headers: headers })
            .pipe(catchError(function (error) { return throwError(error); }));
    };
    UserAuthenticationTokenService.prototype.refreshToken = function (refreshToken) {
        var url = this.occEndpointsService.getRawEndpoint('login');
        var params = new HttpParams()
            .set('client_id', encodeURIComponent(this.config.authentication.client_id))
            .set('client_secret', encodeURIComponent(this.config.authentication.client_secret))
            .set('refresh_token', encodeURI(refreshToken))
            .set('grant_type', 'refresh_token');
        var headers = new HttpHeaders({
            'Content-Type': 'application/x-www-form-urlencoded',
        });
        return this.http
            .post(url, params, { headers: headers })
            .pipe(catchError(function (error) { return throwError(error); }));
    };
    UserAuthenticationTokenService.prototype.revoke = function (userToken) {
        var url = this.occEndpointsService.getRawEndpoint('revoke');
        var headers = InterceptorUtil.createHeader(TOKEN_REVOCATION_HEADER, true, new HttpHeaders({
            Authorization: userToken.token_type + " " + userToken.access_token,
            'Content-Type': 'application/x-www-form-urlencoded',
        }));
        var params = new HttpParams().set('token', userToken.access_token);
        return this.http
            .post(url, params, { headers: headers })
            .pipe(catchError(function (error) { return throwError(error); }));
    };
    UserAuthenticationTokenService.ctorParameters = function () { return [
        { type: HttpClient },
        { type: AuthConfig },
        { type: OccEndpointsService }
    ]; };
    UserAuthenticationTokenService.ɵprov = ɵɵdefineInjectable({ factory: function UserAuthenticationTokenService_Factory() { return new UserAuthenticationTokenService(ɵɵinject(HttpClient), ɵɵinject(AuthConfig), ɵɵinject(OccEndpointsService)); }, token: UserAuthenticationTokenService, providedIn: "root" });
    UserAuthenticationTokenService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], UserAuthenticationTokenService);
    return UserAuthenticationTokenService;
}());

var UserTokenEffects = /** @class */ (function () {
    function UserTokenEffects(actions$, userTokenService) {
        var _this = this;
        this.actions$ = actions$;
        this.userTokenService = userTokenService;
        this.loadUserToken$ = this.actions$.pipe(ofType(LOAD_USER_TOKEN), map(function (action) { return action.payload; }), mergeMap(function (_a) {
            var userId = _a.userId, password = _a.password;
            return _this.userTokenService.loadToken(userId, password).pipe(map(function (token) {
                var date = new Date();
                date.setSeconds(date.getSeconds() + token.expires_in);
                token.expiration_time = date.toJSON();
                token.userId = OCC_USER_ID_CURRENT;
                return new LoadUserTokenSuccess(token);
            }), catchError(function (error) {
                return of(new LoadUserTokenFail(makeErrorSerializable(error)));
            }));
        }));
        this.login$ = this.actions$.pipe(ofType(LOAD_USER_TOKEN_SUCCESS), map(function () { return new Login(); }));
        this.refreshUserToken$ = this.actions$.pipe(ofType(REFRESH_USER_TOKEN), map(function (action) { return action.payload; }), exhaustMap(function (_a) {
            var refreshToken = _a.refreshToken;
            return _this.userTokenService.refreshToken(refreshToken).pipe(map(function (token) {
                var date = new Date();
                date.setSeconds(date.getSeconds() + token.expires_in);
                token.expiration_time = date.toJSON();
                return new RefreshUserTokenSuccess(token);
            }, catchError(function (error) {
                return of(new RefreshUserTokenFail(makeErrorSerializable(error)));
            })));
        }));
        this.revokeUserToken$ = this.actions$.pipe(ofType(REVOKE_USER_TOKEN), map(function (action) {
            return action.payload;
        }), mergeMap(function (userToken) {
            return _this.userTokenService.revoke(userToken).pipe(map(function () { return new RevokeUserTokenSuccess(userToken); }), catchError(function (error) { return of(new RevokeUserTokenFail(error)); }));
        }));
    }
    UserTokenEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: UserAuthenticationTokenService }
    ]; };
    __decorate([
        Effect()
    ], UserTokenEffects.prototype, "loadUserToken$", void 0);
    __decorate([
        Effect()
    ], UserTokenEffects.prototype, "login$", void 0);
    __decorate([
        Effect()
    ], UserTokenEffects.prototype, "refreshUserToken$", void 0);
    __decorate([
        Effect()
    ], UserTokenEffects.prototype, "revokeUserToken$", void 0);
    UserTokenEffects = __decorate([
        Injectable()
    ], UserTokenEffects);
    return UserTokenEffects;
}());

var effects = [UserTokenEffects, ClientTokenEffect];

var initialState = {};
function reducer(state, action) {
    if (state === void 0) { state = initialState; }
    switch (action.type) {
        case LOAD_USER_TOKEN:
        case REFRESH_USER_TOKEN: {
            return __assign({}, state);
        }
        case LOAD_USER_TOKEN_SUCCESS:
        case REFRESH_USER_TOKEN_SUCCESS: {
            return __assign(__assign({}, state), action.payload);
        }
        case LOAD_USER_TOKEN_FAIL:
        case REFRESH_USER_TOKEN_FAIL: {
            return __assign({}, state);
        }
    }
    return state;
}

function getReducers() {
    return {
        userToken: combineReducers({ token: reducer }),
        clientToken: loaderReducer(CLIENT_TOKEN_DATA),
    };
}
var reducerToken = new InjectionToken('AuthReducers');
var reducerProvider = {
    provide: reducerToken,
    useFactory: getReducers,
};
function clearAuthState(reducer) {
    return function (state, action) {
        if (action.type === LOGOUT) {
            state = __assign(__assign({}, state), { userToken: undefined });
        }
        return reducer(state, action);
    };
}
var metaReducers = [clearAuthState];

function authStoreConfigFactory() {
    // if we want to reuse AUTH_FEATURE const in config, we have to use factory instead of plain object
    var config = {
        state: {
            storageSync: {
                keys: {
                    'auth.userToken.token.access_token': StorageSyncType.LOCAL_STORAGE,
                    'auth.userToken.token.token_type': StorageSyncType.LOCAL_STORAGE,
                    'auth.userToken.token.expires_in': StorageSyncType.LOCAL_STORAGE,
                    'auth.userToken.token.expiration_time': StorageSyncType.LOCAL_STORAGE,
                    'auth.userToken.token.scope': StorageSyncType.LOCAL_STORAGE,
                    'auth.userToken.token.userId': StorageSyncType.LOCAL_STORAGE,
                },
            },
        },
    };
    return config;
}
var AuthStoreModule = /** @class */ (function () {
    function AuthStoreModule() {
    }
    AuthStoreModule = __decorate([
        NgModule({
            imports: [
                CommonModule,
                HttpClientModule,
                StateModule,
                StoreModule.forFeature(AUTH_FEATURE, reducerToken, { metaReducers: metaReducers }),
                EffectsModule.forFeature(effects),
            ],
            providers: [
                provideDefaultConfigFactory(authStoreConfigFactory),
                reducerProvider,
            ],
        })
    ], AuthStoreModule);
    return AuthStoreModule;
}());

var AuthModule = /** @class */ (function () {
    function AuthModule() {
    }
    AuthModule_1 = AuthModule;
    AuthModule.forRoot = function () {
        return {
            ngModule: AuthModule_1,
            providers: __spread([provideDefaultConfig(defaultAuthConfig)], interceptors),
        };
    };
    var AuthModule_1;
    AuthModule = AuthModule_1 = __decorate([
        NgModule({
            imports: [CommonModule, HttpClientModule, AuthStoreModule],
        })
    ], AuthModule);
    return AuthModule;
}());

var AuthRedirectService = /** @class */ (function () {
    /**
     * This service is responsible for redirecting to the last page before authorization. "The last page" can be:
     * 1. Just the previously opened page; or
     * 2. The page that we just tried to open, but AuthGuard cancelled it
     *
     * For example:
     * 1. The user opens the product page, then clicks /login link and signs in
     *    -> Then we should redirect to the product page; or
     * 2. The user opens the product page, then he clicks /my-account link,
     *    but is automatically redirected to the login page by the AuthGuard, and he signs in
     *    -> Then we should redirect to the my-account page, not the product page
     */
    function AuthRedirectService(routing, router) {
        this.routing = routing;
        this.router = router;
        this.ignoredUrls = new Set();
    }
    AuthRedirectService.prototype.redirect = function () {
        if (this.redirectUrl === undefined) {
            this.routing.go('/');
        }
        else {
            this.routing.goByUrl(this.redirectUrl);
        }
        this.redirectUrl = undefined;
        this.lastAuthGuardNavigation = undefined;
    };
    AuthRedirectService.prototype.reportAuthGuard = function () {
        var _a = this.getCurrentNavigation(), url = _a.url, navigationId = _a.navigationId;
        this.lastAuthGuardNavigation = { url: url, navigationId: navigationId };
        this.redirectUrl = url;
    };
    AuthRedirectService.prototype.reportNotAuthGuard = function () {
        var _a = this.getCurrentNavigation(), url = _a.url, initialUrl = _a.initialUrl, navigationId = _a.navigationId;
        this.ignoredUrls.add(url);
        // Don't save redirect url if you've already come from page with NotAuthGuard (i.e. user has come from login to register)
        if (!this.ignoredUrls.has(initialUrl)) {
            // We compare the navigation id to find out if the url cancelled by AuthGuard (i.e. my-account) is more recent
            // than the last opened page
            if (!this.lastAuthGuardNavigation ||
                this.lastAuthGuardNavigation.navigationId < navigationId - 1) {
                this.redirectUrl = initialUrl;
                this.lastAuthGuardNavigation = undefined;
            }
        }
    };
    AuthRedirectService.prototype.getCurrentNavigation = function () {
        var initialUrl = this.router.url;
        var navigation = this.router.getCurrentNavigation();
        var url = this.router.serializeUrl(navigation.finalUrl);
        return {
            navigationId: navigation.id,
            url: url,
            initialUrl: initialUrl,
        };
    };
    AuthRedirectService.ctorParameters = function () { return [
        { type: RoutingService },
        { type: Router }
    ]; };
    AuthRedirectService.ɵprov = ɵɵdefineInjectable({ factory: function AuthRedirectService_Factory() { return new AuthRedirectService(ɵɵinject(RoutingService), ɵɵinject(Router)); }, token: AuthRedirectService, providedIn: "root" });
    AuthRedirectService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], AuthRedirectService);
    return AuthRedirectService;
}());

var AuthGuard = /** @class */ (function () {
    function AuthGuard(routingService, authService, authRedirectService, router) {
        this.routingService = routingService;
        this.authService = authService;
        this.authRedirectService = authRedirectService;
        this.router = router;
    }
    AuthGuard.prototype.canActivate = function () {
        var _this = this;
        return this.authService.getUserToken().pipe(map(function (token) {
            if (!token.access_token) {
                _this.authRedirectService.reportAuthGuard();
                _this.routingService.go({ cxRoute: 'login' });
            }
            return !!token.access_token;
        }));
    };
    AuthGuard.ctorParameters = function () { return [
        { type: RoutingService },
        { type: AuthService },
        { type: AuthRedirectService },
        { type: Router }
    ]; };
    AuthGuard.ɵprov = ɵɵdefineInjectable({ factory: function AuthGuard_Factory() { return new AuthGuard(ɵɵinject(RoutingService), ɵɵinject(AuthService), ɵɵinject(AuthRedirectService), ɵɵinject(Router)); }, token: AuthGuard, providedIn: "root" });
    AuthGuard = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], AuthGuard);
    return AuthGuard;
}());

var NotAuthGuard = /** @class */ (function () {
    function NotAuthGuard(routingService, authService, authRedirectService) {
        this.routingService = routingService;
        this.authService = authService;
        this.authRedirectService = authRedirectService;
    }
    NotAuthGuard.prototype.canActivate = function () {
        var _this = this;
        this.authRedirectService.reportNotAuthGuard();
        // redirect, if user is already logged in:
        return this.authService.getUserToken().pipe(map(function (token) {
            if (token.access_token) {
                _this.routingService.go({ cxRoute: 'home' });
            }
            return !token.access_token;
        }));
    };
    NotAuthGuard.ctorParameters = function () { return [
        { type: RoutingService },
        { type: AuthService },
        { type: AuthRedirectService }
    ]; };
    NotAuthGuard.ɵprov = ɵɵdefineInjectable({ factory: function NotAuthGuard_Factory() { return new NotAuthGuard(ɵɵinject(RoutingService), ɵɵinject(AuthService), ɵɵinject(AuthRedirectService)); }, token: NotAuthGuard, providedIn: "root" });
    NotAuthGuard = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], NotAuthGuard);
    return NotAuthGuard;
}());

var CountryType;
(function (CountryType) {
    CountryType["BILLING"] = "BILLING";
    CountryType["SHIPPING"] = "SHIPPING";
})(CountryType || (CountryType = {}));

var PromotionLocation;
(function (PromotionLocation) {
    PromotionLocation["ActiveCart"] = "CART";
    PromotionLocation["Checkout"] = "CHECKOUT";
    PromotionLocation["Order"] = "ORDER";
})(PromotionLocation || (PromotionLocation = {}));

var PageType;
(function (PageType) {
    PageType["CONTENT_PAGE"] = "ContentPage";
    PageType["PRODUCT_PAGE"] = "ProductPage";
    PageType["CATEGORY_PAGE"] = "CategoryPage";
    PageType["CATALOG_PAGE"] = "CatalogPage";
})(PageType || (PageType = {}));
var CmsBannerCarouselEffect;
(function (CmsBannerCarouselEffect) {
    CmsBannerCarouselEffect["FADE"] = "FADE";
    CmsBannerCarouselEffect["ZOOM"] = "ZOOM";
    CmsBannerCarouselEffect["CURTAIN"] = "CURTAINX";
    CmsBannerCarouselEffect["TURNDOWN"] = "TURNDOWN";
})(CmsBannerCarouselEffect || (CmsBannerCarouselEffect = {}));

var ANONYMOUS_CONSENT_STATUS;
(function (ANONYMOUS_CONSENT_STATUS) {
    ANONYMOUS_CONSENT_STATUS["GIVEN"] = "GIVEN";
    ANONYMOUS_CONSENT_STATUS["WITHDRAWN"] = "WITHDRAWN";
})(ANONYMOUS_CONSENT_STATUS || (ANONYMOUS_CONSENT_STATUS = {}));

var ImageType;
(function (ImageType) {
    ImageType["PRIMARY"] = "PRIMARY";
    ImageType["GALLERY"] = "GALLERY";
})(ImageType || (ImageType = {}));

var VariantType;
(function (VariantType) {
    VariantType["SIZE"] = "ApparelSizeVariantProduct";
    VariantType["STYLE"] = "ApparelStyleVariantProduct";
    VariantType["COLOR"] = "ElectronicsColorVariantProduct";
})(VariantType || (VariantType = {}));
var PriceType;
(function (PriceType) {
    PriceType["BUY"] = "BUY";
    PriceType["FROM"] = "FROM";
})(PriceType || (PriceType = {}));
var VariantQualifier;
(function (VariantQualifier) {
    VariantQualifier["SIZE"] = "size";
    VariantQualifier["STYLE"] = "style";
    VariantQualifier["COLOR"] = "color";
    VariantQualifier["THUMBNAIL"] = "thumbnail";
    VariantQualifier["PRODUCT"] = "product";
    VariantQualifier["ROLLUP_PROPERTY"] = "rollupProperty";
})(VariantQualifier || (VariantQualifier = {}));

var testestsd = 'sare';

var NotificationType;
(function (NotificationType) {
    NotificationType["BACK_IN_STOCK"] = "BACK_IN_STOCK";
})(NotificationType || (NotificationType = {}));

var ANONYMOUS_CONSENTS_STORE_FEATURE = 'anonymous-consents';
var ANONYMOUS_CONSENTS = '[Anonymous Consents] Anonymous Consents';

var LOAD_ANONYMOUS_CONSENT_TEMPLATES = '[Anonymous Consents] Load Anonymous Consent Templates';
var LOAD_ANONYMOUS_CONSENT_TEMPLATES_SUCCESS = '[Anonymous Consents] Load Anonymous Consent Templates Success';
var LOAD_ANONYMOUS_CONSENT_TEMPLATES_FAIL = '[Anonymous Consents] Load Anonymous Consent Templates Fail';
var RESET_LOAD_ANONYMOUS_CONSENT_TEMPLATES = '[Anonymous Consents] Reset Load Anonymous Consent Templates';
var GET_ALL_ANONYMOUS_CONSENTS = '[Anonymous Consents] Get All Anonymous Consents';
var GET_ANONYMOUS_CONSENT = '[Anonymous Consents] Get Anonymous Consent';
var SET_ANONYMOUS_CONSENTS = '[Anonymous Consents] Set Anonymous Consents';
var GIVE_ANONYMOUS_CONSENT = '[Anonymous Consents] Give Anonymous Consent';
var WITHDRAW_ANONYMOUS_CONSENT = '[Anonymous Consents] Withdraw Anonymous Consent';
var TOGGLE_ANONYMOUS_CONSENTS_BANNER_DISMISSED = '[Anonymous Consents] Toggle Anonymous Consents Banner Dismissed';
var TOGGLE_ANONYMOUS_CONSENT_TEMPLATES_UPDATED = '[Anonymous Consents] Anonymous Consent Templates Updated';
var LoadAnonymousConsentTemplates = /** @class */ (function (_super) {
    __extends(LoadAnonymousConsentTemplates, _super);
    function LoadAnonymousConsentTemplates() {
        var _this = _super.call(this, ANONYMOUS_CONSENTS) || this;
        _this.type = LOAD_ANONYMOUS_CONSENT_TEMPLATES;
        return _this;
    }
    return LoadAnonymousConsentTemplates;
}(LoaderLoadAction));
var LoadAnonymousConsentTemplatesSuccess = /** @class */ (function (_super) {
    __extends(LoadAnonymousConsentTemplatesSuccess, _super);
    function LoadAnonymousConsentTemplatesSuccess(payload) {
        var _this = _super.call(this, ANONYMOUS_CONSENTS) || this;
        _this.payload = payload;
        _this.type = LOAD_ANONYMOUS_CONSENT_TEMPLATES_SUCCESS;
        return _this;
    }
    return LoadAnonymousConsentTemplatesSuccess;
}(LoaderSuccessAction));
var LoadAnonymousConsentTemplatesFail = /** @class */ (function (_super) {
    __extends(LoadAnonymousConsentTemplatesFail, _super);
    function LoadAnonymousConsentTemplatesFail(payload) {
        var _this = _super.call(this, ANONYMOUS_CONSENTS, payload) || this;
        _this.type = LOAD_ANONYMOUS_CONSENT_TEMPLATES_FAIL;
        return _this;
    }
    return LoadAnonymousConsentTemplatesFail;
}(LoaderFailAction));
var ResetLoadAnonymousConsentTemplates = /** @class */ (function (_super) {
    __extends(ResetLoadAnonymousConsentTemplates, _super);
    function ResetLoadAnonymousConsentTemplates() {
        var _this = _super.call(this, ANONYMOUS_CONSENTS) || this;
        _this.type = RESET_LOAD_ANONYMOUS_CONSENT_TEMPLATES;
        return _this;
    }
    return ResetLoadAnonymousConsentTemplates;
}(LoaderResetAction));
var GetAllAnonymousConsents = /** @class */ (function () {
    function GetAllAnonymousConsents() {
        this.type = GET_ALL_ANONYMOUS_CONSENTS;
    }
    return GetAllAnonymousConsents;
}());
var GetAnonymousConsent = /** @class */ (function () {
    function GetAnonymousConsent(templateCode) {
        this.templateCode = templateCode;
        this.type = GET_ANONYMOUS_CONSENT;
    }
    return GetAnonymousConsent;
}());
var SetAnonymousConsents = /** @class */ (function () {
    function SetAnonymousConsents(payload) {
        this.payload = payload;
        this.type = SET_ANONYMOUS_CONSENTS;
    }
    return SetAnonymousConsents;
}());
var GiveAnonymousConsent = /** @class */ (function () {
    function GiveAnonymousConsent(templateCode) {
        this.templateCode = templateCode;
        this.type = GIVE_ANONYMOUS_CONSENT;
    }
    return GiveAnonymousConsent;
}());
var WithdrawAnonymousConsent = /** @class */ (function () {
    function WithdrawAnonymousConsent(templateCode) {
        this.templateCode = templateCode;
        this.type = WITHDRAW_ANONYMOUS_CONSENT;
    }
    return WithdrawAnonymousConsent;
}());
var ToggleAnonymousConsentsBannerDissmissed = /** @class */ (function () {
    function ToggleAnonymousConsentsBannerDissmissed(dismissed) {
        this.dismissed = dismissed;
        this.type = TOGGLE_ANONYMOUS_CONSENTS_BANNER_DISMISSED;
    }
    return ToggleAnonymousConsentsBannerDissmissed;
}());
var ToggleAnonymousConsentTemplatesUpdated = /** @class */ (function () {
    function ToggleAnonymousConsentTemplatesUpdated(updated) {
        this.updated = updated;
        this.type = TOGGLE_ANONYMOUS_CONSENT_TEMPLATES_UPDATED;
    }
    return ToggleAnonymousConsentTemplatesUpdated;
}());



var anonymousConsentsGroup = /*#__PURE__*/Object.freeze({
    __proto__: null,
    LOAD_ANONYMOUS_CONSENT_TEMPLATES: LOAD_ANONYMOUS_CONSENT_TEMPLATES,
    LOAD_ANONYMOUS_CONSENT_TEMPLATES_SUCCESS: LOAD_ANONYMOUS_CONSENT_TEMPLATES_SUCCESS,
    LOAD_ANONYMOUS_CONSENT_TEMPLATES_FAIL: LOAD_ANONYMOUS_CONSENT_TEMPLATES_FAIL,
    RESET_LOAD_ANONYMOUS_CONSENT_TEMPLATES: RESET_LOAD_ANONYMOUS_CONSENT_TEMPLATES,
    GET_ALL_ANONYMOUS_CONSENTS: GET_ALL_ANONYMOUS_CONSENTS,
    GET_ANONYMOUS_CONSENT: GET_ANONYMOUS_CONSENT,
    SET_ANONYMOUS_CONSENTS: SET_ANONYMOUS_CONSENTS,
    GIVE_ANONYMOUS_CONSENT: GIVE_ANONYMOUS_CONSENT,
    WITHDRAW_ANONYMOUS_CONSENT: WITHDRAW_ANONYMOUS_CONSENT,
    TOGGLE_ANONYMOUS_CONSENTS_BANNER_DISMISSED: TOGGLE_ANONYMOUS_CONSENTS_BANNER_DISMISSED,
    TOGGLE_ANONYMOUS_CONSENT_TEMPLATES_UPDATED: TOGGLE_ANONYMOUS_CONSENT_TEMPLATES_UPDATED,
    LoadAnonymousConsentTemplates: LoadAnonymousConsentTemplates,
    LoadAnonymousConsentTemplatesSuccess: LoadAnonymousConsentTemplatesSuccess,
    LoadAnonymousConsentTemplatesFail: LoadAnonymousConsentTemplatesFail,
    ResetLoadAnonymousConsentTemplates: ResetLoadAnonymousConsentTemplates,
    GetAllAnonymousConsents: GetAllAnonymousConsents,
    GetAnonymousConsent: GetAnonymousConsent,
    SetAnonymousConsents: SetAnonymousConsents,
    GiveAnonymousConsent: GiveAnonymousConsent,
    WithdrawAnonymousConsent: WithdrawAnonymousConsent,
    ToggleAnonymousConsentsBannerDissmissed: ToggleAnonymousConsentsBannerDissmissed,
    ToggleAnonymousConsentTemplatesUpdated: ToggleAnonymousConsentTemplatesUpdated
});

var getAnonymousConsentState = createFeatureSelector(ANONYMOUS_CONSENTS_STORE_FEATURE);

var ɵ0$8 = function (state) { return state.templates; };
var getAnonymousConsentTemplatesState = createSelector(getAnonymousConsentState, ɵ0$8);
var getAnonymousConsentTemplatesValue = createSelector(getAnonymousConsentTemplatesState, loaderValueSelector);
var getAnonymousConsentTemplatesLoading = createSelector(getAnonymousConsentTemplatesState, loaderLoadingSelector);
var getAnonymousConsentTemplatesSuccess = createSelector(getAnonymousConsentTemplatesState, loaderSuccessSelector);
var getAnonymousConsentTemplatesError = createSelector(getAnonymousConsentTemplatesState, loaderErrorSelector);
var getAnonymousConsentTemplate = function (templateCode) {
    return createSelector(getAnonymousConsentTemplatesValue, function (templates) {
        return templates
            ? templates.find(function (template) { return template.id === templateCode; })
            : null;
    });
};

var ɵ0$9 = function (state) { return state.ui.updated; };
var getAnonymousConsentTemplatesUpdate = createSelector(getAnonymousConsentState, ɵ0$9);
var ɵ1$6 = function (state) { return state.ui.bannerDismissed; };
var getAnonymousConsentsBannerDismissed = createSelector(getAnonymousConsentState, ɵ1$6);

var ɵ0$a = function (state) { return state.consents; };
var getAnonymousConsents = createSelector(getAnonymousConsentState, ɵ0$a);
var getAnonymousConsentByTemplateCode = function (templateCode) {
    return createSelector(getAnonymousConsents, function (consents) {
        return consents.find(function (consent) { return consent.templateCode === templateCode; });
    });
};



var anonymousConsentsGroup_selectors = /*#__PURE__*/Object.freeze({
    __proto__: null,
    getAnonymousConsentTemplatesState: getAnonymousConsentTemplatesState,
    getAnonymousConsentTemplatesValue: getAnonymousConsentTemplatesValue,
    getAnonymousConsentTemplatesLoading: getAnonymousConsentTemplatesLoading,
    getAnonymousConsentTemplatesSuccess: getAnonymousConsentTemplatesSuccess,
    getAnonymousConsentTemplatesError: getAnonymousConsentTemplatesError,
    getAnonymousConsentTemplate: getAnonymousConsentTemplate,
    ɵ0: ɵ0$8,
    getAnonymousConsentTemplatesUpdate: getAnonymousConsentTemplatesUpdate,
    getAnonymousConsentsBannerDismissed: getAnonymousConsentsBannerDismissed,
    ɵ1: ɵ1$6,
    getAnonymousConsents: getAnonymousConsents,
    getAnonymousConsentByTemplateCode: getAnonymousConsentByTemplateCode,
    getAnonymousConsentState: getAnonymousConsentState
});

var AnonymousConsentsService = /** @class */ (function () {
    function AnonymousConsentsService(store, authService) {
        this.store = store;
        this.authService = authService;
    }
    /**
     * Retrieves the anonymous consent templates.
     */
    AnonymousConsentsService.prototype.loadTemplates = function () {
        this.store.dispatch(new LoadAnonymousConsentTemplates());
    };
    /**
     * Conditionally triggers the load of the anonymous consent templates if:
     *   - `loadIfMissing` parameter is set to `true`
     *   - the `templates` in the store are `undefined`
     *
     * Othewise it just returns the value from the store.
     *
     * @param loadIfMissing setting to `true` will trigger the load of the templates if the currently stored templates are `undefined`
     */
    AnonymousConsentsService.prototype.getTemplates = function (loadIfMissing) {
        var _this = this;
        if (loadIfMissing === void 0) { loadIfMissing = false; }
        return iif(function () { return loadIfMissing; }, this.store.pipe(select(getAnonymousConsentTemplatesValue), withLatestFrom(this.getLoadTemplatesLoading()), filter(function (_a) {
            var _b = __read(_a, 2), _templates = _b[0], loading = _b[1];
            return !loading;
        }), tap(function (_a) {
            var _b = __read(_a, 2), templates = _b[0], _loading = _b[1];
            if (!Boolean(templates)) {
                _this.loadTemplates();
            }
        }), filter(function (_a) {
            var _b = __read(_a, 2), templates = _b[0], _loading = _b[1];
            return Boolean(templates);
        }), map(function (_a) {
            var _b = __read(_a, 2), templates = _b[0], _loading = _b[1];
            return templates;
        })), this.store.pipe(select(getAnonymousConsentTemplatesValue)));
    };
    /**
     * Returns the anonymous consent templates with the given template code.
     * @param templateCode a template code by which to filter anonymous consent templates.
     */
    AnonymousConsentsService.prototype.getTemplate = function (templateCode) {
        return this.store.pipe(select(getAnonymousConsentTemplate(templateCode)));
    };
    /**
     * Returns an indicator for the loading status for the anonymous consent templates.
     */
    AnonymousConsentsService.prototype.getLoadTemplatesLoading = function () {
        return this.store.pipe(select(getAnonymousConsentTemplatesLoading));
    };
    /**
     * Returns an indicator for the success status for the anonymous consent templates.
     */
    AnonymousConsentsService.prototype.getLoadTemplatesSuccess = function () {
        return this.store.pipe(select(getAnonymousConsentTemplatesSuccess));
    };
    /**
     * Returns an indicator for the error status for the anonymous consent templates.
     */
    AnonymousConsentsService.prototype.getLoadTemplatesError = function () {
        return this.store.pipe(select(getAnonymousConsentTemplatesError));
    };
    /**
     * Resets the loading, success and error indicators for the anonymous consent templates.
     */
    AnonymousConsentsService.prototype.resetLoadTemplatesState = function () {
        this.store.dispatch(new ResetLoadAnonymousConsentTemplates());
    };
    /**
     * Returns all the anonymous consents.
     */
    AnonymousConsentsService.prototype.getConsents = function () {
        return this.store.pipe(select(getAnonymousConsents));
    };
    /**
     * Puts the provided anonymous consents into the store.
     */
    AnonymousConsentsService.prototype.setConsents = function (consents) {
        return this.store.dispatch(new SetAnonymousConsents(consents));
    };
    /**
     * Returns the anonymous consent for the given template ID.
     *
     * As a side-effect, the method will call `getTemplates(true)` to load the templates if those are not present.
     *
     * @param templateId a template ID by which to filter anonymous consent templates.
     */
    AnonymousConsentsService.prototype.getConsent = function (templateId) {
        var _this = this;
        return this.authService.isUserLoggedIn().pipe(filter(function (authenticated) { return !authenticated; }), tap(function () { return _this.getTemplates(true); }), switchMap(function () {
            return _this.store.pipe(select(getAnonymousConsentByTemplateCode(templateId)));
        }));
    };
    /**
     * Give a consent for the given `templateCode`
     * @param templateCode for which to give the consent
     */
    AnonymousConsentsService.prototype.giveConsent = function (templateCode) {
        this.store.dispatch(new GiveAnonymousConsent(templateCode));
    };
    /**
     * Sets all the anonymous consents' state to given.
     */
    AnonymousConsentsService.prototype.giveAllConsents = function () {
        var _this = this;
        return this.getTemplates(true).pipe(tap(function (templates) {
            return templates.forEach(function (template) { return _this.giveConsent(template.id); });
        }));
    };
    /**
     * Returns `true` if the provided `consent` is given.
     * @param consent a consent to test
     */
    AnonymousConsentsService.prototype.isConsentGiven = function (consent) {
        return consent && consent.consentState === ANONYMOUS_CONSENT_STATUS.GIVEN;
    };
    /**
     * Withdraw a consent for the given `templateCode`
     * @param templateCode for which to withdraw the consent
     */
    AnonymousConsentsService.prototype.withdrawConsent = function (templateCode) {
        this.store.dispatch(new WithdrawAnonymousConsent(templateCode));
    };
    /**
     * Sets all the anonymous consents' state to withdrawn.
     */
    AnonymousConsentsService.prototype.withdrawAllConsents = function () {
        var _this = this;
        return this.getTemplates(true).pipe(tap(function (templates) {
            return templates.forEach(function (template) { return _this.withdrawConsent(template.id); });
        }));
    };
    /**
     * Returns `true` if the provided `consent` is withdrawn.
     * @param consent a consent to test
     */
    AnonymousConsentsService.prototype.isConsentWithdrawn = function (consent) {
        return (consent && consent.consentState === ANONYMOUS_CONSENT_STATUS.WITHDRAWN);
    };
    /**
     * Toggles the dismissed state of the anonymous consents banner.
     * @param dismissed the banner will be dismissed if `true` is passed, otherwise it will be visible.
     */
    AnonymousConsentsService.prototype.toggleBannerDismissed = function (dismissed) {
        this.store.dispatch(new ToggleAnonymousConsentsBannerDissmissed(dismissed));
        if (dismissed) {
            this.toggleTemplatesUpdated(false);
        }
    };
    /**
     * Returns `true` if the banner was dismissed, `false` otherwise.
     */
    AnonymousConsentsService.prototype.isBannerDismissed = function () {
        return this.store.pipe(select(getAnonymousConsentsBannerDismissed));
    };
    /**
     * Returns `true` if the consent templates were updated on the back-end.
     * If the templates are not present in the store, it triggers the load.
     */
    AnonymousConsentsService.prototype.getTemplatesUpdated = function () {
        var _this = this;
        return this.getTemplates(true).pipe(switchMap(function () {
            return _this.store.pipe(select(getAnonymousConsentTemplatesUpdate));
        }));
    };
    /**
     * Toggles the `updated` slice of the state
     * @param updated
     */
    AnonymousConsentsService.prototype.toggleTemplatesUpdated = function (updated) {
        this.store.dispatch(new ToggleAnonymousConsentTemplatesUpdated(updated));
    };
    /**
     * Returns `true` if either the banner is not dismissed or if the templates were updated on the back-end.
     * Otherwise, it returns `false`.
     */
    AnonymousConsentsService.prototype.isBannerVisible = function () {
        return combineLatest([
            this.isBannerDismissed(),
            this.getTemplatesUpdated(),
        ]).pipe(map(function (_a) {
            var _b = __read(_a, 2), dismissed = _b[0], updated = _b[1];
            return !dismissed || updated;
        }));
    };
    /**
     * Returns `true` if there's a missmatch in template versions between the provided `currentTemplates` and `newTemplates`
     * @param currentTemplates current templates to check
     * @param newTemplates new templates to check
     */
    AnonymousConsentsService.prototype.detectUpdatedTemplates = function (currentTemplates, newTemplates) {
        if (newTemplates.length !== currentTemplates.length) {
            return true;
        }
        for (var i = 0; i < newTemplates.length; i++) {
            var newTemplate = newTemplates[i];
            var currentTemplate = currentTemplates[i];
            if (newTemplate.version !== currentTemplate.version) {
                return true;
            }
        }
        return false;
    };
    /**
     * Serializes using `JSON.stringify()` and encodes using `encodeURIComponent()` methods
     * @param consents to serialize and encode
     */
    AnonymousConsentsService.prototype.serializeAndEncode = function (consents) {
        if (!consents) {
            return '';
        }
        var serialized = JSON.stringify(consents);
        var encoded = encodeURIComponent(serialized);
        return encoded;
    };
    /**
     * Decodes using `decodeURIComponent()` and deserializes using `JSON.parse()`
     * @param rawConsents to decode an deserialize
     */
    AnonymousConsentsService.prototype.decodeAndDeserialize = function (rawConsents) {
        var decoded = decodeURIComponent(rawConsents);
        var unserialized = JSON.parse(decoded);
        return unserialized;
    };
    /**
     *
     * Compares the given `newConsents` and `previousConsents` and returns `true` if there are differences (the `newConsents` are updates).
     * Otherwise it returns `false`.
     *
     * @param newConsents new consents to compare
     * @param previousConsents old consents to compare
     */
    AnonymousConsentsService.prototype.consentsUpdated = function (newConsents, previousConsents) {
        var newRawConsents = this.serializeAndEncode(newConsents);
        var previousRawConsents = this.serializeAndEncode(previousConsents);
        return newRawConsents !== previousRawConsents;
    };
    AnonymousConsentsService.ctorParameters = function () { return [
        { type: Store },
        { type: AuthService }
    ]; };
    AnonymousConsentsService.ɵprov = ɵɵdefineInjectable({ factory: function AnonymousConsentsService_Factory() { return new AnonymousConsentsService(ɵɵinject(Store), ɵɵinject(AuthService)); }, token: AnonymousConsentsService, providedIn: "root" });
    AnonymousConsentsService = __decorate([
        Injectable({ providedIn: 'root' })
    ], AnonymousConsentsService);
    return AnonymousConsentsService;
}());

var AsmAdapter = /** @class */ (function () {
    function AsmAdapter() {
    }
    return AsmAdapter;
}());

var defaultOccAsmConfig = {
    backend: {
        occ: {
            endpoints: {
                asmCustomerSearch: '/assistedservicewebservices/customers/search',
            },
        },
    },
};

var AsmConfig = /** @class */ (function (_super) {
    __extends(AsmConfig, _super);
    function AsmConfig() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    AsmConfig.ɵprov = ɵɵdefineInjectable({ factory: function AsmConfig_Factory() { return ɵɵinject(Config); }, token: AsmConfig, providedIn: "root" });
    AsmConfig = __decorate([
        Injectable({
            providedIn: 'root',
            useExisting: Config,
        })
    ], AsmConfig);
    return AsmConfig;
}(OccConfig));

var CUSTOMER_SEARCH_PAGE_NORMALIZER = new InjectionToken('CustomerSearchPageNormalizer');

var ConverterService = /** @class */ (function () {
    function ConverterService(injector) {
        this.injector = injector;
        this.converters = new Map();
    }
    ConverterService.prototype.getConverters = function (injectionToken) {
        if (!this.converters.has(injectionToken)) {
            var converters = this.injector.get(injectionToken, []);
            if (!Array.isArray(converters)) {
                console.warn('Converter must be multi-provided, please use "multi: true" for', injectionToken.toString());
            }
            this.converters.set(injectionToken, converters);
        }
        return this.converters.get(injectionToken);
    };
    /**
     * Will return true if converters for specified token were provided
     */
    ConverterService.prototype.hasConverters = function (injectionToken) {
        var converters = this.getConverters(injectionToken);
        return Array.isArray(converters) && converters.length > 0;
    };
    /**
     * Pipeable operator to apply converter logic in a observable stream
     */
    ConverterService.prototype.pipeable = function (injectionToken) {
        var _this = this;
        if (this.hasConverters(injectionToken)) {
            return map(function (model) { return _this.convertSource(model, injectionToken); });
        }
        else {
            return function (observable) { return observable; };
        }
    };
    /**
     * Pipeable operator to apply converter logic in a observable stream to collection of items
     */
    ConverterService.prototype.pipeableMany = function (injectionToken) {
        var _this = this;
        if (this.hasConverters(injectionToken)) {
            return map(function (model) { return _this.convertMany(model, injectionToken); });
        }
        else {
            return function (observable) { return observable; };
        }
    };
    /**
     * Apply converter logic specified by injection token to source data
     */
    ConverterService.prototype.convert = function (source, injectionToken) {
        if (this.hasConverters(injectionToken)) {
            return this.convertSource(source, injectionToken);
        }
        else {
            return source;
        }
    };
    /**
     * Apply converter logic specified by injection token to a collection
     */
    ConverterService.prototype.convertMany = function (sources, injectionToken) {
        var _this = this;
        if (this.hasConverters(injectionToken) && Array.isArray(sources)) {
            return sources.map(function (source) {
                return _this.convertSource(source, injectionToken);
            });
        }
        else {
            return sources;
        }
    };
    ConverterService.prototype.convertSource = function (source, injectionToken) {
        return this.getConverters(injectionToken).reduce(function (target, converter) {
            return converter.convert(source, target);
        }, undefined);
    };
    ConverterService.ctorParameters = function () { return [
        { type: Injector }
    ]; };
    ConverterService.ɵprov = ɵɵdefineInjectable({ factory: function ConverterService_Factory() { return new ConverterService(ɵɵinject(INJECTOR)); }, token: ConverterService, providedIn: "root" });
    ConverterService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], ConverterService);
    return ConverterService;
}());

var OccAsmAdapter = /** @class */ (function () {
    function OccAsmAdapter(http, occEndpointsService, converterService, config, baseSiteService) {
        var _this = this;
        this.http = http;
        this.occEndpointsService = occEndpointsService;
        this.converterService = converterService;
        this.config = config;
        this.baseSiteService = baseSiteService;
        this.baseSiteService
            .getActive()
            .subscribe(function (value) { return (_this.activeBaseSite = value); });
    }
    OccAsmAdapter.prototype.customerSearch = function (options) {
        var headers = InterceptorUtil.createHeader(USE_CUSTOMER_SUPPORT_AGENT_TOKEN, true, new HttpHeaders());
        var params = new HttpParams()
            .set('baseSite', this.activeBaseSite)
            .set('sort', 'byNameAsc');
        if (typeof options['query'] !== 'undefined') {
            params = params.set('query', '' + options.query);
        }
        if (typeof options['pageSize'] !== 'undefined') {
            params = params.set('pageSize', '' + options.pageSize);
        }
        var url = this.occEndpointsService.getRawEndpoint('asmCustomerSearch');
        return this.http
            .get(url, { headers: headers, params: params })
            .pipe(this.converterService.pipeable(CUSTOMER_SEARCH_PAGE_NORMALIZER));
    };
    OccAsmAdapter.ctorParameters = function () { return [
        { type: HttpClient },
        { type: OccEndpointsService },
        { type: ConverterService },
        { type: AsmConfig },
        { type: BaseSiteService }
    ]; };
    OccAsmAdapter = __decorate([
        Injectable()
    ], OccAsmAdapter);
    return OccAsmAdapter;
}());

var AsmOccModule = /** @class */ (function () {
    function AsmOccModule() {
    }
    AsmOccModule = __decorate([
        NgModule({
            imports: [CommonModule, HttpClientModule],
            providers: [
                provideDefaultConfig(defaultOccAsmConfig),
                {
                    provide: AsmAdapter,
                    useClass: OccAsmAdapter,
                },
            ],
        })
    ], AsmOccModule);
    return AsmOccModule;
}());

var CartAdapter = /** @class */ (function () {
    function CartAdapter() {
    }
    return CartAdapter;
}());

var CART_NORMALIZER = new InjectionToken('CartNormalizer');

var CartEntryAdapter = /** @class */ (function () {
    function CartEntryAdapter() {
    }
    return CartEntryAdapter;
}());

var SaveCartAdapter = /** @class */ (function () {
    function SaveCartAdapter() {
    }
    return SaveCartAdapter;
}());

var CartVoucherAdapter = /** @class */ (function () {
    function CartVoucherAdapter() {
    }
    return CartVoucherAdapter;
}());

var PRODUCT_NORMALIZER = new InjectionToken('ProductNormalizer');

var OccCartNormalizer = /** @class */ (function () {
    function OccCartNormalizer(converter) {
        this.converter = converter;
    }
    OccCartNormalizer.prototype.convert = function (source, target) {
        var _this = this;
        if (target === undefined) {
            target = __assign({}, source);
        }
        if (source && source.entries) {
            target.entries = source.entries.map(function (entry) { return (__assign(__assign({}, entry), { product: _this.converter.convert(entry.product, PRODUCT_NORMALIZER) })); });
        }
        this.removeDuplicatePromotions(source, target);
        return target;
    };
    /**
     * Remove all duplicate promotions
     */
    OccCartNormalizer.prototype.removeDuplicatePromotions = function (source, target) {
        if (source && source.potentialOrderPromotions) {
            target.potentialOrderPromotions = this.removeDuplicateItems(source.potentialOrderPromotions);
        }
        if (source && source.potentialProductPromotions) {
            target.potentialProductPromotions = this.removeDuplicateItems(source.potentialProductPromotions);
        }
        if (source && source.appliedOrderPromotions) {
            target.appliedOrderPromotions = this.removeDuplicateItems(source.appliedOrderPromotions);
        }
        if (source && source.appliedProductPromotions) {
            target.appliedProductPromotions = this.removeDuplicateItems(source.appliedProductPromotions);
        }
    };
    OccCartNormalizer.prototype.removeDuplicateItems = function (itemList) {
        return itemList.filter(function (p, i, a) {
            var b = a.map(function (el) { return JSON.stringify(el); });
            return i === b.indexOf(JSON.stringify(p));
        });
    };
    OccCartNormalizer.ctorParameters = function () { return [
        { type: ConverterService }
    ]; };
    OccCartNormalizer.ɵprov = ɵɵdefineInjectable({ factory: function OccCartNormalizer_Factory() { return new OccCartNormalizer(ɵɵinject(ConverterService)); }, token: OccCartNormalizer, providedIn: "root" });
    OccCartNormalizer = __decorate([
        Injectable({ providedIn: 'root' })
    ], OccCartNormalizer);
    return OccCartNormalizer;
}());

var defaultOccCartConfig = {
    backend: {
        occ: {
            endpoints: {
                // tslint:disable:max-line-length
                carts: 'users/${userId}/carts?fields=carts(DEFAULT,potentialProductPromotions,appliedProductPromotions,potentialOrderPromotions,appliedOrderPromotions,entries(totalPrice(formattedValue),product(images(FULL),stock(FULL)),basePrice(formattedValue,value),updateable),totalPrice(formattedValue),totalItems,totalPriceWithTax(formattedValue),totalDiscounts(value,formattedValue),subTotal(formattedValue),deliveryItemsQuantity,deliveryCost(formattedValue),totalTax(formattedValue, value),pickupItemsQuantity,net,appliedVouchers,productDiscounts(formattedValue),saveTime,user,name)',
                cart: 'users/${userId}/carts/${cartId}?fields=DEFAULT,potentialProductPromotions,appliedProductPromotions,potentialOrderPromotions,appliedOrderPromotions,entries(totalPrice(formattedValue),product(images(FULL),stock(FULL)),basePrice(formattedValue,value),updateable),totalPrice(formattedValue),totalItems,totalPriceWithTax(formattedValue),totalDiscounts(value,formattedValue),subTotal(formattedValue),deliveryItemsQuantity,deliveryCost(formattedValue),totalTax(formattedValue, value),pickupItemsQuantity,net,appliedVouchers,productDiscounts(formattedValue),user',
                createCart: 'users/${userId}/carts?fields=DEFAULT,potentialProductPromotions,appliedProductPromotions,potentialOrderPromotions,appliedOrderPromotions,entries(totalPrice(formattedValue),product(images(FULL),stock(FULL)),basePrice(formattedValue,value),updateable),totalPrice(formattedValue),totalItems,totalPriceWithTax(formattedValue),totalDiscounts(value,formattedValue),subTotal(formattedValue),deliveryItemsQuantity,deliveryCost(formattedValue),totalTax(formattedValue, value),pickupItemsQuantity,net,appliedVouchers,productDiscounts(formattedValue),user',
                addEntries: 'users/${userId}/carts/${cartId}/entries',
                updateEntries: 'users/${userId}/carts/${cartId}/entries/${entryNumber}',
                removeEntries: 'users/${userId}/carts/${cartId}/entries/${entryNumber}',
                addEmail: 'users/${userId}/carts/${cartId}/email',
                deleteCart: 'users/${userId}/carts/${cartId}',
                cartVoucher: 'users/${userId}/carts/${cartId}/vouchers',
                saveCart: 'users/${userId}/carts/${cartId}/save',
            },
        },
    },
};

var CART_MODIFICATION_NORMALIZER = new InjectionToken('CartModificationNormalizer');

var OccCartEntryAdapter = /** @class */ (function () {
    function OccCartEntryAdapter(http, occEndpointsService, converterService) {
        this.http = http;
        this.occEndpointsService = occEndpointsService;
        this.converterService = converterService;
    }
    OccCartEntryAdapter.prototype.add = function (userId, cartId, productCode, quantity) {
        if (quantity === void 0) { quantity = 1; }
        var toAdd = JSON.stringify({});
        var headers = new HttpHeaders({
            'Content-Type': 'application/x-www-form-urlencoded',
        });
        var url = this.occEndpointsService.getUrl('addEntries', {
            userId: userId,
            cartId: cartId,
        }, { code: productCode, qty: quantity });
        return this.http
            .post(url, toAdd, { headers: headers })
            .pipe(this.converterService.pipeable(CART_MODIFICATION_NORMALIZER));
    };
    OccCartEntryAdapter.prototype.update = function (userId, cartId, entryNumber, qty, pickupStore) {
        var params = {};
        if (pickupStore) {
            params = { pickupStore: pickupStore };
        }
        var headers = new HttpHeaders({
            'Content-Type': 'application/x-www-form-urlencoded',
        });
        var url = this.occEndpointsService.getUrl('updateEntries', { userId: userId, cartId: cartId, entryNumber: entryNumber }, __assign({ qty: qty }, params));
        return this.http
            .patch(url, {}, { headers: headers })
            .pipe(this.converterService.pipeable(CART_MODIFICATION_NORMALIZER));
    };
    OccCartEntryAdapter.prototype.remove = function (userId, cartId, entryNumber) {
        var headers = new HttpHeaders({
            'Content-Type': 'application/x-www-form-urlencoded',
        });
        var url = this.occEndpointsService.getUrl('removeEntries', {
            userId: userId,
            cartId: cartId,
            entryNumber: entryNumber,
        });
        return this.http.delete(url, { headers: headers });
    };
    OccCartEntryAdapter.ctorParameters = function () { return [
        { type: HttpClient },
        { type: OccEndpointsService },
        { type: ConverterService }
    ]; };
    OccCartEntryAdapter = __decorate([
        Injectable()
    ], OccCartEntryAdapter);
    return OccCartEntryAdapter;
}());

var CART_VOUCHER_NORMALIZER = new InjectionToken('CartVoucherNormalizer');

var OccCartVoucherAdapter = /** @class */ (function () {
    function OccCartVoucherAdapter(http, occEndpoints, converter) {
        this.http = http;
        this.occEndpoints = occEndpoints;
        this.converter = converter;
    }
    OccCartVoucherAdapter.prototype.getCartVoucherEndpoint = function (userId, cartId) {
        return this.occEndpoints.getUrl('cartVoucher', { userId: userId, cartId: cartId });
    };
    OccCartVoucherAdapter.prototype.getHeaders = function (userId) {
        var headers = new HttpHeaders({
            'Content-Type': 'application/json',
        });
        if (userId === OCC_USER_ID_ANONYMOUS) {
            headers = InterceptorUtil.createHeader(USE_CLIENT_TOKEN, true, headers);
        }
        return headers;
    };
    OccCartVoucherAdapter.prototype.add = function (userId, cartId, voucherId) {
        var url = this.getCartVoucherEndpoint(userId, cartId);
        var toAdd = JSON.stringify({});
        var params = new HttpParams().set('voucherId', voucherId);
        var headers = this.getHeaders(userId);
        return this.http.post(url, toAdd, { headers: headers, params: params }).pipe(catchError(function (error) { return throwError(error); }), this.converter.pipeable(CART_VOUCHER_NORMALIZER));
    };
    OccCartVoucherAdapter.prototype.remove = function (userId, cartId, voucherId) {
        var url = this.getCartVoucherEndpoint(userId, cartId) +
            '/' +
            encodeURIComponent(voucherId);
        var headers = this.getHeaders(userId);
        return this.http
            .delete(url, { headers: headers })
            .pipe(catchError(function (error) { return throwError(error); }));
    };
    OccCartVoucherAdapter.ctorParameters = function () { return [
        { type: HttpClient },
        { type: OccEndpointsService },
        { type: ConverterService }
    ]; };
    OccCartVoucherAdapter = __decorate([
        Injectable()
    ], OccCartVoucherAdapter);
    return OccCartVoucherAdapter;
}());

var OccCartAdapter = /** @class */ (function () {
    function OccCartAdapter(http, occEndpointsService, converterService) {
        this.http = http;
        this.occEndpointsService = occEndpointsService;
        this.converterService = converterService;
    }
    OccCartAdapter.prototype.loadAll = function (userId) {
        return this.http
            .get(this.occEndpointsService.getUrl('carts', { userId: userId }))
            .pipe(pluck('carts'), this.converterService.pipeableMany(CART_NORMALIZER));
    };
    OccCartAdapter.prototype.load = function (userId, cartId) {
        if (cartId === OCC_CART_ID_CURRENT) {
            return this.loadAll(userId).pipe(map(function (carts) {
                if (carts) {
                    var activeCart = carts.find(function (cart) {
                        return cart['saveTime'] === undefined;
                    });
                    return activeCart;
                }
                else {
                    return null;
                }
            }));
        }
        else {
            return this.http
                .get(this.occEndpointsService.getUrl('cart', { userId: userId, cartId: cartId }))
                .pipe(this.converterService.pipeable(CART_NORMALIZER));
        }
    };
    OccCartAdapter.prototype.create = function (userId, oldCartId, toMergeCartGuid) {
        var toAdd = JSON.stringify({});
        var params = {};
        if (oldCartId) {
            params = { oldCartId: oldCartId };
        }
        if (toMergeCartGuid) {
            params['toMergeCartGuid'] = toMergeCartGuid;
        }
        return this.http
            .post(this.occEndpointsService.getUrl('createCart', { userId: userId }, params), toAdd)
            .pipe(this.converterService.pipeable(CART_NORMALIZER));
    };
    OccCartAdapter.prototype.delete = function (userId, cartId) {
        var headers = new HttpHeaders();
        if (userId === OCC_USER_ID_ANONYMOUS) {
            headers = InterceptorUtil.createHeader(USE_CLIENT_TOKEN, true, headers);
        }
        return this.http.delete(this.occEndpointsService.getUrl('deleteCart', { userId: userId, cartId: cartId }), { headers: headers });
    };
    OccCartAdapter.prototype.addEmail = function (userId, cartId, email) {
        var headers = new HttpHeaders({
            'Content-Type': 'application/x-www-form-urlencoded',
        });
        headers = InterceptorUtil.createHeader(USE_CLIENT_TOKEN, true, headers);
        var httpParams = new HttpParams().set('email', email);
        var url = this.occEndpointsService.getUrl('addEmail', {
            userId: userId,
            cartId: cartId,
        });
        return this.http.put(url, httpParams, { headers: headers });
    };
    OccCartAdapter.ctorParameters = function () { return [
        { type: HttpClient },
        { type: OccEndpointsService },
        { type: ConverterService }
    ]; };
    OccCartAdapter = __decorate([
        Injectable()
    ], OccCartAdapter);
    return OccCartAdapter;
}());

var SAVE_CART_NORMALIZER = new InjectionToken('SaveCartNormalizer');

var OccSaveCartAdapter = /** @class */ (function () {
    function OccSaveCartAdapter(http, occEndpointsService, converterService) {
        this.http = http;
        this.occEndpointsService = occEndpointsService;
        this.converterService = converterService;
    }
    OccSaveCartAdapter.prototype.saveCart = function (userId, cartId, saveCartName, saveCartDescription) {
        var httpParams = new HttpParams();
        if (Boolean(saveCartName)) {
            httpParams = httpParams.set('saveCartName', saveCartName);
        }
        if (Boolean(saveCartDescription)) {
            httpParams = httpParams.set('saveCartDescription', saveCartDescription);
        }
        var headers = new HttpHeaders({
            'Content-Type': 'application/x-www-form-urlencoded',
        });
        return this.http
            .patch(this.occEndpointsService.getUrl('saveCart', { userId: userId, cartId: cartId }), httpParams, { headers: headers })
            .pipe(this.converterService.pipeable(SAVE_CART_NORMALIZER));
    };
    OccSaveCartAdapter.ctorParameters = function () { return [
        { type: HttpClient },
        { type: OccEndpointsService },
        { type: ConverterService }
    ]; };
    OccSaveCartAdapter = __decorate([
        Injectable()
    ], OccSaveCartAdapter);
    return OccSaveCartAdapter;
}());

var CartOccModule = /** @class */ (function () {
    function CartOccModule() {
    }
    CartOccModule = __decorate([
        NgModule({
            imports: [CommonModule, HttpClientModule],
            providers: [
                provideDefaultConfig(defaultOccCartConfig),
                {
                    provide: CartAdapter,
                    useClass: OccCartAdapter,
                },
                {
                    provide: CART_NORMALIZER,
                    useExisting: OccCartNormalizer,
                    multi: true,
                },
                {
                    provide: CartEntryAdapter,
                    useClass: OccCartEntryAdapter,
                },
                {
                    provide: CartVoucherAdapter,
                    useClass: OccCartVoucherAdapter,
                },
                {
                    provide: SaveCartAdapter,
                    useClass: OccSaveCartAdapter,
                },
            ],
        })
    ], CartOccModule);
    return CartOccModule;
}());

var ORDER_NORMALIZER = new InjectionToken('OrderNormalizer');

// To be changed to a more optimised params after ticket: C3PO-1076
var FULL_PARAMS = 'fields=FULL';
var CHECKOUT_PARAMS = 'deliveryAddress(FULL),deliveryMode,paymentInfo(FULL)';
var ORDERS_ENDPOINT = '/orders';
var CARTS_ENDPOINT = '/carts/';
var OccCheckoutAdapter = /** @class */ (function () {
    function OccCheckoutAdapter(http, occEndpoints, converter) {
        this.http = http;
        this.occEndpoints = occEndpoints;
        this.converter = converter;
    }
    OccCheckoutAdapter.prototype.getEndpoint = function (userId, subEndpoint) {
        var orderEndpoint = 'users/' + userId + subEndpoint;
        return this.occEndpoints.getEndpoint(orderEndpoint);
    };
    OccCheckoutAdapter.prototype.placeOrder = function (userId, cartId) {
        var url = this.getEndpoint(userId, ORDERS_ENDPOINT);
        var params = new HttpParams({
            fromString: 'cartId=' + cartId + '&' + FULL_PARAMS,
        });
        var headers = new HttpHeaders({
            'Content-Type': 'application/x-www-form-urlencoded',
        });
        if (userId === OCC_USER_ID_ANONYMOUS) {
            headers = InterceptorUtil.createHeader(USE_CLIENT_TOKEN, true, headers);
        }
        return this.http
            .post(url, {}, { headers: headers, params: params })
            .pipe(this.converter.pipeable(ORDER_NORMALIZER));
    };
    OccCheckoutAdapter.prototype.loadCheckoutDetails = function (userId, cartId) {
        var url = this.getEndpoint(userId, CARTS_ENDPOINT) + cartId;
        var params = new HttpParams({
            fromString: "fields=" + CHECKOUT_PARAMS,
        });
        return this.http.get(url, { params: params });
    };
    OccCheckoutAdapter.prototype.clearCheckoutDeliveryAddress = function (userId, cartId) {
        var url = "" + this.getEndpoint(userId, CARTS_ENDPOINT) + cartId + "/addresses/delivery";
        return this.http.delete(url);
    };
    OccCheckoutAdapter.prototype.clearCheckoutDeliveryMode = function (userId, cartId) {
        var url = "" + this.getEndpoint(userId, CARTS_ENDPOINT) + cartId + "/deliverymode";
        return this.http.delete(url);
    };
    OccCheckoutAdapter.ctorParameters = function () { return [
        { type: HttpClient },
        { type: OccEndpointsService },
        { type: ConverterService }
    ]; };
    OccCheckoutAdapter = __decorate([
        Injectable()
    ], OccCheckoutAdapter);
    return OccCheckoutAdapter;
}());

var DELIVERY_MODE_NORMALIZER = new InjectionToken('DeliveryModeNormalizer');

var ADDRESS_NORMALIZER = new InjectionToken('AddressNormalizer');
var ADDRESS_SERIALIZER = new InjectionToken('AddressSerializer');
var ADDRESS_VALIDATION_NORMALIZER = new InjectionToken('AddressValidationNormalizer');

var OccCheckoutDeliveryAdapter = /** @class */ (function () {
    function OccCheckoutDeliveryAdapter(http, occEndpoints, converter) {
        this.http = http;
        this.occEndpoints = occEndpoints;
        this.converter = converter;
    }
    OccCheckoutDeliveryAdapter.prototype.getCartEndpoint = function (userId) {
        var cartEndpoint = 'users/' + userId + '/carts/';
        return this.occEndpoints.getEndpoint(cartEndpoint);
    };
    OccCheckoutDeliveryAdapter.prototype.createAddress = function (userId, cartId, address) {
        address = this.converter.convert(address, ADDRESS_SERIALIZER);
        return this.http
            .post(this.getCartEndpoint(userId) + cartId + '/addresses/delivery', address, {
            headers: new HttpHeaders().set('Content-Type', 'application/json'),
        })
            .pipe(this.converter.pipeable(ADDRESS_NORMALIZER));
    };
    OccCheckoutDeliveryAdapter.prototype.setAddress = function (userId, cartId, addressId) {
        return this.http.put(this.getCartEndpoint(userId) + cartId + '/addresses/delivery', {}, {
            params: { addressId: addressId },
        });
    };
    OccCheckoutDeliveryAdapter.prototype.setMode = function (userId, cartId, deliveryModeId) {
        return this.http.put(this.getCartEndpoint(userId) + cartId + '/deliverymode', {}, {
            params: { deliveryModeId: deliveryModeId },
        });
    };
    OccCheckoutDeliveryAdapter.prototype.getMode = function (userId, cartId) {
        return this.http
            .get(this.getCartEndpoint(userId) + cartId + '/deliverymode')
            .pipe(this.converter.pipeable(DELIVERY_MODE_NORMALIZER));
    };
    OccCheckoutDeliveryAdapter.prototype.getSupportedModes = function (userId, cartId) {
        return this.http
            .get(this.getCartEndpoint(userId) + cartId + '/deliverymodes')
            .pipe(pluck('deliveryModes'), this.converter.pipeableMany(DELIVERY_MODE_NORMALIZER));
    };
    OccCheckoutDeliveryAdapter.ctorParameters = function () { return [
        { type: HttpClient },
        { type: OccEndpointsService },
        { type: ConverterService }
    ]; };
    OccCheckoutDeliveryAdapter = __decorate([
        Injectable()
    ], OccCheckoutDeliveryAdapter);
    return OccCheckoutDeliveryAdapter;
}());

var PAYMENT_DETAILS_NORMALIZER = new InjectionToken('PaymentDetailsNormalizer');
var PAYMENT_DETAILS_SERIALIZER = new InjectionToken('PaymentDetailsSerializer');
var CARD_TYPE_NORMALIZER = new InjectionToken('CardTypeNormalizer');

var ENDPOINT_CARD_TYPES = 'cardtypes';
var OccCheckoutPaymentAdapter = /** @class */ (function () {
    function OccCheckoutPaymentAdapter(http, occEndpoints, converter) {
        this.http = http;
        this.occEndpoints = occEndpoints;
        this.converter = converter;
        if (typeof DOMParser !== 'undefined') {
            this.domparser = new DOMParser();
        }
    }
    OccCheckoutPaymentAdapter.prototype.getCartEndpoint = function (userId) {
        var cartEndpoint = 'users/' + userId + '/carts/';
        return this.occEndpoints.getEndpoint(cartEndpoint);
    };
    OccCheckoutPaymentAdapter.prototype.create = function (userId, cartId, paymentDetails) {
        var _this = this;
        paymentDetails = this.converter.convert(paymentDetails, PAYMENT_DETAILS_SERIALIZER);
        return this.getProviderSubInfo(userId, cartId).pipe(map(function (data) {
            var labelsMap = _this.convertToMap(data.mappingLabels.entry);
            return {
                url: data.postUrl,
                parameters: _this.getParamsForPaymentProvider(paymentDetails, data.parameters.entry, labelsMap),
                mappingLabels: labelsMap,
            };
        }), mergeMap(function (sub) {
            // create a subscription directly with payment provider
            return _this.createSubWithProvider(sub.url, sub.parameters).pipe(map(function (response) { return _this.extractPaymentDetailsFromHtml(response); }), mergeMap(function (fromPaymentProvider) {
                fromPaymentProvider['defaultPayment'] =
                    paymentDetails.defaultPayment;
                fromPaymentProvider['savePaymentInfo'] = true;
                return _this.createDetailsWithParameters(userId, cartId, fromPaymentProvider).pipe(_this.converter.pipeable(PAYMENT_DETAILS_NORMALIZER));
            }));
        }));
    };
    OccCheckoutPaymentAdapter.prototype.set = function (userId, cartId, paymentDetailsId) {
        return this.http.put(this.getCartEndpoint(userId) + cartId + '/paymentdetails', {}, {
            params: { paymentDetailsId: paymentDetailsId },
        });
    };
    OccCheckoutPaymentAdapter.prototype.loadCardTypes = function () {
        return this.http
            .get(this.occEndpoints.getEndpoint(ENDPOINT_CARD_TYPES))
            .pipe(map(function (cardTypeList) { return cardTypeList.cardTypes; }), this.converter.pipeableMany(CARD_TYPE_NORMALIZER));
    };
    OccCheckoutPaymentAdapter.prototype.getProviderSubInfo = function (userId, cartId) {
        return this.http.get(this.getCartEndpoint(userId) +
            cartId +
            '/payment/sop/request?responseUrl=sampleUrl');
    };
    OccCheckoutPaymentAdapter.prototype.createSubWithProvider = function (postUrl, parameters) {
        var headers = new HttpHeaders({
            'Content-Type': 'application/x-www-form-urlencoded',
            Accept: 'text/html',
        });
        var httpParams = new HttpParams({ encoder: new CustomEncoder() });
        Object.keys(parameters).forEach(function (key) {
            httpParams = httpParams.append(key, parameters[key]);
        });
        return this.http.post(postUrl, httpParams, {
            headers: headers,
            responseType: 'text',
        });
    };
    OccCheckoutPaymentAdapter.prototype.createDetailsWithParameters = function (userId, cartId, parameters) {
        var httpParams = new HttpParams({ encoder: new CustomEncoder() });
        Object.keys(parameters).forEach(function (key) {
            httpParams = httpParams.append(key, parameters[key]);
        });
        var headers = new HttpHeaders({
            'Content-Type': 'application/x-www-form-urlencoded',
        });
        return this.http.post(this.getCartEndpoint(userId) + cartId + '/payment/sop/response', httpParams, { headers: headers });
    };
    OccCheckoutPaymentAdapter.prototype.getParamsForPaymentProvider = function (paymentDetails, parameters, mappingLabels) {
        var params = this.convertToMap(parameters);
        params[mappingLabels['hybris_account_holder_name']] =
            paymentDetails.accountHolderName;
        params[mappingLabels['hybris_card_type']] = paymentDetails.cardType.code;
        params[mappingLabels['hybris_card_number']] = paymentDetails.cardNumber;
        if (mappingLabels['hybris_combined_expiry_date'] === 'true') {
            params[mappingLabels['hybris_card_expiry_date']] =
                paymentDetails.expiryMonth +
                    mappingLabels['hybris_separator_expiry_date'] +
                    paymentDetails.expiryYear;
        }
        else {
            params[mappingLabels['hybris_card_expiration_month']] =
                paymentDetails.expiryMonth;
            params[mappingLabels['hybris_card_expiration_year']] =
                paymentDetails.expiryYear;
        }
        params[mappingLabels['hybris_card_cvn']] = paymentDetails.cvn;
        // billing address
        params[mappingLabels['hybris_billTo_country']] =
            paymentDetails.billingAddress.country.isocode;
        params[mappingLabels['hybris_billTo_firstname']] =
            paymentDetails.billingAddress.firstName;
        params[mappingLabels['hybris_billTo_lastname']] =
            paymentDetails.billingAddress.lastName;
        params[mappingLabels['hybris_billTo_street1']] =
            paymentDetails.billingAddress.line1 +
                ' ' +
                paymentDetails.billingAddress.line2;
        params[mappingLabels['hybris_billTo_city']] =
            paymentDetails.billingAddress.town;
        if (paymentDetails.billingAddress.region) {
            params[mappingLabels['hybris_billTo_region']] =
                paymentDetails.billingAddress.region.isocodeShort;
        }
        else {
            params[mappingLabels['hybris_billTo_region']] = '';
        }
        params[mappingLabels['hybris_billTo_postalcode']] =
            paymentDetails.billingAddress.postalCode;
        return params;
    };
    OccCheckoutPaymentAdapter.prototype.extractPaymentDetailsFromHtml = function (html) {
        var domdoc = this.domparser.parseFromString(html, 'text/xml');
        var responseForm = domdoc.getElementsByTagName('form')[0];
        var inputs = responseForm.getElementsByTagName('input');
        var values = {};
        for (var i = 0; inputs[i]; i++) {
            var input = inputs[i];
            if (input.getAttribute('name') !== '{}' &&
                input.getAttribute('value') !== '') {
                values[input.getAttribute('name')] = input.getAttribute('value');
            }
        }
        return values;
    };
    OccCheckoutPaymentAdapter.prototype.convertToMap = function (paramList) {
        return paramList.reduce(function (result, item) {
            var key = item.key;
            result[key] = item.value;
            return result;
        }, {});
    };
    OccCheckoutPaymentAdapter.ctorParameters = function () { return [
        { type: HttpClient },
        { type: OccEndpointsService },
        { type: ConverterService }
    ]; };
    OccCheckoutPaymentAdapter = __decorate([
        Injectable()
    ], OccCheckoutPaymentAdapter);
    return OccCheckoutPaymentAdapter;
}());

var CheckoutAdapter = /** @class */ (function () {
    function CheckoutAdapter() {
    }
    return CheckoutAdapter;
}());

var OccOrderNormalizer = /** @class */ (function () {
    function OccOrderNormalizer(converter) {
        this.converter = converter;
    }
    OccOrderNormalizer.prototype.convert = function (source, target) {
        var _this = this;
        if (target === undefined) {
            target = __assign({}, source);
        }
        if (source.entries) {
            target.entries = source.entries.map(function (entry) {
                return _this.convertOrderEntry(entry);
            });
        }
        if (source.consignments) {
            target.consignments = source.consignments.map(function (consignment) { return (__assign(__assign({}, consignment), { entries: consignment.entries.map(function (entry) { return (__assign(__assign({}, entry), { orderEntry: _this.convertOrderEntry(entry.orderEntry) })); }) })); });
        }
        if (source.unconsignedEntries) {
            target.unconsignedEntries = source.unconsignedEntries.map(function (entry) {
                return _this.convertOrderEntry(entry);
            });
        }
        return target;
    };
    OccOrderNormalizer.prototype.convertOrderEntry = function (source) {
        return __assign(__assign({}, source), { product: this.converter.convert(source.product, PRODUCT_NORMALIZER) });
    };
    OccOrderNormalizer.ctorParameters = function () { return [
        { type: ConverterService }
    ]; };
    OccOrderNormalizer.ɵprov = ɵɵdefineInjectable({ factory: function OccOrderNormalizer_Factory() { return new OccOrderNormalizer(ɵɵinject(ConverterService)); }, token: OccOrderNormalizer, providedIn: "root" });
    OccOrderNormalizer = __decorate([
        Injectable({ providedIn: 'root' })
    ], OccOrderNormalizer);
    return OccOrderNormalizer;
}());

var CheckoutDeliveryAdapter = /** @class */ (function () {
    function CheckoutDeliveryAdapter() {
    }
    return CheckoutDeliveryAdapter;
}());

var CheckoutPaymentAdapter = /** @class */ (function () {
    function CheckoutPaymentAdapter() {
    }
    return CheckoutPaymentAdapter;
}());

var CheckoutOccModule = /** @class */ (function () {
    function CheckoutOccModule() {
    }
    CheckoutOccModule = __decorate([
        NgModule({
            imports: [CommonModule, HttpClientModule],
            providers: [
                {
                    provide: CheckoutAdapter,
                    useClass: OccCheckoutAdapter,
                },
                { provide: ORDER_NORMALIZER, useExisting: OccOrderNormalizer, multi: true },
                {
                    provide: CheckoutDeliveryAdapter,
                    useClass: OccCheckoutDeliveryAdapter,
                },
                {
                    provide: CheckoutPaymentAdapter,
                    useClass: OccCheckoutPaymentAdapter,
                },
            ],
        })
    ], CheckoutOccModule);
    return CheckoutOccModule;
}());

var CMS_PAGE_NORMALIZER = new InjectionToken('CmsPageNormalizer');

var OccCmsPageAdapter = /** @class */ (function () {
    function OccCmsPageAdapter(http, occEndpoints, converter) {
        this.http = http;
        this.occEndpoints = occEndpoints;
        this.converter = converter;
        this.headers = new HttpHeaders().set('Content-Type', 'application/json');
    }
    OccCmsPageAdapter.prototype.load = function (pageContext, fields) {
        // load page by Id
        if (pageContext.type === undefined) {
            return this.http
                .get(this.occEndpoints.getUrl('page', {
                id: pageContext.id,
            }, { fields: fields ? fields : 'DEFAULT' }), {
                headers: this.headers,
            })
                .pipe(this.converter.pipeable(CMS_PAGE_NORMALIZER));
        }
        // load page by PageContext
        var httpParams = this.getPagesRequestParams(pageContext);
        return this.http
            .get(this.getPagesEndpoint(httpParams, fields), {
            headers: this.headers,
        })
            .pipe(this.converter.pipeable(CMS_PAGE_NORMALIZER));
    };
    OccCmsPageAdapter.prototype.getPagesEndpoint = function (params, fields) {
        fields = fields ? fields : 'DEFAULT';
        return this.occEndpoints.getUrl('pages', {}, __assign({ fields: fields }, params));
    };
    OccCmsPageAdapter.prototype.getPagesRequestParams = function (pageContext) {
        var httpParams = {};
        // smartedit preview page is loaded by previewToken which added by interceptor
        if (pageContext.id !== 'smartedit-preview') {
            httpParams = { pageType: pageContext.type };
            if (pageContext.type === PageType.CONTENT_PAGE) {
                httpParams['pageLabelOrId'] = pageContext.id;
            }
            else {
                httpParams['code'] = pageContext.id;
            }
        }
        return httpParams;
    };
    OccCmsPageAdapter.ctorParameters = function () { return [
        { type: HttpClient },
        { type: OccEndpointsService },
        { type: ConverterService }
    ]; };
    OccCmsPageAdapter = __decorate([
        Injectable()
    ], OccCmsPageAdapter);
    return OccCmsPageAdapter;
}());

var CMS_COMPONENT_NORMALIZER = new InjectionToken('CmsComponentNormalizer');

var OccCmsComponentAdapter = /** @class */ (function () {
    function OccCmsComponentAdapter(http, occEndpoints, converter) {
        this.http = http;
        this.occEndpoints = occEndpoints;
        this.converter = converter;
        this.headers = new HttpHeaders().set('Content-Type', 'application/json');
    }
    OccCmsComponentAdapter.prototype.load = function (id, pageContext) {
        return this.http
            .get(this.getComponentEndPoint(id, pageContext), {
            headers: this.headers,
        })
            .pipe(this.converter.pipeable(CMS_COMPONENT_NORMALIZER));
    };
    OccCmsComponentAdapter.prototype.findComponentsByIds = function (ids, pageContext, fields, currentPage, pageSize, sort) {
        if (fields === void 0) { fields = 'DEFAULT'; }
        if (currentPage === void 0) { currentPage = 0; }
        if (pageSize === void 0) { pageSize = ids.length; }
        var requestParams = __assign(__assign({}, this.getContextParams(pageContext)), this.getPaginationParams(currentPage, pageSize, sort));
        requestParams['componentIds'] = ids.toString();
        return this.http
            .get(this.getComponentsEndpoint(requestParams, fields), {
            headers: this.headers,
        })
            .pipe(pluck('component'), this.converter.pipeableMany(CMS_COMPONENT_NORMALIZER));
    };
    OccCmsComponentAdapter.prototype.findComponentsByIdsLegacy = function (ids, pageContext, fields, currentPage, pageSize, sort) {
        if (fields === void 0) { fields = 'DEFAULT'; }
        if (currentPage === void 0) { currentPage = 0; }
        if (pageSize === void 0) { pageSize = ids.length; }
        var idList = { idList: ids };
        var requestParams = __assign(__assign({}, this.getContextParams(pageContext)), this.getPaginationParams(currentPage, pageSize, sort));
        return this.http
            .post(this.getComponentsEndpoint(requestParams, fields), idList, {
            headers: this.headers,
        })
            .pipe(pluck('component'), this.converter.pipeableMany(CMS_COMPONENT_NORMALIZER));
    };
    OccCmsComponentAdapter.prototype.getComponentEndPoint = function (id, pageContext) {
        return this.occEndpoints.getUrl('component', { id: id }, this.getContextParams(pageContext));
    };
    OccCmsComponentAdapter.prototype.getComponentsEndpoint = function (requestParams, fields) {
        return this.occEndpoints.getUrl('components', {}, __assign({ fields: fields }, requestParams));
    };
    OccCmsComponentAdapter.prototype.getPaginationParams = function (currentPage, pageSize, sort) {
        var requestParams = {};
        if (currentPage !== undefined) {
            requestParams['currentPage'] = currentPage.toString();
        }
        if (pageSize !== undefined) {
            requestParams['pageSize'] = pageSize.toString();
        }
        if (sort !== undefined) {
            requestParams['sort'] = sort;
        }
        return requestParams;
    };
    OccCmsComponentAdapter.prototype.getContextParams = function (pageContext) {
        var requestParams = {};
        switch (pageContext.type) {
            case PageType.PRODUCT_PAGE: {
                requestParams = { productCode: pageContext.id };
                break;
            }
            case PageType.CATEGORY_PAGE: {
                requestParams = { categoryCode: pageContext.id };
                break;
            }
            case PageType.CATALOG_PAGE: {
                requestParams = { catalogCode: pageContext.id };
                break;
            }
        }
        return requestParams;
    };
    OccCmsComponentAdapter.ctorParameters = function () { return [
        { type: HttpClient },
        { type: OccEndpointsService },
        { type: ConverterService }
    ]; };
    OccCmsComponentAdapter = __decorate([
        Injectable()
    ], OccCmsComponentAdapter);
    return OccCmsComponentAdapter;
}());

var JSP_INCLUDE_CMS_COMPONENT_TYPE = 'JspIncludeComponent';
var CMS_FLEX_COMPONENT_TYPE = 'CMSFlexComponent';
/** Strategy to control the loading strategy of DOM elements. */
var DeferLoadingStrategy;
(function (DeferLoadingStrategy) {
    /** Defers loading of DOM elements until element is near/in the users view port */
    DeferLoadingStrategy["DEFER"] = "DEFERRED-LOADING";
    /** Renders the DOM instantly without being concerned with the view port */
    DeferLoadingStrategy["INSTANT"] = "INSTANT-LOADING";
})(DeferLoadingStrategy || (DeferLoadingStrategy = {}));
var CmsConfig = /** @class */ (function (_super) {
    __extends(CmsConfig, _super);
    function CmsConfig() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    CmsConfig.ɵprov = ɵɵdefineInjectable({ factory: function CmsConfig_Factory() { return ɵɵinject(Config); }, token: CmsConfig, providedIn: "root" });
    CmsConfig = __decorate([
        Injectable({
            providedIn: 'root',
            useExisting: Config,
        })
    ], CmsConfig);
    return CmsConfig;
}(OccConfig));

var OccCmsPageNormalizer = /** @class */ (function () {
    function OccCmsPageNormalizer() {
    }
    OccCmsPageNormalizer.prototype.convert = function (source, target) {
        if (target === void 0) { target = {}; }
        this.normalizePageData(source, target);
        this.normalizePageSlotData(source, target);
        this.normalizePageComponentData(source, target);
        this.normalizeComponentData(source, target);
        return target;
    };
    OccCmsPageNormalizer.prototype.normalizePageData = function (source, target) {
        target.page = {
            loadTime: Date.now(),
            name: source.name,
            type: source.typeCode,
            title: source.title,
            pageId: source.uid,
            template: source.template,
            slots: {},
            properties: source.properties,
            label: source.label,
        };
    };
    OccCmsPageNormalizer.prototype.normalizePageSlotData = function (source, target) {
        var e_1, _a;
        try {
            for (var _b = __values(source.contentSlots.contentSlot), _c = _b.next(); !_c.done; _c = _b.next()) {
                var slot = _c.value;
                target.page.slots[slot.position] = {
                    components: [],
                    properties: slot.properties,
                };
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
    };
    OccCmsPageNormalizer.prototype.normalizePageComponentData = function (source, target) {
        var e_2, _a, e_3, _b;
        try {
            for (var _c = __values(source.contentSlots.contentSlot), _d = _c.next(); !_d.done; _d = _c.next()) {
                var slot = _d.value;
                if (slot.components.component &&
                    Array.isArray(slot.components.component)) {
                    try {
                        for (var _e = (e_3 = void 0, __values(slot.components.component)), _f = _e.next(); !_f.done; _f = _e.next()) {
                            var component = _f.value;
                            var comp = {
                                uid: component.uid,
                                typeCode: component.typeCode,
                                properties: component.properties,
                            };
                            if (component.typeCode === CMS_FLEX_COMPONENT_TYPE) {
                                comp.flexType = component.flexType;
                            }
                            else if (component.typeCode === JSP_INCLUDE_CMS_COMPONENT_TYPE) {
                                comp.flexType = component.uid;
                            }
                            else {
                                comp.flexType = component.typeCode;
                            }
                            target.page.slots[slot.position].components.push(comp);
                        }
                    }
                    catch (e_3_1) { e_3 = { error: e_3_1 }; }
                    finally {
                        try {
                            if (_f && !_f.done && (_b = _e.return)) _b.call(_e);
                        }
                        finally { if (e_3) throw e_3.error; }
                    }
                }
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (_d && !_d.done && (_a = _c.return)) _a.call(_c);
            }
            finally { if (e_2) throw e_2.error; }
        }
    };
    OccCmsPageNormalizer.prototype.normalizeComponentData = function (source, target) {
        var e_4, _a, e_5, _b;
        target.components = [];
        try {
            for (var _c = __values(source.contentSlots.contentSlot), _d = _c.next(); !_d.done; _d = _c.next()) {
                var slot = _d.value;
                if (slot.components.component &&
                    Array.isArray(slot.components.component)) {
                    try {
                        for (var _e = (e_5 = void 0, __values(slot.components.component)), _f = _e.next(); !_f.done; _f = _e.next()) {
                            var component = _f.value;
                            // we dont put properties into component state
                            if (component.properties) {
                                component.properties = undefined;
                            }
                            target.components.push(component);
                        }
                    }
                    catch (e_5_1) { e_5 = { error: e_5_1 }; }
                    finally {
                        try {
                            if (_f && !_f.done && (_b = _e.return)) _b.call(_e);
                        }
                        finally { if (e_5) throw e_5.error; }
                    }
                }
            }
        }
        catch (e_4_1) { e_4 = { error: e_4_1 }; }
        finally {
            try {
                if (_d && !_d.done && (_a = _c.return)) _a.call(_c);
            }
            finally { if (e_4) throw e_4.error; }
        }
    };
    OccCmsPageNormalizer.ɵprov = ɵɵdefineInjectable({ factory: function OccCmsPageNormalizer_Factory() { return new OccCmsPageNormalizer(); }, token: OccCmsPageNormalizer, providedIn: "root" });
    OccCmsPageNormalizer = __decorate([
        Injectable({ providedIn: 'root' })
    ], OccCmsPageNormalizer);
    return OccCmsPageNormalizer;
}());

/**
 * Abstract class that can be used to implement custom loader logic
 * in order to load CMS structure from third-party CMS system.
 */
var CmsPageAdapter = /** @class */ (function () {
    function CmsPageAdapter() {
    }
    return CmsPageAdapter;
}());

var CmsComponentAdapter = /** @class */ (function () {
    function CmsComponentAdapter() {
    }
    return CmsComponentAdapter;
}());

var CmsOccModule = /** @class */ (function () {
    function CmsOccModule() {
    }
    CmsOccModule = __decorate([
        NgModule({
            imports: [CommonModule, HttpClientModule],
            providers: [
                {
                    provide: CmsPageAdapter,
                    useClass: OccCmsPageAdapter,
                },
                {
                    provide: CMS_PAGE_NORMALIZER,
                    useExisting: OccCmsPageNormalizer,
                    multi: true,
                },
                {
                    provide: CmsComponentAdapter,
                    useClass: OccCmsComponentAdapter,
                },
            ],
        })
    ], CmsOccModule);
    return CmsOccModule;
}());

var ProductImageNormalizer = /** @class */ (function () {
    function ProductImageNormalizer(config) {
        this.config = config;
    }
    ProductImageNormalizer.prototype.convert = function (source, target) {
        if (target === undefined) {
            target = __assign({}, source);
        }
        if (source.images) {
            target.images = this.normalize(source.images);
        }
        return target;
    };
    /**
     * @desc
     * Creates the image structure we'd like to have. Instead of
     * having a single list with all images despite type and format
     * we create a proper structure. With that we can do:
     * - images.primary.thumnail.url
     * - images.GALLERY[0].thumnail.url
     */
    ProductImageNormalizer.prototype.normalize = function (source) {
        var e_1, _a;
        var images = {};
        if (source) {
            try {
                for (var source_1 = __values(source), source_1_1 = source_1.next(); !source_1_1.done; source_1_1 = source_1.next()) {
                    var image = source_1_1.value;
                    var isList = image.hasOwnProperty('galleryIndex');
                    if (!images.hasOwnProperty(image.imageType)) {
                        images[image.imageType] = isList ? [] : {};
                    }
                    var imageContainer = void 0;
                    if (isList && !images[image.imageType][image.galleryIndex]) {
                        images[image.imageType][image.galleryIndex] = {};
                    }
                    if (isList) {
                        imageContainer = images[image.imageType][image.galleryIndex];
                    }
                    else {
                        imageContainer = images[image.imageType];
                    }
                    var targetImage = __assign({}, image);
                    targetImage.url = this.normalizeImageUrl(targetImage.url);
                    imageContainer[image.format] = targetImage;
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (source_1_1 && !source_1_1.done && (_a = source_1.return)) _a.call(source_1);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
        return images;
    };
    /**
     * Traditionally, in an on-prem world, medias and other backend related calls
     * are hosted at the same platform, but in a cloud setup, applications are are
     * typically distributed cross different environments. For media, we use the
     * `backend.media.baseUrl` by default, but fallback to `backend.occ.baseUrl`
     * if none provided.
     */
    ProductImageNormalizer.prototype.normalizeImageUrl = function (url) {
        if (new RegExp(/^(http|data:image|\/\/)/i).test(url)) {
            return url;
        }
        return ((this.config.backend.media.baseUrl ||
            this.config.backend.occ.baseUrl ||
            '') + url);
    };
    ProductImageNormalizer.ctorParameters = function () { return [
        { type: OccConfig }
    ]; };
    ProductImageNormalizer.ɵprov = ɵɵdefineInjectable({ factory: function ProductImageNormalizer_Factory() { return new ProductImageNormalizer(ɵɵinject(OccConfig)); }, token: ProductImageNormalizer, providedIn: "root" });
    ProductImageNormalizer = __decorate([
        Injectable({ providedIn: 'root' })
    ], ProductImageNormalizer);
    return ProductImageNormalizer;
}());

var ProductReferenceNormalizer = /** @class */ (function () {
    function ProductReferenceNormalizer() {
    }
    ProductReferenceNormalizer.prototype.convert = function (source, target) {
        if (target === undefined) {
            target = __assign({}, source);
        }
        if (source.productReferences) {
            target.productReferences = this.normalize(source.productReferences);
        }
        return target;
    };
    /**
     * @desc
     * Creates the reference structure we'd like to have. Instead of
     * having a single list with all references we create a proper structure.
     * With that we have a semantic API for the clients
     * - product.references.SIMILAR[0].code
     */
    ProductReferenceNormalizer.prototype.normalize = function (source) {
        var e_1, _a;
        var references = {};
        if (source) {
            try {
                for (var source_1 = __values(source), source_1_1 = source_1.next(); !source_1_1.done; source_1_1 = source_1.next()) {
                    var reference = source_1_1.value;
                    if (!references.hasOwnProperty(reference.referenceType)) {
                        references[reference.referenceType] = [];
                    }
                    references[reference.referenceType].push(reference);
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (source_1_1 && !source_1_1.done && (_a = source_1.return)) _a.call(source_1);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
        return references;
    };
    ProductReferenceNormalizer = __decorate([
        Injectable()
    ], ProductReferenceNormalizer);
    return ProductReferenceNormalizer;
}());

var OccProductSearchPageNormalizer = /** @class */ (function () {
    function OccProductSearchPageNormalizer(converterService) {
        this.converterService = converterService;
        /**
         * Specifies the minimal number of top values in case
         * non have been setup by the business.
         */
        this.DEFAULT_TOP_VALUES = 6;
    }
    OccProductSearchPageNormalizer.prototype.convert = function (source, target) {
        var _this = this;
        if (target === void 0) { target = {}; }
        target = __assign(__assign({}, target), source);
        this.normalizeFacets(target);
        if (source.products) {
            target.products = source.products.map(function (product) {
                return _this.converterService.convert(product, PRODUCT_NORMALIZER);
            });
        }
        return target;
    };
    OccProductSearchPageNormalizer.prototype.normalizeFacets = function (target) {
        this.normalizeFacetValues(target);
        this.normalizeUselessFacets(target);
    };
    /**
     * The (current) backend returns facets with values that do not contribute
     * to the facet navigation much, as the number in the result list will not get
     * behaviour, see https://jira.hybris.com/browse/CS-427.
     *
     * As long as this is not in place, we manually filter the facet from the list;
     * any facet that does not have a count < the total results will be dropped from
     * the facets.
     */
    OccProductSearchPageNormalizer.prototype.normalizeUselessFacets = function (target) {
        target.facets = target.facets.filter(function (facet) {
            return (!target.pagination ||
                !target.pagination.totalResults ||
                ((!facet.hasOwnProperty('visible') || facet.visible) &&
                    facet.values &&
                    facet.values.find(function (value) {
                        return (value.selected || value.count < target.pagination.totalResults);
                    })));
        });
    };
    /*
     * In case there are so-called `topValues` given for the facet values,
     * values are obsolete.
     *
     * `topValues` is a feature in Adaptive Search which can limit a large
     * amount of facet values to a small set (5 by default). As long as the backend
     * provides all facet values AND topValues, we normalize the data to not bother
     * the UI with this specific feature.
     */
    OccProductSearchPageNormalizer.prototype.normalizeFacetValues = function (target) {
        var _this = this;
        if (target.facets) {
            target.facets = target.facets.map(function (facetSource) {
                var topValues = facetSource.topValues, facetTarget = __rest(facetSource, ["topValues"]);
                facetTarget.topValueCount = topValues
                    ? topValues.length
                    : _this.DEFAULT_TOP_VALUES;
                return facetTarget;
            });
        }
    };
    OccProductSearchPageNormalizer.ctorParameters = function () { return [
        { type: ConverterService }
    ]; };
    OccProductSearchPageNormalizer.ɵprov = ɵɵdefineInjectable({ factory: function OccProductSearchPageNormalizer_Factory() { return new OccProductSearchPageNormalizer(ɵɵinject(ConverterService)); }, token: OccProductSearchPageNormalizer, providedIn: "root" });
    OccProductSearchPageNormalizer = __decorate([
        Injectable({ providedIn: 'root' })
    ], OccProductSearchPageNormalizer);
    return OccProductSearchPageNormalizer;
}());

var OccProductReferencesListNormalizer = /** @class */ (function () {
    function OccProductReferencesListNormalizer(converter) {
        this.converter = converter;
    }
    OccProductReferencesListNormalizer.prototype.convert = function (source, target) {
        var _this = this;
        if (target === void 0) { target = []; }
        if (target === undefined) {
            target = __assign({}, source);
        }
        if (source && source.references) {
            target = source.references.map(function (reference) { return (__assign(__assign({}, reference), { target: _this.converter.convert(reference.target, PRODUCT_NORMALIZER) })); });
            return target;
        }
    };
    OccProductReferencesListNormalizer.ctorParameters = function () { return [
        { type: ConverterService }
    ]; };
    OccProductReferencesListNormalizer.ɵprov = ɵɵdefineInjectable({ factory: function OccProductReferencesListNormalizer_Factory() { return new OccProductReferencesListNormalizer(ɵɵinject(ConverterService)); }, token: OccProductReferencesListNormalizer, providedIn: "root" });
    OccProductReferencesListNormalizer = __decorate([
        Injectable({ providedIn: 'root' })
    ], OccProductReferencesListNormalizer);
    return OccProductReferencesListNormalizer;
}());

var ProductNameNormalizer = /** @class */ (function () {
    function ProductNameNormalizer(config) {
        this.config = config;
    }
    ProductNameNormalizer.prototype.convert = function (source, target) {
        if (target === undefined) {
            target = __assign({}, source);
        }
        if (source.name) {
            target.name = this.normalize(source.name);
            target.nameHtml = source.name;
        }
        return target;
    };
    ProductNameNormalizer.prototype.normalize = function (name) {
        return name.replace(/<[^>]*>/g, '');
    };
    ProductNameNormalizer.ctorParameters = function () { return [
        { type: OccConfig }
    ]; };
    ProductNameNormalizer.ɵprov = ɵɵdefineInjectable({ factory: function ProductNameNormalizer_Factory() { return new ProductNameNormalizer(ɵɵinject(OccConfig)); }, token: ProductNameNormalizer, providedIn: "root" });
    ProductNameNormalizer = __decorate([
        Injectable({ providedIn: 'root' })
    ], ProductNameNormalizer);
    return ProductNameNormalizer;
}());

var PRODUCT_REFERENCES_NORMALIZER = new InjectionToken('ProductReferencesListNormalizer');

var OccProductReferencesAdapter = /** @class */ (function () {
    function OccProductReferencesAdapter(http, occEndpoints, converter) {
        this.http = http;
        this.occEndpoints = occEndpoints;
        this.converter = converter;
    }
    OccProductReferencesAdapter.prototype.load = function (productCode, referenceType, pageSize) {
        return this.http
            .get(this.getEndpoint(productCode, referenceType, pageSize))
            .pipe(this.converter.pipeable(PRODUCT_REFERENCES_NORMALIZER));
    };
    OccProductReferencesAdapter.prototype.getEndpoint = function (code, reference, pageSize) {
        return this.occEndpoints.getUrl('productReferences', {
            productCode: code,
        }, { referenceType: reference, pageSize: pageSize });
    };
    OccProductReferencesAdapter.ctorParameters = function () { return [
        { type: HttpClient },
        { type: OccEndpointsService },
        { type: ConverterService }
    ]; };
    OccProductReferencesAdapter = __decorate([
        Injectable()
    ], OccProductReferencesAdapter);
    return OccProductReferencesAdapter;
}());

var PRODUCT_REVIEW_NORMALIZER = new InjectionToken('ProductReviewNormalizer');
var PRODUCT_REVIEW_SERIALIZER = new InjectionToken('ProductReviewSerializer');

var OccProductReviewsAdapter = /** @class */ (function () {
    function OccProductReviewsAdapter(http, occEndpoints, converter) {
        this.http = http;
        this.occEndpoints = occEndpoints;
        this.converter = converter;
    }
    OccProductReviewsAdapter.prototype.load = function (productCode, maxCount) {
        return this.http
            .get(this.getEndpoint(productCode, maxCount))
            .pipe(pluck('reviews'), this.converter.pipeableMany(PRODUCT_REVIEW_NORMALIZER));
    };
    OccProductReviewsAdapter.prototype.post = function (productCode, review) {
        review = this.converter.convert(review, PRODUCT_REVIEW_SERIALIZER);
        var headers = new HttpHeaders({
            'Content-Type': 'application/x-www-form-urlencoded',
        });
        var body = new URLSearchParams();
        body.append('headline', review.headline);
        body.append('comment', review.comment);
        body.append('rating', review.rating.toString());
        body.append('alias', review.alias);
        return this.http.post(this.getEndpoint(productCode), body.toString(), {
            headers: headers,
        });
    };
    OccProductReviewsAdapter.prototype.getEndpoint = function (code, maxCount) {
        return this.occEndpoints.getUrl('productReviews', {
            productCode: code,
        }, { maxCount: maxCount });
    };
    OccProductReviewsAdapter.ctorParameters = function () { return [
        { type: HttpClient },
        { type: OccEndpointsService },
        { type: ConverterService }
    ]; };
    OccProductReviewsAdapter = __decorate([
        Injectable()
    ], OccProductReviewsAdapter);
    return OccProductReviewsAdapter;
}());

var PRODUCT_SEARCH_PAGE_NORMALIZER = new InjectionToken('ProductSearchPageNormalizer');
var PRODUCT_SUGGESTION_NORMALIZER = new InjectionToken('ProductSuggestionNormalizer');

var DEFAULT_SEARCH_CONFIG = {
    pageSize: 20,
};
var OccProductSearchAdapter = /** @class */ (function () {
    function OccProductSearchAdapter(http, occEndpoints, converter) {
        this.http = http;
        this.occEndpoints = occEndpoints;
        this.converter = converter;
    }
    OccProductSearchAdapter.prototype.search = function (query, searchConfig) {
        if (searchConfig === void 0) { searchConfig = DEFAULT_SEARCH_CONFIG; }
        return this.http
            .get(this.getSearchEndpoint(query, searchConfig))
            .pipe(this.converter.pipeable(PRODUCT_SEARCH_PAGE_NORMALIZER));
    };
    OccProductSearchAdapter.prototype.loadSuggestions = function (term, pageSize) {
        if (pageSize === void 0) { pageSize = 3; }
        return this.http
            .get(this.getSuggestionEndpoint(term, pageSize.toString()))
            .pipe(pluck('suggestions'), this.converter.pipeableMany(PRODUCT_SUGGESTION_NORMALIZER));
    };
    OccProductSearchAdapter.prototype.getSearchEndpoint = function (query, searchConfig) {
        return this.occEndpoints.getUrl('productSearch', {}, {
            query: query,
            pageSize: searchConfig.pageSize,
            currentPage: searchConfig.currentPage,
            sort: searchConfig.sortCode,
        });
    };
    OccProductSearchAdapter.prototype.getSuggestionEndpoint = function (term, max) {
        return this.occEndpoints.getUrl('productSuggestions', {}, { term: term, max: max });
    };
    OccProductSearchAdapter.ctorParameters = function () { return [
        { type: HttpClient },
        { type: OccEndpointsService },
        { type: ConverterService }
    ]; };
    OccProductSearchAdapter = __decorate([
        Injectable()
    ], OccProductSearchAdapter);
    return OccProductSearchAdapter;
}());

/**
 * Merge occ fields parameters
 *
 * @param fields Fields definition as string or object
 */
function mergeFields(fields) {
    var parsedFields = fields.map(function (f) {
        return typeof f === 'string' ? parseFields(f) : f;
    });
    var mergedFields = optimizeFields(deepMerge.apply(void 0, __spread([{}], parsedFields)));
    return stringifyFields(mergedFields);
}
/**
 * Optimize fields definition by removing not needed groups
 *
 * @param fields
 */
function optimizeFields(fields) {
    if (fields === void 0) { fields = {}; }
    var keys = Object.keys(fields);
    if (keys.includes('FULL')) {
        delete fields['DEFAULT'];
        delete fields['BASIC'];
    }
    else if (keys.includes('DEFAULT')) {
        delete fields['BASIC'];
    }
    Object.keys(fields).forEach(function (key) {
        fields[key] = optimizeFields(fields[key]);
    });
    return fields;
}
/**
 * Parse string field definition to an AST object
 *
 * @param fields Fields string definition
 * @param startIndex Used for recurrence
 */
function parseFields(fields, startIndex) {
    if (startIndex === void 0) { startIndex = 0; }
    var parsedFields = {};
    var i = startIndex;
    while (i < fields.length) {
        if (fields[i] === ',') {
            if (i > startIndex) {
                parsedFields[fields.substr(startIndex, i - startIndex)] = {};
            }
            startIndex = i + 1;
        }
        else if (fields[i] === '(') {
            var subFields = parseFields(fields, i + 1);
            if (Array.isArray(subFields)) {
                parsedFields[fields.substr(startIndex, i - startIndex)] = subFields[0];
                startIndex = subFields[1];
                i = startIndex - 1;
            }
            else {
                return parsedFields;
            }
        }
        else if (fields[i] === ')') {
            if (i > startIndex) {
                parsedFields[fields.substr(startIndex, i - startIndex)] = {};
            }
            return [parsedFields, i + 1];
        }
        i++;
    }
    if (startIndex < fields.length) {
        parsedFields[fields.substr(startIndex, i - startIndex)] = {};
    }
    return parsedFields;
}
/**
 * Convert AST object fields definition to string representation
 *
 * @param fields
 */
function stringifyFields(fields) {
    return Object.keys(fields)
        .map(function (key) {
        var subFields = stringifyFields(fields[key]);
        return subFields ? key + "(" + subFields + ")" : key;
    })
        .join(',');
}
/**
 * Extract part of the object described by fields definition
 *
 * @param data
 * @param fields
 */
function extractFields(data, fields) {
    var parsedFields = typeof fields === 'string' ? parseFields(fields) : fields;
    return getObjectPart(data, parsedFields);
}
function getObjectPart(data, fields) {
    if (!isObject(data)) {
        return data;
    }
    var keys = Object.keys(fields);
    if (keys.length === 0 ||
        // we should not extract parts of the object with ambiguous fields definitions
        keys.find(function (el) { return el === 'BASIC' || el === 'DEFAULT' || el === 'FULL'; })) {
        return data;
    }
    var result = {};
    keys.forEach(function (key) {
        if (data.hasOwnProperty(key)) {
            result[key] = getObjectPart(data[key], fields[key]);
        }
    });
    return result;
}

/**
 * Helper service for optimizing endpoint calls to occ backend
 */
var OccFieldsService = /** @class */ (function () {
    function OccFieldsService(http) {
        this.http = http;
        this.FIELDS_PARAM = 'fields';
    }
    /**
     * Merge similar occ endpoints calls by merging fields parameter
     *
     * We assume that different scopes are defined by different fields parameters,
     * so we are grouping all requests with the same urls (except fields definition)
     * and merging into one request with fields that will satisfy all separate ones.
     *
     * @param models
     */
    OccFieldsService.prototype.getOptimalUrlGroups = function (models) {
        var e_1, _a, e_2, _b;
        var groupedByUrls = {};
        try {
            for (var _c = __values(models), _d = _c.next(); !_d.done; _d = _c.next()) {
                var model = _d.value;
                var _e = __read(this.splitFields(model.url), 2), urlPart = _e[0], fields = _e[1];
                if (!groupedByUrls[urlPart]) {
                    groupedByUrls[urlPart] = {};
                }
                model.fields = fields ? parseFields(fields) : {};
                groupedByUrls[urlPart][model.scopedData.scope] = model;
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_d && !_d.done && (_a = _c.return)) _a.call(_c);
            }
            finally { if (e_1) throw e_1.error; }
        }
        var mergedUrls = {};
        try {
            for (var _f = __values(Object.entries(groupedByUrls)), _g = _f.next(); !_g.done; _g = _f.next()) {
                var _h = __read(_g.value, 2), url = _h[0], group = _h[1];
                var urlWithFields = this.getUrlWithFields(url, Object.values(group).map(function (lo) { return lo.fields; }));
                mergedUrls[urlWithFields] = group;
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (_g && !_g.done && (_b = _f.return)) _b.call(_f);
            }
            finally { if (e_2) throw e_2.error; }
        }
        return mergedUrls;
    };
    /**
     * Extract fields parameter from occ endpoint url
     *
     * @param urlWithFields
     */
    OccFieldsService.prototype.splitFields = function (urlWithFields) {
        var _this = this;
        var _a = __read(urlWithFields.split('?'), 2), url = _a[0], params = _a[1];
        var paramsMap = {};
        if (params) {
            params.split('&').map(function (param) {
                var keyValue = param.split('=');
                paramsMap[keyValue[0]] = keyValue[1];
            });
        }
        var nonFieldsParams = Object.keys(paramsMap)
            .sort()
            .reduce(function (id, par) {
            if (par !== _this.FIELDS_PARAM) {
                id.push(paramsMap[par] ? par + "=" + paramsMap[par] : par);
            }
            return id;
        }, []);
        var nonFields = nonFieldsParams.join('&');
        return [
            nonFields ? url + "?" + nonFields : url,
            paramsMap[this.FIELDS_PARAM],
        ];
    };
    /**
     * Combine url with field parameters
     *
     * @param url
     * @param fields
     */
    OccFieldsService.prototype.getUrlWithFields = function (url, fields) {
        var mergedFields = mergeFields(fields);
        if (mergedFields) {
            url += url.includes('?') ? '&' : '?';
            url += this.FIELDS_PARAM + "=" + mergedFields;
        }
        return url;
    };
    OccFieldsService.ctorParameters = function () { return [
        { type: HttpClient }
    ]; };
    OccFieldsService.ɵprov = ɵɵdefineInjectable({ factory: function OccFieldsService_Factory() { return new OccFieldsService(ɵɵinject(HttpClient)); }, token: OccFieldsService, providedIn: "root" });
    OccFieldsService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], OccFieldsService);
    return OccFieldsService;
}());

var OccRequestsOptimizerService = /** @class */ (function () {
    function OccRequestsOptimizerService(http, occFields) {
        this.http = http;
        this.occFields = occFields;
    }
    /**
     * Optimize occ endpoint calls merging requests to the same url by merging field parameters
     *
     * @param scopedDataWithUrls
     * @param dataFactory
     */
    OccRequestsOptimizerService.prototype.scopedDataLoad = function (scopedDataWithUrls, dataFactory) {
        var _this = this;
        var result = [];
        if (!dataFactory) {
            dataFactory = function (url) { return _this.http.get(url); };
        }
        var mergedUrls = this.occFields.getOptimalUrlGroups(scopedDataWithUrls);
        Object.entries(mergedUrls).forEach(function (_a) {
            var _b = __read(_a, 2), url = _b[0], groupedModelsSet = _b[1];
            var groupedModels = Object.values(groupedModelsSet);
            if (groupedModels.length === 1) {
                // only one scope for url, we can pass the data straightaway
                result.push(__assign(__assign({}, groupedModels[0].scopedData), { data$: dataFactory(url) }));
            }
            else {
                // multiple scopes per url
                // we have to split the model per each scope
                var data$_1 = dataFactory(url).pipe(shareReplay(1));
                groupedModels.forEach(function (modelData) {
                    result.push(__assign(__assign({}, modelData.scopedData), { data$: data$_1.pipe(map(function (data) { return extractFields(data, modelData.fields); })) }));
                });
            }
        });
        return result;
    };
    OccRequestsOptimizerService.ctorParameters = function () { return [
        { type: HttpClient },
        { type: OccFieldsService }
    ]; };
    OccRequestsOptimizerService.ɵprov = ɵɵdefineInjectable({ factory: function OccRequestsOptimizerService_Factory() { return new OccRequestsOptimizerService(ɵɵinject(HttpClient), ɵɵinject(OccFieldsService)); }, token: OccRequestsOptimizerService, providedIn: "root" });
    OccRequestsOptimizerService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], OccRequestsOptimizerService);
    return OccRequestsOptimizerService;
}());

var OccProductAdapter = /** @class */ (function () {
    function OccProductAdapter(http, occEndpoints, converter, requestsOptimizer) {
        this.http = http;
        this.occEndpoints = occEndpoints;
        this.converter = converter;
        this.requestsOptimizer = requestsOptimizer;
    }
    OccProductAdapter.prototype.load = function (productCode, scope) {
        return this.http
            .get(this.getEndpoint(productCode, scope))
            .pipe(this.converter.pipeable(PRODUCT_NORMALIZER));
    };
    OccProductAdapter.prototype.loadMany = function (products) {
        var _this = this;
        var scopedDataWithUrls = products.map(function (model) { return ({
            scopedData: model,
            url: _this.getEndpoint(model.code, model.scope),
        }); });
        return this.requestsOptimizer
            .scopedDataLoad(scopedDataWithUrls)
            .map(function (scopedProduct) {
            return (__assign(__assign({}, scopedProduct), { data$: scopedProduct.data$.pipe(_this.converter.pipeable(PRODUCT_NORMALIZER)) }));
        });
    };
    OccProductAdapter.prototype.getEndpoint = function (code, scope) {
        return this.occEndpoints.getUrl('product', {
            productCode: code,
        }, undefined, scope);
    };
    OccProductAdapter.ctorParameters = function () { return [
        { type: HttpClient },
        { type: OccEndpointsService },
        { type: ConverterService },
        { type: OccRequestsOptimizerService }
    ]; };
    OccProductAdapter = __decorate([
        Injectable()
    ], OccProductAdapter);
    return OccProductAdapter;
}());

var ProductAdapter = /** @class */ (function () {
    function ProductAdapter() {
    }
    return ProductAdapter;
}());

var ProductReferencesAdapter = /** @class */ (function () {
    function ProductReferencesAdapter() {
    }
    return ProductReferencesAdapter;
}());

var ProductReviewsAdapter = /** @class */ (function () {
    function ProductReviewsAdapter() {
    }
    return ProductReviewsAdapter;
}());

var ProductSearchAdapter = /** @class */ (function () {
    function ProductSearchAdapter() {
    }
    return ProductSearchAdapter;
}());

var ProductScope;
(function (ProductScope) {
    ProductScope["LIST"] = "list";
    ProductScope["DETAILS"] = "details";
    ProductScope["ATTRIBUTES"] = "attributes";
    ProductScope["VARIANTS"] = "variants";
})(ProductScope || (ProductScope = {}));

var defaultOccProductConfig = {
    backend: {
        occ: {
            endpoints: {
                product: {
                    default: 'products/${productCode}?fields=DEFAULT,averageRating,images(FULL),classifications,manufacturer,numberOfReviews,categories(FULL),baseOptions,baseProduct,variantOptions,variantType',
                    list: 'products/${productCode}?fields=code,name,summary,price(formattedValue),images(DEFAULT,galleryIndex)',
                    details: 'products/${productCode}?fields=averageRating,stock(DEFAULT),description,availableForPickup,code,url,price(DEFAULT),numberOfReviews,manufacturer,categories(FULL),priceRange,multidimensional,configuratorType,configurable,tags,images(FULL)',
                    attributes: 'products/${productCode}?fields=classifications',
                    variants: 'products/${productCode}?fields=name,purchasable,baseOptions(DEFAULT),baseProduct,variantOptions(DEFAULT),variantType',
                },
                productReviews: 'products/${productCode}/reviews',
                // Uncomment this when occ gets configured
                // productReferences:
                //   'products/${productCode}/references?fields=DEFAULT,references(target(images(FULL)))&referenceType=${referenceType}',
                productReferences: 'products/${productCode}/references?fields=DEFAULT,references(target(images(FULL)))',
                // tslint:disable:max-line-length
                productSearch: 'products/search?fields=products(code,name,summary,price(FULL),images(DEFAULT),stock(FULL),averageRating,variantOptions),facets,breadcrumbs,pagination(DEFAULT),sorts(DEFAULT),freeTextSearch,currentQuery',
                // tslint:enable
                productSuggestions: 'products/suggestions',
            },
        },
        loadingScopes: {
            product: {
                details: {
                    include: [ProductScope.LIST, ProductScope.VARIANTS],
                },
            },
        },
    },
};

var ProductOccModule = /** @class */ (function () {
    function ProductOccModule() {
    }
    ProductOccModule = __decorate([
        NgModule({
            imports: [CommonModule, HttpClientModule],
            providers: [
                provideDefaultConfig(defaultOccProductConfig),
                {
                    provide: ProductAdapter,
                    useClass: OccProductAdapter,
                },
                {
                    provide: PRODUCT_NORMALIZER,
                    useExisting: ProductImageNormalizer,
                    multi: true,
                },
                {
                    provide: PRODUCT_NORMALIZER,
                    useExisting: ProductNameNormalizer,
                    multi: true,
                },
                {
                    provide: ProductReferencesAdapter,
                    useClass: OccProductReferencesAdapter,
                },
                {
                    provide: PRODUCT_REFERENCES_NORMALIZER,
                    useExisting: OccProductReferencesListNormalizer,
                    multi: true,
                },
                {
                    provide: ProductSearchAdapter,
                    useClass: OccProductSearchAdapter,
                },
                {
                    provide: PRODUCT_SEARCH_PAGE_NORMALIZER,
                    useExisting: OccProductSearchPageNormalizer,
                    multi: true,
                },
                {
                    provide: ProductReviewsAdapter,
                    useClass: OccProductReviewsAdapter,
                },
            ],
        })
    ], ProductOccModule);
    return ProductOccModule;
}());

var LANGUAGE_NORMALIZER = new InjectionToken('LanguageNormalizer');
var CURRENCY_NORMALIZER = new InjectionToken('CurrencyNormalizer');
var COUNTRY_NORMALIZER = new InjectionToken('CountryNormalizer');
var REGION_NORMALIZER = new InjectionToken('RegionNormalizer');

var OccSiteAdapter = /** @class */ (function () {
    function OccSiteAdapter(http, occEndpointsService, converterService) {
        this.http = http;
        this.occEndpointsService = occEndpointsService;
        this.converterService = converterService;
    }
    OccSiteAdapter.prototype.loadLanguages = function () {
        return this.http
            .get(this.occEndpointsService.getUrl('languages'))
            .pipe(map(function (languageList) { return languageList.languages; }), this.converterService.pipeableMany(LANGUAGE_NORMALIZER));
    };
    OccSiteAdapter.prototype.loadCurrencies = function () {
        return this.http
            .get(this.occEndpointsService.getUrl('currencies'))
            .pipe(map(function (currencyList) { return currencyList.currencies; }), this.converterService.pipeableMany(CURRENCY_NORMALIZER));
    };
    OccSiteAdapter.prototype.loadCountries = function (type) {
        return this.http
            .get(this.occEndpointsService.getUrl('countries', undefined, type ? { type: type } : undefined))
            .pipe(map(function (countryList) { return countryList.countries; }), this.converterService.pipeableMany(COUNTRY_NORMALIZER));
    };
    OccSiteAdapter.prototype.loadRegions = function (countryIsoCode) {
        return this.http
            .get(this.occEndpointsService.getUrl('regions', { isoCode: countryIsoCode }))
            .pipe(map(function (regionList) { return regionList.regions; }), this.converterService.pipeableMany(REGION_NORMALIZER));
    };
    OccSiteAdapter.prototype.loadBaseSite = function () {
        var baseUrl = this.occEndpointsService.getBaseEndpoint();
        var urlSplits = baseUrl.split('/');
        var activeSite = urlSplits.pop();
        var url = urlSplits.join('/') + '/basesites';
        var params = new HttpParams({
            fromString: 'fields=FULL',
        });
        return this.http
            .get(url, { params: params })
            .pipe(map(function (siteList) {
            return siteList.baseSites.find(function (site) { return site.uid === activeSite; });
        }));
    };
    OccSiteAdapter.ctorParameters = function () { return [
        { type: HttpClient },
        { type: OccEndpointsService },
        { type: ConverterService }
    ]; };
    OccSiteAdapter = __decorate([
        Injectable()
    ], OccSiteAdapter);
    return OccSiteAdapter;
}());

var SiteAdapter = /** @class */ (function () {
    function SiteAdapter() {
    }
    return SiteAdapter;
}());

var defaultOccSiteContextConfig = {
    backend: {
        occ: {
            endpoints: {
                languages: 'languages',
                currencies: 'currencies',
                countries: 'countries',
                regions: 'countries/${isoCode}/regions?fields=regions(name,isocode,isocodeShort)',
            },
        },
    },
};

/**
 * Facade that provides easy access to curreny state, actions and selectors.
 */
var CurrencyService = /** @class */ (function () {
    function CurrencyService(store, winRef, config) {
        this.store = store;
        this.config = config;
        this.sessionStorage = winRef.sessionStorage;
    }
    /**
     * Represents all the currencies supported by the current store.
     */
    CurrencyService.prototype.getAll = function () {
        var _this = this;
        return this.store.pipe(select(getAllCurrencies), tap(function (currencies) {
            if (!currencies) {
                _this.store.dispatch(new LoadCurrencies());
            }
        }), filter(function (currenies) { return Boolean(currenies); }));
    };
    /**
     * Represents the isocode of the active currency.
     */
    CurrencyService.prototype.getActive = function () {
        return this.store.pipe(select(getActiveCurrency), filter(function (active) { return Boolean(active); }));
    };
    /**
     * Sets the active language.
     */
    CurrencyService.prototype.setActive = function (isocode) {
        var _this = this;
        return this.store
            .pipe(select(getActiveCurrency), take(1))
            .subscribe(function (activeCurrency) {
            if (activeCurrency !== isocode) {
                _this.store.dispatch(new SetActiveCurrency(isocode));
            }
        });
    };
    /**
     * Initials the active currency. The active currency is either given
     * by the last visit (stored in session storage) or by the
     * default session currency of the store.
     */
    CurrencyService.prototype.initialize = function () {
        var value;
        this.getActive()
            .subscribe(function (val) { return (value = val); })
            .unsubscribe();
        if (value) {
            // don't initialize, if there is already a value (i.e. retrieved from route or transferred from SSR)
            return;
        }
        var sessionCurrency = this.sessionStorage && this.sessionStorage.getItem('currency');
        if (sessionCurrency &&
            getContextParameterValues(this.config, CURRENCY_CONTEXT_ID).includes(sessionCurrency)) {
            this.setActive(sessionCurrency);
        }
        else {
            this.setActive(getContextParameterDefault(this.config, CURRENCY_CONTEXT_ID));
        }
    };
    CurrencyService.ctorParameters = function () { return [
        { type: Store },
        { type: WindowRef },
        { type: SiteContextConfig }
    ]; };
    CurrencyService = __decorate([
        Injectable()
    ], CurrencyService);
    return CurrencyService;
}());

/**
 * Facade that provides easy access to language state, actions and selectors.
 */
var LanguageService = /** @class */ (function () {
    function LanguageService(store, winRef, config) {
        this.store = store;
        this.config = config;
        this.sessionStorage = winRef.sessionStorage;
    }
    /**
     * Represents all the languages supported by the current store.
     */
    LanguageService.prototype.getAll = function () {
        var _this = this;
        return this.store.pipe(select(getAllLanguages), tap(function (languages) {
            if (!languages) {
                _this.store.dispatch(new LoadLanguages());
            }
        }), filter(function (languages) { return Boolean(languages); }));
    };
    /**
     * Represents the isocode of the active language.
     */
    LanguageService.prototype.getActive = function () {
        return this.store.pipe(select(getActiveLanguage), filter(function (active) { return Boolean(active); }));
    };
    /**
     * Sets the active language.
     */
    LanguageService.prototype.setActive = function (isocode) {
        var _this = this;
        return this.store
            .pipe(select(getActiveLanguage), take(1))
            .subscribe(function (activeLanguage) {
            if (activeLanguage !== isocode) {
                _this.store.dispatch(new SetActiveLanguage(isocode));
            }
        });
    };
    /**
     * Initials the active language. The active language is either given
     * by the last visit (stored in session storage) or by the
     * default session language of the store.
     */
    LanguageService.prototype.initialize = function () {
        var value;
        this.getActive()
            .subscribe(function (val) { return (value = val); })
            .unsubscribe();
        if (value) {
            // don't initialize, if there is already a value (i.e. retrieved from route or transferred from SSR)
            return;
        }
        var sessionLanguage = this.sessionStorage && this.sessionStorage.getItem('language');
        if (sessionLanguage &&
            getContextParameterValues(this.config, LANGUAGE_CONTEXT_ID).includes(sessionLanguage)) {
            this.setActive(sessionLanguage);
        }
        else {
            this.setActive(getContextParameterDefault(this.config, LANGUAGE_CONTEXT_ID));
        }
    };
    LanguageService.ctorParameters = function () { return [
        { type: Store },
        { type: WindowRef },
        { type: SiteContextConfig }
    ]; };
    LanguageService = __decorate([
        Injectable()
    ], LanguageService);
    return LanguageService;
}());

var SiteContextInterceptor = /** @class */ (function () {
    function SiteContextInterceptor(languageService, currencyService, occEndpoints, config) {
        var _this = this;
        this.languageService = languageService;
        this.currencyService = currencyService;
        this.occEndpoints = occEndpoints;
        this.config = config;
        this.activeLang = getContextParameterDefault(this.config, LANGUAGE_CONTEXT_ID);
        this.activeCurr = getContextParameterDefault(this.config, CURRENCY_CONTEXT_ID);
        this.languageService
            .getActive()
            .subscribe(function (data) { return (_this.activeLang = data); });
        this.currencyService.getActive().subscribe(function (data) {
            _this.activeCurr = data;
        });
    }
    SiteContextInterceptor.prototype.intercept = function (request, next) {
        if (request.url.includes(this.occEndpoints.getBaseEndpoint())) {
            request = request.clone({
                setParams: {
                    lang: this.activeLang,
                    curr: this.activeCurr,
                },
            });
        }
        return next.handle(request);
    };
    SiteContextInterceptor.ctorParameters = function () { return [
        { type: LanguageService },
        { type: CurrencyService },
        { type: OccEndpointsService },
        { type: SiteContextConfig }
    ]; };
    SiteContextInterceptor.ɵprov = ɵɵdefineInjectable({ factory: function SiteContextInterceptor_Factory() { return new SiteContextInterceptor(ɵɵinject(LanguageService), ɵɵinject(CurrencyService), ɵɵinject(OccEndpointsService), ɵɵinject(SiteContextConfig)); }, token: SiteContextInterceptor, providedIn: "root" });
    SiteContextInterceptor = __decorate([
        Injectable({ providedIn: 'root' })
    ], SiteContextInterceptor);
    return SiteContextInterceptor;
}());

var SiteContextOccModule = /** @class */ (function () {
    function SiteContextOccModule() {
    }
    SiteContextOccModule = __decorate([
        NgModule({
            imports: [CommonModule, HttpClientModule],
            providers: [
                provideDefaultConfig(defaultOccSiteContextConfig),
                {
                    provide: SiteAdapter,
                    useClass: OccSiteAdapter,
                },
                {
                    provide: HTTP_INTERCEPTORS,
                    useExisting: SiteContextInterceptor,
                    multi: true,
                },
            ],
        })
    ], SiteContextOccModule);
    return SiteContextOccModule;
}());

var StoreFinderAdapter = /** @class */ (function () {
    function StoreFinderAdapter() {
    }
    return StoreFinderAdapter;
}());

var defaultOccStoreFinderConfig = {
    backend: {
        occ: {
            endpoints: {
                store: 'stores/${storeId}?fields=FULL',
                stores: 'stores?fields=stores(name,displayName,formattedDistance,openingHours(weekDayOpeningList(FULL),specialDayOpeningList(FULL)),geoPoint(latitude,longitude),address(line1,line2,town,region(FULL),postalCode,phone,country,email), features),pagination(DEFAULT),sorts(DEFAULT)',
                storescounts: 'stores/storescounts',
            },
        },
    },
};

var StoreFinderConnector = /** @class */ (function () {
    function StoreFinderConnector(adapter) {
        this.adapter = adapter;
    }
    StoreFinderConnector.prototype.search = function (query, searchConfig, longitudeLatitude, radius) {
        return this.adapter.search(query, searchConfig, longitudeLatitude, radius);
    };
    StoreFinderConnector.prototype.getCounts = function () {
        return this.adapter.loadCounts();
    };
    StoreFinderConnector.prototype.get = function (storeId) {
        return this.adapter.load(storeId);
    };
    StoreFinderConnector.ctorParameters = function () { return [
        { type: StoreFinderAdapter }
    ]; };
    StoreFinderConnector.ɵprov = ɵɵdefineInjectable({ factory: function StoreFinderConnector_Factory() { return new StoreFinderConnector(ɵɵinject(StoreFinderAdapter)); }, token: StoreFinderConnector, providedIn: "root" });
    StoreFinderConnector = __decorate([
        Injectable({ providedIn: 'root' })
    ], StoreFinderConnector);
    return StoreFinderConnector;
}());

var POINT_OF_SERVICE_NORMALIZER = new InjectionToken('PointOfServiceNormalizer');
var STORE_FINDER_SEARCH_PAGE_NORMALIZER = new InjectionToken('StoreFinderSearchPageNormalizer');
var STORE_COUNT_NORMALIZER = new InjectionToken('StoreCountNormalizer');

var OccStoreFinderAdapter = /** @class */ (function () {
    function OccStoreFinderAdapter(http, occEndpointsService, converterService) {
        this.http = http;
        this.occEndpointsService = occEndpointsService;
        this.converterService = converterService;
    }
    OccStoreFinderAdapter.prototype.search = function (query, searchConfig, longitudeLatitude, radius) {
        return this.callOccFindStores(query, searchConfig, longitudeLatitude, radius).pipe(this.converterService.pipeable(STORE_FINDER_SEARCH_PAGE_NORMALIZER));
    };
    OccStoreFinderAdapter.prototype.loadCounts = function () {
        return this.http
            .get(this.occEndpointsService.getUrl('storescounts'))
            .pipe(map(function (_a) {
            var countriesAndRegionsStoreCount = _a.countriesAndRegionsStoreCount;
            return countriesAndRegionsStoreCount;
        }), this.converterService.pipeableMany(STORE_COUNT_NORMALIZER));
    };
    OccStoreFinderAdapter.prototype.load = function (storeId) {
        return this.http
            .get(this.occEndpointsService.getUrl('store', { storeId: storeId }))
            .pipe(this.converterService.pipeable(POINT_OF_SERVICE_NORMALIZER));
    };
    OccStoreFinderAdapter.prototype.callOccFindStores = function (query, searchConfig, longitudeLatitude, radius) {
        var params = {};
        if (longitudeLatitude) {
            params['longitude'] = String(longitudeLatitude.longitude);
            params['latitude'] = String(longitudeLatitude.latitude);
            params['radius'] = String(radius);
        }
        else {
            params['query'] = query;
        }
        if (searchConfig.pageSize) {
            params['pageSize'] = String(searchConfig.pageSize);
        }
        if (searchConfig.currentPage) {
            params['currentPage'] = String(searchConfig.currentPage);
        }
        if (searchConfig.sort) {
            params['sort'] = searchConfig.sort;
        }
        return this.http.get(this.occEndpointsService.getUrl('stores', undefined, params));
    };
    OccStoreFinderAdapter.ctorParameters = function () { return [
        { type: HttpClient },
        { type: OccEndpointsService },
        { type: ConverterService }
    ]; };
    OccStoreFinderAdapter = __decorate([
        Injectable()
    ], OccStoreFinderAdapter);
    return OccStoreFinderAdapter;
}());

var StoreFinderOccModule = /** @class */ (function () {
    function StoreFinderOccModule() {
    }
    StoreFinderOccModule = __decorate([
        NgModule({
            providers: [
                provideDefaultConfig(defaultOccStoreFinderConfig),
                { provide: StoreFinderAdapter, useClass: OccStoreFinderAdapter },
            ],
        })
    ], StoreFinderOccModule);
    return StoreFinderOccModule;
}());

var CONSENT_TEMPLATE_NORMALIZER = new InjectionToken('ConsentTemplateNormalizer');

var OccAnonymousConsentTemplatesAdapter = /** @class */ (function () {
    function OccAnonymousConsentTemplatesAdapter(http, occEndpoints, converter) {
        this.http = http;
        this.occEndpoints = occEndpoints;
        this.converter = converter;
    }
    OccAnonymousConsentTemplatesAdapter.prototype.loadAnonymousConsentTemplates = function () {
        var url = this.occEndpoints.getUrl('anonymousConsentTemplates');
        return this.http.get(url).pipe(catchError(function (error) { return throwError(error); }), map(function (consentList) { return consentList.consentTemplates; }), this.converter.pipeableMany(CONSENT_TEMPLATE_NORMALIZER));
    };
    OccAnonymousConsentTemplatesAdapter.ctorParameters = function () { return [
        { type: HttpClient },
        { type: OccEndpointsService },
        { type: ConverterService }
    ]; };
    OccAnonymousConsentTemplatesAdapter = __decorate([
        Injectable()
    ], OccAnonymousConsentTemplatesAdapter);
    return OccAnonymousConsentTemplatesAdapter;
}());

var OccUserAddressAdapter = /** @class */ (function () {
    function OccUserAddressAdapter(http, occEndpoints, converter) {
        this.http = http;
        this.occEndpoints = occEndpoints;
        this.converter = converter;
    }
    OccUserAddressAdapter.prototype.loadAll = function (userId) {
        var url = this.occEndpoints.getUrl('addresses', { userId: userId });
        var headers = new HttpHeaders({
            'Content-Type': 'application/json',
        });
        return this.http
            .get(url, { headers: headers })
            .pipe(catchError(function (error) { return throwError(error); }), map(function (addressList) { return addressList.addresses; }), this.converter.pipeableMany(ADDRESS_NORMALIZER));
    };
    OccUserAddressAdapter.prototype.add = function (userId, address) {
        var url = this.occEndpoints.getUrl('addresses', { userId: userId });
        var headers = new HttpHeaders({
            'Content-Type': 'application/json',
        });
        address = this.converter.convert(address, ADDRESS_SERIALIZER);
        return this.http
            .post(url, address, { headers: headers })
            .pipe(catchError(function (error) { return throwError(error); }));
    };
    OccUserAddressAdapter.prototype.update = function (userId, addressId, address) {
        var url = this.occEndpoints.getUrl('addressDetail', {
            userId: userId,
            addressId: addressId,
        });
        var headers = new HttpHeaders({
            'Content-Type': 'application/json',
        });
        address = this.converter.convert(address, ADDRESS_SERIALIZER);
        return this.http
            .patch(url, address, { headers: headers })
            .pipe(catchError(function (error) { return throwError(error); }));
    };
    OccUserAddressAdapter.prototype.verify = function (userId, address) {
        var url = this.occEndpoints.getUrl('addressVerification', { userId: userId });
        var headers = new HttpHeaders({
            'Content-Type': 'application/json',
        });
        if (userId === OCC_USER_ID_ANONYMOUS) {
            headers = InterceptorUtil.createHeader(USE_CLIENT_TOKEN, true, headers);
        }
        address = this.converter.convert(address, ADDRESS_SERIALIZER);
        return this.http
            .post(url, address, { headers: headers })
            .pipe(catchError(function (error) { return throwError(error); }), this.converter.pipeable(ADDRESS_VALIDATION_NORMALIZER));
    };
    OccUserAddressAdapter.prototype.delete = function (userId, addressId) {
        var url = this.occEndpoints.getUrl('addressDetail', {
            userId: userId,
            addressId: addressId,
        });
        var headers = new HttpHeaders({
            'Content-Type': 'application/json',
        });
        return this.http
            .delete(url, { headers: headers })
            .pipe(catchError(function (error) { return throwError(error); }));
    };
    OccUserAddressAdapter.ctorParameters = function () { return [
        { type: HttpClient },
        { type: OccEndpointsService },
        { type: ConverterService }
    ]; };
    OccUserAddressAdapter = __decorate([
        Injectable()
    ], OccUserAddressAdapter);
    return OccUserAddressAdapter;
}());

var OccUserConsentAdapter = /** @class */ (function () {
    function OccUserConsentAdapter(http, occEndpoints, converter) {
        this.http = http;
        this.occEndpoints = occEndpoints;
        this.converter = converter;
    }
    OccUserConsentAdapter.prototype.loadConsents = function (userId) {
        var url = this.occEndpoints.getUrl('consentTemplates', { userId: userId });
        var headers = new HttpHeaders({ 'Cache-Control': 'no-cache' });
        return this.http
            .get(url, { headers: headers })
            .pipe(catchError(function (error) { return throwError(error); }), map(function (consentList) { return consentList.consentTemplates; }), this.converter.pipeableMany(CONSENT_TEMPLATE_NORMALIZER));
    };
    OccUserConsentAdapter.prototype.giveConsent = function (userId, consentTemplateId, consentTemplateVersion) {
        var url = this.occEndpoints.getUrl('consents', { userId: userId });
        var httpParams = new HttpParams()
            .set('consentTemplateId', consentTemplateId)
            .set('consentTemplateVersion', consentTemplateVersion.toString());
        var headers = new HttpHeaders({
            'Content-Type': 'application/x-www-form-urlencoded',
            'Cache-Control': 'no-cache',
        });
        return this.http
            .post(url, httpParams, { headers: headers })
            .pipe(catchError(function (error) { return throwError(error); }), this.converter.pipeable(CONSENT_TEMPLATE_NORMALIZER));
    };
    OccUserConsentAdapter.prototype.withdrawConsent = function (userId, consentCode) {
        var headers = new HttpHeaders({
            'Cache-Control': 'no-cache',
        });
        var url = this.occEndpoints.getUrl('consentDetail', {
            userId: userId,
            consentId: consentCode,
        });
        return this.http.delete(url, { headers: headers });
    };
    OccUserConsentAdapter.ctorParameters = function () { return [
        { type: HttpClient },
        { type: OccEndpointsService },
        { type: ConverterService }
    ]; };
    OccUserConsentAdapter = __decorate([
        Injectable()
    ], OccUserConsentAdapter);
    return OccUserConsentAdapter;
}());

var ORDER_HISTORY_NORMALIZER = new InjectionToken('OrderHistoryNormalizer');
var CONSIGNMENT_TRACKING_NORMALIZER = new InjectionToken('ConsignmentTrackingNormalizer');
var ORDER_RETURN_REQUEST_NORMALIZER = new InjectionToken('OrderReturnRequestNormalizer');
var ORDER_RETURN_REQUEST_INPUT_SERIALIZER = new InjectionToken('OrderReturnRequestInputSerializer');
var ORDER_RETURNS_NORMALIZER = new InjectionToken('OrderReturnsNormalizer');

var OccUserOrderAdapter = /** @class */ (function () {
    function OccUserOrderAdapter(http, occEndpoints, converter) {
        this.http = http;
        this.occEndpoints = occEndpoints;
        this.converter = converter;
    }
    OccUserOrderAdapter.prototype.load = function (userId, orderCode) {
        var url = this.occEndpoints.getUrl('orderDetail', {
            userId: userId,
            orderId: orderCode,
        });
        var headers = new HttpHeaders();
        if (userId === OCC_USER_ID_ANONYMOUS) {
            headers = InterceptorUtil.createHeader(USE_CLIENT_TOKEN, true, headers);
        }
        return this.http
            .get(url, { headers: headers })
            .pipe(this.converter.pipeable(ORDER_NORMALIZER));
    };
    OccUserOrderAdapter.prototype.loadHistory = function (userId, pageSize, currentPage, sort) {
        var params = {};
        if (pageSize) {
            params['pageSize'] = pageSize.toString();
        }
        if (currentPage) {
            params['currentPage'] = currentPage.toString();
        }
        if (sort) {
            params['sort'] = sort.toString();
        }
        var url = this.occEndpoints.getUrl('orderHistory', { userId: userId }, params);
        return this.http
            .get(url)
            .pipe(this.converter.pipeable(ORDER_HISTORY_NORMALIZER));
    };
    OccUserOrderAdapter.prototype.getConsignmentTracking = function (orderCode, consignmentCode, userId) {
        if (userId === void 0) { userId = OCC_USER_ID_CURRENT; }
        var url = this.occEndpoints.getUrl('consignmentTracking', {
            userId: userId,
            orderCode: orderCode,
            consignmentCode: consignmentCode,
        });
        return this.http
            .get(url)
            .pipe(this.converter.pipeable(CONSIGNMENT_TRACKING_NORMALIZER));
    };
    OccUserOrderAdapter.prototype.cancel = function (userId, orderCode, cancelRequestInput) {
        var url = this.occEndpoints.getUrl('cancelOrder', {
            userId: userId,
            orderId: orderCode,
        });
        var headers = new HttpHeaders({
            'Content-Type': 'application/json',
        });
        return this.http
            .post(url, cancelRequestInput, { headers: headers })
            .pipe(catchError(function (error) { return throwError(error); }));
    };
    OccUserOrderAdapter.prototype.createReturnRequest = function (userId, returnRequestInput) {
        var url = this.occEndpoints.getUrl('returnOrder', {
            userId: userId,
        });
        var headers = new HttpHeaders({
            'Content-Type': 'application/json',
        });
        returnRequestInput = this.converter.convert(returnRequestInput, ORDER_RETURN_REQUEST_INPUT_SERIALIZER);
        return this.http.post(url, returnRequestInput, { headers: headers }).pipe(catchError(function (error) { return throwError(error); }), this.converter.pipeable(ORDER_RETURN_REQUEST_NORMALIZER));
    };
    OccUserOrderAdapter.prototype.loadReturnRequestList = function (userId, pageSize, currentPage, sort) {
        var params = {};
        if (pageSize) {
            params['pageSize'] = pageSize.toString();
        }
        if (currentPage) {
            params['currentPage'] = currentPage.toString();
        }
        if (sort) {
            params['sort'] = sort.toString();
        }
        var url = this.occEndpoints.getUrl('orderReturns', { userId: userId }, params);
        return this.http
            .get(url)
            .pipe(this.converter.pipeable(ORDER_RETURNS_NORMALIZER));
    };
    OccUserOrderAdapter.prototype.loadReturnRequestDetail = function (userId, returnRequestCode) {
        var url = this.occEndpoints.getUrl('orderReturnDetail', {
            userId: userId,
            returnRequestCode: returnRequestCode,
        });
        return this.http
            .get(url)
            .pipe(this.converter.pipeable(ORDER_RETURN_REQUEST_NORMALIZER));
    };
    OccUserOrderAdapter.prototype.cancelReturnRequest = function (userId, returnRequestCode, returnRequestModification) {
        var url = this.occEndpoints.getUrl('cancelReturn', {
            userId: userId,
            returnRequestCode: returnRequestCode,
        });
        var headers = new HttpHeaders({
            'Content-Type': 'application/json',
        });
        return this.http
            .patch(url, returnRequestModification, { headers: headers })
            .pipe(catchError(function (error) { return throwError(error); }));
    };
    OccUserOrderAdapter.ctorParameters = function () { return [
        { type: HttpClient },
        { type: OccEndpointsService },
        { type: ConverterService }
    ]; };
    OccUserOrderAdapter = __decorate([
        Injectable()
    ], OccUserOrderAdapter);
    return OccUserOrderAdapter;
}());

var OccUserPaymentAdapter = /** @class */ (function () {
    function OccUserPaymentAdapter(http, occEndpoints, converter) {
        this.http = http;
        this.occEndpoints = occEndpoints;
        this.converter = converter;
    }
    OccUserPaymentAdapter.prototype.loadAll = function (userId) {
        var url = this.occEndpoints.getUrl('paymentDetailsAll', { userId: userId }) + '?saved=true';
        var headers = new HttpHeaders({
            'Content-Type': 'application/json',
        });
        return this.http
            .get(url, { headers: headers })
            .pipe(catchError(function (error) { return throwError(error); }), map(function (methodList) { return methodList.payments; }), this.converter.pipeableMany(PAYMENT_DETAILS_NORMALIZER));
    };
    OccUserPaymentAdapter.prototype.delete = function (userId, paymentMethodID) {
        var url = this.occEndpoints.getUrl('paymentDetail', {
            userId: userId,
            paymentDetailId: paymentMethodID,
        });
        var headers = new HttpHeaders({
            'Content-Type': 'application/json',
        });
        return this.http
            .delete(url, { headers: headers })
            .pipe(catchError(function (error) { return throwError(error); }));
    };
    OccUserPaymentAdapter.prototype.setDefault = function (userId, paymentMethodID) {
        var url = this.occEndpoints.getUrl('paymentDetail', {
            userId: userId,
            paymentDetailId: paymentMethodID,
        });
        var headers = new HttpHeaders({
            'Content-Type': 'application/json',
        });
        return this.http
            .patch(url, 
        // TODO: Remove billingAddress property
        { billingAddress: { titleCode: 'mr' }, defaultPayment: true }, { headers: headers })
            .pipe(catchError(function (error) { return throwError(error); }));
    };
    OccUserPaymentAdapter.ctorParameters = function () { return [
        { type: HttpClient },
        { type: OccEndpointsService },
        { type: ConverterService }
    ]; };
    OccUserPaymentAdapter = __decorate([
        Injectable()
    ], OccUserPaymentAdapter);
    return OccUserPaymentAdapter;
}());

var USER_NORMALIZER = new InjectionToken('UserNormalizer');
var USER_SERIALIZER = new InjectionToken('UserSerializer');
var USER_SIGN_UP_SERIALIZER = new InjectionToken('UserSignUpSerializer');
var TITLE_NORMALIZER = new InjectionToken('TitleNormalizer');

var OccUserAdapter = /** @class */ (function () {
    function OccUserAdapter(http, occEndpoints, converter) {
        this.http = http;
        this.occEndpoints = occEndpoints;
        this.converter = converter;
    }
    OccUserAdapter.prototype.load = function (userId) {
        var url = this.occEndpoints.getUrl('user', { userId: userId });
        return this.http
            .get(url)
            .pipe(this.converter.pipeable(USER_NORMALIZER));
    };
    OccUserAdapter.prototype.update = function (userId, user) {
        var url = this.occEndpoints.getUrl('user', { userId: userId });
        user = this.converter.convert(user, USER_SERIALIZER);
        return this.http.patch(url, user);
    };
    OccUserAdapter.prototype.register = function (user) {
        var url = this.occEndpoints.getUrl('userRegister');
        var headers = new HttpHeaders({
            'Content-Type': 'application/json',
        });
        headers = InterceptorUtil.createHeader(USE_CLIENT_TOKEN, true, headers);
        user = this.converter.convert(user, USER_SIGN_UP_SERIALIZER);
        return this.http
            .post(url, user, { headers: headers })
            .pipe(this.converter.pipeable(USER_NORMALIZER));
    };
    OccUserAdapter.prototype.registerGuest = function (guid, password) {
        var url = this.occEndpoints.getUrl('userRegister');
        var headers = new HttpHeaders({
            'Content-Type': 'application/x-www-form-urlencoded',
        });
        headers = InterceptorUtil.createHeader(USE_CLIENT_TOKEN, true, headers);
        var httpParams = new HttpParams()
            .set('guid', guid)
            .set('password', password);
        return this.http
            .post(url, httpParams, { headers: headers })
            .pipe(this.converter.pipeable(USER_NORMALIZER));
    };
    OccUserAdapter.prototype.requestForgotPasswordEmail = function (userEmailAddress) {
        var url = this.occEndpoints.getUrl('userForgotPassword');
        var httpParams = new HttpParams().set('userId', userEmailAddress);
        var headers = new HttpHeaders({
            'Content-Type': 'application/x-www-form-urlencoded',
        });
        headers = InterceptorUtil.createHeader(USE_CLIENT_TOKEN, true, headers);
        return this.http.post(url, httpParams, { headers: headers });
    };
    OccUserAdapter.prototype.resetPassword = function (token, newPassword) {
        var url = this.occEndpoints.getUrl('userResetPassword');
        var headers = new HttpHeaders({
            'Content-Type': 'application/json',
        });
        headers = InterceptorUtil.createHeader(USE_CLIENT_TOKEN, true, headers);
        return this.http.post(url, { token: token, newPassword: newPassword }, { headers: headers });
    };
    OccUserAdapter.prototype.updateEmail = function (userId, currentPassword, newUserId) {
        var url = this.occEndpoints.getUrl('userUpdateLoginId', { userId: userId });
        var httpParams = new HttpParams()
            .set('password', currentPassword)
            .set('newLogin', newUserId);
        var headers = new HttpHeaders({
            'Content-Type': 'application/x-www-form-urlencoded',
        });
        return this.http.put(url, httpParams, { headers: headers });
    };
    OccUserAdapter.prototype.updatePassword = function (userId, oldPassword, newPassword) {
        var url = this.occEndpoints.getUrl('userUpdatePassword', { userId: userId });
        var httpParams = new HttpParams()
            .set('old', oldPassword)
            .set('new', newPassword);
        var headers = new HttpHeaders({
            'Content-Type': 'application/x-www-form-urlencoded',
        });
        return this.http.put(url, httpParams, { headers: headers });
    };
    OccUserAdapter.prototype.remove = function (userId) {
        var url = this.occEndpoints.getUrl('user', { userId: userId });
        return this.http.delete(url);
    };
    OccUserAdapter.prototype.loadTitles = function () {
        var url = this.occEndpoints.getUrl('titles');
        return this.http.get(url).pipe(map(function (titleList) { return titleList.titles; }), this.converter.pipeableMany(TITLE_NORMALIZER));
    };
    OccUserAdapter.ctorParameters = function () { return [
        { type: HttpClient },
        { type: OccEndpointsService },
        { type: ConverterService }
    ]; };
    OccUserAdapter = __decorate([
        Injectable()
    ], OccUserAdapter);
    return OccUserAdapter;
}());

var AnonymousConsentTemplatesAdapter = /** @class */ (function () {
    function AnonymousConsentTemplatesAdapter() {
    }
    return AnonymousConsentTemplatesAdapter;
}());

var UserAddressAdapter = /** @class */ (function () {
    function UserAddressAdapter() {
    }
    return UserAddressAdapter;
}());

var UserConsentAdapter = /** @class */ (function () {
    function UserConsentAdapter() {
    }
    return UserConsentAdapter;
}());

var UserOrderAdapter = /** @class */ (function () {
    function UserOrderAdapter() {
    }
    return UserOrderAdapter;
}());

var UserPaymentAdapter = /** @class */ (function () {
    function UserPaymentAdapter() {
    }
    return UserPaymentAdapter;
}());

var UserAdapter = /** @class */ (function () {
    function UserAdapter() {
    }
    return UserAdapter;
}());

var defaultOccUserConfig = {
    backend: {
        occ: {
            endpoints: {
                // tslint:disable:max-line-length
                user: 'users/${userId}',
                userRegister: 'users',
                userForgotPassword: 'forgottenpasswordtokens',
                userResetPassword: 'resetpassword',
                userUpdateLoginId: 'users/${userId}/login',
                userUpdatePassword: 'users/${userId}/password',
                titles: 'titles',
                paymentDetailsAll: 'users/${userId}/paymentdetails',
                paymentDetail: 'users/${userId}/paymentdetails/${paymentDetailId}',
                orderHistory: 'users/${userId}/orders',
                orderDetail: 'users/${userId}/orders/${orderId}?fields=FULL',
                anonymousConsentTemplates: 'users/anonymous/consenttemplates',
                consentTemplates: 'users/${userId}/consenttemplates',
                consents: 'users/${userId}/consents',
                consentDetail: 'users/${userId}/consents/${consentId}',
                addresses: 'users/${userId}/addresses',
                addressDetail: 'users/${userId}/addresses/${addressId}',
                addressVerification: 'users/${userId}/addresses/verification',
                consignmentTracking: 'users/${userId}/orders/${orderCode}/consignments/${consignmentCode}/tracking',
                customerCoupons: 'users/${userId}/customercoupons',
                claimCoupon: 'users/${userId}/customercoupons/${couponCode}/claim',
                couponNotification: 'users/${userId}/customercoupons/${couponCode}/notification',
                notificationPreference: 'users/${userId}/notificationpreferences',
                productInterests: 'users/${userId}/productinterests',
                getProductInterests: 'users/${userId}/productinterests?fields=sorts,pagination,results(productInterestEntry,product(code))',
                cancelOrder: 'users/${userId}/orders/${orderId}/cancellation',
                returnOrder: 'users/${userId}/orderReturns?fields=BASIC,returnEntries(BASIC,refundAmount(formattedValue),orderEntry(basePrice(formattedValue),product(name,code,baseOptions,images(DEFAULT,galleryIndex)))),deliveryCost(formattedValue),totalPrice(formattedValue),subTotal(formattedValue)',
                orderReturns: 'users/${userId}/orderReturns?fields=BASIC',
                orderReturnDetail: 'users/${userId}/orderReturns/${returnRequestCode}?fields=BASIC,returnEntries(BASIC,refundAmount(formattedValue),orderEntry(basePrice(formattedValue),product(name,code,baseOptions,images(DEFAULT,galleryIndex)))),deliveryCost(formattedValue),totalPrice(formattedValue),subTotal(formattedValue)',
                cancelReturn: 'users/${userId}/orderReturns/${returnRequestCode}',
            },
        },
    },
};

var CustomerCouponAdapter = /** @class */ (function () {
    function CustomerCouponAdapter() {
    }
    return CustomerCouponAdapter;
}());

var CUSTOMER_COUPON_SEARCH_RESULT_NORMALIZER = new InjectionToken('CustomerCouponSearchResultNormalizer');

var OccCustomerCouponAdapter = /** @class */ (function () {
    function OccCustomerCouponAdapter(http, occEndpoints, converter) {
        this.http = http;
        this.occEndpoints = occEndpoints;
        this.converter = converter;
    }
    OccCustomerCouponAdapter.prototype.getCustomerCoupons = function (userId, pageSize, currentPage, sort) {
        // Currently OCC only supports calls for customer coupons in case of logged users
        if (userId === OCC_USER_ID_ANONYMOUS) {
            return of({});
        }
        var url = this.occEndpoints.getUrl('customerCoupons', { userId: userId });
        var params = new HttpParams().set('sort', sort ? sort : 'startDate:asc');
        if (pageSize) {
            params = params.set('pageSize', pageSize.toString());
        }
        if (currentPage) {
            params = params.set('currentPage', currentPage.toString());
        }
        var headers = this.newHttpHeader();
        return this.http
            .get(url, { headers: headers, params: params })
            .pipe(this.converter.pipeable(CUSTOMER_COUPON_SEARCH_RESULT_NORMALIZER));
    };
    OccCustomerCouponAdapter.prototype.turnOffNotification = function (userId, couponCode) {
        var url = this.occEndpoints.getUrl('couponNotification', {
            userId: userId,
            couponCode: couponCode,
        });
        var headers = this.newHttpHeader();
        return this.http.delete(url, { headers: headers });
    };
    OccCustomerCouponAdapter.prototype.turnOnNotification = function (userId, couponCode) {
        var url = this.occEndpoints.getUrl('couponNotification', {
            userId: userId,
            couponCode: couponCode,
        });
        var headers = this.newHttpHeader();
        return this.http.post(url, { headers: headers });
    };
    OccCustomerCouponAdapter.prototype.claimCustomerCoupon = function (userId, couponCode) {
        var url = this.occEndpoints.getUrl('claimCoupon', {
            userId: userId,
            couponCode: couponCode,
        });
        var headers = this.newHttpHeader();
        return this.http.post(url, { headers: headers });
    };
    OccCustomerCouponAdapter.prototype.newHttpHeader = function () {
        return new HttpHeaders({
            'Content-Type': 'application/json',
        });
    };
    OccCustomerCouponAdapter.ctorParameters = function () { return [
        { type: HttpClient },
        { type: OccEndpointsService },
        { type: ConverterService }
    ]; };
    OccCustomerCouponAdapter = __decorate([
        Injectable()
    ], OccCustomerCouponAdapter);
    return OccCustomerCouponAdapter;
}());

var UserNotificationPreferenceAdapter = /** @class */ (function () {
    function UserNotificationPreferenceAdapter() {
    }
    return UserNotificationPreferenceAdapter;
}());

var NOTIFICATION_PREFERENCE_SERIALIZER = new InjectionToken('NotificationPreferenceSerializer');
var NOTIFICATION_PREFERENCE_NORMALIZER = new InjectionToken('NotificationPreferenceNormalizer');

var UserNotificationPreferenceConnector = /** @class */ (function () {
    function UserNotificationPreferenceConnector(adapter) {
        this.adapter = adapter;
    }
    UserNotificationPreferenceConnector.prototype.loadAll = function (userId) {
        return this.adapter.loadAll(userId);
    };
    UserNotificationPreferenceConnector.prototype.update = function (userId, preferences) {
        return this.adapter.update(userId, preferences);
    };
    UserNotificationPreferenceConnector.ctorParameters = function () { return [
        { type: UserNotificationPreferenceAdapter }
    ]; };
    UserNotificationPreferenceConnector.ɵprov = ɵɵdefineInjectable({ factory: function UserNotificationPreferenceConnector_Factory() { return new UserNotificationPreferenceConnector(ɵɵinject(UserNotificationPreferenceAdapter)); }, token: UserNotificationPreferenceConnector, providedIn: "root" });
    UserNotificationPreferenceConnector = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], UserNotificationPreferenceConnector);
    return UserNotificationPreferenceConnector;
}());

var headers = new HttpHeaders({
    'Content-Type': 'application/json',
});
var OccUserNotificationPreferenceAdapter = /** @class */ (function () {
    function OccUserNotificationPreferenceAdapter(http, converter, occEndpoints) {
        this.http = http;
        this.converter = converter;
        this.occEndpoints = occEndpoints;
    }
    OccUserNotificationPreferenceAdapter.prototype.loadAll = function (userId) {
        return this.http
            .get(this.occEndpoints.getUrl('notificationPreference', { userId: userId }), {
            headers: headers,
        })
            .pipe(map(function (list) { return list.preferences; }), this.converter.pipeableMany(NOTIFICATION_PREFERENCE_NORMALIZER), catchError(function (error) { return throwError(error); }));
    };
    OccUserNotificationPreferenceAdapter.prototype.update = function (userId, preferences) {
        preferences = this.converter.convert(preferences, NOTIFICATION_PREFERENCE_SERIALIZER);
        return this.http
            .patch(this.occEndpoints.getUrl('notificationPreference', { userId: userId }), { preferences: preferences }, { headers: headers })
            .pipe(catchError(function (error) { return throwError(error); }));
    };
    OccUserNotificationPreferenceAdapter.ctorParameters = function () { return [
        { type: HttpClient },
        { type: ConverterService },
        { type: OccEndpointsService }
    ]; };
    OccUserNotificationPreferenceAdapter = __decorate([
        Injectable()
    ], OccUserNotificationPreferenceAdapter);
    return OccUserNotificationPreferenceAdapter;
}());

var PRODUCT_INTERESTS_NORMALIZER = new InjectionToken('ProductInterestsNormalizer');

var headers$1 = new HttpHeaders({
    'Content-Type': 'application/json',
});
var OccUserInterestsAdapter = /** @class */ (function () {
    function OccUserInterestsAdapter(http, occEndpoints, config, converter) {
        this.http = http;
        this.occEndpoints = occEndpoints;
        this.config = config;
        this.converter = converter;
    }
    OccUserInterestsAdapter.prototype.getInterests = function (userId, pageSize, currentPage, sort, productCode, notificationType) {
        var params = new HttpParams().set('sort', sort ? sort : 'name:asc');
        if (pageSize) {
            params = params.set('pageSize', pageSize.toString());
        }
        if (currentPage) {
            params = params.set('currentPage', currentPage.toString());
        }
        if (productCode) {
            params = params.set('productCode', productCode);
        }
        if (notificationType) {
            params = params.set('notificationType', notificationType.toString());
        }
        return this.http
            .get(this.occEndpoints.getUrl('getProductInterests', { userId: userId }), {
            headers: headers$1,
            params: params,
        })
            .pipe(this.converter.pipeable(PRODUCT_INTERESTS_NORMALIZER), catchError(function (error) { return throwError(error); }));
    };
    OccUserInterestsAdapter.prototype.removeInterest = function (userId, item) {
        var _this = this;
        var r = [];
        item.productInterestEntry.forEach(function (entry) {
            var params = new HttpParams()
                .set('productCode', item.product.code)
                .set('notificationType', entry.interestType);
            r.push(_this.http
                .delete(_this.occEndpoints.getUrl('productInterests', { userId: userId }), {
                params: params,
            })
                .pipe(catchError(function (error) { return throwError(error); })));
        });
        return forkJoin(r);
    };
    OccUserInterestsAdapter.prototype.addInterest = function (userId, productCode, notificationType) {
        var params = new HttpParams()
            .set('productCode', productCode)
            .set('notificationType', notificationType.toString());
        return this.http
            .post(this.occEndpoints.getUrl('productInterests', { userId: userId }), {}, {
            headers: headers$1,
            params: params,
        })
            .pipe(catchError(function (error) { return throwError(error); }));
    };
    OccUserInterestsAdapter.ctorParameters = function () { return [
        { type: HttpClient },
        { type: OccEndpointsService },
        { type: OccConfig },
        { type: ConverterService }
    ]; };
    OccUserInterestsAdapter = __decorate([
        Injectable()
    ], OccUserInterestsAdapter);
    return OccUserInterestsAdapter;
}());

var UserInterestsAdapter = /** @class */ (function () {
    function UserInterestsAdapter() {
    }
    return UserInterestsAdapter;
}());

var OccUserInterestsNormalizer = /** @class */ (function () {
    function OccUserInterestsNormalizer(converter) {
        this.converter = converter;
    }
    OccUserInterestsNormalizer.prototype.convert = function (source, target) {
        var _this = this;
        if (target === undefined) {
            target = __assign({}, source);
        }
        if (source && source.results) {
            target.results = source.results.map(function (result) { return (__assign(__assign({}, result), { product: _this.converter.convert(result.product, PRODUCT_NORMALIZER) })); });
        }
        return target;
    };
    OccUserInterestsNormalizer.ctorParameters = function () { return [
        { type: ConverterService }
    ]; };
    OccUserInterestsNormalizer.ɵprov = ɵɵdefineInjectable({ factory: function OccUserInterestsNormalizer_Factory() { return new OccUserInterestsNormalizer(ɵɵinject(ConverterService)); }, token: OccUserInterestsNormalizer, providedIn: "root" });
    OccUserInterestsNormalizer = __decorate([
        Injectable({ providedIn: 'root' })
    ], OccUserInterestsNormalizer);
    return OccUserInterestsNormalizer;
}());

var OccReturnRequestNormalizer = /** @class */ (function () {
    function OccReturnRequestNormalizer(converter) {
        this.converter = converter;
    }
    OccReturnRequestNormalizer.prototype.convert = function (source, target) {
        var _this = this;
        if (target === undefined) {
            target = __assign({}, source);
        }
        if (source.returnEntries) {
            target.returnEntries = source.returnEntries.map(function (entry) { return (__assign(__assign({}, entry), { orderEntry: _this.convertOrderEntry(entry.orderEntry) })); });
        }
        return target;
    };
    OccReturnRequestNormalizer.prototype.convertOrderEntry = function (source) {
        return __assign(__assign({}, source), { product: this.converter.convert(source.product, PRODUCT_NORMALIZER) });
    };
    OccReturnRequestNormalizer.ctorParameters = function () { return [
        { type: ConverterService }
    ]; };
    OccReturnRequestNormalizer.ɵprov = ɵɵdefineInjectable({ factory: function OccReturnRequestNormalizer_Factory() { return new OccReturnRequestNormalizer(ɵɵinject(ConverterService)); }, token: OccReturnRequestNormalizer, providedIn: "root" });
    OccReturnRequestNormalizer = __decorate([
        Injectable({ providedIn: 'root' })
    ], OccReturnRequestNormalizer);
    return OccReturnRequestNormalizer;
}());

var UserOccModule = /** @class */ (function () {
    function UserOccModule() {
    }
    UserOccModule = __decorate([
        NgModule({
            imports: [CommonModule, HttpClientModule],
            providers: [
                provideDefaultConfig(defaultOccUserConfig),
                { provide: UserAdapter, useClass: OccUserAdapter },
                { provide: UserAddressAdapter, useClass: OccUserAddressAdapter },
                { provide: UserConsentAdapter, useClass: OccUserConsentAdapter },
                {
                    provide: AnonymousConsentTemplatesAdapter,
                    useClass: OccAnonymousConsentTemplatesAdapter,
                },
                {
                    provide: UserPaymentAdapter,
                    useClass: OccUserPaymentAdapter,
                },
                { provide: UserOrderAdapter, useClass: OccUserOrderAdapter },
                { provide: CustomerCouponAdapter, useClass: OccCustomerCouponAdapter },
                {
                    provide: UserNotificationPreferenceAdapter,
                    useClass: OccUserNotificationPreferenceAdapter,
                },
                { provide: UserInterestsAdapter, useClass: OccUserInterestsAdapter },
                {
                    provide: PRODUCT_INTERESTS_NORMALIZER,
                    useExisting: OccUserInterestsNormalizer,
                    multi: true,
                },
                {
                    provide: ORDER_RETURN_REQUEST_NORMALIZER,
                    useExisting: OccReturnRequestNormalizer,
                    multi: true,
                },
            ],
        })
    ], UserOccModule);
    return UserOccModule;
}());

var JavaRegExpConverter = /** @class */ (function () {
    function JavaRegExpConverter() {
        /**
         * Pattern that extracts modifiers from the Java regexp.
         *
         * Java regexps MAY start with ONE or MANY modifiers like `(?MODIFIERS)PATTERN`. Examples:
         * - `(?i)` for Case Insensitive Mode: `(?i)PATTERN`
         * - `(?u)` for Unicode-Aware Case Folding; `(?u)PATTERN`
         * - or multiple combined:  `(?iu)PATTERN`
         * - (more modifiers in the official Java docs https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html)
         *
         * This pattern extracts 3 parts from the input string, i.e. for `(?iu)PATTERN`:
         *    1. original modifiers syntax, i.e. `(?iu)` (or undefined if no modifiers present)
         *    2. extracted modifiers, i.e. `iu` (or undefined if no modifiers present)
         *    3. the rest of the regexp, i.e. `PATTERN`
         */
        this.EXTRACT_JAVA_REGEXP_MODIFIERS = /^(\(\?([a-z]+)\))?(.*)/;
    }
    /**
     * Converts RegExp from Java syntax to Javascript, by recognizing Java regexp modifiers
     * and converting them to the Javascript ones (i.e. case insensitive mode: `(?i)PATTERN` -> `/pattern/i`)
     *
     * **CAUTION!** Not all features and modifiers of Java regexps are valid in Javascript!
     * If unsupported feature or modifier is used, then `null` will be returned instead of Javascript RegExp.
     *
     * See differences between Java and Javascript regexps:
     * - https://stackoverflow.com/questions/8754444/convert-javascript-regular-expression-to-java-syntax
     * - https://en.wikipedia.org/wiki/Comparison_of_regular_expression_engines#Language_features
     */
    JavaRegExpConverter.prototype.toJsRegExp = function (javaSyntax) {
        var parts = javaSyntax.match(this.EXTRACT_JAVA_REGEXP_MODIFIERS);
        if (!parts) {
            return null;
        }
        var _a = __read(parts, 4), modifiers = _a[2], jsSyntax = _a[3];
        try {
            return new RegExp(jsSyntax, modifiers);
        }
        catch (error) {
            if (isDevMode()) {
                console.warn("WARNING: Could not convert Java regexp into Javascript. Original regexp: " + javaSyntax + " \nMessage: " + error);
            }
            return null;
        }
    };
    JavaRegExpConverter.ɵprov = ɵɵdefineInjectable({ factory: function JavaRegExpConverter_Factory() { return new JavaRegExpConverter(); }, token: JavaRegExpConverter, providedIn: "root" });
    JavaRegExpConverter = __decorate([
        Injectable({ providedIn: 'root' })
    ], JavaRegExpConverter);
    return JavaRegExpConverter;
}());

var CONFIG_INITIALIZER = new InjectionToken('ConfigInitializer');
var CONFIG_INITIALIZER_FORROOT_GUARD = new InjectionToken('CONFIG_INITIALIZER_FORROOT_GUARD');

/**
 * The url of the server request when running SSR
 * */
var SERVER_REQUEST_URL = new InjectionToken('SERVER_REQUEST_URL');
/**
 * The url of the server request host when running SSR
 * */
var SERVER_REQUEST_ORIGIN = new InjectionToken('SERVER_REQUEST_ORIGIN');

var OccLoadedConfigConverter = /** @class */ (function () {
    function OccLoadedConfigConverter(javaRegExpConverter) {
        this.javaRegExpConverter = javaRegExpConverter;
    }
    OccLoadedConfigConverter.prototype.fromOccBaseSites = function (baseSites, currentUrl) {
        var _this = this;
        var baseSite = baseSites.find(function (site) {
            return _this.isCurrentBaseSite(site, currentUrl);
        });
        if (!baseSite) {
            throw this.getError("Current url (" + currentUrl + ") doesn't match with any of url patterns of any base site.");
        }
        // Although `stores` property is an array, typically there is only one store. So we return the first store from the list.
        var baseStore = baseSite.stores && baseSite.stores[0];
        if (!baseStore) {
            throw this.getError("Current base site (" + baseSite.uid + ") doesn't have any base store.");
        }
        return {
            baseSite: baseSite.uid,
            languages: this.getIsoCodes(baseStore.languages, baseSite.defaultLanguage || baseStore.defaultLanguage),
            currencies: this.getIsoCodes(baseStore.currencies, baseStore.defaultCurrency),
            urlParameters: this.getUrlParams(baseSite.urlEncodingAttributes),
        };
    };
    OccLoadedConfigConverter.prototype.toSiteContextConfig = function (_a) {
        var _b;
        var baseSite = _a.baseSite, languages = _a.languages, currencies = _a.currencies, urlEncodingAttributes = _a.urlParameters;
        var result = {
            context: (_b = {
                    urlParameters: urlEncodingAttributes
                },
                _b[BASE_SITE_CONTEXT_ID] = [baseSite],
                _b[LANGUAGE_CONTEXT_ID] = languages,
                _b[CURRENCY_CONTEXT_ID] = currencies,
                _b),
        };
        return result;
    };
    OccLoadedConfigConverter.prototype.toI18nConfig = function (_a) {
        var languages = _a.languages;
        return { i18n: { fallbackLang: languages[0] } };
    };
    OccLoadedConfigConverter.prototype.isCurrentBaseSite = function (site, currentUrl) {
        var _this = this;
        var index = (site.urlPatterns || []).findIndex(function (javaRegexp) {
            var jsRegexp = _this.javaRegExpConverter.toJsRegExp(javaRegexp);
            if (jsRegexp) {
                var result = jsRegexp.test(currentUrl);
                return result;
            }
        });
        return index !== -1;
    };
    /**
     * Returns an array of url encoded site context parameters.
     *
     * It maps the string "storefront" (used in OCC) to the "baseSite" (used in Spartacus)
     */
    OccLoadedConfigConverter.prototype.getUrlParams = function (params) {
        var STOREFRONT_PARAM = 'storefront';
        return (params || []).map(function (param) {
            return param === STOREFRONT_PARAM ? BASE_SITE_CONTEXT_ID : param;
        });
    };
    /**
     * Returns iso codes in a array, where the first element is the default iso code.
     */
    OccLoadedConfigConverter.prototype.getIsoCodes = function (elements, defaultElement) {
        var result = this.moveToFirst(elements, function (el) { return el.isocode === defaultElement.isocode; }).map(function (el) { return el.isocode; });
        return result;
    };
    /**
     * Moves to the start of the array the first element that satisfies the given predicate.
     *
     * @param array array to modify
     * @param predicate function called on elements
     */
    OccLoadedConfigConverter.prototype.moveToFirst = function (array, predicate) {
        array = __spread(array);
        var index = array.findIndex(predicate);
        if (index !== -1) {
            var _a = __read(array.splice(index, 1), 1), el = _a[0];
            array.unshift(el);
        }
        return array;
    };
    OccLoadedConfigConverter.prototype.getError = function (message) {
        return new Error("Error: Cannot get base site config! " + message);
    };
    OccLoadedConfigConverter.ctorParameters = function () { return [
        { type: JavaRegExpConverter }
    ]; };
    OccLoadedConfigConverter.ɵprov = ɵɵdefineInjectable({ factory: function OccLoadedConfigConverter_Factory() { return new OccLoadedConfigConverter(ɵɵinject(JavaRegExpConverter)); }, token: OccLoadedConfigConverter, providedIn: "root" });
    OccLoadedConfigConverter = __decorate([
        Injectable({ providedIn: 'root' })
    ], OccLoadedConfigConverter);
    return OccLoadedConfigConverter;
}());

var OccSitesConfigLoader = /** @class */ (function () {
    function OccSitesConfigLoader(config, http) {
        this.config = config;
        this.http = http;
        this.endpoint = 'basesites?fields=baseSites(uid,defaultLanguage(isocode),urlEncodingAttributes,urlPatterns,stores(currencies(isocode),defaultCurrency(isocode),languages(isocode),defaultLanguage(isocode)))';
    }
    Object.defineProperty(OccSitesConfigLoader.prototype, "baseEndpoint", {
        get: function () {
            return ((this.config.backend.occ.baseUrl || '') + this.config.backend.occ.prefix);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(OccSitesConfigLoader.prototype, "url", {
        get: function () {
            return "" + this.baseEndpoint + this.endpoint;
        },
        enumerable: true,
        configurable: true
    });
    OccSitesConfigLoader.prototype.load = function () {
        if (!this.config || !this.config.backend || !this.config.backend.occ) {
            return throwError(new Error("Missing config for OCC backend!"));
        }
        return this.http
            .get(this.url)
            .pipe(map(function (_a) {
            var baseSites = _a.baseSites;
            return baseSites;
        }));
    };
    OccSitesConfigLoader.ctorParameters = function () { return [
        { type: OccConfig },
        { type: HttpClient }
    ]; };
    OccSitesConfigLoader.ɵprov = ɵɵdefineInjectable({ factory: function OccSitesConfigLoader_Factory() { return new OccSitesConfigLoader(ɵɵinject(OccConfig), ɵɵinject(HttpClient)); }, token: OccSitesConfigLoader, providedIn: "root" });
    OccSitesConfigLoader = __decorate([
        Injectable({ providedIn: 'root' })
    ], OccSitesConfigLoader);
    return OccSitesConfigLoader;
}());

var EXTERNAL_CONFIG_TRANSFER_ID = makeStateKey('cx-external-config');
var OccConfigLoaderService = /** @class */ (function () {
    function OccConfigLoaderService(platform, document, config, sitesConfigLoader, converter, transferState, serverRequestUrl) {
        this.platform = platform;
        this.document = document;
        this.config = config;
        this.sitesConfigLoader = sitesConfigLoader;
        this.converter = converter;
        this.transferState = transferState;
        this.serverRequestUrl = serverRequestUrl;
    }
    Object.defineProperty(OccConfigLoaderService.prototype, "currentUrl", {
        get: function () {
            if (isPlatformBrowser(this.platform)) {
                return this.document.location.href;
            }
            if (this.serverRequestUrl) {
                return this.serverRequestUrl;
            }
            if (isDevMode()) {
                console.error("Please provide token 'SERVER_REQUEST_URL' with the requested URL for SSR");
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Initializes the Spartacus config asynchronously basing on the external config
     */
    OccConfigLoaderService.prototype.loadConfig = function () {
        var _this = this;
        return this.get()
            .pipe(tap(function (externalConfig) { return _this.transfer(externalConfig); }), map(function (externalConfig) {
            return deepMerge.apply(void 0, __spread([{}], _this.getConfigChunks(externalConfig)));
        }))
            .toPromise();
    };
    /**
     * Returns the external config
     */
    OccConfigLoaderService.prototype.get = function () {
        var rehydratedExternalConfig = this.rehydrate();
        return rehydratedExternalConfig
            ? of(rehydratedExternalConfig)
            : this.load();
    };
    /**
     * Loads the external config from backend
     */
    OccConfigLoaderService.prototype.load = function () {
        var _this = this;
        return this.sitesConfigLoader
            .load()
            .pipe(map(function (baseSites) {
            return _this.converter.fromOccBaseSites(baseSites, _this.currentUrl);
        }));
    };
    /**
     * Tries to rehydrate external config in the browser from SSR
     */
    OccConfigLoaderService.prototype.rehydrate = function () {
        if (this.transferState && isPlatformBrowser(this.platform)) {
            return this.transferState.get(EXTERNAL_CONFIG_TRANSFER_ID, undefined);
        }
    };
    /**
     * Transfers the given external config in SSR to the browser
     *
     * @param externalConfig
     */
    OccConfigLoaderService.prototype.transfer = function (externalConfig) {
        if (this.transferState &&
            isPlatformServer(this.platform) &&
            externalConfig) {
            this.transferState.set(EXTERNAL_CONFIG_TRANSFER_ID, externalConfig);
        }
    };
    OccConfigLoaderService.prototype.getConfigChunks = function (externalConfig) {
        var chunks = [this.converter.toSiteContextConfig(externalConfig)];
        if (this.shouldReturnI18nChunk()) {
            chunks.push(this.converter.toI18nConfig(externalConfig));
        }
        return chunks;
    };
    OccConfigLoaderService.prototype.shouldReturnI18nChunk = function () {
        var fallbackLangExists = typeof (this.config &&
            this.config.i18n &&
            this.config.i18n.fallbackLang) !== 'undefined';
        if (fallbackLangExists && isDevMode()) {
            console.warn("There is an already provided static config for 'i18n.fallbackLang', so the value from OCC loaded config is ignored.");
        }
        return !fallbackLangExists;
    };
    OccConfigLoaderService.ctorParameters = function () { return [
        { type: undefined, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] },
        { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] },
        { type: undefined, decorators: [{ type: Inject, args: [Config,] }] },
        { type: OccSitesConfigLoader },
        { type: OccLoadedConfigConverter },
        { type: TransferState, decorators: [{ type: Optional }] },
        { type: String, decorators: [{ type: Optional }, { type: Inject, args: [SERVER_REQUEST_URL,] }] }
    ]; };
    OccConfigLoaderService.ɵprov = ɵɵdefineInjectable({ factory: function OccConfigLoaderService_Factory() { return new OccConfigLoaderService(ɵɵinject(PLATFORM_ID), ɵɵinject(DOCUMENT), ɵɵinject(Config), ɵɵinject(OccSitesConfigLoader), ɵɵinject(OccLoadedConfigConverter), ɵɵinject(TransferState, 8), ɵɵinject(SERVER_REQUEST_URL, 8)); }, token: OccConfigLoaderService, providedIn: "root" });
    OccConfigLoaderService = __decorate([
        Injectable({ providedIn: 'root' }),
        __param(0, Inject(PLATFORM_ID)),
        __param(1, Inject(DOCUMENT)),
        __param(2, Inject(Config)),
        __param(5, Optional()),
        __param(6, Optional()),
        __param(6, Inject(SERVER_REQUEST_URL))
    ], OccConfigLoaderService);
    return OccConfigLoaderService;
}());

/**
 * Initializes the Spartacus config asynchronously basing on the external config
 */
function initConfig(configLoader, config) {
    /**
     * Load config for `context` from backend only when there is no static config for `context.baseSite`
     */
    if (!config.context || !config.context[BASE_SITE_CONTEXT_ID]) {
        return {
            scopes: ['context', 'i18n.fallbackLang'],
            configFactory: function () { return configLoader.loadConfig(); },
        };
    }
    return null;
}
/**
 * Re-provides the external config chunk given before Angular bootstrap
 */
var OccConfigLoaderModule = /** @class */ (function () {
    function OccConfigLoaderModule() {
    }
    OccConfigLoaderModule_1 = OccConfigLoaderModule;
    OccConfigLoaderModule.forRoot = function () {
        return {
            ngModule: OccConfigLoaderModule_1,
            providers: [
                {
                    provide: CONFIG_INITIALIZER,
                    useFactory: initConfig,
                    deps: [OccConfigLoaderService, SiteContextConfig],
                    multi: true,
                },
            ],
        };
    };
    var OccConfigLoaderModule_1;
    OccConfigLoaderModule = OccConfigLoaderModule_1 = __decorate([
        NgModule()
    ], OccConfigLoaderModule);
    return OccConfigLoaderModule;
}());

var OCC_BASE_URL_META_TAG_NAME = 'occ-backend-base-url';
var OCC_BASE_URL_META_TAG_PLACEHOLDER = 'OCC_BACKEND_BASE_URL_VALUE';
var MEDIA_BASE_URL_META_TAG_NAME = 'media-backend-base-url';
var MEDIA_BASE_URL_META_TAG_PLACEHOLDER = 'MEDIA_BACKEND_BASE_URL_VALUE';
function occServerConfigFromMetaTagFactory(meta) {
    var baseUrl = getMetaTagContent(OCC_BASE_URL_META_TAG_NAME, meta);
    return baseUrl && baseUrl !== OCC_BASE_URL_META_TAG_PLACEHOLDER
        ? { backend: { occ: { baseUrl: baseUrl } } }
        : {};
}
function mediaServerConfigFromMetaTagFactory(meta) {
    var baseUrl = getMetaTagContent(MEDIA_BASE_URL_META_TAG_NAME, meta);
    return baseUrl && baseUrl !== MEDIA_BASE_URL_META_TAG_PLACEHOLDER
        ? { backend: { media: { baseUrl: baseUrl } } }
        : {};
}
function getMetaTagContent(name, meta) {
    var metaTag = meta.getTag("name=\"" + name + "\"");
    return metaTag && metaTag.content;
}
function provideConfigFromMetaTags() {
    return [
        provideConfigFactory(occServerConfigFromMetaTagFactory, [Meta]),
        provideConfigFactory(mediaServerConfigFromMetaTagFactory, [Meta]),
    ];
}

var defaultOccConfig = {
    backend: {
        occ: {
            prefix: '/rest/v2/',
        },
        media: {},
    },
};

function occConfigValidator(config) {
    if (config.backend === undefined ||
        config.backend.occ === undefined ||
        config.backend.occ.baseUrl === undefined) {
        return 'Please configure backend.occ.baseUrl before using storefront library!';
    }
}

/**
 * Http interceptor to add cookies to all cross-site requests.
 */
var WithCredentialsInterceptor = /** @class */ (function () {
    function WithCredentialsInterceptor(config) {
        this.config = config;
    }
    /**
     * Intercepts each request and adds the `withCredential` flag to it
     * if it hasn't been added already.
     */
    WithCredentialsInterceptor.prototype.intercept = function (request, next) {
        if (this.requiresWithCredentials(request)) {
            request = request.clone({
                withCredentials: true,
            });
        }
        return next.handle(request);
    };
    /**
     * indicates whether the request should use the WithCredentials flag.
     */
    WithCredentialsInterceptor.prototype.requiresWithCredentials = function (request) {
        var _a, _b;
        return (((_a = this.occConfig) === null || _a === void 0 ? void 0 : _a.useWithCredentials) &&
            request.url.indexOf((_b = this.occConfig) === null || _b === void 0 ? void 0 : _b.prefix) > -1);
    };
    Object.defineProperty(WithCredentialsInterceptor.prototype, "occConfig", {
        get: function () {
            return this.config.backend.occ;
        },
        enumerable: true,
        configurable: true
    });
    WithCredentialsInterceptor.ctorParameters = function () { return [
        { type: OccConfig }
    ]; };
    WithCredentialsInterceptor.ɵprov = ɵɵdefineInjectable({ factory: function WithCredentialsInterceptor_Factory() { return new WithCredentialsInterceptor(ɵɵinject(OccConfig)); }, token: WithCredentialsInterceptor, providedIn: "root" });
    WithCredentialsInterceptor = __decorate([
        Injectable({ providedIn: 'root' })
    ], WithCredentialsInterceptor);
    return WithCredentialsInterceptor;
}());

var Occ;
(function (Occ) {
    /**
     * Defines values for PriceType.
     * Possible values include: 'BUY', 'FROM'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: PriceType = <PriceType>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var PriceType;
    (function (PriceType) {
        PriceType["BUY"] = "BUY";
        PriceType["FROM"] = "FROM";
    })(PriceType = Occ.PriceType || (Occ.PriceType = {}));
    /**
     * Defines values for ImageType.
     * Possible values include: 'PRIMARY', 'GALLERY'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: ImageType = <ImageType>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var ImageType;
    (function (ImageType) {
        ImageType["PRIMARY"] = "PRIMARY";
        ImageType["GALLERY"] = "GALLERY";
    })(ImageType = Occ.ImageType || (Occ.ImageType = {}));
    /**
     * Defines values for Fields.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields = <Fields>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields;
    (function (Fields) {
        Fields["BASIC"] = "BASIC";
        Fields["DEFAULT"] = "DEFAULT";
        Fields["FULL"] = "FULL";
    })(Fields = Occ.Fields || (Occ.Fields = {}));
    /**
     * Defines values for Fields1.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields1 = <Fields1>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields1;
    (function (Fields1) {
        Fields1["BASIC"] = "BASIC";
        Fields1["DEFAULT"] = "DEFAULT";
        Fields1["FULL"] = "FULL";
    })(Fields1 = Occ.Fields1 || (Occ.Fields1 = {}));
    /**
     * Defines values for Fields2.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields2 = <Fields2>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields2;
    (function (Fields2) {
        Fields2["BASIC"] = "BASIC";
        Fields2["DEFAULT"] = "DEFAULT";
        Fields2["FULL"] = "FULL";
    })(Fields2 = Occ.Fields2 || (Occ.Fields2 = {}));
    /**
     * Defines values for Fields3.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields3 = <Fields3>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields3;
    (function (Fields3) {
        Fields3["BASIC"] = "BASIC";
        Fields3["DEFAULT"] = "DEFAULT";
        Fields3["FULL"] = "FULL";
    })(Fields3 = Occ.Fields3 || (Occ.Fields3 = {}));
    /**
     * Defines values for Fields4.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields4 = <Fields4>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields4;
    (function (Fields4) {
        Fields4["BASIC"] = "BASIC";
        Fields4["DEFAULT"] = "DEFAULT";
        Fields4["FULL"] = "FULL";
    })(Fields4 = Occ.Fields4 || (Occ.Fields4 = {}));
    /**
     * Defines values for Fields5.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields5 = <Fields5>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields5;
    (function (Fields5) {
        Fields5["BASIC"] = "BASIC";
        Fields5["DEFAULT"] = "DEFAULT";
        Fields5["FULL"] = "FULL";
    })(Fields5 = Occ.Fields5 || (Occ.Fields5 = {}));
    /**
     * Defines values for Fields6.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields6 = <Fields6>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields6;
    (function (Fields6) {
        Fields6["BASIC"] = "BASIC";
        Fields6["DEFAULT"] = "DEFAULT";
        Fields6["FULL"] = "FULL";
    })(Fields6 = Occ.Fields6 || (Occ.Fields6 = {}));
    /**
     * Defines values for PageType.
     * Possible values include: 'ContentPage', 'ProductPage', 'CategoryPage',
     * 'CatalogPage'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: PageType = <PageType>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var PageType;
    (function (PageType) {
        PageType["CONTENT_PAGE"] = "ContentPage";
        PageType["PRODUCT_PAGE"] = "ProductPage";
        PageType["CATEGORY_PAGE"] = "CategoryPage";
        PageType["CATALOG_PAGE"] = "CatalogPage";
    })(PageType = Occ.PageType || (Occ.PageType = {}));
    /**
     * Defines values for Fields7.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields7 = <Fields7>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields7;
    (function (Fields7) {
        Fields7["BASIC"] = "BASIC";
        Fields7["DEFAULT"] = "DEFAULT";
        Fields7["FULL"] = "FULL";
    })(Fields7 = Occ.Fields7 || (Occ.Fields7 = {}));
    /**
     * Defines values for Fields8.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields8 = <Fields8>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields8;
    (function (Fields8) {
        Fields8["BASIC"] = "BASIC";
        Fields8["DEFAULT"] = "DEFAULT";
        Fields8["FULL"] = "FULL";
    })(Fields8 = Occ.Fields8 || (Occ.Fields8 = {}));
    /**
     * Defines values for Fields9.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields9 = <Fields9>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields9;
    (function (Fields9) {
        Fields9["BASIC"] = "BASIC";
        Fields9["DEFAULT"] = "DEFAULT";
        Fields9["FULL"] = "FULL";
    })(Fields9 = Occ.Fields9 || (Occ.Fields9 = {}));
    /**
     * Defines values for Fields10.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields10 = <Fields10>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields10;
    (function (Fields10) {
        Fields10["BASIC"] = "BASIC";
        Fields10["DEFAULT"] = "DEFAULT";
        Fields10["FULL"] = "FULL";
    })(Fields10 = Occ.Fields10 || (Occ.Fields10 = {}));
    /**
     * Defines values for Fields11.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields11 = <Fields11>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields11;
    (function (Fields11) {
        Fields11["BASIC"] = "BASIC";
        Fields11["DEFAULT"] = "DEFAULT";
        Fields11["FULL"] = "FULL";
    })(Fields11 = Occ.Fields11 || (Occ.Fields11 = {}));
    /**
     * Defines values for Fields12.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields12 = <Fields12>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields12;
    (function (Fields12) {
        Fields12["BASIC"] = "BASIC";
        Fields12["DEFAULT"] = "DEFAULT";
        Fields12["FULL"] = "FULL";
    })(Fields12 = Occ.Fields12 || (Occ.Fields12 = {}));
    /**
     * Defines values for Fields13.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields13 = <Fields13>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields13;
    (function (Fields13) {
        Fields13["BASIC"] = "BASIC";
        Fields13["DEFAULT"] = "DEFAULT";
        Fields13["FULL"] = "FULL";
    })(Fields13 = Occ.Fields13 || (Occ.Fields13 = {}));
    /**
     * Defines values for Fields14.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields14 = <Fields14>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields14;
    (function (Fields14) {
        Fields14["BASIC"] = "BASIC";
        Fields14["DEFAULT"] = "DEFAULT";
        Fields14["FULL"] = "FULL";
    })(Fields14 = Occ.Fields14 || (Occ.Fields14 = {}));
    /**
     * Defines values for Fields15.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields15 = <Fields15>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields15;
    (function (Fields15) {
        Fields15["BASIC"] = "BASIC";
        Fields15["DEFAULT"] = "DEFAULT";
        Fields15["FULL"] = "FULL";
    })(Fields15 = Occ.Fields15 || (Occ.Fields15 = {}));
    /**
     * Defines values for Fields16.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields16 = <Fields16>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields16;
    (function (Fields16) {
        Fields16["BASIC"] = "BASIC";
        Fields16["DEFAULT"] = "DEFAULT";
        Fields16["FULL"] = "FULL";
    })(Fields16 = Occ.Fields16 || (Occ.Fields16 = {}));
    /**
     * Defines values for SortEnum.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: SortEnum = <SortEnum>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var SortEnum;
    (function (SortEnum) {
        SortEnum["BASIC"] = "BASIC";
        SortEnum["DEFAULT"] = "DEFAULT";
        SortEnum["FULL"] = "FULL";
    })(SortEnum = Occ.SortEnum || (Occ.SortEnum = {}));
    /**
     * Defines values for Fields17.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields17 = <Fields17>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields17;
    (function (Fields17) {
        Fields17["BASIC"] = "BASIC";
        Fields17["DEFAULT"] = "DEFAULT";
        Fields17["FULL"] = "FULL";
    })(Fields17 = Occ.Fields17 || (Occ.Fields17 = {}));
    /**
     * Defines values for Fields18.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields18 = <Fields18>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields18;
    (function (Fields18) {
        Fields18["BASIC"] = "BASIC";
        Fields18["DEFAULT"] = "DEFAULT";
        Fields18["FULL"] = "FULL";
    })(Fields18 = Occ.Fields18 || (Occ.Fields18 = {}));
    /**
     * Defines values for Fields19.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields19 = <Fields19>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields19;
    (function (Fields19) {
        Fields19["BASIC"] = "BASIC";
        Fields19["DEFAULT"] = "DEFAULT";
        Fields19["FULL"] = "FULL";
    })(Fields19 = Occ.Fields19 || (Occ.Fields19 = {}));
    /**
     * Defines values for Fields20.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields20 = <Fields20>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields20;
    (function (Fields20) {
        Fields20["BASIC"] = "BASIC";
        Fields20["DEFAULT"] = "DEFAULT";
        Fields20["FULL"] = "FULL";
    })(Fields20 = Occ.Fields20 || (Occ.Fields20 = {}));
    /**
     * Defines values for Fields21.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields21 = <Fields21>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields21;
    (function (Fields21) {
        Fields21["BASIC"] = "BASIC";
        Fields21["DEFAULT"] = "DEFAULT";
        Fields21["FULL"] = "FULL";
    })(Fields21 = Occ.Fields21 || (Occ.Fields21 = {}));
    /**
     * Defines values for Fields22.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields22 = <Fields22>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields22;
    (function (Fields22) {
        Fields22["BASIC"] = "BASIC";
        Fields22["DEFAULT"] = "DEFAULT";
        Fields22["FULL"] = "FULL";
    })(Fields22 = Occ.Fields22 || (Occ.Fields22 = {}));
    /**
     * Defines values for Fields23.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields23 = <Fields23>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields23;
    (function (Fields23) {
        Fields23["BASIC"] = "BASIC";
        Fields23["DEFAULT"] = "DEFAULT";
        Fields23["FULL"] = "FULL";
    })(Fields23 = Occ.Fields23 || (Occ.Fields23 = {}));
    /**
     * Defines values for Fields24.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields24 = <Fields24>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields24;
    (function (Fields24) {
        Fields24["BASIC"] = "BASIC";
        Fields24["DEFAULT"] = "DEFAULT";
        Fields24["FULL"] = "FULL";
    })(Fields24 = Occ.Fields24 || (Occ.Fields24 = {}));
    /**
     * Defines values for Fields25.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields25 = <Fields25>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields25;
    (function (Fields25) {
        Fields25["BASIC"] = "BASIC";
        Fields25["DEFAULT"] = "DEFAULT";
        Fields25["FULL"] = "FULL";
    })(Fields25 = Occ.Fields25 || (Occ.Fields25 = {}));
    /**
     * Defines values for Fields26.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields26 = <Fields26>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields26;
    (function (Fields26) {
        Fields26["BASIC"] = "BASIC";
        Fields26["DEFAULT"] = "DEFAULT";
        Fields26["FULL"] = "FULL";
    })(Fields26 = Occ.Fields26 || (Occ.Fields26 = {}));
    /**
     * Defines values for Fields27.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields27 = <Fields27>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields27;
    (function (Fields27) {
        Fields27["BASIC"] = "BASIC";
        Fields27["DEFAULT"] = "DEFAULT";
        Fields27["FULL"] = "FULL";
    })(Fields27 = Occ.Fields27 || (Occ.Fields27 = {}));
    /**
     * Defines values for Fields28.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields28 = <Fields28>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields28;
    (function (Fields28) {
        Fields28["BASIC"] = "BASIC";
        Fields28["DEFAULT"] = "DEFAULT";
        Fields28["FULL"] = "FULL";
    })(Fields28 = Occ.Fields28 || (Occ.Fields28 = {}));
    /**
     * Defines values for Fields29.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields29 = <Fields29>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields29;
    (function (Fields29) {
        Fields29["BASIC"] = "BASIC";
        Fields29["DEFAULT"] = "DEFAULT";
        Fields29["FULL"] = "FULL";
    })(Fields29 = Occ.Fields29 || (Occ.Fields29 = {}));
    /**
     * Defines values for Fields30.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields30 = <Fields30>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields30;
    (function (Fields30) {
        Fields30["BASIC"] = "BASIC";
        Fields30["DEFAULT"] = "DEFAULT";
        Fields30["FULL"] = "FULL";
    })(Fields30 = Occ.Fields30 || (Occ.Fields30 = {}));
    /**
     * Defines values for Fields31.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields31 = <Fields31>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields31;
    (function (Fields31) {
        Fields31["BASIC"] = "BASIC";
        Fields31["DEFAULT"] = "DEFAULT";
        Fields31["FULL"] = "FULL";
    })(Fields31 = Occ.Fields31 || (Occ.Fields31 = {}));
    /**
     * Defines values for Fields32.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields32 = <Fields32>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields32;
    (function (Fields32) {
        Fields32["BASIC"] = "BASIC";
        Fields32["DEFAULT"] = "DEFAULT";
        Fields32["FULL"] = "FULL";
    })(Fields32 = Occ.Fields32 || (Occ.Fields32 = {}));
    /**
     * Defines values for Fields33.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields33 = <Fields33>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields33;
    (function (Fields33) {
        Fields33["BASIC"] = "BASIC";
        Fields33["DEFAULT"] = "DEFAULT";
        Fields33["FULL"] = "FULL";
    })(Fields33 = Occ.Fields33 || (Occ.Fields33 = {}));
    /**
     * Defines values for Fields34.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields34 = <Fields34>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields34;
    (function (Fields34) {
        Fields34["BASIC"] = "BASIC";
        Fields34["DEFAULT"] = "DEFAULT";
        Fields34["FULL"] = "FULL";
    })(Fields34 = Occ.Fields34 || (Occ.Fields34 = {}));
    /**
     * Defines values for Fields35.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields35 = <Fields35>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields35;
    (function (Fields35) {
        Fields35["BASIC"] = "BASIC";
        Fields35["DEFAULT"] = "DEFAULT";
        Fields35["FULL"] = "FULL";
    })(Fields35 = Occ.Fields35 || (Occ.Fields35 = {}));
    /**
     * Defines values for Fields36.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields36 = <Fields36>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields36;
    (function (Fields36) {
        Fields36["BASIC"] = "BASIC";
        Fields36["DEFAULT"] = "DEFAULT";
        Fields36["FULL"] = "FULL";
    })(Fields36 = Occ.Fields36 || (Occ.Fields36 = {}));
    /**
     * Defines values for Fields37.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields37 = <Fields37>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields37;
    (function (Fields37) {
        Fields37["BASIC"] = "BASIC";
        Fields37["DEFAULT"] = "DEFAULT";
        Fields37["FULL"] = "FULL";
    })(Fields37 = Occ.Fields37 || (Occ.Fields37 = {}));
    /**
     * Defines values for Fields38.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields38 = <Fields38>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields38;
    (function (Fields38) {
        Fields38["BASIC"] = "BASIC";
        Fields38["DEFAULT"] = "DEFAULT";
        Fields38["FULL"] = "FULL";
    })(Fields38 = Occ.Fields38 || (Occ.Fields38 = {}));
    /**
     * Defines values for Fields39.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields39 = <Fields39>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields39;
    (function (Fields39) {
        Fields39["BASIC"] = "BASIC";
        Fields39["DEFAULT"] = "DEFAULT";
        Fields39["FULL"] = "FULL";
    })(Fields39 = Occ.Fields39 || (Occ.Fields39 = {}));
    /**
     * Defines values for Fields40.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields40 = <Fields40>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields40;
    (function (Fields40) {
        Fields40["BASIC"] = "BASIC";
        Fields40["DEFAULT"] = "DEFAULT";
        Fields40["FULL"] = "FULL";
    })(Fields40 = Occ.Fields40 || (Occ.Fields40 = {}));
    /**
     * Defines values for Fields41.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields41 = <Fields41>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields41;
    (function (Fields41) {
        Fields41["BASIC"] = "BASIC";
        Fields41["DEFAULT"] = "DEFAULT";
        Fields41["FULL"] = "FULL";
    })(Fields41 = Occ.Fields41 || (Occ.Fields41 = {}));
    /**
     * Defines values for Fields42.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields42 = <Fields42>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields42;
    (function (Fields42) {
        Fields42["BASIC"] = "BASIC";
        Fields42["DEFAULT"] = "DEFAULT";
        Fields42["FULL"] = "FULL";
    })(Fields42 = Occ.Fields42 || (Occ.Fields42 = {}));
    /**
     * Defines values for Fields43.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields43 = <Fields43>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields43;
    (function (Fields43) {
        Fields43["BASIC"] = "BASIC";
        Fields43["DEFAULT"] = "DEFAULT";
        Fields43["FULL"] = "FULL";
    })(Fields43 = Occ.Fields43 || (Occ.Fields43 = {}));
    /**
     * Defines values for Fields44.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields44 = <Fields44>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields44;
    (function (Fields44) {
        Fields44["BASIC"] = "BASIC";
        Fields44["DEFAULT"] = "DEFAULT";
        Fields44["FULL"] = "FULL";
    })(Fields44 = Occ.Fields44 || (Occ.Fields44 = {}));
    /**
     * Defines values for Fields45.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields45 = <Fields45>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields45;
    (function (Fields45) {
        Fields45["BASIC"] = "BASIC";
        Fields45["DEFAULT"] = "DEFAULT";
        Fields45["FULL"] = "FULL";
    })(Fields45 = Occ.Fields45 || (Occ.Fields45 = {}));
    /**
     * Defines values for Fields46.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields46 = <Fields46>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields46;
    (function (Fields46) {
        Fields46["BASIC"] = "BASIC";
        Fields46["DEFAULT"] = "DEFAULT";
        Fields46["FULL"] = "FULL";
    })(Fields46 = Occ.Fields46 || (Occ.Fields46 = {}));
    /**
     * Defines values for Fields47.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields47 = <Fields47>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields47;
    (function (Fields47) {
        Fields47["BASIC"] = "BASIC";
        Fields47["DEFAULT"] = "DEFAULT";
        Fields47["FULL"] = "FULL";
    })(Fields47 = Occ.Fields47 || (Occ.Fields47 = {}));
    /**
     * Defines values for Fields48.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields48 = <Fields48>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields48;
    (function (Fields48) {
        Fields48["BASIC"] = "BASIC";
        Fields48["DEFAULT"] = "DEFAULT";
        Fields48["FULL"] = "FULL";
    })(Fields48 = Occ.Fields48 || (Occ.Fields48 = {}));
    /**
     * Defines values for Fields49.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields49 = <Fields49>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields49;
    (function (Fields49) {
        Fields49["BASIC"] = "BASIC";
        Fields49["DEFAULT"] = "DEFAULT";
        Fields49["FULL"] = "FULL";
    })(Fields49 = Occ.Fields49 || (Occ.Fields49 = {}));
    /**
     * Defines values for Fields50.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields50 = <Fields50>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields50;
    (function (Fields50) {
        Fields50["BASIC"] = "BASIC";
        Fields50["DEFAULT"] = "DEFAULT";
        Fields50["FULL"] = "FULL";
    })(Fields50 = Occ.Fields50 || (Occ.Fields50 = {}));
    /**
     * Defines values for Fields51.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields51 = <Fields51>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields51;
    (function (Fields51) {
        Fields51["BASIC"] = "BASIC";
        Fields51["DEFAULT"] = "DEFAULT";
        Fields51["FULL"] = "FULL";
    })(Fields51 = Occ.Fields51 || (Occ.Fields51 = {}));
    /**
     * Defines values for Fields52.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields52 = <Fields52>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields52;
    (function (Fields52) {
        Fields52["BASIC"] = "BASIC";
        Fields52["DEFAULT"] = "DEFAULT";
        Fields52["FULL"] = "FULL";
    })(Fields52 = Occ.Fields52 || (Occ.Fields52 = {}));
    /**
     * Defines values for Fields53.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields53 = <Fields53>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields53;
    (function (Fields53) {
        Fields53["BASIC"] = "BASIC";
        Fields53["DEFAULT"] = "DEFAULT";
        Fields53["FULL"] = "FULL";
    })(Fields53 = Occ.Fields53 || (Occ.Fields53 = {}));
    /**
     * Defines values for Fields54.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields54 = <Fields54>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields54;
    (function (Fields54) {
        Fields54["BASIC"] = "BASIC";
        Fields54["DEFAULT"] = "DEFAULT";
        Fields54["FULL"] = "FULL";
    })(Fields54 = Occ.Fields54 || (Occ.Fields54 = {}));
    /**
     * Defines values for Fields55.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields55 = <Fields55>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields55;
    (function (Fields55) {
        Fields55["BASIC"] = "BASIC";
        Fields55["DEFAULT"] = "DEFAULT";
        Fields55["FULL"] = "FULL";
    })(Fields55 = Occ.Fields55 || (Occ.Fields55 = {}));
    /**
     * Defines values for Fields56.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields56 = <Fields56>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields56;
    (function (Fields56) {
        Fields56["BASIC"] = "BASIC";
        Fields56["DEFAULT"] = "DEFAULT";
        Fields56["FULL"] = "FULL";
    })(Fields56 = Occ.Fields56 || (Occ.Fields56 = {}));
    /**
     * Defines values for Fields57.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields57 = <Fields57>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields57;
    (function (Fields57) {
        Fields57["BASIC"] = "BASIC";
        Fields57["DEFAULT"] = "DEFAULT";
        Fields57["FULL"] = "FULL";
    })(Fields57 = Occ.Fields57 || (Occ.Fields57 = {}));
    /**
     * Defines values for Fields58.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields58 = <Fields58>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields58;
    (function (Fields58) {
        Fields58["BASIC"] = "BASIC";
        Fields58["DEFAULT"] = "DEFAULT";
        Fields58["FULL"] = "FULL";
    })(Fields58 = Occ.Fields58 || (Occ.Fields58 = {}));
    /**
     * Defines values for Fields59.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields59 = <Fields59>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields59;
    (function (Fields59) {
        Fields59["BASIC"] = "BASIC";
        Fields59["DEFAULT"] = "DEFAULT";
        Fields59["FULL"] = "FULL";
    })(Fields59 = Occ.Fields59 || (Occ.Fields59 = {}));
    /**
     * Defines values for Fields60.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields60 = <Fields60>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields60;
    (function (Fields60) {
        Fields60["BASIC"] = "BASIC";
        Fields60["DEFAULT"] = "DEFAULT";
        Fields60["FULL"] = "FULL";
    })(Fields60 = Occ.Fields60 || (Occ.Fields60 = {}));
    /**
     * Defines values for Fields61.
     * Possible values include: 'BASIC', 'DEFAULT', 'FULL'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Fields61 = <Fields61>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Fields61;
    (function (Fields61) {
        Fields61["BASIC"] = "BASIC";
        Fields61["DEFAULT"] = "DEFAULT";
        Fields61["FULL"] = "FULL";
    })(Fields61 = Occ.Fields61 || (Occ.Fields61 = {}));
    /**
     * Defines values for Type.
     * Possible values include: 'all', 'product', 'order'
     * There could be more values for this enum apart from the ones defined here.If
     * you want to set a value that is not from the known values then you can do
     * the following:
     * let param: Type = <Type>"someUnknownValueThatWillStillBeValid";
     * @readonly
     * @enum {string}
     */
    var Type;
    (function (Type) {
        Type["All"] = "all";
        Type["Product"] = "product";
        Type["Order"] = "order";
    })(Type = Occ.Type || (Occ.Type = {}));
    var CONSENT_STATUS;
    (function (CONSENT_STATUS) {
        CONSENT_STATUS["ANONYMOUS_CONSENT_GIVEN"] = "GIVEN";
        CONSENT_STATUS["ANONYMOUS_CONSENT_WITHDRAWN"] = "WITHDRAWN";
    })(CONSENT_STATUS = Occ.CONSENT_STATUS || (Occ.CONSENT_STATUS = {}));
    var NotificationType;
    (function (NotificationType) {
        NotificationType["BACK_IN_STOCK"] = "BACK_IN_STOCK";
    })(NotificationType = Occ.NotificationType || (Occ.NotificationType = {}));
})(Occ || (Occ = {}));

var ConfigValidatorToken = new InjectionToken('ConfigurationValidator');
/**
 * Use to probide config validation at app bootstrap (when all config chunks are merged)
 *
 * @param configValidator
 */
function provideConfigValidator(configValidator) {
    return {
        provide: ConfigValidatorToken,
        useValue: configValidator,
        multi: true,
    };
}
function validateConfig(config, configValidators) {
    var e_1, _a;
    try {
        for (var configValidators_1 = __values(configValidators), configValidators_1_1 = configValidators_1.next(); !configValidators_1_1.done; configValidators_1_1 = configValidators_1.next()) {
            var validate = configValidators_1_1.value;
            var warning = validate(config);
            if (warning) {
                console.warn(warning);
            }
        }
    }
    catch (e_1_1) { e_1 = { error: e_1_1 }; }
    finally {
        try {
            if (configValidators_1_1 && !configValidators_1_1.done && (_a = configValidators_1.return)) _a.call(configValidators_1);
        }
        finally { if (e_1) throw e_1.error; }
    }
}

var OccModule = /** @class */ (function () {
    function OccModule() {
    }
    OccModule_1 = OccModule;
    OccModule.forRoot = function () {
        return {
            ngModule: OccModule_1,
            providers: [
                {
                    provide: HTTP_INTERCEPTORS,
                    useExisting: WithCredentialsInterceptor,
                    multi: true,
                },
                provideDefaultConfig(defaultOccConfig),
                provideConfigValidator(occConfigValidator),
            ],
        };
    };
    var OccModule_1;
    OccModule = OccModule_1 = __decorate([
        NgModule({
            imports: [
                AsmOccModule,
                CmsOccModule,
                CartOccModule,
                CheckoutOccModule,
                ProductOccModule,
                SiteContextOccModule,
                StoreFinderOccModule,
                UserOccModule,
                OccConfigLoaderModule.forRoot(),
            ],
        })
    ], OccModule);
    return OccModule;
}());

var LoadingScopesService = /** @class */ (function () {
    function LoadingScopesService(config) {
        this.config = config;
    }
    /**
     * Aims to expand scopes based on loading scopes config.
     *
     * I.e. if 'details' scope includes 'list' scope by configuration, it'll return ['details', 'list']
     *
     * If scope data overlaps with each other, the data should be merged in the order of scopes provided,
     * i.e. the last scope is merged last, overwriting parts of the data already provided by preceding scope.
     * It should apply also to implicit scopes (that are included by configuration).
     *
     * @param model
     * @param scopes
     */
    LoadingScopesService.prototype.expand = function (model, scopes) {
        var e_1, _a;
        var scopesConfig = this.config &&
            this.config.backend &&
            this.config.backend.loadingScopes &&
            this.config.backend.loadingScopes[model];
        if (scopesConfig) {
            var expandedScopes = __spread(scopes);
            var i = expandedScopes.length;
            while (i > 0) {
                i--;
                var includedScopes = scopesConfig[expandedScopes[i]] &&
                    scopesConfig[expandedScopes[i]].include;
                if (includedScopes) {
                    try {
                        for (var includedScopes_1 = (e_1 = void 0, __values(includedScopes)), includedScopes_1_1 = includedScopes_1.next(); !includedScopes_1_1.done; includedScopes_1_1 = includedScopes_1.next()) {
                            var includedScope = includedScopes_1_1.value;
                            if (!expandedScopes.includes(includedScope)) {
                                expandedScopes.splice(i, 0, includedScope);
                                i++;
                            }
                        }
                    }
                    catch (e_1_1) { e_1 = { error: e_1_1 }; }
                    finally {
                        try {
                            if (includedScopes_1_1 && !includedScopes_1_1.done && (_a = includedScopes_1.return)) _a.call(includedScopes_1);
                        }
                        finally { if (e_1) throw e_1.error; }
                    }
                }
            }
            return expandedScopes;
        }
        return scopes;
    };
    /**
     * Return maxAge for product scope in milliseconds
     *
     * @param model
     * @param scope
     */
    LoadingScopesService.prototype.getMaxAge = function (model, scope) {
        var scopesConfig = this.config &&
            this.config.backend &&
            this.config.backend.loadingScopes &&
            this.config.backend.loadingScopes[model];
        return (scopesConfig[scope] && scopesConfig[scope].maxAge) * 1000 || 0;
    };
    LoadingScopesService.ctorParameters = function () { return [
        { type: OccConfig }
    ]; };
    LoadingScopesService.ɵprov = ɵɵdefineInjectable({ factory: function LoadingScopesService_Factory() { return new LoadingScopesService(ɵɵinject(OccConfig)); }, token: LoadingScopesService, providedIn: "root" });
    LoadingScopesService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], LoadingScopesService);
    return LoadingScopesService;
}());

var AnonymousConsentsConfig = /** @class */ (function (_super) {
    __extends(AnonymousConsentsConfig, _super);
    function AnonymousConsentsConfig() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    AnonymousConsentsConfig.ɵprov = ɵɵdefineInjectable({ factory: function AnonymousConsentsConfig_Factory() { return ɵɵinject(Config); }, token: AnonymousConsentsConfig, providedIn: "root" });
    AnonymousConsentsConfig = __decorate([
        Injectable({
            providedIn: 'root',
            useExisting: Config,
        })
    ], AnonymousConsentsConfig);
    return AnonymousConsentsConfig;
}(OccConfig));

var ANONYMOUS_CONSENTS_HEADER = 'X-Anonymous-Consents';
var AnonymousConsentsInterceptor = /** @class */ (function () {
    function AnonymousConsentsInterceptor(anonymousConsentsService, authService, occEndpoints, config) {
        this.anonymousConsentsService = anonymousConsentsService;
        this.authService = authService;
        this.occEndpoints = occEndpoints;
        this.config = config;
    }
    AnonymousConsentsInterceptor.prototype.intercept = function (request, next) {
        var _this = this;
        return this.anonymousConsentsService.getConsents().pipe(take(1), withLatestFrom(this.authService.isUserLoggedIn()), switchMap(function (_a) {
            var _b = __read(_a, 2), consents = _b[0], isUserLoggedIn = _b[1];
            if (!_this.isOccUrl(request.url)) {
                return next.handle(request);
            }
            var clonedRequest = _this.handleRequest(consents, request);
            return next.handle(clonedRequest).pipe(tap(function (event) {
                if (event instanceof HttpResponse) {
                    _this.handleResponse(isUserLoggedIn, event.headers.get(ANONYMOUS_CONSENTS_HEADER), consents);
                }
            }));
        }));
    };
    AnonymousConsentsInterceptor.prototype.handleResponse = function (isUserLoggedIn, newRawConsents, previousConsents) {
        if (!isUserLoggedIn && newRawConsents) {
            var newConsents = [];
            newConsents = this.anonymousConsentsService.decodeAndDeserialize(newRawConsents);
            newConsents = this.giveRequiredConsents(newConsents);
            if (this.anonymousConsentsService.consentsUpdated(newConsents, previousConsents)) {
                this.anonymousConsentsService.setConsents(newConsents);
            }
        }
    };
    AnonymousConsentsInterceptor.prototype.handleRequest = function (consents, request) {
        var _a;
        if (!consents) {
            return request;
        }
        var rawConsents = this.anonymousConsentsService.serializeAndEncode(consents);
        return request.clone({
            setHeaders: (_a = {},
                _a[ANONYMOUS_CONSENTS_HEADER] = rawConsents,
                _a),
        });
    };
    AnonymousConsentsInterceptor.prototype.isOccUrl = function (url) {
        return url.includes(this.occEndpoints.getBaseEndpoint());
    };
    AnonymousConsentsInterceptor.prototype.giveRequiredConsents = function (consents) {
        var e_1, _a;
        var givenConsents = __spread(consents);
        if (Boolean(this.config.anonymousConsents) &&
            Boolean(this.config.anonymousConsents.requiredConsents)) {
            try {
                for (var givenConsents_1 = __values(givenConsents), givenConsents_1_1 = givenConsents_1.next(); !givenConsents_1_1.done; givenConsents_1_1 = givenConsents_1.next()) {
                    var consent = givenConsents_1_1.value;
                    if (this.config.anonymousConsents.requiredConsents.includes(consent.templateCode)) {
                        consent.consentState = ANONYMOUS_CONSENT_STATUS.GIVEN;
                    }
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (givenConsents_1_1 && !givenConsents_1_1.done && (_a = givenConsents_1.return)) _a.call(givenConsents_1);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
        return givenConsents;
    };
    AnonymousConsentsInterceptor.ctorParameters = function () { return [
        { type: AnonymousConsentsService },
        { type: AuthService },
        { type: OccEndpointsService },
        { type: AnonymousConsentsConfig }
    ]; };
    AnonymousConsentsInterceptor.ɵprov = ɵɵdefineInjectable({ factory: function AnonymousConsentsInterceptor_Factory() { return new AnonymousConsentsInterceptor(ɵɵinject(AnonymousConsentsService), ɵɵinject(AuthService), ɵɵinject(OccEndpointsService), ɵɵinject(AnonymousConsentsConfig)); }, token: AnonymousConsentsInterceptor, providedIn: "root" });
    AnonymousConsentsInterceptor = __decorate([
        Injectable({ providedIn: 'root' })
    ], AnonymousConsentsInterceptor);
    return AnonymousConsentsInterceptor;
}());

var interceptors$1 = [
    {
        provide: HTTP_INTERCEPTORS,
        useExisting: AnonymousConsentsInterceptor,
        multi: true,
    },
];

// PRIVATE API
/**
 * Allows for dynamic adding and removing source observables
 * and exposes them as one merged observable at a property `output$`.
 *
 * Thanks to the `share()` operator used inside, it subscribes to source observables
 * only when someone subscribes to it. And it unsubscribes from source observables
 * when the counter of consumers drops to 0.
 *
 * **To avoid memory leaks**, all manually added sources should be manually removed
 * when not plan to emit values anymore. In particular closed event sources won't be
 * automatically removed.
 */
var MergingSubject = /** @class */ (function () {
    function MergingSubject() {
        var _this = this;
        /**
         * List of already added sources (but not removed yet)
         */
        this.sources = [];
        /**
         * For each source: it stores a subscription responsible for
         * passing all values from source to the consumer
         */
        this.subscriptionsToSources = new Map();
        /**
         * Observable with all sources merged.
         *
         * Only after subscribing to it, under the hood it subscribes to the source observables.
         * When the number of subscribers drops to 0, it unsubscribes from all source observables.
         * But if later on something subscribes to it again, it subscribes to the source observables again.
         *
         * It multicasts the emissions for each subscriber.
         */
        this.output$ = new Observable(function (consumer) {
            // There can be only 0 or 1 consumer of this observable coming from the `share()` operator
            // that is piped right after this observable.
            // `share()` not only multicasts the results but also  When all end-subscribers unsubscribe from `share()` operator, it will unsubscribe
            // from this observable (by the nature `refCount`-nature of the `share()` operator).
            _this.consumer = consumer;
            _this.bindAllSourcesToConsumer(consumer);
            return function () {
                _this.consumer = null;
                _this.unbindAllSourcesFromConsumer();
            };
        }).pipe(share());
        /**
         * Reference to the subscriber coming from the `share()` operator piped to the `output$` observable.
         * For more, see docs of the `output$` observable;
         */
        this.consumer = null;
    }
    /**
     * Registers the given source to pass its values to the `output$` observable.
     *
     * It does nothing, when the source has been already added (but not removed yet).
     */
    MergingSubject.prototype.add = function (source) {
        if (this.has(source)) {
            return;
        }
        if (this.consumer) {
            this.bindSourceToConsumer(source, this.consumer);
        }
        this.sources.push(source);
    };
    /**
     * Starts passing all values from already added sources to consumer
     */
    MergingSubject.prototype.bindAllSourcesToConsumer = function (consumer) {
        var _this = this;
        this.sources.forEach(function (source) {
            return _this.bindSourceToConsumer(source, consumer);
        });
    };
    /**
     * Stops passing all values from already added sources to consumer
     * (if any consumer is active at the moment)
     */
    MergingSubject.prototype.unbindAllSourcesFromConsumer = function () {
        var _this = this;
        this.sources.forEach(function (source) { return _this.unbindSourceFromConsumer(source); });
    };
    /**
     * Starts passing all values from a single source to consumer
     */
    MergingSubject.prototype.bindSourceToConsumer = function (source, consumer) {
        var subscriptionToSource = source.subscribe(function (val) { return consumer.next(val); }); // passes all emissions from source to consumer
        this.subscriptionsToSources.set(source, subscriptionToSource);
    };
    /**
     * Stops passing all values from a single source to consumer
     * (if any consumer is active at the moment)
     */
    MergingSubject.prototype.unbindSourceFromConsumer = function (source) {
        var subscriptionToSource = this.subscriptionsToSources.get(source);
        if (subscriptionToSource !== undefined) {
            subscriptionToSource.unsubscribe();
            this.subscriptionsToSources.delete(source);
        }
    };
    /**
     * Unregisters the given source so it stops passing its values to `output$` observable.
     *
     * Should be used when a source is no longer maintained **to avoid memory leaks**.
     */
    MergingSubject.prototype.remove = function (source) {
        // clear binding from source to consumer (if any consumer exists at the moment)
        this.unbindSourceFromConsumer(source);
        // remove source from array
        var i;
        if ((i = this.sources.findIndex(function (s) { return s === source; })) !== -1) {
            this.sources.splice(i, 1);
        }
    };
    /**
     * Returns whether the given source has been already addded
     */
    MergingSubject.prototype.has = function (source) {
        return this.sources.includes(source);
    };
    return MergingSubject;
}());

/**
 * A service to register and observe event sources. Events are driven by event types, which are class signatures
 * for the given event.
 *
 * It is possible to register multiple sources to a single event, even without
 * knowing as multiple decoupled features can attach sources to the same
 * event type.
 */
var EventService = /** @class */ (function () {
    function EventService() {
        /**
         * The various events meta are collected in a map, stored by the event type class
         */
        this.eventsMeta = new Map();
    }
    /**
     * Register an event source for the given event type.
     *
     * CAUTION: To avoid memory leaks, the returned teardown function should be called
     *  when the event source is no longer maintained by its creator
     * (i.e. in `ngOnDestroy` if the event source was registered in the component).
     *
     * @param eventType the event type
     * @param source$ an observable that represents the source
     *
     * @returns a teardown function which unregisters the given event source
     */
    EventService.prototype.register = function (eventType, source$) {
        var eventMeta = this.getEventMeta(eventType);
        if (eventMeta.mergingSubject.has(source$)) {
            if (isDevMode()) {
                console.warn("EventService: the event source", source$, "has been already registered for the type", eventType);
            }
        }
        else {
            eventMeta.mergingSubject.add(source$);
        }
        return function () { return eventMeta.mergingSubject.remove(source$); };
    };
    /**
     * Returns a stream of events for the given event type
     * @param eventTypes event type
     */
    EventService.prototype.get = function (eventType) {
        var output$ = this.getEventMeta(eventType).mergingSubject.output$;
        if (isDevMode()) {
            output$ = this.getValidatedEventStream(output$, eventType);
        }
        return output$;
    };
    /**
     * Dispatches an instance of an individual event.
     */
    EventService.prototype.dispatch = function (event) {
        var eventType = event.constructor;
        var inputSubject$ = this.getInputSubject(eventType);
        inputSubject$.next(event);
    };
    /**
     * Returns the input subject used to dispatch a single event.
     * The subject is created on demand, when it's needed for the first time.
     * @param eventType type of event
     */
    EventService.prototype.getInputSubject = function (eventType) {
        var eventMeta = this.getEventMeta(eventType);
        if (!eventMeta.inputSubject$) {
            eventMeta.inputSubject$ = new Subject();
            this.register(eventType, eventMeta.inputSubject$);
        }
        return eventMeta.inputSubject$;
    };
    /**
     * Returns the event meta object for the given event type
     */
    EventService.prototype.getEventMeta = function (eventType) {
        if (isDevMode()) {
            this.validateEventType(eventType);
        }
        if (!this.eventsMeta.get(eventType)) {
            this.createEventMeta(eventType);
        }
        return this.eventsMeta.get(eventType);
    };
    /**
     * Creates the event meta object for the given event type
     */
    EventService.prototype.createEventMeta = function (eventType) {
        this.eventsMeta.set(eventType, {
            inputSubject$: null,
            mergingSubject: new MergingSubject(),
        });
    };
    /**
     * Checks if the event type is a valid type (is a class with constructor).
     *
     * Should be used only in dev mode.
     */
    EventService.prototype.validateEventType = function (eventType) {
        if (!(eventType === null || eventType === void 0 ? void 0 : eventType.constructor)) {
            throw new Error("EventService:  " + eventType + " is not a valid event type. Please provide a class reference.");
        }
    };
    /**
     * Returns the given event source with runtime validation whether the emitted values are instances of given event type.
     *
     * Should be used only in dev mode.
     */
    EventService.prototype.getValidatedEventStream = function (source$, eventType) {
        return source$.pipe(tap(function (event) {
            if (!(event instanceof eventType)) {
                console.warn("EventService: The stream", source$, "emitted the event", event, "that is not an instance of the declared type", eventType.name);
            }
        }));
    };
    EventService.ɵprov = ɵɵdefineInjectable({ factory: function EventService_Factory() { return new EventService(); }, token: EventService, providedIn: "root" });
    EventService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], EventService);
    return EventService;
}());

/**
 * Creates an instance of the given class and fills its properties with the given data.
 *
 * @param type reference to the class
 * @param data object with properties to be copied to the class
 */
function createFrom(type, data) {
    return Object.assign(new type(), data);
}

/**
 * Registers streams of ngrx actions as events source streams
 */
var StateEventService = /** @class */ (function () {
    function StateEventService(actionsSubject, eventService) {
        this.actionsSubject = actionsSubject;
        this.eventService = eventService;
    }
    /**
     * Registers an event source stream of specific events
     * mapped from a given action type.
     *
     * @param mapping mapping from action to event
     *
     * @returns a teardown function that unregisters the event source
     */
    StateEventService.prototype.register = function (mapping) {
        return this.eventService.register(mapping.event, this.getFromAction(mapping));
    };
    /**
     * Returns a stream of specific events mapped from a specific action.
     * @param mapping mapping from action to event
     */
    StateEventService.prototype.getFromAction = function (mapping) {
        var _this = this;
        return this.actionsSubject
            .pipe(ofType.apply(void 0, __spread([].concat(mapping.action))))
            .pipe(map(function (action) {
            return _this.createEvent(action, mapping.event, mapping.factory);
        }));
    };
    /**
     * Creates an event instance for given class out from the action object.
     * Unless the `factory` parameter is given, the action's `payload` is used
     * as the argument for the event's constructor.
     *
     * @param action instance of an Action
     * @param mapping mapping from action to event
     * @param factory optional function getting an action instance and returning an event instance
     *
     * @returns instance of an Event
     */
    StateEventService.prototype.createEvent = function (action, eventType, factory) {
        var _a;
        return factory
            ? factory(action)
            : createFrom(eventType, (_a = action.payload) !== null && _a !== void 0 ? _a : {});
    };
    StateEventService.ctorParameters = function () { return [
        { type: ActionsSubject },
        { type: EventService }
    ]; };
    StateEventService.ɵprov = ɵɵdefineInjectable({ factory: function StateEventService_Factory() { return new StateEventService(ɵɵinject(ActionsSubject), ɵɵinject(EventService)); }, token: StateEventService, providedIn: "root" });
    StateEventService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], StateEventService);
    return StateEventService;
}());

var StatePersistenceService = /** @class */ (function () {
    function StatePersistenceService(winRef) {
        this.winRef = winRef;
    }
    /**
     * Helper to synchronize state to more persistent storage (localStorage, sessionStorage).
     * It is context aware, so you can keep different state for te same feature based on specified context.
     *
     * Eg. cart is valid only under the same base site. So you want to synchronize cart only with the same base site.
     * Usage for that case: `syncWithStorage({ key: 'cart', state$: activeCartSelector$, context$: this.siteContextParamsService.getValues([BASE_SITE_CONTEXT_ID]), onRead: (state) => setCorrectStateInStore(state) })`.
     * Active cart for the `electronics` base site will be stored under `spartacus⚿electronics⚿cart` and for apparel under `spartacus⚿apparel⚿cart`.
     *
     * On each context change onRead function will be executed with state from storage provided as a parameter.
     *
     * Omitting context$ will trigger onRead only once at initialization.
     *
     * @param key Key to use in storage for the synchronized state. Should be unique for each feature.
     * @param state$ State to be saved and later restored.
     * @param context$ Context for state
     * @param storageType Storage type to be used to persist state
     * @param onRead Function to be executed on each storage read after context change
     *
     * @returns Subscriptions for reading/writing in storage on context/state change
     */
    StatePersistenceService.prototype.syncWithStorage = function (_a) {
        var _this = this;
        var key = _a.key, state$ = _a.state$, _b = _a.context$, context$ = _b === void 0 ? of('') : _b, _c = _a.storageType, storageType = _c === void 0 ? StorageSyncType.LOCAL_STORAGE : _c, _d = _a.onRead, onRead = _d === void 0 ? function () { } : _d;
        var storage = getStorage(storageType, this.winRef);
        var subscriptions = new Subscription();
        // Do not change order of subscription! Read should happen before write on context change.
        subscriptions.add(context$
            .pipe(map(function (context) {
            return readFromStorage(storage, _this.generateKeyWithContext(context, key));
        }), tap(function (state) { return onRead(state); }))
            .subscribe());
        subscriptions.add(state$.pipe(withLatestFrom(context$)).subscribe(function (_a) {
            var _b = __read(_a, 2), state = _b[0], context = _b[1];
            persistToStorage(_this.generateKeyWithContext(context, key), state, storage);
        }));
        return subscriptions;
    };
    StatePersistenceService.prototype.generateKeyWithContext = function (context, key) {
        return "spartacus\u26BF" + [].concat(context).join('⚿') + "\u26BF" + key;
    };
    StatePersistenceService.ctorParameters = function () { return [
        { type: WindowRef }
    ]; };
    StatePersistenceService.ɵprov = ɵɵdefineInjectable({ factory: function StatePersistenceService_Factory() { return new StatePersistenceService(ɵɵinject(WindowRef)); }, token: StatePersistenceService, providedIn: "root" });
    StatePersistenceService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], StatePersistenceService);
    return StatePersistenceService;
}());

var PROCESS_FEATURE = 'process';

function getProcessState() {
    return createFeatureSelector(PROCESS_FEATURE);
}

function getProcessStateFactory(processId) {
    return createSelector(getProcessState(), function (entityState) {
        return entityLoaderStateSelector(entityState, processId);
    });
}
function getProcessLoadingFactory(processId) {
    return createSelector(getProcessStateFactory(processId), function (loaderState) {
        return loaderLoadingSelector(loaderState);
    });
}
function getProcessSuccessFactory(processId) {
    return createSelector(getProcessStateFactory(processId), function (loaderState) {
        return loaderSuccessSelector(loaderState);
    });
}
function getProcessErrorFactory(processId) {
    return createSelector(getProcessStateFactory(processId), function (loaderState) {
        return loaderErrorSelector(loaderState);
    });
}

var process_selectors = /*#__PURE__*/Object.freeze({
    __proto__: null,
    getProcessStateFactory: getProcessStateFactory,
    getProcessLoadingFactory: getProcessLoadingFactory,
    getProcessSuccessFactory: getProcessSuccessFactory,
    getProcessErrorFactory: getProcessErrorFactory
});

var LOAD_BILLING_COUNTRIES = '[User] Load Billing Countries';
var LOAD_BILLING_COUNTRIES_FAIL = '[User] Load Billing Countries Fail';
var LOAD_BILLING_COUNTRIES_SUCCESS = '[User] Load Billing Countries Success';
var LoadBillingCountries = /** @class */ (function () {
    function LoadBillingCountries() {
        this.type = LOAD_BILLING_COUNTRIES;
    }
    return LoadBillingCountries;
}());
var LoadBillingCountriesFail = /** @class */ (function () {
    function LoadBillingCountriesFail(payload) {
        this.payload = payload;
        this.type = LOAD_BILLING_COUNTRIES_FAIL;
    }
    return LoadBillingCountriesFail;
}());
var LoadBillingCountriesSuccess = /** @class */ (function () {
    function LoadBillingCountriesSuccess(payload) {
        this.payload = payload;
        this.type = LOAD_BILLING_COUNTRIES_SUCCESS;
    }
    return LoadBillingCountriesSuccess;
}());

var LOAD_CONSIGNMENT_TRACKING = '[User] Load Consignment Tracking';
var LOAD_CONSIGNMENT_TRACKING_FAIL = '[User] Load Consignment Tracking Fail';
var LOAD_CONSIGNMENT_TRACKING_SUCCESS = '[User] Load Consignment Tracking Success';
var CLEAR_CONSIGNMENT_TRACKING = '[User] Clear Consignment Tracking';
var LoadConsignmentTracking = /** @class */ (function () {
    function LoadConsignmentTracking(payload) {
        this.payload = payload;
        this.type = LOAD_CONSIGNMENT_TRACKING;
    }
    return LoadConsignmentTracking;
}());
var LoadConsignmentTrackingFail = /** @class */ (function () {
    function LoadConsignmentTrackingFail(payload) {
        this.payload = payload;
        this.type = LOAD_CONSIGNMENT_TRACKING_FAIL;
    }
    return LoadConsignmentTrackingFail;
}());
var LoadConsignmentTrackingSuccess = /** @class */ (function () {
    function LoadConsignmentTrackingSuccess(payload) {
        this.payload = payload;
        this.type = LOAD_CONSIGNMENT_TRACKING_SUCCESS;
    }
    return LoadConsignmentTrackingSuccess;
}());
var ClearConsignmentTracking = /** @class */ (function () {
    function ClearConsignmentTracking() {
        this.type = CLEAR_CONSIGNMENT_TRACKING;
    }
    return ClearConsignmentTracking;
}());

var LOAD_DELIVERY_COUNTRIES = '[User] Load Delivery Countries';
var LOAD_DELIVERY_COUNTRIES_FAIL = '[User] Load Delivery Countries Fail';
var LOAD_DELIVERY_COUNTRIES_SUCCESS = '[User] Load Delivery Countries Success';
var LoadDeliveryCountries = /** @class */ (function () {
    function LoadDeliveryCountries() {
        this.type = LOAD_DELIVERY_COUNTRIES;
    }
    return LoadDeliveryCountries;
}());
var LoadDeliveryCountriesFail = /** @class */ (function () {
    function LoadDeliveryCountriesFail(payload) {
        this.payload = payload;
        this.type = LOAD_DELIVERY_COUNTRIES_FAIL;
    }
    return LoadDeliveryCountriesFail;
}());
var LoadDeliveryCountriesSuccess = /** @class */ (function () {
    function LoadDeliveryCountriesSuccess(payload) {
        this.payload = payload;
        this.type = LOAD_DELIVERY_COUNTRIES_SUCCESS;
    }
    return LoadDeliveryCountriesSuccess;
}());

var FORGOT_PASSWORD_EMAIL_REQUEST = '[User] Forgot Password Email Request';
var FORGOT_PASSWORD_EMAIL_REQUEST_SUCCESS = '[User] Forgot Password Email Request Success';
var FORGOT_PASSWORD_EMAIL_REQUEST_FAIL = '[User] Forgot Password Email Request Fail';
var ForgotPasswordEmailRequest = /** @class */ (function () {
    function ForgotPasswordEmailRequest(payload) {
        this.payload = payload;
        this.type = FORGOT_PASSWORD_EMAIL_REQUEST;
    }
    return ForgotPasswordEmailRequest;
}());
var ForgotPasswordEmailRequestFail = /** @class */ (function () {
    function ForgotPasswordEmailRequestFail(payload) {
        this.payload = payload;
        this.type = FORGOT_PASSWORD_EMAIL_REQUEST_FAIL;
    }
    return ForgotPasswordEmailRequestFail;
}());
var ForgotPasswordEmailRequestSuccess = /** @class */ (function () {
    function ForgotPasswordEmailRequestSuccess() {
        this.type = FORGOT_PASSWORD_EMAIL_REQUEST_SUCCESS;
    }
    return ForgotPasswordEmailRequestSuccess;
}());

var USER_FEATURE = 'user';
var UPDATE_EMAIL_PROCESS_ID = 'updateEmail';
var UPDATE_PASSWORD_PROCESS_ID = 'updatePassword';
var UPDATE_USER_DETAILS_PROCESS_ID = 'updateUserDetails';
var REGISTER_USER_PROCESS_ID = 'registerUser';
var REMOVE_USER_PROCESS_ID = 'removeUser';
var GIVE_CONSENT_PROCESS_ID = 'giveConsent';
var WITHDRAW_CONSENT_PROCESS_ID = 'withdrawConsent';
var UPDATE_NOTIFICATION_PREFERENCES_PROCESS_ID = 'updateNotificationPreferences';
var ADD_PRODUCT_INTEREST_PROCESS_ID = 'addProductInterests';
var REMOVE_PRODUCT_INTERESTS_PROCESS_ID = 'removeProductInterests';
var CANCEL_ORDER_PROCESS_ID = 'cancelOrder';
var CANCEL_RETURN_PROCESS_ID = 'cancelReturn';
var USER_CONSENTS = '[User] User Consents';
var USER_PAYMENT_METHODS = '[User] User Payment Methods';
var USER_ORDERS = '[User] User Orders';
var USER_ADDRESSES = '[User] User Addresses';
var USER_RETURN_REQUESTS = '[User] Order Return Requests';
var USER_RETURN_REQUEST_DETAILS = '[User] Return Request Details';
var USER_ORDER_DETAILS = '[User] User Order Details';
var REGIONS = '[User] Regions';
var CUSTOMER_COUPONS = '[User] Customer Coupons';
var SUBSCRIBE_CUSTOMER_COUPON_PROCESS_ID = 'subscribeCustomerCoupon';
var UNSUBSCRIBE_CUSTOMER_COUPON_PROCESS_ID = 'unsubscribeCustomerCoupon';
var CLAIM_CUSTOMER_COUPON_PROCESS_ID = 'claimCustomerCoupon';
var NOTIFICATION_PREFERENCES = '[User] Notification Preferences';
var PRODUCT_INTERESTS = '[User] Product Interests';

var LOAD_ORDER_DETAILS = '[User] Load Order Details';
var LOAD_ORDER_DETAILS_FAIL = '[User] Load Order Details Fail';
var LOAD_ORDER_DETAILS_SUCCESS = '[User] Load Order Details Success';
var CLEAR_ORDER_DETAILS = '[User] Clear Order Details';
var CANCEL_ORDER = '[User] Cancel Order';
var CANCEL_ORDER_FAIL = '[User] Cancel Order Fail';
var CANCEL_ORDER_SUCCESS = '[User] Cancel Order Success';
var RESET_CANCEL_ORDER_PROCESS = '[User] Reset Cancel Order Process';
var LoadOrderDetails = /** @class */ (function (_super) {
    __extends(LoadOrderDetails, _super);
    function LoadOrderDetails(payload) {
        var _this = _super.call(this, USER_ORDER_DETAILS) || this;
        _this.payload = payload;
        _this.type = LOAD_ORDER_DETAILS;
        return _this;
    }
    return LoadOrderDetails;
}(LoaderLoadAction));
var LoadOrderDetailsFail = /** @class */ (function (_super) {
    __extends(LoadOrderDetailsFail, _super);
    function LoadOrderDetailsFail(payload) {
        var _this = _super.call(this, USER_ORDER_DETAILS, payload) || this;
        _this.payload = payload;
        _this.type = LOAD_ORDER_DETAILS_FAIL;
        return _this;
    }
    return LoadOrderDetailsFail;
}(LoaderFailAction));
var LoadOrderDetailsSuccess = /** @class */ (function (_super) {
    __extends(LoadOrderDetailsSuccess, _super);
    function LoadOrderDetailsSuccess(payload) {
        var _this = _super.call(this, USER_ORDER_DETAILS) || this;
        _this.payload = payload;
        _this.type = LOAD_ORDER_DETAILS_SUCCESS;
        return _this;
    }
    return LoadOrderDetailsSuccess;
}(LoaderSuccessAction));
var ClearOrderDetails = /** @class */ (function (_super) {
    __extends(ClearOrderDetails, _super);
    function ClearOrderDetails() {
        var _this = _super.call(this, USER_ORDER_DETAILS) || this;
        _this.type = CLEAR_ORDER_DETAILS;
        return _this;
    }
    return ClearOrderDetails;
}(LoaderResetAction));
var CancelOrder = /** @class */ (function (_super) {
    __extends(CancelOrder, _super);
    function CancelOrder(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, CANCEL_ORDER_PROCESS_ID) || this;
        _this.payload = payload;
        _this.type = CANCEL_ORDER;
        return _this;
    }
    return CancelOrder;
}(EntityLoadAction));
var CancelOrderFail = /** @class */ (function (_super) {
    __extends(CancelOrderFail, _super);
    function CancelOrderFail(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, CANCEL_ORDER_PROCESS_ID, payload) || this;
        _this.payload = payload;
        _this.type = CANCEL_ORDER_FAIL;
        return _this;
    }
    return CancelOrderFail;
}(EntityFailAction));
var CancelOrderSuccess = /** @class */ (function (_super) {
    __extends(CancelOrderSuccess, _super);
    function CancelOrderSuccess() {
        var _this = _super.call(this, PROCESS_FEATURE, CANCEL_ORDER_PROCESS_ID) || this;
        _this.type = CANCEL_ORDER_SUCCESS;
        return _this;
    }
    return CancelOrderSuccess;
}(EntitySuccessAction));
var ResetCancelOrderProcess = /** @class */ (function (_super) {
    __extends(ResetCancelOrderProcess, _super);
    function ResetCancelOrderProcess() {
        var _this = _super.call(this, PROCESS_FEATURE, CANCEL_ORDER_PROCESS_ID) || this;
        _this.type = RESET_CANCEL_ORDER_PROCESS;
        return _this;
    }
    return ResetCancelOrderProcess;
}(EntityLoaderResetAction));

var LOAD_USER_PAYMENT_METHODS = '[User] Load User Payment Methods';
var LOAD_USER_PAYMENT_METHODS_FAIL = '[User] Load User Payment Methods Fail';
var LOAD_USER_PAYMENT_METHODS_SUCCESS = '[User] Load User Payment Methods Success';
var SET_DEFAULT_USER_PAYMENT_METHOD = '[User] Set Default User Payment Method';
var SET_DEFAULT_USER_PAYMENT_METHOD_FAIL = '[User] Set Default User Payment Method Fail';
var SET_DEFAULT_USER_PAYMENT_METHOD_SUCCESS = '[User] Set Default User Payment Method Success';
var DELETE_USER_PAYMENT_METHOD = '[User] Delete User Payment Method';
var DELETE_USER_PAYMENT_METHOD_FAIL = '[User] Delete User Payment Method Fail';
var DELETE_USER_PAYMENT_METHOD_SUCCESS = '[User] Delete User  Payment Method Success';
var LoadUserPaymentMethods = /** @class */ (function (_super) {
    __extends(LoadUserPaymentMethods, _super);
    function LoadUserPaymentMethods(payload) {
        var _this = _super.call(this, USER_PAYMENT_METHODS) || this;
        _this.payload = payload;
        _this.type = LOAD_USER_PAYMENT_METHODS;
        return _this;
    }
    return LoadUserPaymentMethods;
}(LoaderLoadAction));
var LoadUserPaymentMethodsFail = /** @class */ (function (_super) {
    __extends(LoadUserPaymentMethodsFail, _super);
    function LoadUserPaymentMethodsFail(payload) {
        var _this = _super.call(this, USER_PAYMENT_METHODS, payload) || this;
        _this.payload = payload;
        _this.type = LOAD_USER_PAYMENT_METHODS_FAIL;
        return _this;
    }
    return LoadUserPaymentMethodsFail;
}(LoaderFailAction));
var LoadUserPaymentMethodsSuccess = /** @class */ (function (_super) {
    __extends(LoadUserPaymentMethodsSuccess, _super);
    function LoadUserPaymentMethodsSuccess(payload) {
        var _this = _super.call(this, USER_PAYMENT_METHODS) || this;
        _this.payload = payload;
        _this.type = LOAD_USER_PAYMENT_METHODS_SUCCESS;
        return _this;
    }
    return LoadUserPaymentMethodsSuccess;
}(LoaderSuccessAction));
var SetDefaultUserPaymentMethod = /** @class */ (function (_super) {
    __extends(SetDefaultUserPaymentMethod, _super);
    function SetDefaultUserPaymentMethod(payload) {
        var _this = _super.call(this, USER_PAYMENT_METHODS) || this;
        _this.payload = payload;
        _this.type = SET_DEFAULT_USER_PAYMENT_METHOD;
        return _this;
    }
    return SetDefaultUserPaymentMethod;
}(LoaderLoadAction));
var SetDefaultUserPaymentMethodFail = /** @class */ (function (_super) {
    __extends(SetDefaultUserPaymentMethodFail, _super);
    function SetDefaultUserPaymentMethodFail(payload) {
        var _this = _super.call(this, USER_PAYMENT_METHODS, payload) || this;
        _this.payload = payload;
        _this.type = SET_DEFAULT_USER_PAYMENT_METHOD_FAIL;
        return _this;
    }
    return SetDefaultUserPaymentMethodFail;
}(LoaderFailAction));
var SetDefaultUserPaymentMethodSuccess = /** @class */ (function (_super) {
    __extends(SetDefaultUserPaymentMethodSuccess, _super);
    function SetDefaultUserPaymentMethodSuccess(payload) {
        var _this = _super.call(this, USER_PAYMENT_METHODS) || this;
        _this.payload = payload;
        _this.type = SET_DEFAULT_USER_PAYMENT_METHOD_SUCCESS;
        return _this;
    }
    return SetDefaultUserPaymentMethodSuccess;
}(LoaderSuccessAction));
var DeleteUserPaymentMethod = /** @class */ (function (_super) {
    __extends(DeleteUserPaymentMethod, _super);
    function DeleteUserPaymentMethod(payload) {
        var _this = _super.call(this, USER_PAYMENT_METHODS) || this;
        _this.payload = payload;
        _this.type = DELETE_USER_PAYMENT_METHOD;
        return _this;
    }
    return DeleteUserPaymentMethod;
}(LoaderLoadAction));
var DeleteUserPaymentMethodFail = /** @class */ (function (_super) {
    __extends(DeleteUserPaymentMethodFail, _super);
    function DeleteUserPaymentMethodFail(payload) {
        var _this = _super.call(this, USER_PAYMENT_METHODS, payload) || this;
        _this.payload = payload;
        _this.type = DELETE_USER_PAYMENT_METHOD_FAIL;
        return _this;
    }
    return DeleteUserPaymentMethodFail;
}(LoaderFailAction));
var DeleteUserPaymentMethodSuccess = /** @class */ (function (_super) {
    __extends(DeleteUserPaymentMethodSuccess, _super);
    function DeleteUserPaymentMethodSuccess(payload) {
        var _this = _super.call(this, USER_PAYMENT_METHODS) || this;
        _this.payload = payload;
        _this.type = DELETE_USER_PAYMENT_METHOD_SUCCESS;
        return _this;
    }
    return DeleteUserPaymentMethodSuccess;
}(LoaderSuccessAction));

var LOAD_REGIONS = '[User] Load Regions';
var LOAD_REGIONS_SUCCESS = '[User] Load Regions Success';
var LOAD_REGIONS_FAIL = '[User] Load Regions Fail';
var CLEAR_REGIONS = '[User] Clear Regions';
var LoadRegions = /** @class */ (function (_super) {
    __extends(LoadRegions, _super);
    function LoadRegions(payload) {
        var _this = _super.call(this, REGIONS) || this;
        _this.payload = payload;
        _this.type = LOAD_REGIONS;
        return _this;
    }
    return LoadRegions;
}(LoaderLoadAction));
var LoadRegionsFail = /** @class */ (function (_super) {
    __extends(LoadRegionsFail, _super);
    function LoadRegionsFail(payload) {
        var _this = _super.call(this, REGIONS, payload) || this;
        _this.payload = payload;
        _this.type = LOAD_REGIONS_FAIL;
        return _this;
    }
    return LoadRegionsFail;
}(LoaderFailAction));
var LoadRegionsSuccess = /** @class */ (function (_super) {
    __extends(LoadRegionsSuccess, _super);
    function LoadRegionsSuccess(payload) {
        var _this = _super.call(this, REGIONS) || this;
        _this.payload = payload;
        _this.type = LOAD_REGIONS_SUCCESS;
        return _this;
    }
    return LoadRegionsSuccess;
}(LoaderSuccessAction));
var ClearRegions = /** @class */ (function () {
    function ClearRegions() {
        this.type = CLEAR_REGIONS;
    }
    return ClearRegions;
}());

var RESET_PASSWORD = '[User] Reset Password';
var RESET_PASSWORD_SUCCESS = '[User] Reset Password Success';
var RESET_PASSWORD_FAIL = '[User] Reset Password Fail';
var ResetPassword = /** @class */ (function () {
    function ResetPassword(payload) {
        this.payload = payload;
        this.type = RESET_PASSWORD;
    }
    return ResetPassword;
}());
var ResetPasswordFail = /** @class */ (function () {
    function ResetPasswordFail(payload) {
        this.payload = payload;
        this.type = RESET_PASSWORD_FAIL;
    }
    return ResetPasswordFail;
}());
var ResetPasswordSuccess = /** @class */ (function () {
    function ResetPasswordSuccess() {
        this.type = RESET_PASSWORD_SUCCESS;
    }
    return ResetPasswordSuccess;
}());

var LOAD_TITLES = '[User] Load Tiltes';
var LOAD_TITLES_FAIL = '[User] Load Titles Fail';
var LOAD_TITLES_SUCCESS = '[User] Load Titles Success';
var LoadTitles = /** @class */ (function () {
    function LoadTitles() {
        this.type = LOAD_TITLES;
    }
    return LoadTitles;
}());
var LoadTitlesFail = /** @class */ (function () {
    function LoadTitlesFail(payload) {
        this.payload = payload;
        this.type = LOAD_TITLES_FAIL;
    }
    return LoadTitlesFail;
}());
var LoadTitlesSuccess = /** @class */ (function () {
    function LoadTitlesSuccess(payload) {
        this.payload = payload;
        this.type = LOAD_TITLES_SUCCESS;
    }
    return LoadTitlesSuccess;
}());

var UPDATE_EMAIL = '[User] Update Email';
var UPDATE_EMAIL_ERROR = '[User] Update Email Error';
var UPDATE_EMAIL_SUCCESS = '[User] Update Email Success';
var RESET_EMAIL = '[User] Reset Email';
var UpdateEmailAction = /** @class */ (function (_super) {
    __extends(UpdateEmailAction, _super);
    function UpdateEmailAction(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, UPDATE_EMAIL_PROCESS_ID) || this;
        _this.payload = payload;
        _this.type = UPDATE_EMAIL;
        return _this;
    }
    return UpdateEmailAction;
}(EntityLoadAction));
var UpdateEmailSuccessAction = /** @class */ (function (_super) {
    __extends(UpdateEmailSuccessAction, _super);
    function UpdateEmailSuccessAction(newUid) {
        var _this = _super.call(this, PROCESS_FEATURE, UPDATE_EMAIL_PROCESS_ID) || this;
        _this.newUid = newUid;
        _this.type = UPDATE_EMAIL_SUCCESS;
        return _this;
    }
    return UpdateEmailSuccessAction;
}(EntitySuccessAction));
var UpdateEmailErrorAction = /** @class */ (function (_super) {
    __extends(UpdateEmailErrorAction, _super);
    function UpdateEmailErrorAction(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, UPDATE_EMAIL_PROCESS_ID, payload) || this;
        _this.payload = payload;
        _this.type = UPDATE_EMAIL_ERROR;
        return _this;
    }
    return UpdateEmailErrorAction;
}(EntityFailAction));
var ResetUpdateEmailAction = /** @class */ (function (_super) {
    __extends(ResetUpdateEmailAction, _super);
    function ResetUpdateEmailAction() {
        var _this = _super.call(this, PROCESS_FEATURE, UPDATE_EMAIL_PROCESS_ID) || this;
        _this.type = RESET_EMAIL;
        return _this;
    }
    return ResetUpdateEmailAction;
}(EntityLoaderResetAction));

var UPDATE_PASSWORD = '[User] Update Password';
var UPDATE_PASSWORD_FAIL = '[User] Update Password Fail';
var UPDATE_PASSWORD_SUCCESS = '[User] Update Password Success';
var UPDATE_PASSWORD_RESET = '[User] Reset Update Password Process State';
var UpdatePassword = /** @class */ (function (_super) {
    __extends(UpdatePassword, _super);
    function UpdatePassword(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, UPDATE_PASSWORD_PROCESS_ID) || this;
        _this.payload = payload;
        _this.type = UPDATE_PASSWORD;
        return _this;
    }
    return UpdatePassword;
}(EntityLoadAction));
var UpdatePasswordFail = /** @class */ (function (_super) {
    __extends(UpdatePasswordFail, _super);
    function UpdatePasswordFail(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, UPDATE_PASSWORD_PROCESS_ID, payload) || this;
        _this.payload = payload;
        _this.type = UPDATE_PASSWORD_FAIL;
        return _this;
    }
    return UpdatePasswordFail;
}(EntityFailAction));
var UpdatePasswordSuccess = /** @class */ (function (_super) {
    __extends(UpdatePasswordSuccess, _super);
    function UpdatePasswordSuccess() {
        var _this = _super.call(this, PROCESS_FEATURE, UPDATE_PASSWORD_PROCESS_ID) || this;
        _this.type = UPDATE_PASSWORD_SUCCESS;
        return _this;
    }
    return UpdatePasswordSuccess;
}(EntitySuccessAction));
var UpdatePasswordReset = /** @class */ (function (_super) {
    __extends(UpdatePasswordReset, _super);
    function UpdatePasswordReset() {
        var _this = _super.call(this, PROCESS_FEATURE, UPDATE_PASSWORD_PROCESS_ID) || this;
        _this.type = UPDATE_PASSWORD_RESET;
        return _this;
    }
    return UpdatePasswordReset;
}(EntityLoaderResetAction));

var LOAD_USER_ADDRESSES = '[User] Load User Addresses';
var LOAD_USER_ADDRESSES_FAIL = '[User] Load User Addresses Fail';
var LOAD_USER_ADDRESSES_SUCCESS = '[User] Load User Addresses Success';
var ADD_USER_ADDRESS = '[User] Add User Address';
var ADD_USER_ADDRESS_FAIL = '[User] Add User Address Fail';
var ADD_USER_ADDRESS_SUCCESS = '[User] Add User Address Success';
var UPDATE_USER_ADDRESS = '[User] Update User Address';
var UPDATE_USER_ADDRESS_FAIL = '[User] Update User Address Fail';
var UPDATE_USER_ADDRESS_SUCCESS = '[User] Update User Address Success';
var DELETE_USER_ADDRESS = '[User] Delete User Address';
var DELETE_USER_ADDRESS_FAIL = '[User] Delete User Address Fail';
var DELETE_USER_ADDRESS_SUCCESS = '[User] Delete User Address Success';
var LoadUserAddresses = /** @class */ (function (_super) {
    __extends(LoadUserAddresses, _super);
    function LoadUserAddresses(payload) {
        var _this = _super.call(this, USER_ADDRESSES) || this;
        _this.payload = payload;
        _this.type = LOAD_USER_ADDRESSES;
        return _this;
    }
    return LoadUserAddresses;
}(LoaderLoadAction));
var LoadUserAddressesFail = /** @class */ (function (_super) {
    __extends(LoadUserAddressesFail, _super);
    function LoadUserAddressesFail(payload) {
        var _this = _super.call(this, USER_ADDRESSES, payload) || this;
        _this.payload = payload;
        _this.type = LOAD_USER_ADDRESSES_FAIL;
        return _this;
    }
    return LoadUserAddressesFail;
}(LoaderFailAction));
var LoadUserAddressesSuccess = /** @class */ (function (_super) {
    __extends(LoadUserAddressesSuccess, _super);
    function LoadUserAddressesSuccess(payload) {
        var _this = _super.call(this, USER_ADDRESSES) || this;
        _this.payload = payload;
        _this.type = LOAD_USER_ADDRESSES_SUCCESS;
        return _this;
    }
    return LoadUserAddressesSuccess;
}(LoaderSuccessAction));
// Adding address actions
var AddUserAddress = /** @class */ (function (_super) {
    __extends(AddUserAddress, _super);
    function AddUserAddress(payload) {
        var _this = _super.call(this, USER_ADDRESSES) || this;
        _this.payload = payload;
        _this.type = ADD_USER_ADDRESS;
        return _this;
    }
    return AddUserAddress;
}(LoaderLoadAction));
var AddUserAddressFail = /** @class */ (function (_super) {
    __extends(AddUserAddressFail, _super);
    function AddUserAddressFail(payload) {
        var _this = _super.call(this, USER_ADDRESSES, payload) || this;
        _this.payload = payload;
        _this.type = ADD_USER_ADDRESS_FAIL;
        return _this;
    }
    return AddUserAddressFail;
}(LoaderFailAction));
var AddUserAddressSuccess = /** @class */ (function (_super) {
    __extends(AddUserAddressSuccess, _super);
    function AddUserAddressSuccess(payload) {
        var _this = _super.call(this, USER_ADDRESSES) || this;
        _this.payload = payload;
        _this.type = ADD_USER_ADDRESS_SUCCESS;
        return _this;
    }
    return AddUserAddressSuccess;
}(LoaderSuccessAction));
// Updating address actions
var UpdateUserAddress = /** @class */ (function (_super) {
    __extends(UpdateUserAddress, _super);
    function UpdateUserAddress(payload) {
        var _this = _super.call(this, USER_ADDRESSES) || this;
        _this.payload = payload;
        _this.type = UPDATE_USER_ADDRESS;
        return _this;
    }
    return UpdateUserAddress;
}(LoaderLoadAction));
var UpdateUserAddressFail = /** @class */ (function (_super) {
    __extends(UpdateUserAddressFail, _super);
    function UpdateUserAddressFail(payload) {
        var _this = _super.call(this, USER_ADDRESSES, payload) || this;
        _this.payload = payload;
        _this.type = UPDATE_USER_ADDRESS_FAIL;
        return _this;
    }
    return UpdateUserAddressFail;
}(LoaderFailAction));
var UpdateUserAddressSuccess = /** @class */ (function (_super) {
    __extends(UpdateUserAddressSuccess, _super);
    function UpdateUserAddressSuccess(payload) {
        var _this = _super.call(this, USER_ADDRESSES) || this;
        _this.payload = payload;
        _this.type = UPDATE_USER_ADDRESS_SUCCESS;
        return _this;
    }
    return UpdateUserAddressSuccess;
}(LoaderSuccessAction));
// Deleting address actions
var DeleteUserAddress = /** @class */ (function (_super) {
    __extends(DeleteUserAddress, _super);
    function DeleteUserAddress(payload) {
        var _this = _super.call(this, USER_ADDRESSES) || this;
        _this.payload = payload;
        _this.type = DELETE_USER_ADDRESS;
        return _this;
    }
    return DeleteUserAddress;
}(LoaderLoadAction));
var DeleteUserAddressFail = /** @class */ (function (_super) {
    __extends(DeleteUserAddressFail, _super);
    function DeleteUserAddressFail(payload) {
        var _this = _super.call(this, USER_ADDRESSES, payload) || this;
        _this.payload = payload;
        _this.type = DELETE_USER_ADDRESS_FAIL;
        return _this;
    }
    return DeleteUserAddressFail;
}(LoaderFailAction));
var DeleteUserAddressSuccess = /** @class */ (function (_super) {
    __extends(DeleteUserAddressSuccess, _super);
    function DeleteUserAddressSuccess(payload) {
        var _this = _super.call(this, USER_ADDRESSES) || this;
        _this.payload = payload;
        _this.type = DELETE_USER_ADDRESS_SUCCESS;
        return _this;
    }
    return DeleteUserAddressSuccess;
}(LoaderSuccessAction));

var LOAD_USER_CONSENTS = '[User] Load User Consents';
var LOAD_USER_CONSENTS_SUCCESS = '[User] Load User Consents Success';
var LOAD_USER_CONSENTS_FAIL = '[User] Load User Consents Fail';
var RESET_LOAD_USER_CONSENTS = '[User] Reset Load User Consents';
var GIVE_USER_CONSENT = '[User] Give User Consent';
var GIVE_USER_CONSENT_FAIL = '[User] Give User Consent Fail';
var GIVE_USER_CONSENT_SUCCESS = '[User] Give User Consent Success';
var RESET_GIVE_USER_CONSENT_PROCESS = '[User] Reset Give User Consent Process';
var TRANSFER_ANONYMOUS_CONSENT = '[User] Transfer Anonymous Consent';
var WITHDRAW_USER_CONSENT = '[User] Withdraw User Consent';
var WITHDRAW_USER_CONSENT_FAIL = '[User] Withdraw User Consent Fail';
var WITHDRAW_USER_CONSENT_SUCCESS = '[User] Withdraw User Consent Success';
var RESET_WITHDRAW_USER_CONSENT_PROCESS = '[User] Reset Withdraw User Consent Process';
var LoadUserConsents = /** @class */ (function (_super) {
    __extends(LoadUserConsents, _super);
    function LoadUserConsents(payload) {
        var _this = _super.call(this, USER_CONSENTS) || this;
        _this.payload = payload;
        _this.type = LOAD_USER_CONSENTS;
        return _this;
    }
    return LoadUserConsents;
}(LoaderLoadAction));
var LoadUserConsentsFail = /** @class */ (function (_super) {
    __extends(LoadUserConsentsFail, _super);
    function LoadUserConsentsFail(payload) {
        var _this = _super.call(this, USER_CONSENTS, payload) || this;
        _this.payload = payload;
        _this.type = LOAD_USER_CONSENTS_FAIL;
        return _this;
    }
    return LoadUserConsentsFail;
}(LoaderFailAction));
var LoadUserConsentsSuccess = /** @class */ (function (_super) {
    __extends(LoadUserConsentsSuccess, _super);
    function LoadUserConsentsSuccess(payload) {
        var _this = _super.call(this, USER_CONSENTS) || this;
        _this.payload = payload;
        _this.type = LOAD_USER_CONSENTS_SUCCESS;
        return _this;
    }
    return LoadUserConsentsSuccess;
}(LoaderSuccessAction));
var ResetLoadUserConsents = /** @class */ (function (_super) {
    __extends(ResetLoadUserConsents, _super);
    function ResetLoadUserConsents() {
        var _this = _super.call(this, USER_CONSENTS) || this;
        _this.type = RESET_LOAD_USER_CONSENTS;
        return _this;
    }
    return ResetLoadUserConsents;
}(LoaderResetAction));
var GiveUserConsent = /** @class */ (function (_super) {
    __extends(GiveUserConsent, _super);
    function GiveUserConsent(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, GIVE_CONSENT_PROCESS_ID) || this;
        _this.payload = payload;
        _this.type = GIVE_USER_CONSENT;
        return _this;
    }
    return GiveUserConsent;
}(EntityLoadAction));
var GiveUserConsentFail = /** @class */ (function (_super) {
    __extends(GiveUserConsentFail, _super);
    function GiveUserConsentFail(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, GIVE_CONSENT_PROCESS_ID, payload) || this;
        _this.type = GIVE_USER_CONSENT_FAIL;
        return _this;
    }
    return GiveUserConsentFail;
}(EntityFailAction));
var GiveUserConsentSuccess = /** @class */ (function (_super) {
    __extends(GiveUserConsentSuccess, _super);
    function GiveUserConsentSuccess(consentTemplate) {
        var _this = _super.call(this, PROCESS_FEATURE, GIVE_CONSENT_PROCESS_ID) || this;
        _this.consentTemplate = consentTemplate;
        _this.type = GIVE_USER_CONSENT_SUCCESS;
        return _this;
    }
    return GiveUserConsentSuccess;
}(EntitySuccessAction));
var ResetGiveUserConsentProcess = /** @class */ (function (_super) {
    __extends(ResetGiveUserConsentProcess, _super);
    function ResetGiveUserConsentProcess() {
        var _this = _super.call(this, PROCESS_FEATURE, GIVE_CONSENT_PROCESS_ID) || this;
        _this.type = RESET_GIVE_USER_CONSENT_PROCESS;
        return _this;
    }
    return ResetGiveUserConsentProcess;
}(EntityLoaderResetAction));
var TransferAnonymousConsent = /** @class */ (function () {
    function TransferAnonymousConsent(payload) {
        this.payload = payload;
        this.type = TRANSFER_ANONYMOUS_CONSENT;
    }
    return TransferAnonymousConsent;
}());
var WithdrawUserConsent = /** @class */ (function (_super) {
    __extends(WithdrawUserConsent, _super);
    function WithdrawUserConsent(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, WITHDRAW_CONSENT_PROCESS_ID) || this;
        _this.payload = payload;
        _this.type = WITHDRAW_USER_CONSENT;
        return _this;
    }
    return WithdrawUserConsent;
}(EntityLoadAction));
var WithdrawUserConsentFail = /** @class */ (function (_super) {
    __extends(WithdrawUserConsentFail, _super);
    function WithdrawUserConsentFail(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, WITHDRAW_CONSENT_PROCESS_ID, payload) || this;
        _this.type = WITHDRAW_USER_CONSENT_FAIL;
        return _this;
    }
    return WithdrawUserConsentFail;
}(EntityFailAction));
var WithdrawUserConsentSuccess = /** @class */ (function (_super) {
    __extends(WithdrawUserConsentSuccess, _super);
    function WithdrawUserConsentSuccess() {
        var _this = _super.call(this, PROCESS_FEATURE, WITHDRAW_CONSENT_PROCESS_ID) || this;
        _this.type = WITHDRAW_USER_CONSENT_SUCCESS;
        return _this;
    }
    return WithdrawUserConsentSuccess;
}(EntitySuccessAction));
var ResetWithdrawUserConsentProcess = /** @class */ (function (_super) {
    __extends(ResetWithdrawUserConsentProcess, _super);
    function ResetWithdrawUserConsentProcess() {
        var _this = _super.call(this, PROCESS_FEATURE, WITHDRAW_CONSENT_PROCESS_ID) || this;
        _this.type = RESET_WITHDRAW_USER_CONSENT_PROCESS;
        return _this;
    }
    return ResetWithdrawUserConsentProcess;
}(EntityLoaderResetAction));

var LOAD_USER_DETAILS = '[User] Load User Details';
var LOAD_USER_DETAILS_FAIL = '[User] Load User Details Fail';
var LOAD_USER_DETAILS_SUCCESS = '[User] Load User Details Success';
var UPDATE_USER_DETAILS = '[User] Update User Details';
var UPDATE_USER_DETAILS_FAIL = '[User] Update User Details Fail';
var UPDATE_USER_DETAILS_SUCCESS = '[User] Update User Details Success';
var RESET_USER_DETAILS = '[User] Reset User Details';
var LoadUserDetails = /** @class */ (function () {
    function LoadUserDetails(payload) {
        this.payload = payload;
        this.type = LOAD_USER_DETAILS;
    }
    return LoadUserDetails;
}());
var LoadUserDetailsFail = /** @class */ (function () {
    function LoadUserDetailsFail(payload) {
        this.payload = payload;
        this.type = LOAD_USER_DETAILS_FAIL;
    }
    return LoadUserDetailsFail;
}());
var LoadUserDetailsSuccess = /** @class */ (function () {
    function LoadUserDetailsSuccess(payload) {
        this.payload = payload;
        this.type = LOAD_USER_DETAILS_SUCCESS;
    }
    return LoadUserDetailsSuccess;
}());
var UpdateUserDetails = /** @class */ (function (_super) {
    __extends(UpdateUserDetails, _super);
    function UpdateUserDetails(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, UPDATE_USER_DETAILS_PROCESS_ID) || this;
        _this.payload = payload;
        _this.type = UPDATE_USER_DETAILS;
        return _this;
    }
    return UpdateUserDetails;
}(EntityLoadAction));
var UpdateUserDetailsFail = /** @class */ (function (_super) {
    __extends(UpdateUserDetailsFail, _super);
    function UpdateUserDetailsFail(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, UPDATE_USER_DETAILS_PROCESS_ID, payload) || this;
        _this.payload = payload;
        _this.type = UPDATE_USER_DETAILS_FAIL;
        return _this;
    }
    return UpdateUserDetailsFail;
}(EntityFailAction));
var UpdateUserDetailsSuccess = /** @class */ (function (_super) {
    __extends(UpdateUserDetailsSuccess, _super);
    function UpdateUserDetailsSuccess(userUpdates) {
        var _this = _super.call(this, PROCESS_FEATURE, UPDATE_USER_DETAILS_PROCESS_ID) || this;
        _this.userUpdates = userUpdates;
        _this.type = UPDATE_USER_DETAILS_SUCCESS;
        return _this;
    }
    return UpdateUserDetailsSuccess;
}(EntitySuccessAction));
var ResetUpdateUserDetails = /** @class */ (function (_super) {
    __extends(ResetUpdateUserDetails, _super);
    function ResetUpdateUserDetails() {
        var _this = _super.call(this, PROCESS_FEATURE, UPDATE_USER_DETAILS_PROCESS_ID) || this;
        _this.type = RESET_USER_DETAILS;
        return _this;
    }
    return ResetUpdateUserDetails;
}(EntityLoaderResetAction));

var CLEAR_USER_MISCS_DATA = '[User] Clear User Misc Data';
var ClearUserMiscsData = /** @class */ (function () {
    function ClearUserMiscsData() {
        this.type = CLEAR_USER_MISCS_DATA;
    }
    return ClearUserMiscsData;
}());

var LOAD_USER_ORDERS = '[User] Load User Orders';
var LOAD_USER_ORDERS_FAIL = '[User] Load User Orders Fail';
var LOAD_USER_ORDERS_SUCCESS = '[User] Load User Orders Success';
var CLEAR_USER_ORDERS = '[User] Clear User Orders';
var LoadUserOrders = /** @class */ (function (_super) {
    __extends(LoadUserOrders, _super);
    function LoadUserOrders(payload) {
        var _this = _super.call(this, USER_ORDERS) || this;
        _this.payload = payload;
        _this.type = LOAD_USER_ORDERS;
        return _this;
    }
    return LoadUserOrders;
}(LoaderLoadAction));
var LoadUserOrdersFail = /** @class */ (function (_super) {
    __extends(LoadUserOrdersFail, _super);
    function LoadUserOrdersFail(payload) {
        var _this = _super.call(this, USER_ORDERS, payload) || this;
        _this.payload = payload;
        _this.type = LOAD_USER_ORDERS_FAIL;
        return _this;
    }
    return LoadUserOrdersFail;
}(LoaderFailAction));
var LoadUserOrdersSuccess = /** @class */ (function (_super) {
    __extends(LoadUserOrdersSuccess, _super);
    function LoadUserOrdersSuccess(payload) {
        var _this = _super.call(this, USER_ORDERS) || this;
        _this.payload = payload;
        _this.type = LOAD_USER_ORDERS_SUCCESS;
        return _this;
    }
    return LoadUserOrdersSuccess;
}(LoaderSuccessAction));
var ClearUserOrders = /** @class */ (function (_super) {
    __extends(ClearUserOrders, _super);
    function ClearUserOrders() {
        var _this = _super.call(this, USER_ORDERS) || this;
        _this.type = CLEAR_USER_ORDERS;
        return _this;
    }
    return ClearUserOrders;
}(LoaderResetAction));

var REGISTER_USER = '[User] Register User';
var REGISTER_USER_FAIL = '[User] Register User Fail';
var REGISTER_USER_SUCCESS = '[User] Register User Success';
var RESET_REGISTER_USER_PROCESS = '[User] Reset Register User Process';
var REGISTER_GUEST = '[User] Register Guest';
var REGISTER_GUEST_FAIL = '[User] Register Guest Fail';
var REGISTER_GUEST_SUCCESS = '[User] Register Guest Success';
var REMOVE_USER = '[User] Remove User';
var REMOVE_USER_FAIL = '[User] Remove User Fail';
var REMOVE_USER_SUCCESS = '[User] Remove User Success';
var REMOVE_USER_RESET = '[User] Reset Remove User Process State';
var RegisterUser = /** @class */ (function (_super) {
    __extends(RegisterUser, _super);
    function RegisterUser(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, REGISTER_USER_PROCESS_ID) || this;
        _this.payload = payload;
        _this.type = REGISTER_USER;
        return _this;
    }
    return RegisterUser;
}(EntityLoadAction));
var RegisterUserFail = /** @class */ (function (_super) {
    __extends(RegisterUserFail, _super);
    function RegisterUserFail(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, REGISTER_USER_PROCESS_ID, payload) || this;
        _this.payload = payload;
        _this.type = REGISTER_USER_FAIL;
        return _this;
    }
    return RegisterUserFail;
}(EntityFailAction));
var RegisterUserSuccess = /** @class */ (function (_super) {
    __extends(RegisterUserSuccess, _super);
    function RegisterUserSuccess() {
        var _this = _super.call(this, PROCESS_FEATURE, REGISTER_USER_PROCESS_ID) || this;
        _this.type = REGISTER_USER_SUCCESS;
        return _this;
    }
    return RegisterUserSuccess;
}(EntitySuccessAction));
var ResetRegisterUserProcess = /** @class */ (function (_super) {
    __extends(ResetRegisterUserProcess, _super);
    function ResetRegisterUserProcess() {
        var _this = _super.call(this, PROCESS_FEATURE, REGISTER_USER_PROCESS_ID) || this;
        _this.type = RESET_REGISTER_USER_PROCESS;
        return _this;
    }
    return ResetRegisterUserProcess;
}(EntityLoaderResetAction));
var RegisterGuest = /** @class */ (function () {
    function RegisterGuest(payload) {
        this.payload = payload;
        this.type = REGISTER_GUEST;
    }
    return RegisterGuest;
}());
var RegisterGuestFail = /** @class */ (function () {
    function RegisterGuestFail(payload) {
        this.payload = payload;
        this.type = REGISTER_GUEST_FAIL;
    }
    return RegisterGuestFail;
}());
var RegisterGuestSuccess = /** @class */ (function () {
    function RegisterGuestSuccess() {
        this.type = REGISTER_GUEST_SUCCESS;
    }
    return RegisterGuestSuccess;
}());
var RemoveUser = /** @class */ (function (_super) {
    __extends(RemoveUser, _super);
    function RemoveUser(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, REMOVE_USER_PROCESS_ID) || this;
        _this.payload = payload;
        _this.type = REMOVE_USER;
        return _this;
    }
    return RemoveUser;
}(EntityLoadAction));
var RemoveUserFail = /** @class */ (function (_super) {
    __extends(RemoveUserFail, _super);
    function RemoveUserFail(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, REMOVE_USER_PROCESS_ID, payload) || this;
        _this.payload = payload;
        _this.type = REMOVE_USER_FAIL;
        return _this;
    }
    return RemoveUserFail;
}(EntityFailAction));
var RemoveUserSuccess = /** @class */ (function (_super) {
    __extends(RemoveUserSuccess, _super);
    function RemoveUserSuccess() {
        var _this = _super.call(this, PROCESS_FEATURE, REMOVE_USER_PROCESS_ID) || this;
        _this.type = REMOVE_USER_SUCCESS;
        return _this;
    }
    return RemoveUserSuccess;
}(EntitySuccessAction));
var RemoveUserReset = /** @class */ (function (_super) {
    __extends(RemoveUserReset, _super);
    function RemoveUserReset() {
        var _this = _super.call(this, PROCESS_FEATURE, REMOVE_USER_PROCESS_ID) || this;
        _this.type = REMOVE_USER_RESET;
        return _this;
    }
    return RemoveUserReset;
}(EntityLoaderResetAction));

var LOAD_CUSTOMER_COUPONS = '[User] Load Customer Coupons';
var LOAD_CUSTOMER_COUPONS_FAIL = '[User] Load Customer Coupons Fail';
var LOAD_CUSTOMER_COUPONS_SUCCESS = '[User] Load Customer Coupons Success';
var RESET_LOAD_CUSTOMER_COUPONS = '[User] Reset Load Customer Coupons';
var SUBSCRIBE_CUSTOMER_COUPON = '[User] Subscribe Customer Notification Coupon';
var SUBSCRIBE_CUSTOMER_COUPON_FAIL = '[User] Subscribe Customer Coupon Notification Fail';
var SUBSCRIBE_CUSTOMER_COUPON_SUCCESS = '[User] Subscribe Customer Coupon Notification Success';
var RESET_SUBSCRIBE_CUSTOMER_COUPON_PROCESS = '[User] Reset Subscribe Customer Coupon Process';
var UNSUBSCRIBE_CUSTOMER_COUPON = '[User] Unsubscribe Customer Notification Coupon';
var UNSUBSCRIBE_CUSTOMER_COUPON_FAIL = '[User] Unsubscribe Customer Coupon Notification Fail';
var UNSUBSCRIBE_CUSTOMER_COUPON_SUCCESS = '[User] Unsubscribe Customer Coupon Notification Success';
var RESET_UNSUBSCRIBE_CUSTOMER_COUPON_PROCESS = '[User] Reset Unsubscribe Customer Coupon Process';
var CLAIM_CUSTOMER_COUPON = '[User] Claim Customer';
var CLAIM_CUSTOMER_COUPON_FAIL = '[User] Claim Customer Fail';
var CLAIM_CUSTOMER_COUPON_SUCCESS = '[User] Claim Customer Success';
var LoadCustomerCoupons = /** @class */ (function (_super) {
    __extends(LoadCustomerCoupons, _super);
    function LoadCustomerCoupons(payload) {
        var _this = _super.call(this, CUSTOMER_COUPONS) || this;
        _this.payload = payload;
        _this.type = LOAD_CUSTOMER_COUPONS;
        return _this;
    }
    return LoadCustomerCoupons;
}(LoaderLoadAction));
var LoadCustomerCouponsFail = /** @class */ (function (_super) {
    __extends(LoadCustomerCouponsFail, _super);
    function LoadCustomerCouponsFail(payload) {
        var _this = _super.call(this, CUSTOMER_COUPONS, payload) || this;
        _this.payload = payload;
        _this.type = LOAD_CUSTOMER_COUPONS_FAIL;
        return _this;
    }
    return LoadCustomerCouponsFail;
}(LoaderFailAction));
var LoadCustomerCouponsSuccess = /** @class */ (function (_super) {
    __extends(LoadCustomerCouponsSuccess, _super);
    function LoadCustomerCouponsSuccess(payload) {
        var _this = _super.call(this, CUSTOMER_COUPONS) || this;
        _this.payload = payload;
        _this.type = LOAD_CUSTOMER_COUPONS_SUCCESS;
        return _this;
    }
    return LoadCustomerCouponsSuccess;
}(LoaderSuccessAction));
var ResetLoadCustomerCoupons = /** @class */ (function (_super) {
    __extends(ResetLoadCustomerCoupons, _super);
    function ResetLoadCustomerCoupons() {
        var _this = _super.call(this, CUSTOMER_COUPONS) || this;
        _this.type = RESET_LOAD_CUSTOMER_COUPONS;
        return _this;
    }
    return ResetLoadCustomerCoupons;
}(LoaderResetAction));
// Subscribe coupon notification actions
var SubscribeCustomerCoupon = /** @class */ (function (_super) {
    __extends(SubscribeCustomerCoupon, _super);
    function SubscribeCustomerCoupon(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, SUBSCRIBE_CUSTOMER_COUPON_PROCESS_ID) || this;
        _this.payload = payload;
        _this.type = SUBSCRIBE_CUSTOMER_COUPON;
        return _this;
    }
    return SubscribeCustomerCoupon;
}(EntityLoadAction));
var SubscribeCustomerCouponFail = /** @class */ (function (_super) {
    __extends(SubscribeCustomerCouponFail, _super);
    function SubscribeCustomerCouponFail(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, SUBSCRIBE_CUSTOMER_COUPON_PROCESS_ID, payload) || this;
        _this.payload = payload;
        _this.type = SUBSCRIBE_CUSTOMER_COUPON_FAIL;
        return _this;
    }
    return SubscribeCustomerCouponFail;
}(EntityFailAction));
var SubscribeCustomerCouponSuccess = /** @class */ (function (_super) {
    __extends(SubscribeCustomerCouponSuccess, _super);
    function SubscribeCustomerCouponSuccess(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, SUBSCRIBE_CUSTOMER_COUPON_PROCESS_ID, payload) || this;
        _this.payload = payload;
        _this.type = SUBSCRIBE_CUSTOMER_COUPON_SUCCESS;
        return _this;
    }
    return SubscribeCustomerCouponSuccess;
}(EntitySuccessAction));
var ResetSubscribeCustomerCouponProcess = /** @class */ (function (_super) {
    __extends(ResetSubscribeCustomerCouponProcess, _super);
    function ResetSubscribeCustomerCouponProcess() {
        var _this = _super.call(this, PROCESS_FEATURE, SUBSCRIBE_CUSTOMER_COUPON_PROCESS_ID) || this;
        _this.type = RESET_SUBSCRIBE_CUSTOMER_COUPON_PROCESS;
        return _this;
    }
    return ResetSubscribeCustomerCouponProcess;
}(EntityLoaderResetAction));
var UnsubscribeCustomerCoupon = /** @class */ (function (_super) {
    __extends(UnsubscribeCustomerCoupon, _super);
    function UnsubscribeCustomerCoupon(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, UNSUBSCRIBE_CUSTOMER_COUPON_PROCESS_ID) || this;
        _this.payload = payload;
        _this.type = UNSUBSCRIBE_CUSTOMER_COUPON;
        return _this;
    }
    return UnsubscribeCustomerCoupon;
}(EntityLoadAction));
var UnsubscribeCustomerCouponFail = /** @class */ (function (_super) {
    __extends(UnsubscribeCustomerCouponFail, _super);
    function UnsubscribeCustomerCouponFail(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, UNSUBSCRIBE_CUSTOMER_COUPON_PROCESS_ID, payload) || this;
        _this.payload = payload;
        _this.type = UNSUBSCRIBE_CUSTOMER_COUPON_FAIL;
        return _this;
    }
    return UnsubscribeCustomerCouponFail;
}(EntityFailAction));
var UnsubscribeCustomerCouponSuccess = /** @class */ (function (_super) {
    __extends(UnsubscribeCustomerCouponSuccess, _super);
    function UnsubscribeCustomerCouponSuccess(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, UNSUBSCRIBE_CUSTOMER_COUPON_PROCESS_ID, payload) || this;
        _this.payload = payload;
        _this.type = UNSUBSCRIBE_CUSTOMER_COUPON_SUCCESS;
        return _this;
    }
    return UnsubscribeCustomerCouponSuccess;
}(EntitySuccessAction));
var ResetUnsubscribeCustomerCouponProcess = /** @class */ (function (_super) {
    __extends(ResetUnsubscribeCustomerCouponProcess, _super);
    function ResetUnsubscribeCustomerCouponProcess() {
        var _this = _super.call(this, PROCESS_FEATURE, UNSUBSCRIBE_CUSTOMER_COUPON_PROCESS_ID) || this;
        _this.type = RESET_UNSUBSCRIBE_CUSTOMER_COUPON_PROCESS;
        return _this;
    }
    return ResetUnsubscribeCustomerCouponProcess;
}(EntityLoaderResetAction));
var ClaimCustomerCoupon = /** @class */ (function (_super) {
    __extends(ClaimCustomerCoupon, _super);
    function ClaimCustomerCoupon(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, CLAIM_CUSTOMER_COUPON_PROCESS_ID) || this;
        _this.payload = payload;
        _this.type = CLAIM_CUSTOMER_COUPON;
        return _this;
    }
    return ClaimCustomerCoupon;
}(EntityLoadAction));
var ClaimCustomerCouponFail = /** @class */ (function (_super) {
    __extends(ClaimCustomerCouponFail, _super);
    function ClaimCustomerCouponFail(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, CLAIM_CUSTOMER_COUPON_PROCESS_ID, payload) || this;
        _this.payload = payload;
        _this.type = CLAIM_CUSTOMER_COUPON_FAIL;
        return _this;
    }
    return ClaimCustomerCouponFail;
}(EntityFailAction));
var ClaimCustomerCouponSuccess = /** @class */ (function (_super) {
    __extends(ClaimCustomerCouponSuccess, _super);
    function ClaimCustomerCouponSuccess(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, CLAIM_CUSTOMER_COUPON_PROCESS_ID, payload) || this;
        _this.payload = payload;
        _this.type = CLAIM_CUSTOMER_COUPON_SUCCESS;
        return _this;
    }
    return ClaimCustomerCouponSuccess;
}(EntitySuccessAction));

var LOAD_NOTIFICATION_PREFERENCES = '[User] Load Notification Preferences';
var LOAD_NOTIFICATION_PREFERENCES_FAIL = '[User] Load Notification Preferences Fail';
var LOAD_NOTIFICATION_PREFERENCES_SUCCESS = '[User] Load Notification Preferences Success';
var UPDATE_NOTIFICATION_PREFERENCES = '[User] Update Notification Preferences';
var UPDATE_NOTIFICATION_PREFERENCES_FAIL = '[User] Update Notification Preferences Fail';
var UPDATE_NOTIFICATION_PREFERENCES_SUCCESS = '[User] Update Notification Preferences Success';
var RESET_NOTIFICATION_PREFERENCES = '[User] Reset Notification Preferences';
var CLEAR_NOTIFICATION_PREFERENCES = '[User] Clear Notification Preferences';
var LoadNotificationPreferences = /** @class */ (function (_super) {
    __extends(LoadNotificationPreferences, _super);
    function LoadNotificationPreferences(payload) {
        var _this = _super.call(this, NOTIFICATION_PREFERENCES) || this;
        _this.payload = payload;
        _this.type = LOAD_NOTIFICATION_PREFERENCES;
        return _this;
    }
    return LoadNotificationPreferences;
}(LoaderLoadAction));
var LoadNotificationPreferencesFail = /** @class */ (function (_super) {
    __extends(LoadNotificationPreferencesFail, _super);
    function LoadNotificationPreferencesFail(payload) {
        var _this = _super.call(this, NOTIFICATION_PREFERENCES, payload) || this;
        _this.payload = payload;
        _this.type = LOAD_NOTIFICATION_PREFERENCES_FAIL;
        return _this;
    }
    return LoadNotificationPreferencesFail;
}(LoaderFailAction));
var LoadNotificationPreferencesSuccess = /** @class */ (function (_super) {
    __extends(LoadNotificationPreferencesSuccess, _super);
    function LoadNotificationPreferencesSuccess(payload) {
        var _this = _super.call(this, NOTIFICATION_PREFERENCES) || this;
        _this.payload = payload;
        _this.type = LOAD_NOTIFICATION_PREFERENCES_SUCCESS;
        return _this;
    }
    return LoadNotificationPreferencesSuccess;
}(LoaderSuccessAction));
var UpdateNotificationPreferences = /** @class */ (function (_super) {
    __extends(UpdateNotificationPreferences, _super);
    function UpdateNotificationPreferences(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, UPDATE_NOTIFICATION_PREFERENCES_PROCESS_ID) || this;
        _this.payload = payload;
        _this.type = UPDATE_NOTIFICATION_PREFERENCES;
        return _this;
    }
    return UpdateNotificationPreferences;
}(EntityLoadAction));
var UpdateNotificationPreferencesFail = /** @class */ (function (_super) {
    __extends(UpdateNotificationPreferencesFail, _super);
    function UpdateNotificationPreferencesFail(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, UPDATE_NOTIFICATION_PREFERENCES_PROCESS_ID, payload) || this;
        _this.payload = payload;
        _this.type = UPDATE_NOTIFICATION_PREFERENCES_FAIL;
        return _this;
    }
    return UpdateNotificationPreferencesFail;
}(EntityFailAction));
var UpdateNotificationPreferencesSuccess = /** @class */ (function (_super) {
    __extends(UpdateNotificationPreferencesSuccess, _super);
    function UpdateNotificationPreferencesSuccess(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, UPDATE_NOTIFICATION_PREFERENCES_PROCESS_ID) || this;
        _this.payload = payload;
        _this.type = UPDATE_NOTIFICATION_PREFERENCES_SUCCESS;
        return _this;
    }
    return UpdateNotificationPreferencesSuccess;
}(EntitySuccessAction));
var ResetNotificationPreferences = /** @class */ (function (_super) {
    __extends(ResetNotificationPreferences, _super);
    function ResetNotificationPreferences() {
        var _this = _super.call(this, PROCESS_FEATURE, UPDATE_NOTIFICATION_PREFERENCES_PROCESS_ID) || this;
        _this.type = RESET_NOTIFICATION_PREFERENCES;
        return _this;
    }
    return ResetNotificationPreferences;
}(EntityLoaderResetAction));
var ClearNotificationPreferences = /** @class */ (function (_super) {
    __extends(ClearNotificationPreferences, _super);
    function ClearNotificationPreferences() {
        var _this = _super.call(this, NOTIFICATION_PREFERENCES) || this;
        _this.type = CLEAR_NOTIFICATION_PREFERENCES;
        return _this;
    }
    return ClearNotificationPreferences;
}(LoaderResetAction));

var LOAD_PRODUCT_INTERESTS = 'Load Product Interests';
var LOAD_PRODUCT_INTERESTS_FAIL = 'Load Product Interests Fail';
var LOAD_PRODUCT_INTERESTS_SUCCESS = 'Load Product Interests Success';
var REMOVE_PRODUCT_INTEREST = 'Remove Product Interest';
var REMOVE_PRODUCT_INTEREST_SUCCESS = 'Remove Product Interest Success';
var REMOVE_PRODUCT_INTEREST_FAIL = 'Remove Product Interest Fail';
var ADD_PRODUCT_INTEREST = 'Add Product Interest';
var ADD_PRODUCT_INTEREST_FAIL = 'Add Product Interest Fail';
var ADD_PRODUCT_INTEREST_SUCCESS = 'Add Product Interest Success';
var ADD_PRODUCT_INTEREST_RESET = 'Add Product Interest Reset';
var REMOVE_PRODUCT_INTEREST_RESET = 'Remove Product Interest Reset';
var CLEAR_PRODUCT_INTERESTS = 'Clear Product Interests';
var LoadProductInterests = /** @class */ (function (_super) {
    __extends(LoadProductInterests, _super);
    function LoadProductInterests(payload) {
        var _this = _super.call(this, PRODUCT_INTERESTS) || this;
        _this.payload = payload;
        _this.type = LOAD_PRODUCT_INTERESTS;
        return _this;
    }
    return LoadProductInterests;
}(LoaderLoadAction));
var LoadProductInterestsFail = /** @class */ (function (_super) {
    __extends(LoadProductInterestsFail, _super);
    function LoadProductInterestsFail(payload) {
        var _this = _super.call(this, PRODUCT_INTERESTS, payload) || this;
        _this.payload = payload;
        _this.type = LOAD_PRODUCT_INTERESTS_FAIL;
        return _this;
    }
    return LoadProductInterestsFail;
}(LoaderFailAction));
var LoadProductInterestsSuccess = /** @class */ (function (_super) {
    __extends(LoadProductInterestsSuccess, _super);
    function LoadProductInterestsSuccess(payload) {
        var _this = _super.call(this, PRODUCT_INTERESTS) || this;
        _this.payload = payload;
        _this.type = LOAD_PRODUCT_INTERESTS_SUCCESS;
        return _this;
    }
    return LoadProductInterestsSuccess;
}(LoaderSuccessAction));
var RemoveProductInterest = /** @class */ (function (_super) {
    __extends(RemoveProductInterest, _super);
    function RemoveProductInterest(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, REMOVE_PRODUCT_INTERESTS_PROCESS_ID) || this;
        _this.payload = payload;
        _this.type = REMOVE_PRODUCT_INTEREST;
        return _this;
    }
    return RemoveProductInterest;
}(EntityLoadAction));
var RemoveProductInterestSuccess = /** @class */ (function (_super) {
    __extends(RemoveProductInterestSuccess, _super);
    function RemoveProductInterestSuccess(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, REMOVE_PRODUCT_INTERESTS_PROCESS_ID) || this;
        _this.payload = payload;
        _this.type = REMOVE_PRODUCT_INTEREST_SUCCESS;
        return _this;
    }
    return RemoveProductInterestSuccess;
}(EntitySuccessAction));
var RemoveProductInterestFail = /** @class */ (function (_super) {
    __extends(RemoveProductInterestFail, _super);
    function RemoveProductInterestFail(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, REMOVE_PRODUCT_INTERESTS_PROCESS_ID, payload) || this;
        _this.payload = payload;
        _this.type = REMOVE_PRODUCT_INTEREST_FAIL;
        return _this;
    }
    return RemoveProductInterestFail;
}(EntityFailAction));
var AddProductInterest = /** @class */ (function (_super) {
    __extends(AddProductInterest, _super);
    function AddProductInterest(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, ADD_PRODUCT_INTEREST_PROCESS_ID) || this;
        _this.payload = payload;
        _this.type = ADD_PRODUCT_INTEREST;
        return _this;
    }
    return AddProductInterest;
}(EntityLoadAction));
var AddProductInterestSuccess = /** @class */ (function (_super) {
    __extends(AddProductInterestSuccess, _super);
    function AddProductInterestSuccess(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, ADD_PRODUCT_INTEREST_PROCESS_ID) || this;
        _this.payload = payload;
        _this.type = ADD_PRODUCT_INTEREST_SUCCESS;
        return _this;
    }
    return AddProductInterestSuccess;
}(EntitySuccessAction));
var AddProductInterestFail = /** @class */ (function (_super) {
    __extends(AddProductInterestFail, _super);
    function AddProductInterestFail(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, ADD_PRODUCT_INTEREST_PROCESS_ID, payload) || this;
        _this.payload = payload;
        _this.type = ADD_PRODUCT_INTEREST_FAIL;
        return _this;
    }
    return AddProductInterestFail;
}(EntityFailAction));
var ResetAddInterestState = /** @class */ (function (_super) {
    __extends(ResetAddInterestState, _super);
    function ResetAddInterestState() {
        var _this = _super.call(this, PROCESS_FEATURE, ADD_PRODUCT_INTEREST_PROCESS_ID) || this;
        _this.type = ADD_PRODUCT_INTEREST_RESET;
        return _this;
    }
    return ResetAddInterestState;
}(EntityLoaderResetAction));
var ResetRemoveInterestState = /** @class */ (function (_super) {
    __extends(ResetRemoveInterestState, _super);
    function ResetRemoveInterestState() {
        var _this = _super.call(this, PROCESS_FEATURE, REMOVE_PRODUCT_INTERESTS_PROCESS_ID) || this;
        _this.type = REMOVE_PRODUCT_INTEREST_RESET;
        return _this;
    }
    return ResetRemoveInterestState;
}(EntityLoaderResetAction));
var ClearProductInterests = /** @class */ (function (_super) {
    __extends(ClearProductInterests, _super);
    function ClearProductInterests() {
        var _this = _super.call(this, PRODUCT_INTERESTS) || this;
        _this.type = CLEAR_PRODUCT_INTERESTS;
        return _this;
    }
    return ClearProductInterests;
}(LoaderResetAction));

var CREATE_ORDER_RETURN_REQUEST = '[User] Create Order Return Request';
var CREATE_ORDER_RETURN_REQUEST_FAIL = '[User] Create Order Return Request Fail';
var CREATE_ORDER_RETURN_REQUEST_SUCCESS = '[User] Create Order Return Request Success';
var LOAD_ORDER_RETURN_REQUEST = '[User] Load Order Return Request details';
var LOAD_ORDER_RETURN_REQUEST_FAIL = '[User] Load Order Return Request details Fail';
var LOAD_ORDER_RETURN_REQUEST_SUCCESS = '[User] Load Order Return Request details Success';
var CANCEL_ORDER_RETURN_REQUEST = '[User] Cancel Order Return Request';
var CANCEL_ORDER_RETURN_REQUEST_FAIL = '[User] Cancel Order Return Request Fail';
var CANCEL_ORDER_RETURN_REQUEST_SUCCESS = '[User] Cancel Order Return Request Success';
var LOAD_ORDER_RETURN_REQUEST_LIST = '[User] Load User Order Return Request List';
var LOAD_ORDER_RETURN_REQUEST_LIST_FAIL = '[User] Load User Order Return Request List Fail';
var LOAD_ORDER_RETURN_REQUEST_LIST_SUCCESS = '[User] Load User Order Return Request List Success';
var CLEAR_ORDER_RETURN_REQUEST = '[User] Clear Order Return Request Details';
var CLEAR_ORDER_RETURN_REQUEST_LIST = '[User] Clear Order Return Request List';
var RESET_CANCEL_RETURN_PROCESS = '[User] Reset Cancel Return Request Process';
var CreateOrderReturnRequest = /** @class */ (function (_super) {
    __extends(CreateOrderReturnRequest, _super);
    function CreateOrderReturnRequest(payload) {
        var _this = _super.call(this, USER_RETURN_REQUEST_DETAILS) || this;
        _this.payload = payload;
        _this.type = CREATE_ORDER_RETURN_REQUEST;
        return _this;
    }
    return CreateOrderReturnRequest;
}(LoaderLoadAction));
var CreateOrderReturnRequestFail = /** @class */ (function (_super) {
    __extends(CreateOrderReturnRequestFail, _super);
    function CreateOrderReturnRequestFail(payload) {
        var _this = _super.call(this, USER_RETURN_REQUEST_DETAILS, payload) || this;
        _this.payload = payload;
        _this.type = CREATE_ORDER_RETURN_REQUEST_FAIL;
        return _this;
    }
    return CreateOrderReturnRequestFail;
}(LoaderFailAction));
var CreateOrderReturnRequestSuccess = /** @class */ (function (_super) {
    __extends(CreateOrderReturnRequestSuccess, _super);
    function CreateOrderReturnRequestSuccess(payload) {
        var _this = _super.call(this, USER_RETURN_REQUEST_DETAILS) || this;
        _this.payload = payload;
        _this.type = CREATE_ORDER_RETURN_REQUEST_SUCCESS;
        return _this;
    }
    return CreateOrderReturnRequestSuccess;
}(LoaderSuccessAction));
var LoadOrderReturnRequest = /** @class */ (function (_super) {
    __extends(LoadOrderReturnRequest, _super);
    function LoadOrderReturnRequest(payload) {
        var _this = _super.call(this, USER_RETURN_REQUEST_DETAILS) || this;
        _this.payload = payload;
        _this.type = LOAD_ORDER_RETURN_REQUEST;
        return _this;
    }
    return LoadOrderReturnRequest;
}(LoaderLoadAction));
var LoadOrderReturnRequestFail = /** @class */ (function (_super) {
    __extends(LoadOrderReturnRequestFail, _super);
    function LoadOrderReturnRequestFail(payload) {
        var _this = _super.call(this, USER_RETURN_REQUEST_DETAILS, payload) || this;
        _this.payload = payload;
        _this.type = LOAD_ORDER_RETURN_REQUEST_FAIL;
        return _this;
    }
    return LoadOrderReturnRequestFail;
}(LoaderFailAction));
var LoadOrderReturnRequestSuccess = /** @class */ (function (_super) {
    __extends(LoadOrderReturnRequestSuccess, _super);
    function LoadOrderReturnRequestSuccess(payload) {
        var _this = _super.call(this, USER_RETURN_REQUEST_DETAILS) || this;
        _this.payload = payload;
        _this.type = LOAD_ORDER_RETURN_REQUEST_SUCCESS;
        return _this;
    }
    return LoadOrderReturnRequestSuccess;
}(LoaderSuccessAction));
var CancelOrderReturnRequest = /** @class */ (function (_super) {
    __extends(CancelOrderReturnRequest, _super);
    function CancelOrderReturnRequest(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, CANCEL_RETURN_PROCESS_ID) || this;
        _this.payload = payload;
        _this.type = CANCEL_ORDER_RETURN_REQUEST;
        return _this;
    }
    return CancelOrderReturnRequest;
}(EntityLoadAction));
var CancelOrderReturnRequestFail = /** @class */ (function (_super) {
    __extends(CancelOrderReturnRequestFail, _super);
    function CancelOrderReturnRequestFail(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, CANCEL_RETURN_PROCESS_ID, payload) || this;
        _this.payload = payload;
        _this.type = CANCEL_ORDER_RETURN_REQUEST_FAIL;
        return _this;
    }
    return CancelOrderReturnRequestFail;
}(EntityFailAction));
var CancelOrderReturnRequestSuccess = /** @class */ (function (_super) {
    __extends(CancelOrderReturnRequestSuccess, _super);
    function CancelOrderReturnRequestSuccess() {
        var _this = _super.call(this, PROCESS_FEATURE, CANCEL_RETURN_PROCESS_ID) || this;
        _this.type = CANCEL_ORDER_RETURN_REQUEST_SUCCESS;
        return _this;
    }
    return CancelOrderReturnRequestSuccess;
}(EntitySuccessAction));
var LoadOrderReturnRequestList = /** @class */ (function (_super) {
    __extends(LoadOrderReturnRequestList, _super);
    function LoadOrderReturnRequestList(payload) {
        var _this = _super.call(this, USER_RETURN_REQUESTS) || this;
        _this.payload = payload;
        _this.type = LOAD_ORDER_RETURN_REQUEST_LIST;
        return _this;
    }
    return LoadOrderReturnRequestList;
}(LoaderLoadAction));
var LoadOrderReturnRequestListFail = /** @class */ (function (_super) {
    __extends(LoadOrderReturnRequestListFail, _super);
    function LoadOrderReturnRequestListFail(payload) {
        var _this = _super.call(this, USER_RETURN_REQUESTS, payload) || this;
        _this.payload = payload;
        _this.type = LOAD_ORDER_RETURN_REQUEST_LIST_FAIL;
        return _this;
    }
    return LoadOrderReturnRequestListFail;
}(LoaderFailAction));
var LoadOrderReturnRequestListSuccess = /** @class */ (function (_super) {
    __extends(LoadOrderReturnRequestListSuccess, _super);
    function LoadOrderReturnRequestListSuccess(payload) {
        var _this = _super.call(this, USER_RETURN_REQUESTS) || this;
        _this.payload = payload;
        _this.type = LOAD_ORDER_RETURN_REQUEST_LIST_SUCCESS;
        return _this;
    }
    return LoadOrderReturnRequestListSuccess;
}(LoaderSuccessAction));
var ClearOrderReturnRequest = /** @class */ (function (_super) {
    __extends(ClearOrderReturnRequest, _super);
    function ClearOrderReturnRequest() {
        var _this = _super.call(this, USER_RETURN_REQUEST_DETAILS) || this;
        _this.type = CLEAR_ORDER_RETURN_REQUEST;
        return _this;
    }
    return ClearOrderReturnRequest;
}(LoaderResetAction));
var ClearOrderReturnRequestList = /** @class */ (function (_super) {
    __extends(ClearOrderReturnRequestList, _super);
    function ClearOrderReturnRequestList() {
        var _this = _super.call(this, USER_RETURN_REQUESTS) || this;
        _this.type = CLEAR_ORDER_RETURN_REQUEST_LIST;
        return _this;
    }
    return ClearOrderReturnRequestList;
}(LoaderResetAction));
var ResetCancelReturnProcess = /** @class */ (function (_super) {
    __extends(ResetCancelReturnProcess, _super);
    function ResetCancelReturnProcess() {
        var _this = _super.call(this, PROCESS_FEATURE, CANCEL_RETURN_PROCESS_ID) || this;
        _this.type = RESET_CANCEL_RETURN_PROCESS;
        return _this;
    }
    return ResetCancelReturnProcess;
}(EntityLoaderResetAction));



var userGroup_actions = /*#__PURE__*/Object.freeze({
    __proto__: null,
    LOAD_BILLING_COUNTRIES: LOAD_BILLING_COUNTRIES,
    LOAD_BILLING_COUNTRIES_FAIL: LOAD_BILLING_COUNTRIES_FAIL,
    LOAD_BILLING_COUNTRIES_SUCCESS: LOAD_BILLING_COUNTRIES_SUCCESS,
    LoadBillingCountries: LoadBillingCountries,
    LoadBillingCountriesFail: LoadBillingCountriesFail,
    LoadBillingCountriesSuccess: LoadBillingCountriesSuccess,
    LOAD_CONSIGNMENT_TRACKING: LOAD_CONSIGNMENT_TRACKING,
    LOAD_CONSIGNMENT_TRACKING_FAIL: LOAD_CONSIGNMENT_TRACKING_FAIL,
    LOAD_CONSIGNMENT_TRACKING_SUCCESS: LOAD_CONSIGNMENT_TRACKING_SUCCESS,
    CLEAR_CONSIGNMENT_TRACKING: CLEAR_CONSIGNMENT_TRACKING,
    LoadConsignmentTracking: LoadConsignmentTracking,
    LoadConsignmentTrackingFail: LoadConsignmentTrackingFail,
    LoadConsignmentTrackingSuccess: LoadConsignmentTrackingSuccess,
    ClearConsignmentTracking: ClearConsignmentTracking,
    LOAD_DELIVERY_COUNTRIES: LOAD_DELIVERY_COUNTRIES,
    LOAD_DELIVERY_COUNTRIES_FAIL: LOAD_DELIVERY_COUNTRIES_FAIL,
    LOAD_DELIVERY_COUNTRIES_SUCCESS: LOAD_DELIVERY_COUNTRIES_SUCCESS,
    LoadDeliveryCountries: LoadDeliveryCountries,
    LoadDeliveryCountriesFail: LoadDeliveryCountriesFail,
    LoadDeliveryCountriesSuccess: LoadDeliveryCountriesSuccess,
    FORGOT_PASSWORD_EMAIL_REQUEST: FORGOT_PASSWORD_EMAIL_REQUEST,
    FORGOT_PASSWORD_EMAIL_REQUEST_SUCCESS: FORGOT_PASSWORD_EMAIL_REQUEST_SUCCESS,
    FORGOT_PASSWORD_EMAIL_REQUEST_FAIL: FORGOT_PASSWORD_EMAIL_REQUEST_FAIL,
    ForgotPasswordEmailRequest: ForgotPasswordEmailRequest,
    ForgotPasswordEmailRequestFail: ForgotPasswordEmailRequestFail,
    ForgotPasswordEmailRequestSuccess: ForgotPasswordEmailRequestSuccess,
    LOAD_ORDER_DETAILS: LOAD_ORDER_DETAILS,
    LOAD_ORDER_DETAILS_FAIL: LOAD_ORDER_DETAILS_FAIL,
    LOAD_ORDER_DETAILS_SUCCESS: LOAD_ORDER_DETAILS_SUCCESS,
    CLEAR_ORDER_DETAILS: CLEAR_ORDER_DETAILS,
    CANCEL_ORDER: CANCEL_ORDER,
    CANCEL_ORDER_FAIL: CANCEL_ORDER_FAIL,
    CANCEL_ORDER_SUCCESS: CANCEL_ORDER_SUCCESS,
    RESET_CANCEL_ORDER_PROCESS: RESET_CANCEL_ORDER_PROCESS,
    LoadOrderDetails: LoadOrderDetails,
    LoadOrderDetailsFail: LoadOrderDetailsFail,
    LoadOrderDetailsSuccess: LoadOrderDetailsSuccess,
    ClearOrderDetails: ClearOrderDetails,
    CancelOrder: CancelOrder,
    CancelOrderFail: CancelOrderFail,
    CancelOrderSuccess: CancelOrderSuccess,
    ResetCancelOrderProcess: ResetCancelOrderProcess,
    LOAD_USER_PAYMENT_METHODS: LOAD_USER_PAYMENT_METHODS,
    LOAD_USER_PAYMENT_METHODS_FAIL: LOAD_USER_PAYMENT_METHODS_FAIL,
    LOAD_USER_PAYMENT_METHODS_SUCCESS: LOAD_USER_PAYMENT_METHODS_SUCCESS,
    SET_DEFAULT_USER_PAYMENT_METHOD: SET_DEFAULT_USER_PAYMENT_METHOD,
    SET_DEFAULT_USER_PAYMENT_METHOD_FAIL: SET_DEFAULT_USER_PAYMENT_METHOD_FAIL,
    SET_DEFAULT_USER_PAYMENT_METHOD_SUCCESS: SET_DEFAULT_USER_PAYMENT_METHOD_SUCCESS,
    DELETE_USER_PAYMENT_METHOD: DELETE_USER_PAYMENT_METHOD,
    DELETE_USER_PAYMENT_METHOD_FAIL: DELETE_USER_PAYMENT_METHOD_FAIL,
    DELETE_USER_PAYMENT_METHOD_SUCCESS: DELETE_USER_PAYMENT_METHOD_SUCCESS,
    LoadUserPaymentMethods: LoadUserPaymentMethods,
    LoadUserPaymentMethodsFail: LoadUserPaymentMethodsFail,
    LoadUserPaymentMethodsSuccess: LoadUserPaymentMethodsSuccess,
    SetDefaultUserPaymentMethod: SetDefaultUserPaymentMethod,
    SetDefaultUserPaymentMethodFail: SetDefaultUserPaymentMethodFail,
    SetDefaultUserPaymentMethodSuccess: SetDefaultUserPaymentMethodSuccess,
    DeleteUserPaymentMethod: DeleteUserPaymentMethod,
    DeleteUserPaymentMethodFail: DeleteUserPaymentMethodFail,
    DeleteUserPaymentMethodSuccess: DeleteUserPaymentMethodSuccess,
    LOAD_REGIONS: LOAD_REGIONS,
    LOAD_REGIONS_SUCCESS: LOAD_REGIONS_SUCCESS,
    LOAD_REGIONS_FAIL: LOAD_REGIONS_FAIL,
    CLEAR_REGIONS: CLEAR_REGIONS,
    LoadRegions: LoadRegions,
    LoadRegionsFail: LoadRegionsFail,
    LoadRegionsSuccess: LoadRegionsSuccess,
    ClearRegions: ClearRegions,
    RESET_PASSWORD: RESET_PASSWORD,
    RESET_PASSWORD_SUCCESS: RESET_PASSWORD_SUCCESS,
    RESET_PASSWORD_FAIL: RESET_PASSWORD_FAIL,
    ResetPassword: ResetPassword,
    ResetPasswordFail: ResetPasswordFail,
    ResetPasswordSuccess: ResetPasswordSuccess,
    LOAD_TITLES: LOAD_TITLES,
    LOAD_TITLES_FAIL: LOAD_TITLES_FAIL,
    LOAD_TITLES_SUCCESS: LOAD_TITLES_SUCCESS,
    LoadTitles: LoadTitles,
    LoadTitlesFail: LoadTitlesFail,
    LoadTitlesSuccess: LoadTitlesSuccess,
    UPDATE_EMAIL: UPDATE_EMAIL,
    UPDATE_EMAIL_ERROR: UPDATE_EMAIL_ERROR,
    UPDATE_EMAIL_SUCCESS: UPDATE_EMAIL_SUCCESS,
    RESET_EMAIL: RESET_EMAIL,
    UpdateEmailAction: UpdateEmailAction,
    UpdateEmailSuccessAction: UpdateEmailSuccessAction,
    UpdateEmailErrorAction: UpdateEmailErrorAction,
    ResetUpdateEmailAction: ResetUpdateEmailAction,
    UPDATE_PASSWORD: UPDATE_PASSWORD,
    UPDATE_PASSWORD_FAIL: UPDATE_PASSWORD_FAIL,
    UPDATE_PASSWORD_SUCCESS: UPDATE_PASSWORD_SUCCESS,
    UPDATE_PASSWORD_RESET: UPDATE_PASSWORD_RESET,
    UpdatePassword: UpdatePassword,
    UpdatePasswordFail: UpdatePasswordFail,
    UpdatePasswordSuccess: UpdatePasswordSuccess,
    UpdatePasswordReset: UpdatePasswordReset,
    LOAD_USER_ADDRESSES: LOAD_USER_ADDRESSES,
    LOAD_USER_ADDRESSES_FAIL: LOAD_USER_ADDRESSES_FAIL,
    LOAD_USER_ADDRESSES_SUCCESS: LOAD_USER_ADDRESSES_SUCCESS,
    ADD_USER_ADDRESS: ADD_USER_ADDRESS,
    ADD_USER_ADDRESS_FAIL: ADD_USER_ADDRESS_FAIL,
    ADD_USER_ADDRESS_SUCCESS: ADD_USER_ADDRESS_SUCCESS,
    UPDATE_USER_ADDRESS: UPDATE_USER_ADDRESS,
    UPDATE_USER_ADDRESS_FAIL: UPDATE_USER_ADDRESS_FAIL,
    UPDATE_USER_ADDRESS_SUCCESS: UPDATE_USER_ADDRESS_SUCCESS,
    DELETE_USER_ADDRESS: DELETE_USER_ADDRESS,
    DELETE_USER_ADDRESS_FAIL: DELETE_USER_ADDRESS_FAIL,
    DELETE_USER_ADDRESS_SUCCESS: DELETE_USER_ADDRESS_SUCCESS,
    LoadUserAddresses: LoadUserAddresses,
    LoadUserAddressesFail: LoadUserAddressesFail,
    LoadUserAddressesSuccess: LoadUserAddressesSuccess,
    AddUserAddress: AddUserAddress,
    AddUserAddressFail: AddUserAddressFail,
    AddUserAddressSuccess: AddUserAddressSuccess,
    UpdateUserAddress: UpdateUserAddress,
    UpdateUserAddressFail: UpdateUserAddressFail,
    UpdateUserAddressSuccess: UpdateUserAddressSuccess,
    DeleteUserAddress: DeleteUserAddress,
    DeleteUserAddressFail: DeleteUserAddressFail,
    DeleteUserAddressSuccess: DeleteUserAddressSuccess,
    LOAD_USER_CONSENTS: LOAD_USER_CONSENTS,
    LOAD_USER_CONSENTS_SUCCESS: LOAD_USER_CONSENTS_SUCCESS,
    LOAD_USER_CONSENTS_FAIL: LOAD_USER_CONSENTS_FAIL,
    RESET_LOAD_USER_CONSENTS: RESET_LOAD_USER_CONSENTS,
    GIVE_USER_CONSENT: GIVE_USER_CONSENT,
    GIVE_USER_CONSENT_FAIL: GIVE_USER_CONSENT_FAIL,
    GIVE_USER_CONSENT_SUCCESS: GIVE_USER_CONSENT_SUCCESS,
    RESET_GIVE_USER_CONSENT_PROCESS: RESET_GIVE_USER_CONSENT_PROCESS,
    TRANSFER_ANONYMOUS_CONSENT: TRANSFER_ANONYMOUS_CONSENT,
    WITHDRAW_USER_CONSENT: WITHDRAW_USER_CONSENT,
    WITHDRAW_USER_CONSENT_FAIL: WITHDRAW_USER_CONSENT_FAIL,
    WITHDRAW_USER_CONSENT_SUCCESS: WITHDRAW_USER_CONSENT_SUCCESS,
    RESET_WITHDRAW_USER_CONSENT_PROCESS: RESET_WITHDRAW_USER_CONSENT_PROCESS,
    LoadUserConsents: LoadUserConsents,
    LoadUserConsentsFail: LoadUserConsentsFail,
    LoadUserConsentsSuccess: LoadUserConsentsSuccess,
    ResetLoadUserConsents: ResetLoadUserConsents,
    GiveUserConsent: GiveUserConsent,
    GiveUserConsentFail: GiveUserConsentFail,
    GiveUserConsentSuccess: GiveUserConsentSuccess,
    ResetGiveUserConsentProcess: ResetGiveUserConsentProcess,
    TransferAnonymousConsent: TransferAnonymousConsent,
    WithdrawUserConsent: WithdrawUserConsent,
    WithdrawUserConsentFail: WithdrawUserConsentFail,
    WithdrawUserConsentSuccess: WithdrawUserConsentSuccess,
    ResetWithdrawUserConsentProcess: ResetWithdrawUserConsentProcess,
    LOAD_USER_DETAILS: LOAD_USER_DETAILS,
    LOAD_USER_DETAILS_FAIL: LOAD_USER_DETAILS_FAIL,
    LOAD_USER_DETAILS_SUCCESS: LOAD_USER_DETAILS_SUCCESS,
    UPDATE_USER_DETAILS: UPDATE_USER_DETAILS,
    UPDATE_USER_DETAILS_FAIL: UPDATE_USER_DETAILS_FAIL,
    UPDATE_USER_DETAILS_SUCCESS: UPDATE_USER_DETAILS_SUCCESS,
    RESET_USER_DETAILS: RESET_USER_DETAILS,
    LoadUserDetails: LoadUserDetails,
    LoadUserDetailsFail: LoadUserDetailsFail,
    LoadUserDetailsSuccess: LoadUserDetailsSuccess,
    UpdateUserDetails: UpdateUserDetails,
    UpdateUserDetailsFail: UpdateUserDetailsFail,
    UpdateUserDetailsSuccess: UpdateUserDetailsSuccess,
    ResetUpdateUserDetails: ResetUpdateUserDetails,
    CLEAR_USER_MISCS_DATA: CLEAR_USER_MISCS_DATA,
    ClearUserMiscsData: ClearUserMiscsData,
    LOAD_USER_ORDERS: LOAD_USER_ORDERS,
    LOAD_USER_ORDERS_FAIL: LOAD_USER_ORDERS_FAIL,
    LOAD_USER_ORDERS_SUCCESS: LOAD_USER_ORDERS_SUCCESS,
    CLEAR_USER_ORDERS: CLEAR_USER_ORDERS,
    LoadUserOrders: LoadUserOrders,
    LoadUserOrdersFail: LoadUserOrdersFail,
    LoadUserOrdersSuccess: LoadUserOrdersSuccess,
    ClearUserOrders: ClearUserOrders,
    REGISTER_USER: REGISTER_USER,
    REGISTER_USER_FAIL: REGISTER_USER_FAIL,
    REGISTER_USER_SUCCESS: REGISTER_USER_SUCCESS,
    RESET_REGISTER_USER_PROCESS: RESET_REGISTER_USER_PROCESS,
    REGISTER_GUEST: REGISTER_GUEST,
    REGISTER_GUEST_FAIL: REGISTER_GUEST_FAIL,
    REGISTER_GUEST_SUCCESS: REGISTER_GUEST_SUCCESS,
    REMOVE_USER: REMOVE_USER,
    REMOVE_USER_FAIL: REMOVE_USER_FAIL,
    REMOVE_USER_SUCCESS: REMOVE_USER_SUCCESS,
    REMOVE_USER_RESET: REMOVE_USER_RESET,
    RegisterUser: RegisterUser,
    RegisterUserFail: RegisterUserFail,
    RegisterUserSuccess: RegisterUserSuccess,
    ResetRegisterUserProcess: ResetRegisterUserProcess,
    RegisterGuest: RegisterGuest,
    RegisterGuestFail: RegisterGuestFail,
    RegisterGuestSuccess: RegisterGuestSuccess,
    RemoveUser: RemoveUser,
    RemoveUserFail: RemoveUserFail,
    RemoveUserSuccess: RemoveUserSuccess,
    RemoveUserReset: RemoveUserReset,
    LOAD_CUSTOMER_COUPONS: LOAD_CUSTOMER_COUPONS,
    LOAD_CUSTOMER_COUPONS_FAIL: LOAD_CUSTOMER_COUPONS_FAIL,
    LOAD_CUSTOMER_COUPONS_SUCCESS: LOAD_CUSTOMER_COUPONS_SUCCESS,
    RESET_LOAD_CUSTOMER_COUPONS: RESET_LOAD_CUSTOMER_COUPONS,
    SUBSCRIBE_CUSTOMER_COUPON: SUBSCRIBE_CUSTOMER_COUPON,
    SUBSCRIBE_CUSTOMER_COUPON_FAIL: SUBSCRIBE_CUSTOMER_COUPON_FAIL,
    SUBSCRIBE_CUSTOMER_COUPON_SUCCESS: SUBSCRIBE_CUSTOMER_COUPON_SUCCESS,
    RESET_SUBSCRIBE_CUSTOMER_COUPON_PROCESS: RESET_SUBSCRIBE_CUSTOMER_COUPON_PROCESS,
    UNSUBSCRIBE_CUSTOMER_COUPON: UNSUBSCRIBE_CUSTOMER_COUPON,
    UNSUBSCRIBE_CUSTOMER_COUPON_FAIL: UNSUBSCRIBE_CUSTOMER_COUPON_FAIL,
    UNSUBSCRIBE_CUSTOMER_COUPON_SUCCESS: UNSUBSCRIBE_CUSTOMER_COUPON_SUCCESS,
    RESET_UNSUBSCRIBE_CUSTOMER_COUPON_PROCESS: RESET_UNSUBSCRIBE_CUSTOMER_COUPON_PROCESS,
    CLAIM_CUSTOMER_COUPON: CLAIM_CUSTOMER_COUPON,
    CLAIM_CUSTOMER_COUPON_FAIL: CLAIM_CUSTOMER_COUPON_FAIL,
    CLAIM_CUSTOMER_COUPON_SUCCESS: CLAIM_CUSTOMER_COUPON_SUCCESS,
    LoadCustomerCoupons: LoadCustomerCoupons,
    LoadCustomerCouponsFail: LoadCustomerCouponsFail,
    LoadCustomerCouponsSuccess: LoadCustomerCouponsSuccess,
    ResetLoadCustomerCoupons: ResetLoadCustomerCoupons,
    SubscribeCustomerCoupon: SubscribeCustomerCoupon,
    SubscribeCustomerCouponFail: SubscribeCustomerCouponFail,
    SubscribeCustomerCouponSuccess: SubscribeCustomerCouponSuccess,
    ResetSubscribeCustomerCouponProcess: ResetSubscribeCustomerCouponProcess,
    UnsubscribeCustomerCoupon: UnsubscribeCustomerCoupon,
    UnsubscribeCustomerCouponFail: UnsubscribeCustomerCouponFail,
    UnsubscribeCustomerCouponSuccess: UnsubscribeCustomerCouponSuccess,
    ResetUnsubscribeCustomerCouponProcess: ResetUnsubscribeCustomerCouponProcess,
    ClaimCustomerCoupon: ClaimCustomerCoupon,
    ClaimCustomerCouponFail: ClaimCustomerCouponFail,
    ClaimCustomerCouponSuccess: ClaimCustomerCouponSuccess,
    LOAD_NOTIFICATION_PREFERENCES: LOAD_NOTIFICATION_PREFERENCES,
    LOAD_NOTIFICATION_PREFERENCES_FAIL: LOAD_NOTIFICATION_PREFERENCES_FAIL,
    LOAD_NOTIFICATION_PREFERENCES_SUCCESS: LOAD_NOTIFICATION_PREFERENCES_SUCCESS,
    UPDATE_NOTIFICATION_PREFERENCES: UPDATE_NOTIFICATION_PREFERENCES,
    UPDATE_NOTIFICATION_PREFERENCES_FAIL: UPDATE_NOTIFICATION_PREFERENCES_FAIL,
    UPDATE_NOTIFICATION_PREFERENCES_SUCCESS: UPDATE_NOTIFICATION_PREFERENCES_SUCCESS,
    RESET_NOTIFICATION_PREFERENCES: RESET_NOTIFICATION_PREFERENCES,
    CLEAR_NOTIFICATION_PREFERENCES: CLEAR_NOTIFICATION_PREFERENCES,
    LoadNotificationPreferences: LoadNotificationPreferences,
    LoadNotificationPreferencesFail: LoadNotificationPreferencesFail,
    LoadNotificationPreferencesSuccess: LoadNotificationPreferencesSuccess,
    UpdateNotificationPreferences: UpdateNotificationPreferences,
    UpdateNotificationPreferencesFail: UpdateNotificationPreferencesFail,
    UpdateNotificationPreferencesSuccess: UpdateNotificationPreferencesSuccess,
    ResetNotificationPreferences: ResetNotificationPreferences,
    ClearNotificationPreferences: ClearNotificationPreferences,
    LOAD_PRODUCT_INTERESTS: LOAD_PRODUCT_INTERESTS,
    LOAD_PRODUCT_INTERESTS_FAIL: LOAD_PRODUCT_INTERESTS_FAIL,
    LOAD_PRODUCT_INTERESTS_SUCCESS: LOAD_PRODUCT_INTERESTS_SUCCESS,
    REMOVE_PRODUCT_INTEREST: REMOVE_PRODUCT_INTEREST,
    REMOVE_PRODUCT_INTEREST_SUCCESS: REMOVE_PRODUCT_INTEREST_SUCCESS,
    REMOVE_PRODUCT_INTEREST_FAIL: REMOVE_PRODUCT_INTEREST_FAIL,
    ADD_PRODUCT_INTEREST: ADD_PRODUCT_INTEREST,
    ADD_PRODUCT_INTEREST_FAIL: ADD_PRODUCT_INTEREST_FAIL,
    ADD_PRODUCT_INTEREST_SUCCESS: ADD_PRODUCT_INTEREST_SUCCESS,
    ADD_PRODUCT_INTEREST_RESET: ADD_PRODUCT_INTEREST_RESET,
    REMOVE_PRODUCT_INTEREST_RESET: REMOVE_PRODUCT_INTEREST_RESET,
    CLEAR_PRODUCT_INTERESTS: CLEAR_PRODUCT_INTERESTS,
    LoadProductInterests: LoadProductInterests,
    LoadProductInterestsFail: LoadProductInterestsFail,
    LoadProductInterestsSuccess: LoadProductInterestsSuccess,
    RemoveProductInterest: RemoveProductInterest,
    RemoveProductInterestSuccess: RemoveProductInterestSuccess,
    RemoveProductInterestFail: RemoveProductInterestFail,
    AddProductInterest: AddProductInterest,
    AddProductInterestSuccess: AddProductInterestSuccess,
    AddProductInterestFail: AddProductInterestFail,
    ResetAddInterestState: ResetAddInterestState,
    ResetRemoveInterestState: ResetRemoveInterestState,
    ClearProductInterests: ClearProductInterests,
    CREATE_ORDER_RETURN_REQUEST: CREATE_ORDER_RETURN_REQUEST,
    CREATE_ORDER_RETURN_REQUEST_FAIL: CREATE_ORDER_RETURN_REQUEST_FAIL,
    CREATE_ORDER_RETURN_REQUEST_SUCCESS: CREATE_ORDER_RETURN_REQUEST_SUCCESS,
    LOAD_ORDER_RETURN_REQUEST: LOAD_ORDER_RETURN_REQUEST,
    LOAD_ORDER_RETURN_REQUEST_FAIL: LOAD_ORDER_RETURN_REQUEST_FAIL,
    LOAD_ORDER_RETURN_REQUEST_SUCCESS: LOAD_ORDER_RETURN_REQUEST_SUCCESS,
    CANCEL_ORDER_RETURN_REQUEST: CANCEL_ORDER_RETURN_REQUEST,
    CANCEL_ORDER_RETURN_REQUEST_FAIL: CANCEL_ORDER_RETURN_REQUEST_FAIL,
    CANCEL_ORDER_RETURN_REQUEST_SUCCESS: CANCEL_ORDER_RETURN_REQUEST_SUCCESS,
    LOAD_ORDER_RETURN_REQUEST_LIST: LOAD_ORDER_RETURN_REQUEST_LIST,
    LOAD_ORDER_RETURN_REQUEST_LIST_FAIL: LOAD_ORDER_RETURN_REQUEST_LIST_FAIL,
    LOAD_ORDER_RETURN_REQUEST_LIST_SUCCESS: LOAD_ORDER_RETURN_REQUEST_LIST_SUCCESS,
    CLEAR_ORDER_RETURN_REQUEST: CLEAR_ORDER_RETURN_REQUEST,
    CLEAR_ORDER_RETURN_REQUEST_LIST: CLEAR_ORDER_RETURN_REQUEST_LIST,
    RESET_CANCEL_RETURN_PROCESS: RESET_CANCEL_RETURN_PROCESS,
    CreateOrderReturnRequest: CreateOrderReturnRequest,
    CreateOrderReturnRequestFail: CreateOrderReturnRequestFail,
    CreateOrderReturnRequestSuccess: CreateOrderReturnRequestSuccess,
    LoadOrderReturnRequest: LoadOrderReturnRequest,
    LoadOrderReturnRequestFail: LoadOrderReturnRequestFail,
    LoadOrderReturnRequestSuccess: LoadOrderReturnRequestSuccess,
    CancelOrderReturnRequest: CancelOrderReturnRequest,
    CancelOrderReturnRequestFail: CancelOrderReturnRequestFail,
    CancelOrderReturnRequestSuccess: CancelOrderReturnRequestSuccess,
    LoadOrderReturnRequestList: LoadOrderReturnRequestList,
    LoadOrderReturnRequestListFail: LoadOrderReturnRequestListFail,
    LoadOrderReturnRequestListSuccess: LoadOrderReturnRequestListSuccess,
    ClearOrderReturnRequest: ClearOrderReturnRequest,
    ClearOrderReturnRequestList: ClearOrderReturnRequestList,
    ResetCancelReturnProcess: ResetCancelReturnProcess
});

var getUserState = createFeatureSelector(USER_FEATURE);

var ɵ0$b = function (state) { return state.billingCountries; };
var getBillingCountriesState = createSelector(getUserState, ɵ0$b);
var ɵ1$7 = function (state) { return state.entities; };
var getBillingCountriesEntites = createSelector(getBillingCountriesState, ɵ1$7);
var ɵ2$3 = function (entites) {
    return Object.keys(entites).map(function (isocode) { return entites[isocode]; });
};
var getAllBillingCountries = createSelector(getBillingCountriesEntites, ɵ2$3);

var ɵ0$c = function (state) { return state.consignmentTracking; };
var getConsignmentTrackingState = createSelector(getUserState, ɵ0$c);
var ɵ1$8 = function (state) { return state.tracking; };
var getConsignmentTracking = createSelector(getConsignmentTrackingState, ɵ1$8);

var ɵ0$d = function (state) { return state.countries; };
var getDeliveryCountriesState = createSelector(getUserState, ɵ0$d);
var ɵ1$9 = function (state) { return state.entities; };
var getDeliveryCountriesEntites = createSelector(getDeliveryCountriesState, ɵ1$9);
var ɵ2$4 = function (entites) {
    return Object.keys(entites).map(function (isocode) { return entites[isocode]; });
};
var getAllDeliveryCountries = createSelector(getDeliveryCountriesEntites, ɵ2$4);
var countrySelectorFactory = function (isocode) {
    return createSelector(getDeliveryCountriesEntites, function (entities) {
        return Object.keys(entities).length !== 0 ? entities[isocode] : null;
    });
};

var ɵ0$e = function (state) { return state.order; };
var getOrderState = createSelector(getUserState, ɵ0$e);
var ɵ1$a = function (state) {
    return loaderValueSelector(state);
};
var getOrderDetails = createSelector(getOrderState, ɵ1$a);

var ɵ0$f = function (state) { return state.orderReturn; };
var getOrderReturnRequestState = createSelector(getUserState, ɵ0$f);
var ɵ1$b = function (state) { return loaderValueSelector(state); };
var getOrderReturnRequest = createSelector(getOrderReturnRequestState, ɵ1$b);
var ɵ2$5 = function (state) { return loaderLoadingSelector(state); };
var getOrderReturnRequestLoading = createSelector(getOrderReturnRequestState, ɵ2$5);
var ɵ3$3 = function (state) {
    return loaderSuccessSelector(state) &&
        !loaderLoadingSelector(state);
};
var getOrderReturnRequestSuccess = createSelector(getOrderReturnRequestState, ɵ3$3);
var ɵ4 = function (state) { return state.orderReturnList; };
var getOrderReturnRequestListState = createSelector(getUserState, ɵ4);
var ɵ5 = function (state) {
    return loaderValueSelector(state);
};
var getOrderReturnRequestList = createSelector(getOrderReturnRequestListState, ɵ5);

var ɵ0$g = function (state) { return state.payments; };
var getPaymentMethodsState = createSelector(getUserState, ɵ0$g);
var ɵ1$c = function (state) {
    return loaderValueSelector(state);
};
var getPaymentMethods = createSelector(getPaymentMethodsState, ɵ1$c);
var ɵ2$6 = function (state) {
    return loaderLoadingSelector(state);
};
var getPaymentMethodsLoading = createSelector(getPaymentMethodsState, ɵ2$6);
var ɵ3$4 = function (state) {
    return loaderSuccessSelector(state) &&
        !loaderLoadingSelector(state);
};
var getPaymentMethodsLoadedSuccess = createSelector(getPaymentMethodsState, ɵ3$4);

var ɵ0$h = function (state) { return state.regions; };
var getRegionsLoaderState = createSelector(getUserState, ɵ0$h);
var ɵ1$d = function (state) {
    return loaderValueSelector(state).entities;
};
var getAllRegions = createSelector(getRegionsLoaderState, ɵ1$d);
var ɵ2$7 = function (state) { return ({
    loaded: loaderSuccessSelector(state),
    loading: loaderLoadingSelector(state),
    regions: loaderValueSelector(state).entities,
    country: loaderValueSelector(state).country,
}); };
var getRegionsDataAndLoading = createSelector(getRegionsLoaderState, ɵ2$7);
var ɵ3$5 = function (state) {
    return loaderValueSelector(state).country;
};
var getRegionsCountry = createSelector(getRegionsLoaderState, ɵ3$5);
var ɵ4$1 = function (state) {
    return loaderLoadingSelector(state);
};
var getRegionsLoading = createSelector(getRegionsLoaderState, ɵ4$1);
var ɵ5$1 = function (state) {
    return loaderSuccessSelector(state);
};
var getRegionsLoaded = createSelector(getRegionsLoaderState, ɵ5$1);

var ɵ0$i = function (state) { return state.resetPassword; };
var getResetPassword = createSelector(getUserState, ɵ0$i);

var ɵ0$j = function (state) { return state.titles; };
var getTitlesState = createSelector(getUserState, ɵ0$j);
var ɵ1$e = function (state) { return state.entities; };
var getTitlesEntites = createSelector(getTitlesState, ɵ1$e);
var ɵ2$8 = function (entites) {
    return Object.keys(entites).map(function (code) { return entites[code]; });
};
var getAllTitles = createSelector(getTitlesEntites, ɵ2$8);
var titleSelectorFactory = function (code) {
    return createSelector(getTitlesEntites, function (entities) {
        return Object.keys(entities).length !== 0 ? entities[code] : null;
    });
};

var ɵ0$k = function (state) { return state.addresses; };
var getAddressesLoaderState = createSelector(getUserState, ɵ0$k);
var ɵ1$f = function (state) {
    return loaderValueSelector(state);
};
var getAddresses = createSelector(getAddressesLoaderState, ɵ1$f);
var ɵ2$9 = function (state) {
    return loaderLoadingSelector(state);
};
var getAddressesLoading = createSelector(getAddressesLoaderState, ɵ2$9);
var ɵ3$6 = function (state) {
    return loaderSuccessSelector(state) &&
        !loaderLoadingSelector(state);
};
var getAddressesLoadedSuccess = createSelector(getAddressesLoaderState, ɵ3$6);

var ɵ0$l = function (state) { return state.consents; };
var getConsentsState = createSelector(getUserState, ɵ0$l);
var getConsentsValue = createSelector(getConsentsState, loaderValueSelector);
var getConsentByTemplateId = function (templateId) {
    return createSelector(getConsentsValue, function (templates) {
        return templates.find(function (template) { return template.id === templateId; });
    });
};
var getConsentsLoading = createSelector(getConsentsState, loaderLoadingSelector);
var getConsentsSuccess = createSelector(getConsentsState, loaderSuccessSelector);
var getConsentsError = createSelector(getConsentsState, loaderErrorSelector);

var ɵ0$m = function (state) { return state.account; };
var getDetailsState = createSelector(getUserState, ɵ0$m);
var ɵ1$g = function (state) { return state.details; };
var getDetails = createSelector(getDetailsState, ɵ1$g);

var ɵ0$n = function (state) { return state.orders; };
var getOrdersState = createSelector(getUserState, ɵ0$n);
var ɵ1$h = function (state) {
    return loaderSuccessSelector(state);
};
var getOrdersLoaded = createSelector(getOrdersState, ɵ1$h);
var ɵ2$a = function (state) {
    return loaderValueSelector(state);
};
var getOrders = createSelector(getOrdersState, ɵ2$a);

var ɵ0$o = function (state) { return state.customerCoupons; };
var getCustomerCouponsState = createSelector(getUserState, ɵ0$o);
var ɵ1$i = function (state) {
    return loaderSuccessSelector(state);
};
var getCustomerCouponsLoaded = createSelector(getCustomerCouponsState, ɵ1$i);
var ɵ2$b = function (state) {
    return loaderLoadingSelector(state);
};
var getCustomerCouponsLoading = createSelector(getCustomerCouponsState, ɵ2$b);
var ɵ3$7 = function (state) { return loaderValueSelector(state); };
var getCustomerCoupons = createSelector(getCustomerCouponsState, ɵ3$7);

var ɵ0$p = function (state) { return state.notificationPreferences; };
var getPreferencesLoaderState = createSelector(getUserState, ɵ0$p);
var ɵ1$j = function (state) { return loaderValueSelector(state); };
var getPreferences = createSelector(getPreferencesLoaderState, ɵ1$j);
var ɵ2$c = function (state) {
    return loaderValueSelector(state).filter(function (p) { return p.enabled; });
};
var getEnabledPreferences = createSelector(getPreferencesLoaderState, ɵ2$c);
var ɵ3$8 = function (state) { return loaderLoadingSelector(state); };
var getPreferencesLoading = createSelector(getPreferencesLoaderState, ɵ3$8);

var ɵ0$q = function (state) { return state.productInterests; };
var getInterestsState = createSelector(getUserState, ɵ0$q);
var ɵ1$k = function (state) {
    return loaderValueSelector(state);
};
var getInterests = createSelector(getInterestsState, ɵ1$k);
var ɵ2$d = function (state) {
    return loaderLoadingSelector(state);
};
var getInterestsLoading = createSelector(getInterestsState, ɵ2$d);



var usersGroup_selectors = /*#__PURE__*/Object.freeze({
    __proto__: null,
    getBillingCountriesState: getBillingCountriesState,
    getBillingCountriesEntites: getBillingCountriesEntites,
    getAllBillingCountries: getAllBillingCountries,
    ɵ0: ɵ0$b,
    ɵ1: ɵ1$7,
    ɵ2: ɵ2$3,
    getConsignmentTrackingState: getConsignmentTrackingState,
    getConsignmentTracking: getConsignmentTracking,
    getDeliveryCountriesState: getDeliveryCountriesState,
    getDeliveryCountriesEntites: getDeliveryCountriesEntites,
    getAllDeliveryCountries: getAllDeliveryCountries,
    countrySelectorFactory: countrySelectorFactory,
    getUserState: getUserState,
    getOrderState: getOrderState,
    getOrderDetails: getOrderDetails,
    getOrderReturnRequestState: getOrderReturnRequestState,
    getOrderReturnRequest: getOrderReturnRequest,
    getOrderReturnRequestLoading: getOrderReturnRequestLoading,
    getOrderReturnRequestSuccess: getOrderReturnRequestSuccess,
    getOrderReturnRequestListState: getOrderReturnRequestListState,
    getOrderReturnRequestList: getOrderReturnRequestList,
    ɵ3: ɵ3$3,
    ɵ4: ɵ4,
    ɵ5: ɵ5,
    getPaymentMethodsState: getPaymentMethodsState,
    getPaymentMethods: getPaymentMethods,
    getPaymentMethodsLoading: getPaymentMethodsLoading,
    getPaymentMethodsLoadedSuccess: getPaymentMethodsLoadedSuccess,
    getRegionsLoaderState: getRegionsLoaderState,
    getAllRegions: getAllRegions,
    getRegionsDataAndLoading: getRegionsDataAndLoading,
    getRegionsCountry: getRegionsCountry,
    getRegionsLoading: getRegionsLoading,
    getRegionsLoaded: getRegionsLoaded,
    getResetPassword: getResetPassword,
    getTitlesState: getTitlesState,
    getTitlesEntites: getTitlesEntites,
    getAllTitles: getAllTitles,
    titleSelectorFactory: titleSelectorFactory,
    getAddressesLoaderState: getAddressesLoaderState,
    getAddresses: getAddresses,
    getAddressesLoading: getAddressesLoading,
    getAddressesLoadedSuccess: getAddressesLoadedSuccess,
    getConsentsState: getConsentsState,
    getConsentsValue: getConsentsValue,
    getConsentByTemplateId: getConsentByTemplateId,
    getConsentsLoading: getConsentsLoading,
    getConsentsSuccess: getConsentsSuccess,
    getConsentsError: getConsentsError,
    getDetailsState: getDetailsState,
    getDetails: getDetails,
    getOrdersState: getOrdersState,
    getOrdersLoaded: getOrdersLoaded,
    getOrders: getOrders,
    getCustomerCouponsState: getCustomerCouponsState,
    getCustomerCouponsLoaded: getCustomerCouponsLoaded,
    getCustomerCouponsLoading: getCustomerCouponsLoading,
    getCustomerCoupons: getCustomerCoupons,
    getPreferencesLoaderState: getPreferencesLoaderState,
    getPreferences: getPreferences,
    getEnabledPreferences: getEnabledPreferences,
    getPreferencesLoading: getPreferencesLoading,
    getInterestsState: getInterestsState,
    getInterests: getInterests,
    getInterestsLoading: getInterestsLoading
});

var UserConsentService = /** @class */ (function () {
    function UserConsentService(store, authService) {
        this.store = store;
        this.authService = authService;
    }
    /**
     * Retrieves all consents.
     */
    UserConsentService.prototype.loadConsents = function () {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new LoadUserConsents(userId));
        });
    };
    /**
     * Returns all consent templates. If `loadIfMissing` parameter is set to `true`, the method triggers the load if consent templates.
     * @param loadIfMissing is set to `true`, the method will load templates if those are not already present. The default value is `false`.
     */
    UserConsentService.prototype.getConsents = function (loadIfMissing) {
        var _this = this;
        if (loadIfMissing === void 0) { loadIfMissing = false; }
        return iif(function () { return loadIfMissing; }, this.store.pipe(select(getConsentsValue), withLatestFrom(this.getConsentsResultLoading(), this.getConsentsResultSuccess()), filter(function (_a) {
            var _b = __read(_a, 3), _templates = _b[0], loading = _b[1], _success = _b[2];
            return !loading;
        }), tap(function (_a) {
            var _b = __read(_a, 3), templates = _b[0], _loading = _b[1], success = _b[2];
            if (!templates || templates.length === 0) {
                // avoid infite loop - if we've already attempted to load templates and we got an empty array as the response
                if (!success) {
                    _this.loadConsents();
                }
            }
        }), filter(function (_a) {
            var _b = __read(_a, 2), templates = _b[0], _loading = _b[1];
            return Boolean(templates);
        }), map(function (_a) {
            var _b = __read(_a, 2), templates = _b[0], _loading = _b[1];
            return templates;
        })), this.store.pipe(select(getConsentsValue)));
    };
    /**
     * Returns the consents loading flag
     */
    UserConsentService.prototype.getConsentsResultLoading = function () {
        return this.store.pipe(select(getConsentsLoading));
    };
    /**
     * Returns the consents success flag
     */
    UserConsentService.prototype.getConsentsResultSuccess = function () {
        return this.store.pipe(select(getConsentsSuccess));
    };
    /**
     * Returns the consents error flag
     */
    UserConsentService.prototype.getConsentsResultError = function () {
        return this.store.pipe(select(getConsentsError));
    };
    /**
     * Resets the processing state for consent retrieval
     */
    UserConsentService.prototype.resetConsentsProcessState = function () {
        this.store.dispatch(new ResetLoadUserConsents());
    };
    /**
     * Returns the registered consent for the given template ID.
     *
     * As a side-effect, the method will call `getConsents(true)` to load the templates if those are not present.
     *
     * @param templateId a template ID by which to filter the registered templates.
     */
    UserConsentService.prototype.getConsent = function (templateId) {
        var _this = this;
        return this.authService.isUserLoggedIn().pipe(filter(Boolean), tap(function () { return _this.getConsents(true); }), switchMap(function () {
            return _this.store.pipe(select(getConsentByTemplateId(templateId)));
        }), filter(function (template) { return Boolean(template); }), map(function (template) { return template.currentConsent; }));
    };
    /**
     * Returns `true` if the consent is truthy and if `consentWithdrawnDate` doesn't exist.
     * Otherwise, `false` is returned.
     *
     * @param consent to check
     */
    UserConsentService.prototype.isConsentGiven = function (consent) {
        return (Boolean(consent) &&
            Boolean(consent.consentGivenDate) &&
            !Boolean(consent.consentWithdrawnDate));
    };
    /**
     * Returns `true` if the consent is either falsy or if `consentWithdrawnDate` is present.
     * Otherwise, `false` is returned.
     *
     * @param consent to check
     */
    UserConsentService.prototype.isConsentWithdrawn = function (consent) {
        if (Boolean(consent)) {
            return Boolean(consent.consentWithdrawnDate);
        }
        return true;
    };
    /**
     * Give consent for specified consent template ID and version.
     * @param consentTemplateId a template ID for which to give a consent
     * @param consentTemplateVersion a template version for which to give a consent
     */
    UserConsentService.prototype.giveConsent = function (consentTemplateId, consentTemplateVersion) {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new GiveUserConsent({
                userId: userId,
                consentTemplateId: consentTemplateId,
                consentTemplateVersion: consentTemplateVersion,
            }));
        });
    };
    /**
     * Returns the give consent process loading flag
     */
    UserConsentService.prototype.getGiveConsentResultLoading = function () {
        return this.store.pipe(select(getProcessLoadingFactory(GIVE_CONSENT_PROCESS_ID)));
    };
    /**
     * Returns the give consent process success flag
     */
    UserConsentService.prototype.getGiveConsentResultSuccess = function () {
        return this.store.pipe(select(getProcessSuccessFactory(GIVE_CONSENT_PROCESS_ID)));
    };
    /**
     * Returns the give consent process error flag
     */
    UserConsentService.prototype.getGiveConsentResultError = function () {
        return this.store.pipe(select(getProcessErrorFactory(GIVE_CONSENT_PROCESS_ID)));
    };
    /**
     * Resents the give consent process flags
     */
    UserConsentService.prototype.resetGiveConsentProcessState = function () {
        return this.store.dispatch(new ResetGiveUserConsentProcess());
    };
    /**
     * Withdraw consent for the given `consentCode`
     * @param consentCode for which to withdraw the consent
     */
    UserConsentService.prototype.withdrawConsent = function (consentCode) {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new WithdrawUserConsent({
                userId: userId,
                consentCode: consentCode,
            }));
        });
    };
    /**
     * Returns the withdraw consent process loading flag
     */
    UserConsentService.prototype.getWithdrawConsentResultLoading = function () {
        return this.store.pipe(select(getProcessLoadingFactory(WITHDRAW_CONSENT_PROCESS_ID)));
    };
    /**
     * Returns the withdraw consent process success flag
     */
    UserConsentService.prototype.getWithdrawConsentResultSuccess = function () {
        return this.store.pipe(select(getProcessSuccessFactory(WITHDRAW_CONSENT_PROCESS_ID)));
    };
    /**
     * Returns the withdraw consent process error flag
     */
    UserConsentService.prototype.getWithdrawConsentResultError = function () {
        return this.store.pipe(select(getProcessErrorFactory(WITHDRAW_CONSENT_PROCESS_ID)));
    };
    /**
     * Resets the process flags for withdraw consent
     */
    UserConsentService.prototype.resetWithdrawConsentProcessState = function () {
        return this.store.dispatch(new ResetWithdrawUserConsentProcess());
    };
    /**
     * Filters the provided `templateList`' templates by hiding the template IDs specified in `hideTemplateIds`.
     * If the `hideTemplateIds` is empty, the provided `templateList` is returned.
     *
     * @param templateList a list of consent templates to filter
     * @param hideTemplateIds template IDs to hide
     */
    UserConsentService.prototype.filterConsentTemplates = function (templateList, hideTemplateIds) {
        var e_1, _a;
        if (hideTemplateIds === void 0) { hideTemplateIds = []; }
        if (hideTemplateIds.length === 0) {
            return templateList;
        }
        var updatedTemplateList = [];
        try {
            for (var templateList_1 = __values(templateList), templateList_1_1 = templateList_1.next(); !templateList_1_1.done; templateList_1_1 = templateList_1.next()) {
                var template = templateList_1_1.value;
                var show = !hideTemplateIds.includes(template.id);
                if (show) {
                    updatedTemplateList.push(template);
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (templateList_1_1 && !templateList_1_1.done && (_a = templateList_1.return)) _a.call(templateList_1);
            }
            finally { if (e_1) throw e_1.error; }
        }
        return updatedTemplateList;
    };
    UserConsentService.ctorParameters = function () { return [
        { type: Store },
        { type: AuthService }
    ]; };
    UserConsentService.ɵprov = ɵɵdefineInjectable({ factory: function UserConsentService_Factory() { return new UserConsentService(ɵɵinject(Store), ɵɵinject(AuthService)); }, token: UserConsentService, providedIn: "root" });
    UserConsentService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], UserConsentService);
    return UserConsentService;
}());

var AnonymousConsentTemplatesConnector = /** @class */ (function () {
    function AnonymousConsentTemplatesConnector(adapter) {
        this.adapter = adapter;
    }
    AnonymousConsentTemplatesConnector.prototype.loadAnonymousConsentTemplates = function () {
        return this.adapter.loadAnonymousConsentTemplates();
    };
    AnonymousConsentTemplatesConnector.ctorParameters = function () { return [
        { type: AnonymousConsentTemplatesAdapter }
    ]; };
    AnonymousConsentTemplatesConnector.ɵprov = ɵɵdefineInjectable({ factory: function AnonymousConsentTemplatesConnector_Factory() { return new AnonymousConsentTemplatesConnector(ɵɵinject(AnonymousConsentTemplatesAdapter)); }, token: AnonymousConsentTemplatesConnector, providedIn: "root" });
    AnonymousConsentTemplatesConnector = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], AnonymousConsentTemplatesConnector);
    return AnonymousConsentTemplatesConnector;
}());

var AnonymousConsentsEffects = /** @class */ (function () {
    function AnonymousConsentsEffects(actions$, anonymousConsentTemplatesConnector, authService, anonymousConsentsConfig, anonymousConsentService, userConsentService) {
        var _this = this;
        this.actions$ = actions$;
        this.anonymousConsentTemplatesConnector = anonymousConsentTemplatesConnector;
        this.authService = authService;
        this.anonymousConsentsConfig = anonymousConsentsConfig;
        this.anonymousConsentService = anonymousConsentService;
        this.userConsentService = userConsentService;
        this.loadAnonymousConsentTemplates$ = this.actions$.pipe(ofType(LOAD_ANONYMOUS_CONSENT_TEMPLATES), concatMap(function () {
            return _this.anonymousConsentTemplatesConnector
                .loadAnonymousConsentTemplates()
                .pipe(withLatestFrom(_this.anonymousConsentService.getTemplates()), mergeMap(function (_a) {
                var _b = __read(_a, 2), newConsentTemplates = _b[0], currentConsentTemplates = _b[1];
                var updated = false;
                if (Boolean(currentConsentTemplates) &&
                    currentConsentTemplates.length !== 0) {
                    updated = _this.anonymousConsentService.detectUpdatedTemplates(currentConsentTemplates, newConsentTemplates);
                }
                return [
                    new LoadAnonymousConsentTemplatesSuccess(newConsentTemplates),
                    new ToggleAnonymousConsentTemplatesUpdated(updated),
                ];
            }), catchError(function (error) {
                return of(new LoadAnonymousConsentTemplatesFail(makeErrorSerializable(error)));
            }));
        }));
        this.transferAnonymousConsentsToUser$ = this.actions$.pipe(ofType(LOAD_USER_TOKEN_SUCCESS), filter(function () { return Boolean(_this.anonymousConsentsConfig.anonymousConsents); }), withLatestFrom(this.actions$.pipe(ofType(REGISTER_USER_SUCCESS))), filter(function (_a) {
            var _b = __read(_a, 2), registerAction = _b[1];
            return Boolean(registerAction);
        }), switchMap(function () {
            return _this.anonymousConsentService.getConsents().pipe(withLatestFrom(_this.authService.getOccUserId(), _this.anonymousConsentService.getTemplates(), _this.authService.isUserLoggedIn()), filter(function (_a) {
                var _b = __read(_a, 4), loggedIn = _b[3];
                return loggedIn;
            }), concatMap(function (_a) {
                var e_1, _b, e_2, _c;
                var _d = __read(_a, 4), consents = _d[0], userId = _d[1], templates = _d[2], _loggedIn = _d[3];
                var actions = [];
                try {
                    for (var consents_1 = __values(consents), consents_1_1 = consents_1.next(); !consents_1_1.done; consents_1_1 = consents_1.next()) {
                        var consent = consents_1_1.value;
                        if (_this.anonymousConsentService.isConsentGiven(consent) &&
                            (!_this.anonymousConsentsConfig.anonymousConsents
                                .requiredConsents ||
                                !_this.anonymousConsentsConfig.anonymousConsents.requiredConsents.includes(consent.templateCode))) {
                            try {
                                for (var templates_1 = (e_2 = void 0, __values(templates)), templates_1_1 = templates_1.next(); !templates_1_1.done; templates_1_1 = templates_1.next()) {
                                    var template = templates_1_1.value;
                                    if (template.id === consent.templateCode) {
                                        actions.push(new TransferAnonymousConsent({
                                            userId: userId,
                                            consentTemplateId: template.id,
                                            consentTemplateVersion: template.version,
                                        }));
                                        break;
                                    }
                                }
                            }
                            catch (e_2_1) { e_2 = { error: e_2_1 }; }
                            finally {
                                try {
                                    if (templates_1_1 && !templates_1_1.done && (_c = templates_1.return)) _c.call(templates_1);
                                }
                                finally { if (e_2) throw e_2.error; }
                            }
                        }
                    }
                }
                catch (e_1_1) { e_1 = { error: e_1_1 }; }
                finally {
                    try {
                        if (consents_1_1 && !consents_1_1.done && (_b = consents_1.return)) _b.call(consents_1);
                    }
                    finally { if (e_1) throw e_1.error; }
                }
                if (actions.length > 0) {
                    return actions;
                }
                return EMPTY;
            }));
        }));
        this.giveRequiredConsentsToUser$ = this.actions$.pipe(ofType(LOAD_USER_TOKEN_SUCCESS), filter(function (action) {
            return Boolean(_this.anonymousConsentsConfig.anonymousConsents) &&
                Boolean(_this.anonymousConsentsConfig.anonymousConsents.requiredConsents) &&
                Boolean(action);
        }), concatMap(function () {
            return _this.userConsentService.getConsentsResultSuccess().pipe(withLatestFrom(_this.authService.getOccUserId(), _this.userConsentService.getConsents(), _this.authService.isUserLoggedIn()), filter(function (_a) {
                var _b = __read(_a, 4), loggedIn = _b[3];
                return loggedIn;
            }), tap(function (_a) {
                var _b = __read(_a, 4), loaded = _b[0], _userId = _b[1], _templates = _b[2], _loggedIn = _b[3];
                if (!loaded) {
                    _this.userConsentService.loadConsents();
                }
            }), map(function (_a) {
                var _b = __read(_a, 4), _loaded = _b[0], userId = _b[1], templates = _b[2], _loggedIn = _b[3];
                return { userId: userId, templates: templates };
            }), concatMap(function (_a) {
                var e_3, _b;
                var userId = _a.userId, templates = _a.templates;
                var actions = [];
                try {
                    for (var templates_2 = __values(templates), templates_2_1 = templates_2.next(); !templates_2_1.done; templates_2_1 = templates_2.next()) {
                        var template = templates_2_1.value;
                        if (_this.userConsentService.isConsentWithdrawn(template.currentConsent) &&
                            _this.anonymousConsentsConfig.anonymousConsents.requiredConsents.includes(template.id)) {
                            actions.push(new GiveUserConsent({
                                userId: userId,
                                consentTemplateId: template.id,
                                consentTemplateVersion: template.version,
                            }));
                        }
                    }
                }
                catch (e_3_1) { e_3 = { error: e_3_1 }; }
                finally {
                    try {
                        if (templates_2_1 && !templates_2_1.done && (_b = templates_2.return)) _b.call(templates_2);
                    }
                    finally { if (e_3) throw e_3.error; }
                }
                if (actions.length > 0) {
                    return actions;
                }
                return EMPTY;
            }));
        }));
    }
    AnonymousConsentsEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: AnonymousConsentTemplatesConnector },
        { type: AuthService },
        { type: AnonymousConsentsConfig },
        { type: AnonymousConsentsService },
        { type: UserConsentService }
    ]; };
    __decorate([
        Effect()
    ], AnonymousConsentsEffects.prototype, "loadAnonymousConsentTemplates$", void 0);
    __decorate([
        Effect()
    ], AnonymousConsentsEffects.prototype, "transferAnonymousConsentsToUser$", void 0);
    __decorate([
        Effect()
    ], AnonymousConsentsEffects.prototype, "giveRequiredConsentsToUser$", void 0);
    AnonymousConsentsEffects = __decorate([
        Injectable()
    ], AnonymousConsentsEffects);
    return AnonymousConsentsEffects;
}());

var effects$1 = [AnonymousConsentsEffects];

var SiteConnector = /** @class */ (function () {
    function SiteConnector(adapter) {
        this.adapter = adapter;
    }
    SiteConnector.prototype.getLanguages = function () {
        return this.adapter.loadLanguages();
    };
    SiteConnector.prototype.getCurrencies = function () {
        return this.adapter.loadCurrencies();
    };
    SiteConnector.prototype.getCountries = function (type) {
        return this.adapter.loadCountries(type);
    };
    SiteConnector.prototype.getRegions = function (countryIsoCode) {
        return this.adapter.loadRegions(countryIsoCode);
    };
    SiteConnector.prototype.getBaseSite = function () {
        return this.adapter.loadBaseSite();
    };
    SiteConnector.ctorParameters = function () { return [
        { type: SiteAdapter }
    ]; };
    SiteConnector.ɵprov = ɵɵdefineInjectable({ factory: function SiteConnector_Factory() { return new SiteConnector(ɵɵinject(SiteAdapter)); }, token: SiteConnector, providedIn: "root" });
    SiteConnector = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], SiteConnector);
    return SiteConnector;
}());

var ContextServiceMap = /** @class */ (function () {
    function ContextServiceMap() {
    }
    return ContextServiceMap;
}());
function serviceMapFactory() {
    var _a;
    return _a = {},
        _a[LANGUAGE_CONTEXT_ID] = LanguageService,
        _a[CURRENCY_CONTEXT_ID] = CurrencyService,
        _a[BASE_SITE_CONTEXT_ID] = BaseSiteService,
        _a;
}
var contextServiceMapProvider = {
    provide: ContextServiceMap,
    useFactory: serviceMapFactory,
};

function baseSiteConfigValidator(config) {
    if (getContextParameterDefault(config, BASE_SITE_CONTEXT_ID) === undefined) {
        return 'Please configure context.parameters.baseSite before using storefront library!';
    }
}

function defaultSiteContextConfigFactory() {
    var _a;
    return {
        context: (_a = {},
            _a[LANGUAGE_CONTEXT_ID] = [
                'en',
                'de',
                'ja',
                'zh',
                'ru',
                'fr',
                'tr',
                'it',
                'es',
                'uk',
                'pl',
                'nl',
                'hi',
                'ar',
                'pt',
                'bn',
                'pa',
            ],
            _a[CURRENCY_CONTEXT_ID] = [
                'USD',
                'EUR',
                'JPY',
                'GBP',
                'AUD',
                'CAD',
                'CHF',
                'CNY',
                'SEK',
                'NZD',
                'MXN',
                'SGD',
                'HKD',
                'NOK',
                'KRW',
                'TRY',
                'RUB',
                'INR',
                'BRL',
                'ZAR',
            ],
            _a),
    };
}

/**
 * Provides support for CONFIG_INITIALIZERS
 */
var ConfigInitializerService = /** @class */ (function () {
    function ConfigInitializerService(config, initializerGuard) {
        this.config = config;
        this.initializerGuard = initializerGuard;
        this.ongoingScopes$ = new BehaviorSubject(undefined);
    }
    Object.defineProperty(ConfigInitializerService.prototype, "isStable", {
        /**
         * Returns true if config is stable, i.e. all CONFIG_INITIALIZERS resolved correctly
         */
        get: function () {
            return (!this.initializerGuard ||
                (this.ongoingScopes$.value && this.ongoingScopes$.value.length === 0));
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Recommended way to get config for code that can run before app will finish
     * initialization (APP_INITIALIZERS, selected service constructors)
     *
     * Used without parameters waits for the whole config to become stable
     *
     * Parameters allow to describe which part of the config should be stable using
     * string describing config part, e.g.:
     * 'siteContext', 'siteContext.language', etc.
     *
     * @param scopes String describing parts of the config we want to be sure are stable
     */
    ConfigInitializerService.prototype.getStableConfig = function () {
        var scopes = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            scopes[_i] = arguments[_i];
        }
        return __awaiter(this, void 0, void 0, function () {
            var _this = this;
            return __generator(this, function (_a) {
                if (this.isStable) {
                    return [2 /*return*/, this.config];
                }
                return [2 /*return*/, this.ongoingScopes$
                        .pipe(filter(function (ongoingScopes) {
                        return ongoingScopes && _this.areReady(scopes, ongoingScopes);
                    }), take(1), mapTo(this.config))
                        .toPromise()];
            });
        });
    };
    /**
     * Removes provided scopes from currently ongoingScopes
     *
     * @param scopes
     */
    ConfigInitializerService.prototype.finishScopes = function (scopes) {
        var e_1, _a;
        var newScopes = __spread(this.ongoingScopes$.value);
        try {
            for (var scopes_1 = __values(scopes), scopes_1_1 = scopes_1.next(); !scopes_1_1.done; scopes_1_1 = scopes_1.next()) {
                var scope = scopes_1_1.value;
                newScopes.splice(newScopes.indexOf(scope), 1);
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (scopes_1_1 && !scopes_1_1.done && (_a = scopes_1.return)) _a.call(scopes_1);
            }
            finally { if (e_1) throw e_1.error; }
        }
        this.ongoingScopes$.next(newScopes);
    };
    /**
     * Return true if provided scopes are not part of ongoingScopes
     *
     * @param scopes
     * @param ongoingScopes
     */
    ConfigInitializerService.prototype.areReady = function (scopes, ongoingScopes) {
        var e_2, _a, e_3, _b;
        if (!scopes.length) {
            return !ongoingScopes.length;
        }
        try {
            for (var scopes_2 = __values(scopes), scopes_2_1 = scopes_2.next(); !scopes_2_1.done; scopes_2_1 = scopes_2.next()) {
                var scope = scopes_2_1.value;
                try {
                    for (var ongoingScopes_1 = (e_3 = void 0, __values(ongoingScopes)), ongoingScopes_1_1 = ongoingScopes_1.next(); !ongoingScopes_1_1.done; ongoingScopes_1_1 = ongoingScopes_1.next()) {
                        var ongoingScope = ongoingScopes_1_1.value;
                        if (this.scopesOverlap(scope, ongoingScope)) {
                            return false;
                        }
                    }
                }
                catch (e_3_1) { e_3 = { error: e_3_1 }; }
                finally {
                    try {
                        if (ongoingScopes_1_1 && !ongoingScopes_1_1.done && (_b = ongoingScopes_1.return)) _b.call(ongoingScopes_1);
                    }
                    finally { if (e_3) throw e_3.error; }
                }
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (scopes_2_1 && !scopes_2_1.done && (_a = scopes_2.return)) _a.call(scopes_2);
            }
            finally { if (e_2) throw e_2.error; }
        }
        return true;
    };
    /**
     * Check if two scopes overlap.
     *
     * Example of scopes that overlap:
     * 'test' and 'test', 'test.a' and 'test', 'test' and 'test.a'
     *
     * Example of scopes that do not overlap:
     * 'test' and 'testA', 'test.a' and 'test.b', 'test.nested' and 'test.nest'
     *
     * @param a ScopeA
     * @param b ScopeB
     */
    ConfigInitializerService.prototype.scopesOverlap = function (a, b) {
        var _a;
        if (b.length > a.length) {
            _a = __read([b, a], 2), a = _a[0], b = _a[1];
        }
        return a.startsWith(b) && (a[b.length] || '.') === '.';
    };
    /**
     * @internal
     *
     * Not a part of a public API, used by APP_INITIALIZER to initialize all provided CONFIG_INITIALIZERS
     *
     */
    ConfigInitializerService.prototype.initialize = function (initializers) {
        return __awaiter(this, void 0, void 0, function () {
            var ongoingScopes, asyncConfigs, _loop_1, this_1, _a, _b, initializer;
            var e_4, _c;
            var _this = this;
            return __generator(this, function (_d) {
                switch (_d.label) {
                    case 0:
                        if (this.ongoingScopes$.value) {
                            // guard for double initialization
                            return [2 /*return*/];
                        }
                        ongoingScopes = [];
                        asyncConfigs = [];
                        _loop_1 = function (initializer) {
                            if (!initializer) {
                                return "continue";
                            }
                            if (!initializer.scopes || !initializer.scopes.length) {
                                throw new Error('CONFIG_INITIALIZER should provide scope!');
                            }
                            if (isDevMode() && !this_1.areReady(initializer.scopes, ongoingScopes)) {
                                console.warn('More than one CONFIG_INITIALIZER is initializing the same config scope.');
                            }
                            ongoingScopes.push.apply(ongoingScopes, __spread(initializer.scopes));
                            asyncConfigs.push((function () { return __awaiter(_this, void 0, void 0, function () {
                                var _a, _b;
                                return __generator(this, function (_c) {
                                    switch (_c.label) {
                                        case 0:
                                            _a = deepMerge;
                                            _b = [this.config];
                                            return [4 /*yield*/, initializer.configFactory()];
                                        case 1:
                                            _a.apply(void 0, _b.concat([_c.sent()]));
                                            this.finishScopes(initializer.scopes);
                                            return [2 /*return*/];
                                    }
                                });
                            }); })());
                        };
                        this_1 = this;
                        try {
                            for (_a = __values(initializers || []), _b = _a.next(); !_b.done; _b = _a.next()) {
                                initializer = _b.value;
                                _loop_1(initializer);
                            }
                        }
                        catch (e_4_1) { e_4 = { error: e_4_1 }; }
                        finally {
                            try {
                                if (_b && !_b.done && (_c = _a.return)) _c.call(_a);
                            }
                            finally { if (e_4) throw e_4.error; }
                        }
                        this.ongoingScopes$.next(ongoingScopes);
                        if (!asyncConfigs.length) return [3 /*break*/, 2];
                        return [4 /*yield*/, Promise.all(asyncConfigs)];
                    case 1:
                        _d.sent();
                        _d.label = 2;
                    case 2: return [2 /*return*/];
                }
            });
        });
    };
    ConfigInitializerService.ctorParameters = function () { return [
        { type: undefined, decorators: [{ type: Inject, args: [Config,] }] },
        { type: undefined, decorators: [{ type: Optional }, { type: Inject, args: [CONFIG_INITIALIZER_FORROOT_GUARD,] }] }
    ]; };
    ConfigInitializerService.ɵprov = ɵɵdefineInjectable({ factory: function ConfigInitializerService_Factory() { return new ConfigInitializerService(ɵɵinject(Config), ɵɵinject(CONFIG_INITIALIZER_FORROOT_GUARD, 8)); }, token: ConfigInitializerService, providedIn: "root" });
    ConfigInitializerService = __decorate([
        Injectable({
            providedIn: 'root',
        }),
        __param(0, Inject(Config)),
        __param(1, Optional()),
        __param(1, Inject(CONFIG_INITIALIZER_FORROOT_GUARD))
    ], ConfigInitializerService);
    return ConfigInitializerService;
}());

var SiteContextParamsService = /** @class */ (function () {
    function SiteContextParamsService(config, injector, serviceMap) {
        this.config = config;
        this.injector = injector;
        this.serviceMap = serviceMap;
    }
    SiteContextParamsService.prototype.getContextParameters = function () {
        if (this.config.context) {
            return Object.keys(this.config.context).filter(function (param) { return param !== 'urlParameters'; });
        }
        return [];
    };
    SiteContextParamsService.prototype.getUrlEncodingParameters = function () {
        return (this.config.context && this.config.context.urlParameters) || [];
    };
    SiteContextParamsService.prototype.getParamValues = function (param) {
        return getContextParameterValues(this.config, param);
    };
    SiteContextParamsService.prototype.getParamDefaultValue = function (param) {
        return getContextParameterDefault(this.config, param);
    };
    SiteContextParamsService.prototype.getSiteContextService = function (param) {
        if (this.serviceMap[param]) {
            return this.injector.get(this.serviceMap[param], null);
        }
    };
    SiteContextParamsService.prototype.getValue = function (param) {
        var value;
        var service = this.getSiteContextService(param);
        if (service) {
            service
                .getActive()
                .subscribe(function (val) { return (value = val); })
                .unsubscribe();
        }
        return value !== undefined ? value : this.getParamDefaultValue(param);
    };
    SiteContextParamsService.prototype.setValue = function (param, value) {
        var service = this.getSiteContextService(param);
        if (service) {
            service.setActive(value);
        }
    };
    /**
     * Get active values for all provided context parameters
     *
     * @param params Context parameters
     *
     * @returns Observable emitting array of all passed active context values
     */
    SiteContextParamsService.prototype.getValues = function (params) {
        var _this = this;
        if (params.length === 0) {
            return of([]);
        }
        return combineLatest(params.map(function (param) {
            return _this.getSiteContextService(param)
                .getActive()
                .pipe(distinctUntilChanged());
        })).pipe(filter(function (value) { return value.every(function (param) { return !!param; }); }));
    };
    SiteContextParamsService.ctorParameters = function () { return [
        { type: SiteContextConfig },
        { type: Injector },
        { type: ContextServiceMap }
    ]; };
    SiteContextParamsService = __decorate([
        Injectable()
    ], SiteContextParamsService);
    return SiteContextParamsService;
}());

var UrlSplit = /(^[^#?]*)(.*)/; // used to split url into path and query/fragment parts
var SiteContextUrlSerializer = /** @class */ (function (_super) {
    __extends(SiteContextUrlSerializer, _super);
    function SiteContextUrlSerializer(siteContextParams) {
        var _this = _super.call(this) || this;
        _this.siteContextParams = siteContextParams;
        return _this;
    }
    Object.defineProperty(SiteContextUrlSerializer.prototype, "urlEncodingParameters", {
        get: function () {
            return this.siteContextParams.getUrlEncodingParameters();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SiteContextUrlSerializer.prototype, "hasContextInRoutes", {
        get: function () {
            return this.urlEncodingParameters.length > 0;
        },
        enumerable: true,
        configurable: true
    });
    SiteContextUrlSerializer.prototype.parse = function (url) {
        if (this.hasContextInRoutes) {
            var urlWithParams = this.urlExtractContextParameters(url);
            var parsed = _super.prototype.parse.call(this, urlWithParams.url);
            this.urlTreeIncludeContextParameters(parsed, urlWithParams.params);
            return parsed;
        }
        else {
            return _super.prototype.parse.call(this, url);
        }
    };
    SiteContextUrlSerializer.prototype.urlExtractContextParameters = function (url) {
        var _a = __read(url.match(UrlSplit), 3), urlPart = _a[1], queryPart = _a[2];
        var segments = urlPart.split('/');
        if (segments[0] === '') {
            segments.shift();
        }
        var params = {};
        var paramId = 0;
        var segmentId = 0;
        while (paramId < this.urlEncodingParameters.length &&
            segmentId < segments.length) {
            var paramName = this.urlEncodingParameters[paramId];
            var paramValues = this.siteContextParams.getParamValues(paramName);
            if (paramValues.includes(segments[segmentId])) {
                params[paramName] = segments[segmentId];
                segmentId++;
            }
            paramId++;
        }
        url = segments.slice(Object.keys(params).length).join('/') + queryPart;
        return { url: url, params: params };
    };
    SiteContextUrlSerializer.prototype.urlTreeIncludeContextParameters = function (urlTree, params) {
        urlTree.siteContext = params;
    };
    SiteContextUrlSerializer.prototype.serialize = function (tree) {
        var params = this.urlTreeExtractContextParameters(tree);
        var url = _super.prototype.serialize.call(this, tree);
        var serialized = this.urlIncludeContextParameters(url, params);
        return serialized;
    };
    SiteContextUrlSerializer.prototype.urlTreeExtractContextParameters = function (urlTree) {
        return urlTree.siteContext ? urlTree.siteContext : {};
    };
    SiteContextUrlSerializer.prototype.urlIncludeContextParameters = function (url, params) {
        var _this = this;
        var contextRoutePart = this.urlEncodingParameters
            .map(function (param) {
            return params[param]
                ? params[param]
                : _this.siteContextParams.getValue(param);
        })
            .join('/');
        return contextRoutePart + url;
    };
    SiteContextUrlSerializer.ctorParameters = function () { return [
        { type: SiteContextParamsService }
    ]; };
    SiteContextUrlSerializer = __decorate([
        Injectable()
    ], SiteContextUrlSerializer);
    return SiteContextUrlSerializer;
}(DefaultUrlSerializer));

var SiteContextRoutesHandler = /** @class */ (function () {
    function SiteContextRoutesHandler(siteContextParams, serializer, injector) {
        this.siteContextParams = siteContextParams;
        this.serializer = serializer;
        this.injector = injector;
        this.subscription = new Subscription();
        this.contextValues = {};
        /**
         * Tells whether there is a pending navigation at the moment, so we can avoid an infinite loop caused by the cyclic dependency:
         * - `subscribeChanges` method triggers a navigation on update of site context state
         * - `subscribeRouting` method updates the site context state on navigation
         */
        this.isNavigating = false;
    }
    /**
     * Initializes the two-way synchronization between the site context state and the URL.
     *
     * @returns Promise that is resolved when the site context state is initialized (updated for the first time) based on the URL.
     */
    SiteContextRoutesHandler.prototype.init = function () {
        var _this = this;
        return new Promise(function (resolve) {
            _this.router = _this.injector.get(Router);
            _this.location = _this.injector.get(Location);
            var routingParams = _this.siteContextParams.getUrlEncodingParameters();
            if (routingParams.length) {
                _this.subscribeChanges(routingParams);
                _this.subscribeRouting(resolve);
            }
            else {
                resolve();
            }
        });
    };
    /**
     * After each change of the site context state, it modifies the current URL in place.
     * But it happens only for the parameters configured to be persisted in the URL.
     */
    SiteContextRoutesHandler.prototype.subscribeChanges = function (params) {
        var _this = this;
        params.forEach(function (param) {
            var service = _this.siteContextParams.getSiteContextService(param);
            if (service) {
                _this.subscription.add(service.getActive().subscribe(function (value) {
                    if (!_this.isNavigating &&
                        _this.contextValues[param] &&
                        _this.contextValues[param] !== value) {
                        var parsed = _this.router.parseUrl(_this.router.url);
                        var serialized = _this.router.serializeUrl(parsed);
                        _this.location.replaceState(serialized);
                    }
                    _this.contextValues[param] = value;
                }));
            }
        });
    };
    /**
     * After each Angular NavigationStart event it updates the site context state based on
     * site context params encoded in the anticipated URL.
     *
     * In particular, it's responsible for initializing the state of the context params
     * on page start, reading the values from the URL.
     *
     * @param onContextInitialized notify that the initialization of the context was done based on the URL
     */
    SiteContextRoutesHandler.prototype.subscribeRouting = function (onContextInitialized) {
        var _this = this;
        var contextInitialized = false;
        this.subscription.add(this.router.events
            .pipe(filter(function (event) {
            return event instanceof NavigationStart ||
                event instanceof NavigationEnd ||
                event instanceof NavigationError ||
                event instanceof NavigationCancel;
        }))
            .subscribe(function (event) {
            _this.isNavigating = event instanceof NavigationStart;
            if (_this.isNavigating) {
                _this.setContextParamsFromRoute(event.url);
                if (!contextInitialized) {
                    contextInitialized = true;
                    onContextInitialized();
                }
            }
        }));
    };
    /**
     * Updates the site context state based on the context params encoded in the given URL
     *
     * @param url URL with encoded context params
     */
    SiteContextRoutesHandler.prototype.setContextParamsFromRoute = function (url) {
        var _this = this;
        var params = this.serializer.urlExtractContextParameters(url).params;
        Object.keys(params).forEach(function (param) {
            return _this.siteContextParams.setValue(param, params[param]);
        });
    };
    SiteContextRoutesHandler.prototype.ngOnDestroy = function () {
        this.subscription.unsubscribe();
    };
    SiteContextRoutesHandler.ctorParameters = function () { return [
        { type: SiteContextParamsService },
        { type: SiteContextUrlSerializer },
        { type: Injector }
    ]; };
    SiteContextRoutesHandler.ɵprov = ɵɵdefineInjectable({ factory: function SiteContextRoutesHandler_Factory() { return new SiteContextRoutesHandler(ɵɵinject(SiteContextParamsService), ɵɵinject(SiteContextUrlSerializer), ɵɵinject(INJECTOR)); }, token: SiteContextRoutesHandler, providedIn: "root" });
    SiteContextRoutesHandler = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], SiteContextRoutesHandler);
    return SiteContextRoutesHandler;
}());

function initializeContext(baseSiteService, langService, currService, configInit, siteContextRoutesHandler) {
    return function () {
        configInit.getStableConfig('context').then(function () {
            siteContextRoutesHandler.init().then(function () {
                baseSiteService.initialize();
                langService.initialize();
                currService.initialize();
            });
        });
    };
}
var contextServiceProviders = [
    BaseSiteService,
    LanguageService,
    CurrencyService,
    {
        provide: APP_INITIALIZER,
        useFactory: initializeContext,
        deps: [
            BaseSiteService,
            LanguageService,
            CurrencyService,
            ConfigInitializerService,
            SiteContextRoutesHandler,
        ],
        multi: true,
    },
];

// functions below should not be exposed in public API:
var siteContextParamsProviders = [
    SiteContextParamsService,
    SiteContextUrlSerializer,
    { provide: UrlSerializer, useExisting: SiteContextUrlSerializer },
];

var LanguagesEffects = /** @class */ (function () {
    function LanguagesEffects(actions$, siteConnector, winRef, state) {
        var _this = this;
        this.actions$ = actions$;
        this.siteConnector = siteConnector;
        this.winRef = winRef;
        this.state = state;
        this.loadLanguages$ = this.actions$.pipe(ofType(LOAD_LANGUAGES), exhaustMap(function () {
            return _this.siteConnector.getLanguages().pipe(map(function (languages) { return new LoadLanguagesSuccess(languages); }), catchError(function (error) {
                return of(new LoadLanguagesFail(makeErrorSerializable(error)));
            }));
        }));
        this.persist$ = this.actions$.pipe(ofType(SET_ACTIVE_LANGUAGE), tap(function (action) {
            if (_this.winRef.sessionStorage) {
                _this.winRef.sessionStorage.setItem('language', action.payload);
            }
        }), switchMapTo(NEVER));
        this.activateLanguage$ = this.state.select(getActiveLanguage).pipe(bufferCount(2, 1), 
        // avoid dispatching `change` action when we're just setting the initial value:
        filter(function (_a) {
            var _b = __read(_a, 1), previous = _b[0];
            return !!previous;
        }), map(function (_a) {
            var _b = __read(_a, 2), previous = _b[0], current = _b[1];
            return new LanguageChange({ previous: previous, current: current });
        }));
    }
    LanguagesEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: SiteConnector },
        { type: WindowRef },
        { type: Store }
    ]; };
    __decorate([
        Effect()
    ], LanguagesEffects.prototype, "loadLanguages$", void 0);
    __decorate([
        Effect()
    ], LanguagesEffects.prototype, "persist$", void 0);
    __decorate([
        Effect()
    ], LanguagesEffects.prototype, "activateLanguage$", void 0);
    LanguagesEffects = __decorate([
        Injectable()
    ], LanguagesEffects);
    return LanguagesEffects;
}());

var CurrenciesEffects = /** @class */ (function () {
    function CurrenciesEffects(actions$, siteConnector, winRef, state) {
        var _this = this;
        this.actions$ = actions$;
        this.siteConnector = siteConnector;
        this.winRef = winRef;
        this.state = state;
        this.loadCurrencies$ = this.actions$.pipe(ofType(LOAD_CURRENCIES), exhaustMap(function () {
            return _this.siteConnector.getCurrencies().pipe(map(function (currencies) {
                return new LoadCurrenciesSuccess(currencies);
            }), catchError(function (error) {
                return of(new LoadCurrenciesFail(makeErrorSerializable(error)));
            }));
        }));
        this.persist$ = this.actions$.pipe(ofType(SET_ACTIVE_CURRENCY), tap(function (action) {
            if (_this.winRef.sessionStorage) {
                _this.winRef.sessionStorage.setItem('currency', action.payload);
            }
        }), switchMapTo(NEVER));
        this.activateCurrency$ = this.state.select(getActiveCurrency).pipe(bufferCount(2, 1), 
        // avoid dispatching `change` action when we're just setting the initial value:
        filter(function (_a) {
            var _b = __read(_a, 1), previous = _b[0];
            return !!previous;
        }), map(function (_a) {
            var _b = __read(_a, 2), previous = _b[0], current = _b[1];
            return new CurrencyChange({ previous: previous, current: current });
        }));
    }
    CurrenciesEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: SiteConnector },
        { type: WindowRef },
        { type: Store }
    ]; };
    __decorate([
        Effect()
    ], CurrenciesEffects.prototype, "loadCurrencies$", void 0);
    __decorate([
        Effect()
    ], CurrenciesEffects.prototype, "persist$", void 0);
    __decorate([
        Effect()
    ], CurrenciesEffects.prototype, "activateCurrency$", void 0);
    CurrenciesEffects = __decorate([
        Injectable()
    ], CurrenciesEffects);
    return CurrenciesEffects;
}());

var BaseSiteEffects = /** @class */ (function () {
    function BaseSiteEffects(actions$, siteConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.siteConnector = siteConnector;
        this.loadBaseSite$ = this.actions$.pipe(ofType(LOAD_BASE_SITE), exhaustMap(function () {
            return _this.siteConnector.getBaseSite().pipe(map(function (baseSite) { return new LoadBaseSiteSuccess(baseSite); }), catchError(function (error) {
                return of(new LoadBaseSiteFail(makeErrorSerializable(error)));
            }));
        }));
    }
    BaseSiteEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: SiteConnector }
    ]; };
    __decorate([
        Effect()
    ], BaseSiteEffects.prototype, "loadBaseSite$", void 0);
    BaseSiteEffects = __decorate([
        Injectable()
    ], BaseSiteEffects);
    return BaseSiteEffects;
}());

var effects$2 = [
    LanguagesEffects,
    CurrenciesEffects,
    BaseSiteEffects,
];

var initialState$1 = {
    details: {},
    activeSite: '',
};
function reducer$1(state, action) {
    if (state === void 0) { state = initialState$1; }
    switch (action.type) {
        case LOAD_BASE_SITE_SUCCESS: {
            return __assign(__assign({}, state), { details: action.payload });
        }
        case SET_ACTIVE_BASE_SITE: {
            return __assign(__assign({}, state), { activeSite: action.payload });
        }
    }
    return state;
}

var initialState$2 = {
    entities: null,
    activeCurrency: null,
};
function reducer$2(state, action) {
    if (state === void 0) { state = initialState$2; }
    switch (action.type) {
        case LOAD_CURRENCIES_SUCCESS: {
            var currencies = action.payload;
            var entities = currencies.reduce(function (currEntities, currency) {
                var _a;
                return __assign(__assign({}, currEntities), (_a = {}, _a[currency.isocode] = currency, _a));
            }, __assign({}, state.entities));
            return __assign(__assign({}, state), { entities: entities });
        }
        case SET_ACTIVE_CURRENCY: {
            var isocode = action.payload;
            return __assign(__assign({}, state), { activeCurrency: isocode });
        }
    }
    return state;
}

var initialState$3 = {
    entities: null,
    activeLanguage: null,
};
function reducer$3(state, action) {
    if (state === void 0) { state = initialState$3; }
    switch (action.type) {
        case LOAD_LANGUAGES_SUCCESS: {
            var languages = action.payload;
            var entities = languages.reduce(function (langEntities, language) {
                var _a;
                return __assign(__assign({}, langEntities), (_a = {}, _a[language.isocode] = language, _a));
            }, __assign({}, state.entities));
            return __assign(__assign({}, state), { entities: entities });
        }
        case SET_ACTIVE_LANGUAGE: {
            var isocode = action.payload;
            return __assign(__assign({}, state), { activeLanguage: isocode });
        }
    }
    return state;
}

function getReducers$1() {
    return {
        languages: reducer$3,
        currencies: reducer$2,
        baseSite: reducer$1,
    };
}
var reducerToken$1 = new InjectionToken('SiteContextReducers');
var reducerProvider$1 = {
    provide: reducerToken$1,
    useFactory: getReducers$1,
};

function siteContextStoreConfigFactory() {
    var _a;
    // if we want to reuse SITE_CONTEXT_FEATURE const in config, we have to use factory instead of plain object
    var config = {
        state: {
            ssrTransfer: {
                keys: (_a = {}, _a[SITE_CONTEXT_FEATURE] = StateTransferType.TRANSFER_STATE, _a),
            },
        },
    };
    return config;
}
var SiteContextStoreModule = /** @class */ (function () {
    function SiteContextStoreModule() {
    }
    SiteContextStoreModule = __decorate([
        NgModule({
            imports: [
                CommonModule,
                HttpClientModule,
                StoreModule.forFeature(SITE_CONTEXT_FEATURE, reducerToken$1),
                EffectsModule.forFeature(effects$2),
            ],
            providers: [
                provideDefaultConfigFactory(siteContextStoreConfigFactory),
                reducerProvider$1,
            ],
        })
    ], SiteContextStoreModule);
    return SiteContextStoreModule;
}());

// @dynamic
var SiteContextModule = /** @class */ (function () {
    function SiteContextModule() {
    }
    SiteContextModule_1 = SiteContextModule;
    SiteContextModule.forRoot = function () {
        return {
            ngModule: SiteContextModule_1,
            providers: __spread([
                provideDefaultConfigFactory(defaultSiteContextConfigFactory),
                contextServiceMapProvider
            ], contextServiceProviders, siteContextParamsProviders, [
                provideConfigValidator(baseSiteConfigValidator),
            ]),
        };
    };
    var SiteContextModule_1;
    SiteContextModule = SiteContextModule_1 = __decorate([
        NgModule({
            imports: [StateModule, SiteContextStoreModule],
        })
    ], SiteContextModule);
    return SiteContextModule;
}());

var initialState$4 = false;
function reducer$4(state, action) {
    if (state === void 0) { state = initialState$4; }
    switch (action.type) {
        case TOGGLE_ANONYMOUS_CONSENTS_BANNER_DISMISSED: {
            return action.dismissed;
        }
    }
    return state;
}

var initialState$5 = false;
function reducer$5(state, action) {
    if (state === void 0) { state = initialState$5; }
    switch (action.type) {
        case TOGGLE_ANONYMOUS_CONSENT_TEMPLATES_UPDATED: {
            return action.updated;
        }
    }
    return state;
}

var initialState$6 = [];
function toggleConsentStatus(consents, templateCode, status) {
    if (!consents) {
        return [];
    }
    return consents.map(function (consent) {
        if (consent.templateCode === templateCode) {
            consent = __assign(__assign({}, consent), { consentState: status });
        }
        return consent;
    });
}
function reducer$6(state, action) {
    if (state === void 0) { state = initialState$6; }
    switch (action.type) {
        case GIVE_ANONYMOUS_CONSENT: {
            return toggleConsentStatus(state, action.templateCode, ANONYMOUS_CONSENT_STATUS.GIVEN);
        }
        case WITHDRAW_ANONYMOUS_CONSENT: {
            return toggleConsentStatus(state, action.templateCode, ANONYMOUS_CONSENT_STATUS.WITHDRAWN);
        }
        case SET_ANONYMOUS_CONSENTS: {
            return action.payload;
        }
    }
    return state;
}

function getReducers$2() {
    return {
        templates: loaderReducer(ANONYMOUS_CONSENTS),
        consents: reducer$6,
        ui: combineReducers({
            bannerDismissed: reducer$4,
            updated: reducer$5,
        }),
    };
}
var reducerToken$2 = new InjectionToken('AnonymousConsentsReducers');
var reducerProvider$2 = {
    provide: reducerToken$2,
    useFactory: getReducers$2,
};
function clearAnonymousConsentTemplates(reducer) {
    return function (state, action) {
        if (action.type === LOGOUT ||
            action.type === LANGUAGE_CHANGE) {
            state = __assign(__assign({}, state), { templates: undefined });
        }
        return reducer(state, action);
    };
}
var metaReducers$1 = [
    clearAnonymousConsentTemplates,
];

function anonymousConsentsStoreConfigFactory() {
    var _a;
    var config = {
        state: {
            storageSync: {
                keys: (_a = {},
                    _a[ANONYMOUS_CONSENTS_STORE_FEATURE] = StorageSyncType.LOCAL_STORAGE,
                    _a),
            },
        },
    };
    return config;
}
var AnonymousConsentsStoreModule = /** @class */ (function () {
    function AnonymousConsentsStoreModule() {
    }
    AnonymousConsentsStoreModule = __decorate([
        NgModule({
            imports: [
                CommonModule,
                StateModule,
                StoreModule.forFeature(ANONYMOUS_CONSENTS_STORE_FEATURE, reducerToken$2, {
                    metaReducers: metaReducers$1,
                }),
                EffectsModule.forFeature(effects$1),
            ],
            providers: [
                provideDefaultConfigFactory(anonymousConsentsStoreConfigFactory),
                reducerProvider$2,
            ],
        })
    ], AnonymousConsentsStoreModule);
    return AnonymousConsentsStoreModule;
}());

var AnonymousConsentsModule = /** @class */ (function () {
    function AnonymousConsentsModule() {
    }
    AnonymousConsentsModule_1 = AnonymousConsentsModule;
    AnonymousConsentsModule.forRoot = function () {
        return {
            ngModule: AnonymousConsentsModule_1,
            providers: __spread(interceptors$1, [
                AnonymousConsentsService,
                provideDefaultConfig(defaultAnonymousConsentsConfig),
            ]),
        };
    };
    var AnonymousConsentsModule_1;
    AnonymousConsentsModule = AnonymousConsentsModule_1 = __decorate([
        NgModule({
            imports: [AnonymousConsentsStoreModule],
        })
    ], AnonymousConsentsModule);
    return AnonymousConsentsModule;
}());

var defaultAsmConfig = {
    asm: {
        agentSessionTimer: {
            startingDelayInSeconds: 600,
        },
        customerSearch: {
            maxResults: 20,
        },
    },
};

var ASM_FEATURE = 'asm';
var CUSTOMER_SEARCH_DATA = '[asm] Customer search data';
var CSAGENT_TOKEN_DATA = '[Auth] Customer Support Agent Token Data';

var AsmConnector = /** @class */ (function () {
    function AsmConnector(asmAdapter) {
        this.asmAdapter = asmAdapter;
    }
    AsmConnector.prototype.customerSearch = function (options) {
        return this.asmAdapter.customerSearch(options);
    };
    AsmConnector.ctorParameters = function () { return [
        { type: AsmAdapter }
    ]; };
    AsmConnector.ɵprov = ɵɵdefineInjectable({ factory: function AsmConnector_Factory() { return new AsmConnector(ɵɵinject(AsmAdapter)); }, token: AsmConnector, providedIn: "root" });
    AsmConnector = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], AsmConnector);
    return AsmConnector;
}());

var ASM_UI_UPDATE = '[Asm] UI Update';
var AsmUiUpdate = /** @class */ (function () {
    function AsmUiUpdate(payload) {
        this.payload = payload;
        this.type = ASM_UI_UPDATE;
    }
    return AsmUiUpdate;
}());

var CUSTOMER_SEARCH = '[Asm] Customer Search';
var CUSTOMER_SEARCH_FAIL = '[Asm] Customer Search Fail';
var CUSTOMER_SEARCH_SUCCESS = '[Asm] Customer Search Success';
var CUSTOMER_SEARCH_RESET = '[Asm] Customer Search Reset';
var CustomerSearch = /** @class */ (function (_super) {
    __extends(CustomerSearch, _super);
    function CustomerSearch(payload) {
        var _this = _super.call(this, CUSTOMER_SEARCH_DATA) || this;
        _this.payload = payload;
        _this.type = CUSTOMER_SEARCH;
        return _this;
    }
    return CustomerSearch;
}(LoaderLoadAction));
var CustomerSearchFail = /** @class */ (function (_super) {
    __extends(CustomerSearchFail, _super);
    function CustomerSearchFail(payload) {
        var _this = _super.call(this, CUSTOMER_SEARCH_DATA) || this;
        _this.payload = payload;
        _this.type = CUSTOMER_SEARCH_FAIL;
        return _this;
    }
    return CustomerSearchFail;
}(LoaderFailAction));
var CustomerSearchSuccess = /** @class */ (function (_super) {
    __extends(CustomerSearchSuccess, _super);
    function CustomerSearchSuccess(payload) {
        var _this = _super.call(this, CUSTOMER_SEARCH_DATA) || this;
        _this.payload = payload;
        _this.type = CUSTOMER_SEARCH_SUCCESS;
        return _this;
    }
    return CustomerSearchSuccess;
}(LoaderSuccessAction));
var CustomerSearchReset = /** @class */ (function (_super) {
    __extends(CustomerSearchReset, _super);
    function CustomerSearchReset() {
        var _this = _super.call(this, CUSTOMER_SEARCH_DATA) || this;
        _this.type = CUSTOMER_SEARCH_RESET;
        return _this;
    }
    return CustomerSearchReset;
}(LoaderResetAction));

var LOAD_CUSTOMER_SUPPORT_AGENT_TOKEN = '[Auth] Load Customer Service Agent Token';
var LOAD_CUSTOMER_SUPPORT_AGENT_TOKEN_FAIL = '[Auth] Load Customer Service Agent Token Fail';
var LOAD_CUSTOMER_SUPPORT_AGENT_TOKEN_SUCCESS = '[Auth] Load Customer Service Agent Token Success';
var LoadCustomerSupportAgentToken = /** @class */ (function (_super) {
    __extends(LoadCustomerSupportAgentToken, _super);
    function LoadCustomerSupportAgentToken(payload) {
        var _this = _super.call(this, CSAGENT_TOKEN_DATA) || this;
        _this.payload = payload;
        _this.type = LOAD_CUSTOMER_SUPPORT_AGENT_TOKEN;
        return _this;
    }
    return LoadCustomerSupportAgentToken;
}(LoaderLoadAction));
var LoadCustomerSupportAgentTokenFail = /** @class */ (function (_super) {
    __extends(LoadCustomerSupportAgentTokenFail, _super);
    function LoadCustomerSupportAgentTokenFail(payload) {
        var _this = _super.call(this, CSAGENT_TOKEN_DATA) || this;
        _this.payload = payload;
        _this.type = LOAD_CUSTOMER_SUPPORT_AGENT_TOKEN_FAIL;
        return _this;
    }
    return LoadCustomerSupportAgentTokenFail;
}(LoaderFailAction));
var LoadCustomerSupportAgentTokenSuccess = /** @class */ (function (_super) {
    __extends(LoadCustomerSupportAgentTokenSuccess, _super);
    function LoadCustomerSupportAgentTokenSuccess(payload) {
        var _this = _super.call(this, CSAGENT_TOKEN_DATA) || this;
        _this.payload = payload;
        _this.type = LOAD_CUSTOMER_SUPPORT_AGENT_TOKEN_SUCCESS;
        return _this;
    }
    return LoadCustomerSupportAgentTokenSuccess;
}(LoaderSuccessAction));
var LogoutCustomerSupportAgent = /** @class */ (function () {
    function LogoutCustomerSupportAgent() {
        this.type = LOGOUT_CUSTOMER_SUPPORT_AGENT;
    }
    return LogoutCustomerSupportAgent;
}());



var customerGroup_actions = /*#__PURE__*/Object.freeze({
    __proto__: null,
    ASM_UI_UPDATE: ASM_UI_UPDATE,
    AsmUiUpdate: AsmUiUpdate,
    CUSTOMER_SEARCH: CUSTOMER_SEARCH,
    CUSTOMER_SEARCH_FAIL: CUSTOMER_SEARCH_FAIL,
    CUSTOMER_SEARCH_SUCCESS: CUSTOMER_SEARCH_SUCCESS,
    CUSTOMER_SEARCH_RESET: CUSTOMER_SEARCH_RESET,
    CustomerSearch: CustomerSearch,
    CustomerSearchFail: CustomerSearchFail,
    CustomerSearchSuccess: CustomerSearchSuccess,
    CustomerSearchReset: CustomerSearchReset,
    LOAD_CUSTOMER_SUPPORT_AGENT_TOKEN: LOAD_CUSTOMER_SUPPORT_AGENT_TOKEN,
    LOAD_CUSTOMER_SUPPORT_AGENT_TOKEN_FAIL: LOAD_CUSTOMER_SUPPORT_AGENT_TOKEN_FAIL,
    LOAD_CUSTOMER_SUPPORT_AGENT_TOKEN_SUCCESS: LOAD_CUSTOMER_SUPPORT_AGENT_TOKEN_SUCCESS,
    LoadCustomerSupportAgentToken: LoadCustomerSupportAgentToken,
    LoadCustomerSupportAgentTokenFail: LoadCustomerSupportAgentTokenFail,
    LoadCustomerSupportAgentTokenSuccess: LoadCustomerSupportAgentTokenSuccess,
    LogoutCustomerSupportAgent: LogoutCustomerSupportAgent
});

var CustomerEffects = /** @class */ (function () {
    function CustomerEffects(actions$, asmConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.asmConnector = asmConnector;
        this.customerSearch$ = this.actions$.pipe(ofType(CUSTOMER_SEARCH), map(function (action) { return action.payload; }), switchMap(function (options) {
            return _this.asmConnector.customerSearch(options).pipe(map(function (customerSearchResults) {
                return new CustomerSearchSuccess(customerSearchResults);
            }), catchError(function (error) {
                return of(new CustomerSearchFail(makeErrorSerializable(error)));
            }));
        }));
    }
    CustomerEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: AsmConnector }
    ]; };
    __decorate([
        Effect()
    ], CustomerEffects.prototype, "customerSearch$", void 0);
    CustomerEffects = __decorate([
        Injectable()
    ], CustomerEffects);
    return CustomerEffects;
}());

var CustomerSupportAgentTokenEffects = /** @class */ (function () {
    function CustomerSupportAgentTokenEffects(actions$, userTokenService) {
        var _this = this;
        this.actions$ = actions$;
        this.userTokenService = userTokenService;
        this.loadCustomerSupportAgentToken$ = this.actions$.pipe(ofType(LOAD_CUSTOMER_SUPPORT_AGENT_TOKEN), map(function (action) { return action.payload; }), switchMap(function (_a) {
            var userId = _a.userId, password = _a.password;
            return _this.userTokenService.loadToken(userId, password).pipe(map(function (token) {
                var date = new Date();
                date.setSeconds(date.getSeconds() + token.expires_in);
                token.expiration_time = date.toJSON();
                return new LoadCustomerSupportAgentTokenSuccess(token);
            }), catchError(function (error) {
                return of(new LoadCustomerSupportAgentTokenFail(makeErrorSerializable(error)));
            }));
        }));
    }
    CustomerSupportAgentTokenEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: UserAuthenticationTokenService }
    ]; };
    __decorate([
        Effect()
    ], CustomerSupportAgentTokenEffects.prototype, "loadCustomerSupportAgentToken$", void 0);
    CustomerSupportAgentTokenEffects = __decorate([
        Injectable()
    ], CustomerSupportAgentTokenEffects);
    return CustomerSupportAgentTokenEffects;
}());

var effects$3 = [
    CustomerEffects,
    CustomerSupportAgentTokenEffects,
];

var initialState$7 = { collapsed: false };
function reducer$7(state, action) {
    if (state === void 0) { state = initialState$7; }
    switch (action.type) {
        case ASM_UI_UPDATE: {
            return __assign(__assign({}, state), action.payload);
        }
        default: {
            return state;
        }
    }
}

function getReducers$3() {
    return {
        customerSearchResult: loaderReducer(CUSTOMER_SEARCH_DATA),
        asmUi: reducer$7,
        csagentToken: loaderReducer(CSAGENT_TOKEN_DATA),
    };
}
var reducerToken$3 = new InjectionToken('AsmReducers');
var reducerProvider$3 = {
    provide: reducerToken$3,
    useFactory: getReducers$3,
};
function clearCustomerSupportAgentAsmState(reducer) {
    return function (state, action) {
        if (action.type === LOGOUT_CUSTOMER_SUPPORT_AGENT) {
            state = __assign(__assign({}, state), { customerSearchResult: undefined, csagentToken: undefined });
        }
        return reducer(state, action);
    };
}
var metaReducers$2 = [
    clearCustomerSupportAgentAsmState,
];

function asmStoreConfigFactory() {
    var config = {
        state: {
            storageSync: {
                keys: {
                    'asm.asmUi': StorageSyncType.LOCAL_STORAGE,
                    'asm.csagentToken.value.access_token': StorageSyncType.LOCAL_STORAGE,
                    'asm.csagentToken.value.token_type': StorageSyncType.LOCAL_STORAGE,
                    'asm.csagentToken.value.expires_in': StorageSyncType.LOCAL_STORAGE,
                    'asm.csagentToken.value.expiration_time': StorageSyncType.LOCAL_STORAGE,
                    'asm.csagentToken.value.scope': StorageSyncType.LOCAL_STORAGE,
                    'asm.csagentToken.value.userId': StorageSyncType.LOCAL_STORAGE,
                },
            },
        },
    };
    return config;
}
var AsmStoreModule = /** @class */ (function () {
    function AsmStoreModule() {
    }
    AsmStoreModule = __decorate([
        NgModule({
            imports: [
                CommonModule,
                HttpClientModule,
                StateModule,
                StoreModule.forFeature(ASM_FEATURE, reducerToken$3, { metaReducers: metaReducers$2 }),
                EffectsModule.forFeature(effects$3),
            ],
            providers: [
                provideDefaultConfigFactory(asmStoreConfigFactory),
                reducerProvider$3,
            ],
        })
    ], AsmStoreModule);
    return AsmStoreModule;
}());

var GlobalMessageType;
(function (GlobalMessageType) {
    GlobalMessageType["MSG_TYPE_CONFIRMATION"] = "[GlobalMessage] Confirmation";
    GlobalMessageType["MSG_TYPE_ERROR"] = "[GlobalMessage] Error";
    GlobalMessageType["MSG_TYPE_INFO"] = "[GlobalMessage] Information";
    GlobalMessageType["MSG_TYPE_WARNING"] = "[GlobalMessage] Warning";
})(GlobalMessageType || (GlobalMessageType = {}));

var GlobalMessageConfig = /** @class */ (function () {
    function GlobalMessageConfig() {
    }
    GlobalMessageConfig.ɵprov = ɵɵdefineInjectable({ factory: function GlobalMessageConfig_Factory() { return ɵɵinject(Config); }, token: GlobalMessageConfig, providedIn: "root" });
    GlobalMessageConfig = __decorate([
        Injectable({
            providedIn: 'root',
            useExisting: Config,
        })
    ], GlobalMessageConfig);
    return GlobalMessageConfig;
}());

var ADD_MESSAGE = '[Global-message] Add a Message';
var REMOVE_MESSAGE = '[Global-message] Remove a Message';
var REMOVE_MESSAGES_BY_TYPE = '[Global-message] Remove messages by type';
var AddMessage = /** @class */ (function () {
    function AddMessage(payload) {
        this.payload = payload;
        this.type = ADD_MESSAGE;
    }
    return AddMessage;
}());
var RemoveMessage = /** @class */ (function () {
    function RemoveMessage(payload) {
        this.payload = payload;
        this.type = REMOVE_MESSAGE;
    }
    return RemoveMessage;
}());
var RemoveMessagesByType = /** @class */ (function () {
    function RemoveMessagesByType(payload) {
        this.payload = payload;
        this.type = REMOVE_MESSAGES_BY_TYPE;
    }
    return RemoveMessagesByType;
}());



var globalMessageGroup_actions = /*#__PURE__*/Object.freeze({
    __proto__: null,
    ADD_MESSAGE: ADD_MESSAGE,
    REMOVE_MESSAGE: REMOVE_MESSAGE,
    REMOVE_MESSAGES_BY_TYPE: REMOVE_MESSAGES_BY_TYPE,
    AddMessage: AddMessage,
    RemoveMessage: RemoveMessage,
    RemoveMessagesByType: RemoveMessagesByType
});

var GLOBAL_MESSAGE_FEATURE = 'global-message';

var getGlobalMessageState = createFeatureSelector(GLOBAL_MESSAGE_FEATURE);

var ɵ0$r = function (state) { return state.entities; };
var getGlobalMessageEntities = createSelector(getGlobalMessageState, ɵ0$r);
var getGlobalMessageEntitiesByType = function (type) {
    return createSelector(getGlobalMessageEntities, function (entities) { return entities && entities[type]; });
};
var getGlobalMessageCountByType = function (type) {
    return createSelector(getGlobalMessageEntitiesByType(type), function (entities) { return entities && entities.length; });
};



var globalMessageGroup_selectors = /*#__PURE__*/Object.freeze({
    __proto__: null,
    getGlobalMessageState: getGlobalMessageState,
    getGlobalMessageEntities: getGlobalMessageEntities,
    getGlobalMessageEntitiesByType: getGlobalMessageEntitiesByType,
    getGlobalMessageCountByType: getGlobalMessageCountByType,
    ɵ0: ɵ0$r
});

var GlobalMessageService = /** @class */ (function () {
    function GlobalMessageService(store) {
        this.store = store;
    }
    /**
     * Get all global messages
     */
    GlobalMessageService.prototype.get = function () {
        return this.store.pipe(select(getGlobalMessageEntities), filter(function (data) { return data !== undefined; }));
    };
    /**
     * Add one message into store
     * @param text: string | Translatable
     * @param type: GlobalMessageType object
     * @param timeout: number
     */
    GlobalMessageService.prototype.add = function (text, type, timeout) {
        this.store.dispatch(new AddMessage({
            text: typeof text === 'string' ? { raw: text } : text,
            type: type,
            timeout: timeout,
        }));
    };
    /**
     * Remove message(s) from store
     * @param type: GlobalMessageType
     * @param index:optional. Without it, messages will be removed by type; otherwise,
     * message will be removed from list by index.
     */
    GlobalMessageService.prototype.remove = function (type, index) {
        this.store.dispatch(index !== undefined
            ? new RemoveMessage({
                type: type,
                index: index,
            })
            : new RemoveMessagesByType(type));
    };
    GlobalMessageService.ctorParameters = function () { return [
        { type: Store }
    ]; };
    GlobalMessageService.ɵprov = ɵɵdefineInjectable({ factory: function GlobalMessageService_Factory() { return new GlobalMessageService(ɵɵinject(Store)); }, token: GlobalMessageService, providedIn: "root" });
    GlobalMessageService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], GlobalMessageService);
    return GlobalMessageService;
}());

var HttpResponseStatus;
(function (HttpResponseStatus) {
    HttpResponseStatus[HttpResponseStatus["UNKNOWN"] = -1] = "UNKNOWN";
    HttpResponseStatus[HttpResponseStatus["BAD_REQUEST"] = 400] = "BAD_REQUEST";
    HttpResponseStatus[HttpResponseStatus["UNAUTHORIZED"] = 401] = "UNAUTHORIZED";
    HttpResponseStatus[HttpResponseStatus["FORBIDDEN"] = 403] = "FORBIDDEN";
    HttpResponseStatus[HttpResponseStatus["NOT_FOUND"] = 404] = "NOT_FOUND";
    HttpResponseStatus[HttpResponseStatus["CONFLICT"] = 409] = "CONFLICT";
    HttpResponseStatus[HttpResponseStatus["BAD_GATEWAY"] = 502] = "BAD_GATEWAY";
    HttpResponseStatus[HttpResponseStatus["GATEWAY_TIMEOUT"] = 504] = "GATEWAY_TIMEOUT";
    HttpResponseStatus[HttpResponseStatus["INTERNAL_SERVER_ERROR"] = 500] = "INTERNAL_SERVER_ERROR";
})(HttpResponseStatus || (HttpResponseStatus = {}));

var HttpErrorHandler = /** @class */ (function () {
    function HttpErrorHandler(globalMessageService) {
        this.globalMessageService = globalMessageService;
    }
    /**
     * Error handlers are matched by the error `responseStatus` (i.e. 404). On top of the matching status
     * a priority can be added to distinguish multiple handles for the same response status.
     */
    HttpErrorHandler.prototype.hasMatch = function (errorResponse) {
        return errorResponse.status === this.responseStatus;
    };
    HttpErrorHandler.ctorParameters = function () { return [
        { type: GlobalMessageService }
    ]; };
    HttpErrorHandler.ɵprov = ɵɵdefineInjectable({ factory: function HttpErrorHandler_Factory() { return new HttpErrorHandler(ɵɵinject(GlobalMessageService)); }, token: HttpErrorHandler, providedIn: "root" });
    HttpErrorHandler = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], HttpErrorHandler);
    return HttpErrorHandler;
}());

var BadGatewayHandler = /** @class */ (function (_super) {
    __extends(BadGatewayHandler, _super);
    function BadGatewayHandler() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.responseStatus = HttpResponseStatus.BAD_GATEWAY;
        return _this;
    }
    BadGatewayHandler.prototype.handleError = function () {
        this.globalMessageService.add({ key: 'httpHandlers.badGateway' }, GlobalMessageType.MSG_TYPE_ERROR);
    };
    BadGatewayHandler.prototype.getPriority = function () {
        return -10 /* LOW */;
    };
    BadGatewayHandler.ɵprov = ɵɵdefineInjectable({ factory: function BadGatewayHandler_Factory() { return new BadGatewayHandler(ɵɵinject(GlobalMessageService)); }, token: BadGatewayHandler, providedIn: "root" });
    BadGatewayHandler = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], BadGatewayHandler);
    return BadGatewayHandler;
}(HttpErrorHandler));

/**
 * Extract cart identifier for current user. Anonymous calls use `guid` and for logged users `code` is used.
 */
function getCartIdByUserId(cart, userId) {
    if (userId === OCC_USER_ID_ANONYMOUS) {
        return cart.guid;
    }
    return cart.code;
}
/**
 * Check if cart is selective (save for later) based on id.
 */
function isSelectiveCart(cartId) {
    if (cartId === void 0) { cartId = ''; }
    return cartId.startsWith('selectivecart');
}
/**
 * Check if the returned error is of type notFound.
 *
 * We additionally check if the cart is not a selective cart.
 * For selective cart this error can happen only when extension is disabled.
 * It should never happen, because in that case, selective cart should also be disabled in our configuration.
 * However if that happens we want to handle these errors silently.
 */
function isCartNotFoundError(error) {
    return (error.reason === 'notFound' &&
        error.subjectType === 'cart' &&
        !isSelectiveCart(error.subject));
}
/**
 * Compute wishlist cart name for customer.
 */
function getWishlistName(customerId) {
    return "wishlist" + customerId;
}
/**
 * What is a temporary cart?
 * - frontend only cart entity!
 * - can be identified in store by `temp-` prefix with some unique id (multiple carts can be created at the same time eg. active cart, wishlist)
 *
 * Why we need temporary carts?
 * - to have information about cart creation process (meta flags: loading, error - for showing loader, error message)
 * - to know if there is currently a cart creation process in progress (eg. so, we don't create more than one active cart at the same time)
 * - cart identifiers are created in the backend, so those are only known after cart is created
 *
 * Temporary cart life cycle
 * - create cart method invoked
 * - new `temp-${uuid}` cart is created with `loading=true` state
 * - backend returns created cart
 * - normal cart entity is saved under correct id (eg. for logged user under cart `code` key)
 * - temporary cart value is set to backend response (anyone observing this cart can read code/guid from it and switch selector to normal cart)
 * - in next tick temporary cart is removed
 */
function isTempCartId(cartId) {
    return cartId.startsWith('temp-');
}

var OAUTH_ENDPOINT$1 = '/authorizationserver/oauth/token';
var BadRequestHandler = /** @class */ (function (_super) {
    __extends(BadRequestHandler, _super);
    function BadRequestHandler() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.responseStatus = HttpResponseStatus.BAD_REQUEST;
        return _this;
    }
    BadRequestHandler.prototype.handleError = function (request, response) {
        this.handleBadPassword(request, response);
        this.handleBadLoginResponse(request, response);
        this.handleBadCartRequest(request, response);
        this.handleValidationError(request, response);
        this.handleVoucherOperationError(request, response);
    };
    BadRequestHandler.prototype.handleBadPassword = function (request, response) {
        var _a, _b, _c;
        if (((_a = response.url) === null || _a === void 0 ? void 0 : _a.includes(OAUTH_ENDPOINT$1)) &&
            ((_b = response.error) === null || _b === void 0 ? void 0 : _b.error) === 'invalid_grant' &&
            ((_c = request.body) === null || _c === void 0 ? void 0 : _c.get('grant_type')) === 'password') {
            this.globalMessageService.add({
                key: 'httpHandlers.badRequestPleaseLoginAgain',
                params: {
                    errorMessage: response.error.error_description || response.message || '',
                },
            }, GlobalMessageType.MSG_TYPE_ERROR);
            this.globalMessageService.remove(GlobalMessageType.MSG_TYPE_CONFIRMATION);
        }
    };
    BadRequestHandler.prototype.handleBadLoginResponse = function (_request, response) {
        var _this = this;
        this.getErrors(response)
            .filter(function (error) { return error.type === 'PasswordMismatchError'; })
            .forEach(function () {
            _this.globalMessageService.add({ key: 'httpHandlers.badRequestOldPasswordIncorrect' }, GlobalMessageType.MSG_TYPE_ERROR);
        });
    };
    BadRequestHandler.prototype.handleValidationError = function (_request, response) {
        var _this = this;
        this.getErrors(response)
            .filter(function (e) { return e.type === 'ValidationError'; })
            .forEach(function (error) {
            _this.globalMessageService.add({
                key: "httpHandlers.validationErrors." + error.reason + "." + error.subject,
            }, GlobalMessageType.MSG_TYPE_ERROR);
        });
    };
    BadRequestHandler.prototype.handleBadCartRequest = function (_request, response) {
        var _this = this;
        this.getErrors(response)
            .filter(function (e) { return isCartNotFoundError(e); })
            .forEach(function () {
            _this.globalMessageService.add({ key: 'httpHandlers.cartNotFound' }, GlobalMessageType.MSG_TYPE_ERROR);
        });
    };
    BadRequestHandler.prototype.handleVoucherOperationError = function (_request, response) {
        var _this = this;
        this.getErrors(response)
            .filter(function (e) {
            return e.message === 'coupon.invalid.code.provided' &&
                e.type === 'VoucherOperationError';
        })
            .forEach(function () {
            _this.globalMessageService.add({ key: 'httpHandlers.invalidCodeProvided' }, GlobalMessageType.MSG_TYPE_ERROR);
        });
    };
    BadRequestHandler.prototype.getErrors = function (response) {
        var _a;
        return (((_a = response.error) === null || _a === void 0 ? void 0 : _a.errors) || []).filter(function (error) { return error.type !== 'JaloObjectNoLongerValidError'; });
    };
    BadRequestHandler.prototype.getPriority = function () {
        return -10 /* LOW */;
    };
    BadRequestHandler.ɵprov = ɵɵdefineInjectable({ factory: function BadRequestHandler_Factory() { return new BadRequestHandler(ɵɵinject(GlobalMessageService)); }, token: BadRequestHandler, providedIn: "root" });
    BadRequestHandler = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], BadRequestHandler);
    return BadRequestHandler;
}(HttpErrorHandler));

var ConflictHandler = /** @class */ (function (_super) {
    __extends(ConflictHandler, _super);
    function ConflictHandler() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.responseStatus = HttpResponseStatus.CONFLICT;
        return _this;
    }
    ConflictHandler.prototype.handleError = function () {
        this.globalMessageService.add({ key: 'httpHandlers.conflict' }, GlobalMessageType.MSG_TYPE_ERROR);
    };
    ConflictHandler.prototype.getPriority = function () {
        return -10 /* LOW */;
    };
    ConflictHandler.ɵprov = ɵɵdefineInjectable({ factory: function ConflictHandler_Factory() { return new ConflictHandler(ɵɵinject(GlobalMessageService)); }, token: ConflictHandler, providedIn: "root" });
    ConflictHandler = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], ConflictHandler);
    return ConflictHandler;
}(HttpErrorHandler));

var ForbiddenHandler = /** @class */ (function (_super) {
    __extends(ForbiddenHandler, _super);
    function ForbiddenHandler() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.responseStatus = HttpResponseStatus.FORBIDDEN;
        return _this;
    }
    ForbiddenHandler.prototype.handleError = function () {
        this.globalMessageService.add({ key: 'httpHandlers.forbidden' }, GlobalMessageType.MSG_TYPE_ERROR);
    };
    ForbiddenHandler.prototype.getPriority = function () {
        return -10 /* LOW */;
    };
    ForbiddenHandler.ɵprov = ɵɵdefineInjectable({ factory: function ForbiddenHandler_Factory() { return new ForbiddenHandler(ɵɵinject(GlobalMessageService)); }, token: ForbiddenHandler, providedIn: "root" });
    ForbiddenHandler = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], ForbiddenHandler);
    return ForbiddenHandler;
}(HttpErrorHandler));

var GatewayTimeoutHandler = /** @class */ (function (_super) {
    __extends(GatewayTimeoutHandler, _super);
    function GatewayTimeoutHandler() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.responseStatus = HttpResponseStatus.GATEWAY_TIMEOUT;
        return _this;
    }
    GatewayTimeoutHandler.prototype.handleError = function () {
        this.globalMessageService.add({ key: 'httpHandlers.gatewayTimeout' }, GlobalMessageType.MSG_TYPE_ERROR);
    };
    GatewayTimeoutHandler.prototype.getPriority = function () {
        return -10 /* LOW */;
    };
    GatewayTimeoutHandler.ɵprov = ɵɵdefineInjectable({ factory: function GatewayTimeoutHandler_Factory() { return new GatewayTimeoutHandler(ɵɵinject(GlobalMessageService)); }, token: GatewayTimeoutHandler, providedIn: "root" });
    GatewayTimeoutHandler = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], GatewayTimeoutHandler);
    return GatewayTimeoutHandler;
}(HttpErrorHandler));

var InternalServerErrorHandler = /** @class */ (function (_super) {
    __extends(InternalServerErrorHandler, _super);
    function InternalServerErrorHandler() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.responseStatus = HttpResponseStatus.INTERNAL_SERVER_ERROR;
        return _this;
    }
    InternalServerErrorHandler.prototype.handleError = function () {
        this.globalMessageService.add({ key: 'httpHandlers.internalServerError' }, GlobalMessageType.MSG_TYPE_ERROR);
    };
    InternalServerErrorHandler.prototype.getPriority = function () {
        return -10 /* LOW */;
    };
    InternalServerErrorHandler.ɵprov = ɵɵdefineInjectable({ factory: function InternalServerErrorHandler_Factory() { return new InternalServerErrorHandler(ɵɵinject(GlobalMessageService)); }, token: InternalServerErrorHandler, providedIn: "root" });
    InternalServerErrorHandler = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], InternalServerErrorHandler);
    return InternalServerErrorHandler;
}(HttpErrorHandler));

var NotFoundHandler = /** @class */ (function (_super) {
    __extends(NotFoundHandler, _super);
    function NotFoundHandler() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.responseStatus = HttpResponseStatus.NOT_FOUND;
        return _this;
    }
    // empty error handler to avoid we fallabck to the unknown error handler
    NotFoundHandler.prototype.handleError = function () { };
    NotFoundHandler.prototype.getPriority = function () {
        return -10 /* LOW */;
    };
    NotFoundHandler.ɵprov = ɵɵdefineInjectable({ factory: function NotFoundHandler_Factory() { return new NotFoundHandler(ɵɵinject(GlobalMessageService)); }, token: NotFoundHandler, providedIn: "root" });
    NotFoundHandler = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], NotFoundHandler);
    return NotFoundHandler;
}(HttpErrorHandler));

/**
 * Handles Oauth client errors when a 401 is returned. This is the case for failing
 * authenticaton requests to OCC.
 */
var UnauthorizedErrorHandler = /** @class */ (function (_super) {
    __extends(UnauthorizedErrorHandler, _super);
    function UnauthorizedErrorHandler(globalMessageService) {
        var _this = _super.call(this, globalMessageService) || this;
        _this.globalMessageService = globalMessageService;
        _this.responseStatus = HttpResponseStatus.UNAUTHORIZED;
        return _this;
    }
    UnauthorizedErrorHandler.prototype.handleError = function (_request, response) {
        var _a, _b;
        if (isDevMode()) {
            console.warn("There's a problem with the \"Oauth client\" configuration. You must configure a matching Oauth client in the backend and Spartacus.");
        }
        if (((_a = response.error) === null || _a === void 0 ? void 0 : _a.error) === 'invalid_client') {
            this.globalMessageService.add(((_b = response.error) === null || _b === void 0 ? void 0 : _b.error_description) || {
                key: 'httpHandlers.unauthorized.invalid_client',
            }, GlobalMessageType.MSG_TYPE_ERROR);
        }
        else {
            this.globalMessageService.add({ key: 'httpHandlers.unauthorized.common' }, GlobalMessageType.MSG_TYPE_ERROR);
        }
    };
    UnauthorizedErrorHandler.prototype.getPriority = function () {
        return -10 /* LOW */;
    };
    UnauthorizedErrorHandler.ctorParameters = function () { return [
        { type: GlobalMessageService }
    ]; };
    UnauthorizedErrorHandler.ɵprov = ɵɵdefineInjectable({ factory: function UnauthorizedErrorHandler_Factory() { return new UnauthorizedErrorHandler(ɵɵinject(GlobalMessageService)); }, token: UnauthorizedErrorHandler, providedIn: "root" });
    UnauthorizedErrorHandler = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], UnauthorizedErrorHandler);
    return UnauthorizedErrorHandler;
}(HttpErrorHandler));

/**
 * Unknown Error Handler works as an fallback, to handle errors that were
 * not handled by any other error handlers
 */
var UnknownErrorHandler = /** @class */ (function (_super) {
    __extends(UnknownErrorHandler, _super);
    function UnknownErrorHandler() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.responseStatus = HttpResponseStatus.UNKNOWN;
        return _this;
    }
    /**
     * hasMatch always returns true, to mach all errors
     */
    UnknownErrorHandler.prototype.hasMatch = function (_errorResponse) {
        return true;
    };
    UnknownErrorHandler.prototype.handleError = function () {
        if (isDevMode()) {
            console.warn("Unknown http response error: " + this.responseStatus);
        }
    };
    /**
     * Fallback priority assures that the handler is used as a last resort
     */
    UnknownErrorHandler.prototype.getPriority = function () {
        return -50 /* FALLBACK */;
    };
    UnknownErrorHandler.ɵprov = ɵɵdefineInjectable({ factory: function UnknownErrorHandler_Factory() { return new UnknownErrorHandler(ɵɵinject(GlobalMessageService)); }, token: UnknownErrorHandler, providedIn: "root" });
    UnknownErrorHandler = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], UnknownErrorHandler);
    return UnknownErrorHandler;
}(HttpErrorHandler));

/**
 * Helper logic to resolve best matching Applicable
 *
 * Finding best match is a two step process:
 * 1. Find all matching applicables
 *    - all applicables for which hasMatch(...matchParams) will return true
 *    - all applicables without hasMatch method (implicit always match)
 * 2. Find the applicable with highest priority
 *    - applicable with highest getPriority(...priorityParams) will win
 *    - applicable without getPriority method is treated as Priotity.NORMAL or 0
 *    - applicables with the same priority are sorted by order of providers, the applicable that was provided later wins
 *
 * @param applicables - array or applicable-like instancese
 * @param matchParams - array of parameters passed for hasMatch calls
 * @param priorityParams - array of parameters passed for getPriority calls
 */
function resolveApplicable(applicables, matchParams, priorityParams) {
    if (applicables === void 0) { applicables = []; }
    if (matchParams === void 0) { matchParams = []; }
    if (priorityParams === void 0) { priorityParams = []; }
    var matchedApplicables = applicables.filter(function (applicable) { return !applicable.hasMatch || applicable.hasMatch.apply(applicable, __spread(matchParams)); });
    if (matchedApplicables.length < 2) {
        return matchedApplicables[0];
    }
    var lastPriority = -Infinity;
    return matchedApplicables.reduce(function (acc, curr) {
        var currPriority = curr.getPriority
            ? curr.getPriority.apply(curr, __spread(priorityParams)) : 0 /* NORMAL */;
        if (lastPriority > currPriority) {
            return acc;
        }
        lastPriority = currPriority;
        return curr;
    }, undefined);
}

var HttpErrorInterceptor = /** @class */ (function () {
    function HttpErrorInterceptor(handlers) {
        this.handlers = handlers;
    }
    HttpErrorInterceptor.prototype.intercept = function (request, next) {
        var _this = this;
        return next.handle(request).pipe(catchError(function (response) {
            if (response instanceof HttpErrorResponse) {
                _this.handleErrorResponse(request, response);
                return throwError(response);
            }
        }));
    };
    HttpErrorInterceptor.prototype.handleErrorResponse = function (request, response) {
        var handler = this.getResponseHandler(response);
        if (handler) {
            handler.handleError(request, response);
        }
    };
    /**
     * return the error handler that matches the `HttpResponseStatus` code.
     * If no handler is available, the UNKNOWN handler is returned.
     */
    HttpErrorInterceptor.prototype.getResponseHandler = function (response) {
        return resolveApplicable(this.handlers, [response]);
    };
    HttpErrorInterceptor.ctorParameters = function () { return [
        { type: Array, decorators: [{ type: Inject, args: [HttpErrorHandler,] }] }
    ]; };
    HttpErrorInterceptor.ɵprov = ɵɵdefineInjectable({ factory: function HttpErrorInterceptor_Factory() { return new HttpErrorInterceptor(ɵɵinject(HttpErrorHandler)); }, token: HttpErrorInterceptor, providedIn: "root" });
    HttpErrorInterceptor = __decorate([
        Injectable({ providedIn: 'root' }),
        __param(0, Inject(HttpErrorHandler))
    ], HttpErrorInterceptor);
    return HttpErrorInterceptor;
}());

var errorHandlers = [
    {
        provide: HttpErrorHandler,
        useExisting: UnknownErrorHandler,
        multi: true,
    },
    {
        provide: HttpErrorHandler,
        useExisting: BadGatewayHandler,
        multi: true,
    },
    {
        provide: HttpErrorHandler,
        useExisting: BadRequestHandler,
        multi: true,
    },
    {
        provide: HttpErrorHandler,
        useExisting: ConflictHandler,
        multi: true,
    },
    {
        provide: HttpErrorHandler,
        useExisting: ForbiddenHandler,
        multi: true,
    },
    {
        provide: HttpErrorHandler,
        useExisting: GatewayTimeoutHandler,
        multi: true,
    },
    {
        provide: HttpErrorHandler,
        useExisting: InternalServerErrorHandler,
        multi: true,
    },
    {
        provide: HttpErrorHandler,
        useExisting: NotFoundHandler,
        multi: true,
    },
    {
        provide: HttpErrorHandler,
        useExisting: UnauthorizedErrorHandler,
        multi: true,
    },
];
var httpErrorInterceptors = [
    {
        provide: HTTP_INTERCEPTORS,
        useExisting: HttpErrorInterceptor,
        multi: true,
    },
];

var initialState$8 = {
    entities: {},
};
function reducer$8(state, action) {
    var _a, _b, _c, _d;
    if (state === void 0) { state = initialState$8; }
    switch (action.type) {
        case ADD_MESSAGE: {
            var message = action.payload;
            if (state.entities[message.type] === undefined) {
                return __assign(__assign({}, state), { entities: __assign(__assign({}, state.entities), (_a = {}, _a[message.type] = [message.text], _a)) });
            }
            else {
                var currentMessages = state.entities[message.type];
                return __assign(__assign({}, state), { entities: __assign(__assign({}, state.entities), (_b = {}, _b[message.type] = __spread(currentMessages, [message.text]), _b)) });
            }
        }
        case REMOVE_MESSAGE: {
            var msgType = action.payload.type;
            var msgIndex = action.payload.index;
            if (Object.keys(state.entities).length === 0 ||
                !state.entities[msgType]) {
                return state;
            }
            var messages = __spread(state.entities[msgType]);
            messages.splice(msgIndex, 1);
            return __assign(__assign({}, state), { entities: __assign(__assign({}, state.entities), (_c = {}, _c[msgType] = messages, _c)) });
        }
        case REMOVE_MESSAGES_BY_TYPE: {
            var entities = __assign(__assign({}, state.entities), (_d = {}, _d[action.payload] = [], _d));
            return __assign(__assign({}, state), { entities: entities });
        }
    }
    return state;
}

function getReducers$4() {
    return reducer$8;
}
var reducerToken$4 = new InjectionToken('GlobalMessageReducers');
var reducerProvider$4 = {
    provide: reducerToken$4,
    useFactory: getReducers$4,
};

var GlobalMessageStoreModule = /** @class */ (function () {
    function GlobalMessageStoreModule() {
    }
    GlobalMessageStoreModule = __decorate([
        NgModule({
            imports: [
                StateModule,
                StoreModule.forFeature(GLOBAL_MESSAGE_FEATURE, reducerToken$4),
            ],
            providers: [reducerProvider$4],
        })
    ], GlobalMessageStoreModule);
    return GlobalMessageStoreModule;
}());

function shallowEqualObjects(objA, objB) {
    if (objA === objB) {
        return true;
    }
    if (!objA || !objB) {
        return false;
    }
    var aKeys = Object.keys(objA);
    var bKeys = Object.keys(objB);
    var aKeysLen = aKeys.length;
    var bKeysLen = bKeys.length;
    if (aKeysLen !== bKeysLen) {
        return false;
    }
    for (var i = 0; i < aKeysLen; i++) {
        var key = aKeys[i];
        if (objA[key] !== objB[key]) {
            return false;
        }
    }
    return true;
}
function deepEqualObjects(objA, objB) {
    if (objA === objB) {
        return true; // if both objA and objB are null or undefined and exactly the same
    }
    else if (!(objA instanceof Object) || !(objB instanceof Object)) {
        return false; // if they are not strictly equal, they both need to be Objects
    }
    else if (objA.constructor !== objB.constructor) {
        // they must have the exact same prototype chain, the closest we can do is
        // test their constructor.
        return false;
    }
    else {
        for (var key in objA) {
            if (!objA.hasOwnProperty(key)) {
                continue; // other properties were tested using objA.constructor === y.constructor
            }
            if (!objB.hasOwnProperty(key)) {
                return false; // allows to compare objA[ key ] and objB[ key ] when set to undefined
            }
            if (objA[key] === objB[key]) {
                continue; // if they have the same strict value or identity then they are equal
            }
            if (typeof objA[key] !== 'object') {
                return false; // Numbers, Strings, Functions, Booleans must be strictly equal
            }
            if (!deepEqualObjects(objA[key], objB[key])) {
                return false;
            }
        }
        for (var key in objB) {
            if (objB.hasOwnProperty(key) && !objA.hasOwnProperty(key)) {
                return false;
            }
        }
        return true;
    }
}
function countOfDeepEqualObjects(obj, arr) {
    return arr.reduce(function (acc, curr) {
        if (deepEqualObjects(obj, curr)) {
            acc++;
        }
        return acc;
    }, 0);
}
function indexOfFirstOccurrence(obj, arr) {
    for (var index = 0; index < arr.length; index++) {
        if (deepEqualObjects(arr[index], obj)) {
            return index;
        }
    }
}

var GlobalMessageEffect = /** @class */ (function () {
    function GlobalMessageEffect(actions$, store, config, platformId) {
        var _this = this;
        this.actions$ = actions$;
        this.store = store;
        this.config = config;
        this.platformId = platformId;
        this.removeDuplicated$ = this.actions$.pipe(ofType(ADD_MESSAGE), pluck('payload'), switchMap(function (message) {
            return of(message.text).pipe(withLatestFrom(_this.store.pipe(select(getGlobalMessageEntitiesByType(message.type)))), filter(function (_a) {
                var _b = __read(_a, 2), text = _b[0], messages = _b[1];
                return countOfDeepEqualObjects(text, messages) > 1;
            }), map(function (_a) {
                var _b = __read(_a, 2), text = _b[0], messages = _b[1];
                return new RemoveMessage({
                    type: message.type,
                    index: indexOfFirstOccurrence(text, messages),
                });
            }));
        }));
        this.hideAfterDelay$ = isPlatformBrowser(this.platformId) // we don't want to run this logic when doing SSR
            ? this.actions$.pipe(ofType(ADD_MESSAGE), pluck('payload'), concatMap(function (message) {
                var config = _this.config.globalMessages[message.type];
                return _this.store.pipe(select(getGlobalMessageCountByType(message.type)), take(1), filter(function (count) {
                    return ((config && config.timeout !== undefined) || message.timeout) &&
                        count &&
                        count > 0;
                }), delay(message.timeout || config.timeout), switchMap(function () {
                    return of(new RemoveMessage({
                        type: message.type,
                        index: 0,
                    }));
                }));
            }))
            : EMPTY;
    }
    GlobalMessageEffect.ctorParameters = function () { return [
        { type: Actions },
        { type: Store },
        { type: GlobalMessageConfig },
        { type: undefined, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] }
    ]; };
    __decorate([
        Effect()
    ], GlobalMessageEffect.prototype, "removeDuplicated$", void 0);
    __decorate([
        Effect()
    ], GlobalMessageEffect.prototype, "hideAfterDelay$", void 0);
    GlobalMessageEffect = __decorate([
        Injectable(),
        __param(3, Inject(PLATFORM_ID))
    ], GlobalMessageEffect);
    return GlobalMessageEffect;
}());

function defaultGlobalMessageConfigFactory() {
    var _a;
    return {
        globalMessages: (_a = {},
            _a[GlobalMessageType.MSG_TYPE_CONFIRMATION] = {
                timeout: 3000,
            },
            _a[GlobalMessageType.MSG_TYPE_INFO] = {
                timeout: 3000,
            },
            _a[GlobalMessageType.MSG_TYPE_ERROR] = {
                timeout: 7000,
            },
            _a[GlobalMessageType.MSG_TYPE_WARNING] = {
                timeout: 7000,
            },
            _a),
    };
}

var GlobalMessageModule = /** @class */ (function () {
    function GlobalMessageModule() {
    }
    GlobalMessageModule_1 = GlobalMessageModule;
    GlobalMessageModule.forRoot = function () {
        return {
            ngModule: GlobalMessageModule_1,
            providers: __spread(errorHandlers, httpErrorInterceptors),
        };
    };
    var GlobalMessageModule_1;
    GlobalMessageModule = GlobalMessageModule_1 = __decorate([
        NgModule({
            imports: [
                GlobalMessageStoreModule,
                EffectsModule.forFeature([GlobalMessageEffect]),
            ],
            providers: [provideDefaultConfigFactory(defaultGlobalMessageConfigFactory)],
        })
    ], GlobalMessageModule);
    return GlobalMessageModule;
}());

var getAsmState = createFeatureSelector(ASM_FEATURE);

var ɵ0$s = function (state) { return state.asmUi; };
var getAsmUi = createSelector(getAsmState, ɵ0$s);

var ɵ0$t = function (state) { return state.customerSearchResult; };
var getCustomerSearchResultsLoaderState = createSelector(getAsmState, ɵ0$t);
var ɵ1$l = function (state) {
    return loaderValueSelector(state);
};
var getCustomerSearchResults = createSelector(getCustomerSearchResultsLoaderState, ɵ1$l);
var ɵ2$e = function (state) {
    return loaderLoadingSelector(state);
};
var getCustomerSearchResultsLoading = createSelector(getCustomerSearchResultsLoaderState, ɵ2$e);

var ɵ0$u = function (state) { return state.csagentToken; };
var getCustomerSupportAgentTokenState = createSelector(getAsmState, ɵ0$u);
var ɵ1$m = function (state) {
    return loaderValueSelector(state);
};
var getCustomerSupportAgentToken = createSelector(getCustomerSupportAgentTokenState, ɵ1$m);
var ɵ2$f = function (state) {
    return loaderLoadingSelector(state);
};
var getCustomerSupportAgentTokenLoading = createSelector(getCustomerSupportAgentTokenState, ɵ2$f);



var asmGroup_selectors = /*#__PURE__*/Object.freeze({
    __proto__: null,
    getAsmUi: getAsmUi,
    ɵ0: ɵ0$s,
    getCustomerSearchResultsLoaderState: getCustomerSearchResultsLoaderState,
    getCustomerSearchResults: getCustomerSearchResults,
    getCustomerSearchResultsLoading: getCustomerSearchResultsLoading,
    ɵ1: ɵ1$l,
    ɵ2: ɵ2$e,
    getAsmState: getAsmState,
    getCustomerSupportAgentTokenState: getCustomerSupportAgentTokenState,
    getCustomerSupportAgentToken: getCustomerSupportAgentToken,
    getCustomerSupportAgentTokenLoading: getCustomerSupportAgentTokenLoading
});

var AsmAuthService = /** @class */ (function () {
    function AsmAuthService(store, authService) {
        this.store = store;
        this.authService = authService;
    }
    /**
     * Loads a user token for a customer support agent
     * @param userId
     * @param password
     */
    AsmAuthService.prototype.authorizeCustomerSupportAgent = function (userId, password) {
        this.store.dispatch(new LoadCustomerSupportAgentToken({
            userId: userId,
            password: password,
        }));
    };
    /**
     * Starts an ASM customer emulation session.
     * A customer emulation session is stoped by calling logout().
     * @param customerSupportAgentToken
     * @param customerId
     */
    AsmAuthService.prototype.startCustomerEmulationSession = function (customerSupportAgentToken, customerId) {
        this.authService.authorizeWithToken(__assign(__assign({}, customerSupportAgentToken), { userId: customerId }));
    };
    /**
     * Utility function to determine if a given token is a customer emulation session token.
     * @param userToken
     */
    AsmAuthService.prototype.isCustomerEmulationToken = function (userToken) {
        return (Boolean(userToken) &&
            Boolean(userToken.userId) &&
            userToken.userId !== OCC_USER_ID_CURRENT);
    };
    /**
     * Returns the customer support agent's token
     */
    AsmAuthService.prototype.getCustomerSupportAgentToken = function () {
        return this.store.pipe(select(getCustomerSupportAgentToken));
    };
    /**
     * Returns the customer support agent's token loading status
     */
    AsmAuthService.prototype.getCustomerSupportAgentTokenLoading = function () {
        return this.store.pipe(select(getCustomerSupportAgentTokenLoading));
    };
    /**
     * Logout a customer support agent
     */
    AsmAuthService.prototype.logoutCustomerSupportAgent = function () {
        var _this = this;
        this.getCustomerSupportAgentToken()
            .pipe(take(1))
            .subscribe(function (userToken) {
            _this.store.dispatch(new LogoutCustomerSupportAgent());
            _this.store.dispatch(new RevokeUserToken(userToken));
        });
    };
    AsmAuthService.ctorParameters = function () { return [
        { type: Store },
        { type: AuthService }
    ]; };
    AsmAuthService.ɵprov = ɵɵdefineInjectable({ factory: function AsmAuthService_Factory() { return new AsmAuthService(ɵɵinject(Store), ɵɵinject(AuthService)); }, token: AsmAuthService, providedIn: "root" });
    AsmAuthService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], AsmAuthService);
    return AsmAuthService;
}());

var CustomerSupportAgentErrorHandlingService = /** @class */ (function () {
    function CustomerSupportAgentErrorHandlingService(asmAuthService, globalMessageService) {
        this.asmAuthService = asmAuthService;
        this.globalMessageService = globalMessageService;
    }
    CustomerSupportAgentErrorHandlingService.prototype.terminateCustomerSupportAgentExpiredSession = function () {
        this.asmAuthService.logoutCustomerSupportAgent();
        this.globalMessageService.add({
            key: 'asm.csagentTokenExpired',
        }, GlobalMessageType.MSG_TYPE_ERROR);
    };
    CustomerSupportAgentErrorHandlingService.ctorParameters = function () { return [
        { type: AsmAuthService },
        { type: GlobalMessageService }
    ]; };
    CustomerSupportAgentErrorHandlingService.ɵprov = ɵɵdefineInjectable({ factory: function CustomerSupportAgentErrorHandlingService_Factory() { return new CustomerSupportAgentErrorHandlingService(ɵɵinject(AsmAuthService), ɵɵinject(GlobalMessageService)); }, token: CustomerSupportAgentErrorHandlingService, providedIn: "root" });
    CustomerSupportAgentErrorHandlingService = __decorate([
        Injectable({ providedIn: 'root' })
    ], CustomerSupportAgentErrorHandlingService);
    return CustomerSupportAgentErrorHandlingService;
}());

var CustomerSupportAgentAuthErrorInterceptor = /** @class */ (function () {
    function CustomerSupportAgentAuthErrorInterceptor(csagentErrorHandlingService) {
        this.csagentErrorHandlingService = csagentErrorHandlingService;
    }
    CustomerSupportAgentAuthErrorInterceptor.prototype.intercept = function (request, next) {
        var _this = this;
        var isCustomerSupportAgentRequest = this.isCustomerSupportAgentRequest(request);
        if (isCustomerSupportAgentRequest) {
            request = InterceptorUtil.removeHeader(USE_CUSTOMER_SUPPORT_AGENT_TOKEN, request);
        }
        return next.handle(request).pipe(catchError(function (errResponse) {
            if (errResponse instanceof HttpErrorResponse) {
                // Unauthorized
                if (isCustomerSupportAgentRequest && errResponse.status === 401) {
                    _this.csagentErrorHandlingService.terminateCustomerSupportAgentExpiredSession();
                    return of(undefined);
                }
            }
            return throwError(errResponse);
        }));
    };
    CustomerSupportAgentAuthErrorInterceptor.prototype.isCustomerSupportAgentRequest = function (request) {
        var isRequestMapping = InterceptorUtil.getInterceptorParam(USE_CUSTOMER_SUPPORT_AGENT_TOKEN, request.headers);
        return Boolean(isRequestMapping);
    };
    CustomerSupportAgentAuthErrorInterceptor.ctorParameters = function () { return [
        { type: CustomerSupportAgentErrorHandlingService }
    ]; };
    CustomerSupportAgentAuthErrorInterceptor.ɵprov = ɵɵdefineInjectable({ factory: function CustomerSupportAgentAuthErrorInterceptor_Factory() { return new CustomerSupportAgentAuthErrorInterceptor(ɵɵinject(CustomerSupportAgentErrorHandlingService)); }, token: CustomerSupportAgentAuthErrorInterceptor, providedIn: "root" });
    CustomerSupportAgentAuthErrorInterceptor = __decorate([
        Injectable({ providedIn: 'root' })
    ], CustomerSupportAgentAuthErrorInterceptor);
    return CustomerSupportAgentAuthErrorInterceptor;
}());

var CustomerSupportAgentTokenInterceptor = /** @class */ (function () {
    function CustomerSupportAgentTokenInterceptor(asmAuthService) {
        this.asmAuthService = asmAuthService;
    }
    CustomerSupportAgentTokenInterceptor.prototype.intercept = function (request, next) {
        return this.getCustomerSupportAgentToken(request).pipe(take(1), switchMap(function (token) {
            if (token) {
                request = request.clone({
                    setHeaders: {
                        Authorization: token.token_type + " " + token.access_token,
                    },
                });
            }
            return next.handle(request);
        }));
    };
    CustomerSupportAgentTokenInterceptor.prototype.getCustomerSupportAgentToken = function (request) {
        if (InterceptorUtil.getInterceptorParam(USE_CUSTOMER_SUPPORT_AGENT_TOKEN, request.headers)) {
            return this.asmAuthService.getCustomerSupportAgentToken();
        }
        return of(null);
    };
    CustomerSupportAgentTokenInterceptor.ctorParameters = function () { return [
        { type: AsmAuthService }
    ]; };
    CustomerSupportAgentTokenInterceptor.ɵprov = ɵɵdefineInjectable({ factory: function CustomerSupportAgentTokenInterceptor_Factory() { return new CustomerSupportAgentTokenInterceptor(ɵɵinject(AsmAuthService)); }, token: CustomerSupportAgentTokenInterceptor, providedIn: "root" });
    CustomerSupportAgentTokenInterceptor = __decorate([
        Injectable({ providedIn: 'root' })
    ], CustomerSupportAgentTokenInterceptor);
    return CustomerSupportAgentTokenInterceptor;
}());

var interceptors$2 = [
    {
        provide: HTTP_INTERCEPTORS,
        useExisting: CustomerSupportAgentTokenInterceptor,
        multi: true,
    },
    {
        provide: HTTP_INTERCEPTORS,
        useExisting: CustomerSupportAgentAuthErrorInterceptor,
        multi: true,
    },
];

var AsmModule = /** @class */ (function () {
    function AsmModule() {
    }
    AsmModule_1 = AsmModule;
    AsmModule.forRoot = function () {
        return {
            ngModule: AsmModule_1,
            providers: __spread(interceptors$2, [provideDefaultConfig(defaultAsmConfig)]),
        };
    };
    var AsmModule_1;
    AsmModule = AsmModule_1 = __decorate([
        NgModule({
            imports: [CommonModule, HttpClientModule, AsmStoreModule],
        })
    ], AsmModule);
    return AsmModule;
}());

var AsmService = /** @class */ (function () {
    function AsmService(store) {
        this.store = store;
    }
    /**
     * Search for customers
     * @param options
     */
    AsmService.prototype.customerSearch = function (options) {
        this.store.dispatch(new CustomerSearch(options));
    };
    /**
     * Reset the customer search result data to the initial state.
     */
    AsmService.prototype.customerSearchReset = function () {
        this.store.dispatch(new CustomerSearchReset());
    };
    /**
     * Returns the customer search result data.
     */
    AsmService.prototype.getCustomerSearchResults = function () {
        return this.store.pipe(select(getCustomerSearchResults));
    };
    /**
     * Returns the customer search result loading status.
     */
    AsmService.prototype.getCustomerSearchResultsLoading = function () {
        return this.store.pipe(select(getCustomerSearchResultsLoading));
    };
    /**
     * Updates the state of the ASM UI
     */
    AsmService.prototype.updateAsmUiState = function (asmUi) {
        this.store.dispatch(new AsmUiUpdate(asmUi));
    };
    /**
     * Get the state of the ASM UI
     */
    AsmService.prototype.getAsmUiState = function () {
        return this.store.pipe(select(getAsmUi));
    };
    AsmService.ctorParameters = function () { return [
        { type: Store }
    ]; };
    AsmService.ɵprov = ɵɵdefineInjectable({ factory: function AsmService_Factory() { return new AsmService(ɵɵinject(Store)); }, token: AsmService, providedIn: "root" });
    AsmService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], AsmService);
    return AsmService;
}());

/**
 * Abstract class that can be used to resolve meta data for specific pages.
 * The `getScore` method is used to select the right resolver for a specific
 * page, based on a score. The score is calculated by the (non)matching page
 * type and page template.
 */
var PageMetaResolver = /** @class */ (function () {
    function PageMetaResolver() {
    }
    /**
     * Returns the matching score for a resolver class, based on
     * the page type and page template.
     */
    PageMetaResolver.prototype.getScore = function (page) {
        var score = 0;
        if (this.pageType) {
            score += page.type === this.pageType ? 1 : -1;
        }
        if (this.pageTemplate) {
            score += page.template === this.pageTemplate ? 1 : -1;
        }
        return score;
    };
    PageMetaResolver.prototype.hasMatch = function (page) {
        return this.getScore(page) > 0;
    };
    PageMetaResolver.prototype.getPriority = function (page) {
        return this.getScore(page);
    };
    return PageMetaResolver;
}());

// Email Standard RFC 5322:
var EMAIL_PATTERN = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/; // tslint:disable-line
var PASSWORD_PATTERN = /^(?=.*?[A-Z])(?=.*?[0-9])(?=.*?[!@#$%^*()_\-+{};:.,]).{6,}$/;

var MULTI_CART_FEATURE = 'cart';
var MULTI_CART_DATA = '[Multi Cart] Multi Cart Data';
// TODO(#7241): Drop after event system implementation for cart vouchers
/**
 * Add voucher process const
 * @deprecated since 2.0
 */
var ADD_VOUCHER_PROCESS_ID = 'addVoucher';

var getMultiCartState = createFeatureSelector(MULTI_CART_FEATURE);
var ɵ0$v = function (state) { return state.carts; };
var getMultiCartEntities = createSelector(getMultiCartState, ɵ0$v);
var getCartEntitySelectorFactory = function (cartId) {
    return createSelector(getMultiCartEntities, function (state) {
        return entityProcessesLoaderStateSelector(state, cartId);
    });
};
var getCartSelectorFactory = function (cartId) {
    return createSelector(getMultiCartEntities, function (state) {
        return entityValueSelector(state, cartId);
    });
};
var getCartIsStableSelectorFactory = function (cartId) {
    return createSelector(getMultiCartEntities, function (state) {
        return entityIsStableSelector(state, cartId);
    });
};
var getCartHasPendingProcessesSelectorFactory = function (cartId) {
    return createSelector(getMultiCartEntities, function (state) {
        return entityHasPendingProcessesSelector(state, cartId);
    });
};
var getCartEntriesSelectorFactory = function (cartId) {
    return createSelector(getCartSelectorFactory(cartId), function (state) {
        return state && state.entries ? state.entries : [];
    });
};
var getCartEntrySelectorFactory = function (cartId, productCode) {
    return createSelector(getCartEntriesSelectorFactory(cartId), function (state) {
        return state
            ? state.find(function (entry) { return entry.product.code === productCode; })
            : undefined;
    });
};
var ɵ1$n = function (state) { return state.active; };
var getActiveCartId = createSelector(getMultiCartState, ɵ1$n);
var ɵ2$g = function (state) { return state.wishList; };
var getWishListId = createSelector(getMultiCartState, ɵ2$g);



var multiCartGroup_selectors = /*#__PURE__*/Object.freeze({
    __proto__: null,
    getMultiCartState: getMultiCartState,
    getMultiCartEntities: getMultiCartEntities,
    getCartEntitySelectorFactory: getCartEntitySelectorFactory,
    getCartSelectorFactory: getCartSelectorFactory,
    getCartIsStableSelectorFactory: getCartIsStableSelectorFactory,
    getCartHasPendingProcessesSelectorFactory: getCartHasPendingProcessesSelectorFactory,
    getCartEntriesSelectorFactory: getCartEntriesSelectorFactory,
    getCartEntrySelectorFactory: getCartEntrySelectorFactory,
    getActiveCartId: getActiveCartId,
    getWishListId: getWishListId,
    ɵ0: ɵ0$v,
    ɵ1: ɵ1$n,
    ɵ2: ɵ2$g
});

var CART_ADD_ENTRY = '[Cart-entry] Add Entry';
var CART_ADD_ENTRY_SUCCESS = '[Cart-entry] Add Entry Success';
var CART_ADD_ENTRY_FAIL = '[Cart-entry] Add Entry Fail';
var CART_REMOVE_ENTRY = '[Cart-entry] Remove Entry';
var CART_REMOVE_ENTRY_SUCCESS = '[Cart-entry] Remove Entry Success';
var CART_REMOVE_ENTRY_FAIL = '[Cart-entry] Remove Entry Fail';
var CART_UPDATE_ENTRY = '[Cart-entry] Update Entry';
var CART_UPDATE_ENTRY_SUCCESS = '[Cart-entry] Update Entry Success';
var CART_UPDATE_ENTRY_FAIL = '[Cart-entry] Update Entry Fail';
var CartAddEntry = /** @class */ (function (_super) {
    __extends(CartAddEntry, _super);
    function CartAddEntry(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.cartId) || this;
        _this.payload = payload;
        _this.type = CART_ADD_ENTRY;
        return _this;
    }
    return CartAddEntry;
}(EntityProcessesIncrementAction));
var CartAddEntrySuccess = /** @class */ (function (_super) {
    __extends(CartAddEntrySuccess, _super);
    function CartAddEntrySuccess(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.cartId) || this;
        _this.payload = payload;
        _this.type = CART_ADD_ENTRY_SUCCESS;
        return _this;
    }
    return CartAddEntrySuccess;
}(EntityProcessesDecrementAction));
var CartAddEntryFail = /** @class */ (function (_super) {
    __extends(CartAddEntryFail, _super);
    function CartAddEntryFail(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.cartId) || this;
        _this.payload = payload;
        _this.type = CART_ADD_ENTRY_FAIL;
        return _this;
    }
    return CartAddEntryFail;
}(EntityProcessesDecrementAction));
var CartRemoveEntry = /** @class */ (function (_super) {
    __extends(CartRemoveEntry, _super);
    function CartRemoveEntry(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.cartId) || this;
        _this.payload = payload;
        _this.type = CART_REMOVE_ENTRY;
        return _this;
    }
    return CartRemoveEntry;
}(EntityProcessesIncrementAction));
var CartRemoveEntrySuccess = /** @class */ (function (_super) {
    __extends(CartRemoveEntrySuccess, _super);
    function CartRemoveEntrySuccess(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.cartId) || this;
        _this.payload = payload;
        _this.type = CART_REMOVE_ENTRY_SUCCESS;
        return _this;
    }
    return CartRemoveEntrySuccess;
}(EntityProcessesDecrementAction));
var CartRemoveEntryFail = /** @class */ (function (_super) {
    __extends(CartRemoveEntryFail, _super);
    function CartRemoveEntryFail(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.cartId) || this;
        _this.payload = payload;
        _this.type = CART_REMOVE_ENTRY_FAIL;
        return _this;
    }
    return CartRemoveEntryFail;
}(EntityProcessesDecrementAction));
var CartUpdateEntry = /** @class */ (function (_super) {
    __extends(CartUpdateEntry, _super);
    function CartUpdateEntry(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.cartId) || this;
        _this.payload = payload;
        _this.type = CART_UPDATE_ENTRY;
        return _this;
    }
    return CartUpdateEntry;
}(EntityProcessesIncrementAction));
var CartUpdateEntrySuccess = /** @class */ (function (_super) {
    __extends(CartUpdateEntrySuccess, _super);
    function CartUpdateEntrySuccess(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.cartId) || this;
        _this.payload = payload;
        _this.type = CART_UPDATE_ENTRY_SUCCESS;
        return _this;
    }
    return CartUpdateEntrySuccess;
}(EntityProcessesDecrementAction));
var CartUpdateEntryFail = /** @class */ (function (_super) {
    __extends(CartUpdateEntryFail, _super);
    function CartUpdateEntryFail(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.cartId) || this;
        _this.payload = payload;
        _this.type = CART_UPDATE_ENTRY_FAIL;
        return _this;
    }
    return CartUpdateEntryFail;
}(EntityProcessesDecrementAction));

var CART_ADD_VOUCHER = '[Cart-voucher] Add Cart Vouchers';
var CART_ADD_VOUCHER_FAIL = '[Cart-voucher] Add Cart Voucher Fail';
var CART_ADD_VOUCHER_SUCCESS = '[Cart-voucher] Add Cart Voucher Success';
var CART_RESET_ADD_VOUCHER = '[Cart-voucher] Reset Add Cart Voucher';
var CART_REMOVE_VOUCHER = '[Cart-voucher] Remove Cart Voucher';
var CART_REMOVE_VOUCHER_FAIL = '[Cart-voucher] Remove Cart Voucher Fail';
var CART_REMOVE_VOUCHER_SUCCESS = '[Cart-voucher] Remove Cart Voucher Success';
// Adding cart voucher actions
var CartAddVoucher = /** @class */ (function (_super) {
    __extends(CartAddVoucher, _super);
    function CartAddVoucher(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, ADD_VOUCHER_PROCESS_ID) || this;
        _this.payload = payload;
        _this.type = CART_ADD_VOUCHER;
        return _this;
    }
    return CartAddVoucher;
}(EntityLoadAction));
var CartAddVoucherFail = /** @class */ (function (_super) {
    __extends(CartAddVoucherFail, _super);
    function CartAddVoucherFail(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, ADD_VOUCHER_PROCESS_ID, payload.error) || this;
        _this.payload = payload;
        _this.type = CART_ADD_VOUCHER_FAIL;
        return _this;
    }
    return CartAddVoucherFail;
}(EntityFailAction));
var CartAddVoucherSuccess = /** @class */ (function (_super) {
    __extends(CartAddVoucherSuccess, _super);
    function CartAddVoucherSuccess(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, ADD_VOUCHER_PROCESS_ID) || this;
        _this.payload = payload;
        _this.type = CART_ADD_VOUCHER_SUCCESS;
        return _this;
    }
    return CartAddVoucherSuccess;
}(EntitySuccessAction));
// TODO(#7241): Remove when switching to event system for vouchers
/**
 * Resets add voucher process
 *
 * @deprecated since 2.0
 */
var CartResetAddVoucher = /** @class */ (function (_super) {
    __extends(CartResetAddVoucher, _super);
    function CartResetAddVoucher() {
        var _this = _super.call(this, PROCESS_FEATURE, ADD_VOUCHER_PROCESS_ID) || this;
        _this.type = CART_RESET_ADD_VOUCHER;
        return _this;
    }
    return CartResetAddVoucher;
}(EntityLoaderResetAction));
// Deleting cart voucher
var CartRemoveVoucher = /** @class */ (function (_super) {
    __extends(CartRemoveVoucher, _super);
    function CartRemoveVoucher(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.cartId) || this;
        _this.payload = payload;
        _this.type = CART_REMOVE_VOUCHER;
        return _this;
    }
    return CartRemoveVoucher;
}(EntityProcessesIncrementAction));
var CartRemoveVoucherFail = /** @class */ (function (_super) {
    __extends(CartRemoveVoucherFail, _super);
    function CartRemoveVoucherFail(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.cartId) || this;
        _this.payload = payload;
        _this.type = CART_REMOVE_VOUCHER_FAIL;
        return _this;
    }
    return CartRemoveVoucherFail;
}(EntityProcessesDecrementAction));
var CartRemoveVoucherSuccess = /** @class */ (function (_super) {
    __extends(CartRemoveVoucherSuccess, _super);
    function CartRemoveVoucherSuccess(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.cartId) || this;
        _this.payload = payload;
        _this.type = CART_REMOVE_VOUCHER_SUCCESS;
        return _this;
    }
    return CartRemoveVoucherSuccess;
}(EntityProcessesDecrementAction));

var CREATE_CART = '[Cart] Create Cart';
var CREATE_CART_FAIL = '[Cart] Create Cart Fail';
var CREATE_CART_SUCCESS = '[Cart] Create Cart Success';
var LOAD_CART = '[Cart] Load Cart';
var LOAD_CART_FAIL = '[Cart] Load Cart Fail';
var LOAD_CART_SUCCESS = '[Cart] Load Cart Success';
var ADD_EMAIL_TO_CART = '[Cart] Add Email to Cart';
var ADD_EMAIL_TO_CART_FAIL = '[Cart] Add Email to Cart Fail';
var ADD_EMAIL_TO_CART_SUCCESS = '[Cart] Add Email to Cart Success';
var MERGE_CART = '[Cart] Merge Cart';
var MERGE_CART_SUCCESS = '[Cart] Merge Cart Success';
var RESET_CART_DETAILS = '[Cart] Reset Cart Details';
var REMOVE_CART = '[Cart] Remove Cart';
var DELETE_CART = '[Cart] Delete Cart';
var DELETE_CART_SUCCESS = '[Cart] Delete Cart Success';
var DELETE_CART_FAIL = '[Cart] Delete Cart Fail';
var CreateCart = /** @class */ (function (_super) {
    __extends(CreateCart, _super);
    function CreateCart(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.tempCartId) || this;
        _this.payload = payload;
        _this.type = CREATE_CART;
        return _this;
    }
    return CreateCart;
}(EntityLoadAction));
var CreateCartFail = /** @class */ (function (_super) {
    __extends(CreateCartFail, _super);
    function CreateCartFail(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.tempCartId) || this;
        _this.payload = payload;
        _this.type = CREATE_CART_FAIL;
        return _this;
    }
    return CreateCartFail;
}(EntityFailAction));
var CreateCartSuccess = /** @class */ (function (_super) {
    __extends(CreateCartSuccess, _super);
    function CreateCartSuccess(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.cartId) || this;
        _this.payload = payload;
        _this.type = CREATE_CART_SUCCESS;
        return _this;
    }
    return CreateCartSuccess;
}(EntitySuccessAction));
var AddEmailToCart = /** @class */ (function (_super) {
    __extends(AddEmailToCart, _super);
    function AddEmailToCart(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.cartId) || this;
        _this.payload = payload;
        _this.type = ADD_EMAIL_TO_CART;
        return _this;
    }
    return AddEmailToCart;
}(EntityProcessesIncrementAction));
var AddEmailToCartFail = /** @class */ (function (_super) {
    __extends(AddEmailToCartFail, _super);
    function AddEmailToCartFail(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.cartId) || this;
        _this.payload = payload;
        _this.type = ADD_EMAIL_TO_CART_FAIL;
        return _this;
    }
    return AddEmailToCartFail;
}(EntityProcessesDecrementAction));
var AddEmailToCartSuccess = /** @class */ (function (_super) {
    __extends(AddEmailToCartSuccess, _super);
    function AddEmailToCartSuccess(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.cartId) || this;
        _this.payload = payload;
        _this.type = ADD_EMAIL_TO_CART_SUCCESS;
        return _this;
    }
    return AddEmailToCartSuccess;
}(EntityProcessesDecrementAction));
var LoadCart = /** @class */ (function (_super) {
    __extends(LoadCart, _super);
    function LoadCart(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.cartId) || this;
        _this.payload = payload;
        _this.type = LOAD_CART;
        return _this;
    }
    return LoadCart;
}(EntityLoadAction));
var LoadCartFail = /** @class */ (function (_super) {
    __extends(LoadCartFail, _super);
    function LoadCartFail(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.cartId, payload.error) || this;
        _this.payload = payload;
        _this.type = LOAD_CART_FAIL;
        return _this;
    }
    return LoadCartFail;
}(EntityFailAction));
var LoadCartSuccess = /** @class */ (function (_super) {
    __extends(LoadCartSuccess, _super);
    function LoadCartSuccess(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.cartId) || this;
        _this.payload = payload;
        _this.type = LOAD_CART_SUCCESS;
        return _this;
    }
    return LoadCartSuccess;
}(EntitySuccessAction));
var MergeCart = /** @class */ (function () {
    function MergeCart(payload) {
        this.payload = payload;
        this.type = MERGE_CART;
    }
    return MergeCart;
}());
var MergeCartSuccess = /** @class */ (function (_super) {
    __extends(MergeCartSuccess, _super);
    function MergeCartSuccess(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.oldCartId) || this;
        _this.payload = payload;
        _this.type = MERGE_CART_SUCCESS;
        return _this;
    }
    return MergeCartSuccess;
}(EntityRemoveAction));
/**
 * On site context change we want to keep current list of entities, but we want to clear the value and flags.
 * With ProcessesLoaderResetAction we run it on every entity of this type.
 */
var ResetCartDetails = /** @class */ (function (_super) {
    __extends(ResetCartDetails, _super);
    function ResetCartDetails() {
        var _this = _super.call(this, MULTI_CART_DATA) || this;
        _this.type = RESET_CART_DETAILS;
        return _this;
    }
    return ResetCartDetails;
}(ProcessesLoaderResetAction));
/**
 * Used for cleaning cart in local state, when we get information that it no longer exists in the backend.
 * For removing particular cart in both places use DeleteCart actions.
 */
var RemoveCart = /** @class */ (function (_super) {
    __extends(RemoveCart, _super);
    function RemoveCart(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.cartId) || this;
        _this.payload = payload;
        _this.type = REMOVE_CART;
        return _this;
    }
    return RemoveCart;
}(EntityRemoveAction));
var DeleteCart = /** @class */ (function () {
    function DeleteCart(payload) {
        this.payload = payload;
        this.type = DELETE_CART;
    }
    return DeleteCart;
}());
var DeleteCartSuccess = /** @class */ (function (_super) {
    __extends(DeleteCartSuccess, _super);
    function DeleteCartSuccess(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.cartId) || this;
        _this.payload = payload;
        _this.type = DELETE_CART_SUCCESS;
        return _this;
    }
    return DeleteCartSuccess;
}(EntityRemoveAction));
var DeleteCartFail = /** @class */ (function () {
    function DeleteCartFail(payload) {
        this.payload = payload;
        this.type = DELETE_CART_FAIL;
    }
    return DeleteCartFail;
}());

var SET_TEMP_CART = '[Cart] Set Temp Cart';
var CART_PROCESSES_INCREMENT = '[Cart] Cart Processes Increment';
var CART_PROCESSES_DECREMENT = '[Cart] Cart Processes Decrement';
var SET_ACTIVE_CART_ID = '[Cart] Set Active Cart Id';
var CLEAR_CART_STATE = '[Cart] Clear Cart State';
/**
 * To keep track of cart creation process we use cart with `temp-${uuid}` id.
 * After creating cart we switch to entity with `code` or `guid`.
 * We need `temp-${uuid}` cart entities for loading/error state.
 */
var SetTempCart = /** @class */ (function (_super) {
    __extends(SetTempCart, _super);
    function SetTempCart(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.tempCartId, payload.cart) || this;
        _this.payload = payload;
        _this.type = SET_TEMP_CART;
        return _this;
    }
    return SetTempCart;
}(EntitySuccessAction));
// TODO(#7241): Remove when there won't be any usage
/**
 * Increases process counter on cart entities
 * All actions that cause computations on cart should extend EntityProcessesIncrementAction instead of dispatching this action.
 * @deprecated since 2.0
 */
var CartProcessesIncrement = /** @class */ (function (_super) {
    __extends(CartProcessesIncrement, _super);
    function CartProcessesIncrement(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload) || this;
        _this.payload = payload;
        _this.type = CART_PROCESSES_INCREMENT;
        return _this;
    }
    return CartProcessesIncrement;
}(EntityProcessesIncrementAction));
// TODO(#7241): Remove when there won't be any usage
/**
 * Decrement process counter on cart entities
 * All actions that cause computations on cart should extend EntityProcessesDecrementAction instead of dispatching this action.
 * @deprecated since 2.0
 */
var CartProcessesDecrement = /** @class */ (function (_super) {
    __extends(CartProcessesDecrement, _super);
    function CartProcessesDecrement(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload) || this;
        _this.payload = payload;
        _this.type = CART_PROCESSES_DECREMENT;
        return _this;
    }
    return CartProcessesDecrement;
}(EntityProcessesDecrementAction));
/**
 * Only sets active cart property with id of active cart. Then services take care of loading that cart.
 */
var SetActiveCartId = /** @class */ (function () {
    function SetActiveCartId(payload) {
        this.payload = payload;
        this.type = SET_ACTIVE_CART_ID;
    }
    return SetActiveCartId;
}());
/**
 * Clear whole cart store state: all entities + reset rest of the cart state.
 */
var ClearCartState = /** @class */ (function (_super) {
    __extends(ClearCartState, _super);
    function ClearCartState() {
        var _this = _super.call(this, MULTI_CART_DATA) || this;
        _this.type = CLEAR_CART_STATE;
        return _this;
    }
    return ClearCartState;
}(EntityRemoveAllAction));

var CREATE_WISH_LIST = '[Wish List] Create Wish List';
var CREATE_WISH_LIST_FAIL = '[Wish List] Create Wish List Fail';
var CREATE_WISH_LIST_SUCCESS = '[Wish List] Create Wish List Success';
var LOAD_WISH_LIST = '[Wish List] Load Wish List';
var LOAD_WISH_LIST_SUCCESS = '[Wish List] Load Wish List Success';
var LOAD_WISH_LIST_FAIL = '[Wish List] Load Wish List Fail';
var RESET_WISH_LIST_DETAILS = '[Wish List] Reset Wish List';
var CreateWishList = /** @class */ (function () {
    function CreateWishList(payload) {
        this.payload = payload;
        this.type = CREATE_WISH_LIST;
    }
    return CreateWishList;
}());
var CreateWishListSuccess = /** @class */ (function (_super) {
    __extends(CreateWishListSuccess, _super);
    function CreateWishListSuccess(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, getCartIdByUserId(payload.cart, payload.userId)) || this;
        _this.payload = payload;
        _this.type = CREATE_WISH_LIST_SUCCESS;
        return _this;
    }
    return CreateWishListSuccess;
}(EntitySuccessAction));
var CreateWishListFail = /** @class */ (function (_super) {
    __extends(CreateWishListFail, _super);
    function CreateWishListFail(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.cartId, payload.error) || this;
        _this.payload = payload;
        _this.type = CREATE_WISH_LIST_FAIL;
        return _this;
    }
    return CreateWishListFail;
}(EntityFailAction));
var LoadWishList = /** @class */ (function (_super) {
    __extends(LoadWishList, _super);
    function LoadWishList(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.tempCartId) || this;
        _this.payload = payload;
        _this.type = LOAD_WISH_LIST;
        return _this;
    }
    return LoadWishList;
}(EntityLoadAction));
var LoadWishListSuccess = /** @class */ (function (_super) {
    __extends(LoadWishListSuccess, _super);
    function LoadWishListSuccess(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.cartId) || this;
        _this.payload = payload;
        _this.type = LOAD_WISH_LIST_SUCCESS;
        return _this;
    }
    return LoadWishListSuccess;
}(EntitySuccessAction));
var LoadWishListFail = /** @class */ (function (_super) {
    __extends(LoadWishListFail, _super);
    function LoadWishListFail(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.cartId, payload.error) || this;
        _this.payload = payload;
        _this.type = LOAD_WISH_LIST_FAIL;
        return _this;
    }
    return LoadWishListFail;
}(EntityFailAction));



var cartGroup_actions = /*#__PURE__*/Object.freeze({
    __proto__: null,
    CART_ADD_ENTRY: CART_ADD_ENTRY,
    CART_ADD_ENTRY_SUCCESS: CART_ADD_ENTRY_SUCCESS,
    CART_ADD_ENTRY_FAIL: CART_ADD_ENTRY_FAIL,
    CART_REMOVE_ENTRY: CART_REMOVE_ENTRY,
    CART_REMOVE_ENTRY_SUCCESS: CART_REMOVE_ENTRY_SUCCESS,
    CART_REMOVE_ENTRY_FAIL: CART_REMOVE_ENTRY_FAIL,
    CART_UPDATE_ENTRY: CART_UPDATE_ENTRY,
    CART_UPDATE_ENTRY_SUCCESS: CART_UPDATE_ENTRY_SUCCESS,
    CART_UPDATE_ENTRY_FAIL: CART_UPDATE_ENTRY_FAIL,
    CartAddEntry: CartAddEntry,
    CartAddEntrySuccess: CartAddEntrySuccess,
    CartAddEntryFail: CartAddEntryFail,
    CartRemoveEntry: CartRemoveEntry,
    CartRemoveEntrySuccess: CartRemoveEntrySuccess,
    CartRemoveEntryFail: CartRemoveEntryFail,
    CartUpdateEntry: CartUpdateEntry,
    CartUpdateEntrySuccess: CartUpdateEntrySuccess,
    CartUpdateEntryFail: CartUpdateEntryFail,
    CART_ADD_VOUCHER: CART_ADD_VOUCHER,
    CART_ADD_VOUCHER_FAIL: CART_ADD_VOUCHER_FAIL,
    CART_ADD_VOUCHER_SUCCESS: CART_ADD_VOUCHER_SUCCESS,
    CART_RESET_ADD_VOUCHER: CART_RESET_ADD_VOUCHER,
    CART_REMOVE_VOUCHER: CART_REMOVE_VOUCHER,
    CART_REMOVE_VOUCHER_FAIL: CART_REMOVE_VOUCHER_FAIL,
    CART_REMOVE_VOUCHER_SUCCESS: CART_REMOVE_VOUCHER_SUCCESS,
    CartAddVoucher: CartAddVoucher,
    CartAddVoucherFail: CartAddVoucherFail,
    CartAddVoucherSuccess: CartAddVoucherSuccess,
    CartResetAddVoucher: CartResetAddVoucher,
    CartRemoveVoucher: CartRemoveVoucher,
    CartRemoveVoucherFail: CartRemoveVoucherFail,
    CartRemoveVoucherSuccess: CartRemoveVoucherSuccess,
    CREATE_CART: CREATE_CART,
    CREATE_CART_FAIL: CREATE_CART_FAIL,
    CREATE_CART_SUCCESS: CREATE_CART_SUCCESS,
    LOAD_CART: LOAD_CART,
    LOAD_CART_FAIL: LOAD_CART_FAIL,
    LOAD_CART_SUCCESS: LOAD_CART_SUCCESS,
    ADD_EMAIL_TO_CART: ADD_EMAIL_TO_CART,
    ADD_EMAIL_TO_CART_FAIL: ADD_EMAIL_TO_CART_FAIL,
    ADD_EMAIL_TO_CART_SUCCESS: ADD_EMAIL_TO_CART_SUCCESS,
    MERGE_CART: MERGE_CART,
    MERGE_CART_SUCCESS: MERGE_CART_SUCCESS,
    RESET_CART_DETAILS: RESET_CART_DETAILS,
    REMOVE_CART: REMOVE_CART,
    DELETE_CART: DELETE_CART,
    DELETE_CART_SUCCESS: DELETE_CART_SUCCESS,
    DELETE_CART_FAIL: DELETE_CART_FAIL,
    CreateCart: CreateCart,
    CreateCartFail: CreateCartFail,
    CreateCartSuccess: CreateCartSuccess,
    AddEmailToCart: AddEmailToCart,
    AddEmailToCartFail: AddEmailToCartFail,
    AddEmailToCartSuccess: AddEmailToCartSuccess,
    LoadCart: LoadCart,
    LoadCartFail: LoadCartFail,
    LoadCartSuccess: LoadCartSuccess,
    MergeCart: MergeCart,
    MergeCartSuccess: MergeCartSuccess,
    ResetCartDetails: ResetCartDetails,
    RemoveCart: RemoveCart,
    DeleteCart: DeleteCart,
    DeleteCartSuccess: DeleteCartSuccess,
    DeleteCartFail: DeleteCartFail,
    SET_TEMP_CART: SET_TEMP_CART,
    CART_PROCESSES_INCREMENT: CART_PROCESSES_INCREMENT,
    CART_PROCESSES_DECREMENT: CART_PROCESSES_DECREMENT,
    SET_ACTIVE_CART_ID: SET_ACTIVE_CART_ID,
    CLEAR_CART_STATE: CLEAR_CART_STATE,
    SetTempCart: SetTempCart,
    CartProcessesIncrement: CartProcessesIncrement,
    CartProcessesDecrement: CartProcessesDecrement,
    SetActiveCartId: SetActiveCartId,
    ClearCartState: ClearCartState,
    CREATE_WISH_LIST: CREATE_WISH_LIST,
    CREATE_WISH_LIST_FAIL: CREATE_WISH_LIST_FAIL,
    CREATE_WISH_LIST_SUCCESS: CREATE_WISH_LIST_SUCCESS,
    LOAD_WISH_LIST: LOAD_WISH_LIST,
    LOAD_WISH_LIST_SUCCESS: LOAD_WISH_LIST_SUCCESS,
    LOAD_WISH_LIST_FAIL: LOAD_WISH_LIST_FAIL,
    RESET_WISH_LIST_DETAILS: RESET_WISH_LIST_DETAILS,
    CreateWishList: CreateWishList,
    CreateWishListSuccess: CreateWishListSuccess,
    CreateWishListFail: CreateWishListFail,
    LoadWishList: LoadWishList,
    LoadWishListSuccess: LoadWishListSuccess,
    LoadWishListFail: LoadWishListFail
});

var MultiCartService = /** @class */ (function () {
    function MultiCartService(store) {
        this.store = store;
    }
    /**
     * Returns cart from store as an observable
     *
     * @param cartId
     */
    MultiCartService.prototype.getCart = function (cartId) {
        return this.store.pipe(select(getCartSelectorFactory(cartId)));
    };
    /**
     * Returns cart entity from store (cart with loading, error, success flags) as an observable
     *
     * @param cartId
     */
    MultiCartService.prototype.getCartEntity = function (cartId) {
        return this.store.pipe(select(getCartEntitySelectorFactory(cartId)));
    };
    /**
     * Returns true when there are no operations on that in progress and it is not currently loading
     *
     * @param cartId
     */
    MultiCartService.prototype.isStable = function (cartId) {
        return this.store.pipe(select(getCartIsStableSelectorFactory(cartId)), 
        // We dispatch a lot of actions just after finishing some process or loading, so we want this flag not to flicker.
        // This flickering should only be avoided when switching from false to true
        // Start of loading should be showed instantly (no debounce)
        // Extra actions are only dispatched after some loading
        debounce(function (isStable) { return (isStable ? timer(0) : EMPTY); }), distinctUntilChanged());
    };
    /**
     * Simple random temp cart id generator
     */
    MultiCartService.prototype.generateTempCartId = function () {
        var pseudoUuid = Math.random().toString(36).substr(2, 9);
        return "temp-" + pseudoUuid;
    };
    /**
     * Create or merge cart
     *
     * @param params Object with userId, oldCartId, toMergeCartGuid and extraData
     */
    MultiCartService.prototype.createCart = function (_a) {
        var userId = _a.userId, oldCartId = _a.oldCartId, toMergeCartGuid = _a.toMergeCartGuid, extraData = _a.extraData;
        // to support creating multiple carts at the same time we need to use different entity for every process
        // simple random uuid generator is used here for entity names
        var tempCartId = this.generateTempCartId();
        this.store.dispatch(new CreateCart({
            extraData: extraData,
            userId: userId,
            oldCartId: oldCartId,
            toMergeCartGuid: toMergeCartGuid,
            tempCartId: tempCartId,
        }));
        return this.getCartEntity(tempCartId);
    };
    /**
     * Merge provided cart to current user cart
     *
     * @param params Object with userId, cartId and extraData
     */
    MultiCartService.prototype.mergeToCurrentCart = function (_a) {
        var userId = _a.userId, cartId = _a.cartId, extraData = _a.extraData;
        var tempCartId = this.generateTempCartId();
        this.store.dispatch(new MergeCart({
            userId: userId,
            cartId: cartId,
            extraData: extraData,
            tempCartId: tempCartId,
        }));
    };
    /**
     * Load cart
     *
     * @param params Object with userId, cartId and extraData
     */
    MultiCartService.prototype.loadCart = function (_a) {
        var cartId = _a.cartId, userId = _a.userId, extraData = _a.extraData;
        this.store.dispatch(new LoadCart({
            userId: userId,
            cartId: cartId,
            extraData: extraData,
        }));
    };
    /**
     * Get cart entries as an observable
     * @param cartId
     */
    MultiCartService.prototype.getEntries = function (cartId) {
        return this.store.pipe(select(getCartEntriesSelectorFactory(cartId)));
    };
    /**
     * Add entry to cart
     *
     * @param userId
     * @param cartId
     * @param productCode
     * @param quantity
     */
    MultiCartService.prototype.addEntry = function (userId, cartId, productCode, quantity) {
        this.store.dispatch(new CartAddEntry({
            userId: userId,
            cartId: cartId,
            productCode: productCode,
            quantity: quantity,
        }));
    };
    /**
     * Add multiple entries to cart
     *
     * @param userId
     * @param cartId
     * @param products Array with items (productCode and quantity)
     */
    MultiCartService.prototype.addEntries = function (userId, cartId, products) {
        var _this = this;
        products.forEach(function (product) {
            _this.store.dispatch(new CartAddEntry({
                userId: userId,
                cartId: cartId,
                productCode: product.productCode,
                quantity: product.quantity,
            }));
        });
    };
    /**
     * Remove entry from cart
     *
     * @param userId
     * @param cartId
     * @param entryNumber
     */
    MultiCartService.prototype.removeEntry = function (userId, cartId, entryNumber) {
        this.store.dispatch(new CartRemoveEntry({
            userId: userId,
            cartId: cartId,
            entryNumber: "" + entryNumber,
        }));
    };
    /**
     * Update entry in cart. For quantity = 0 it removes entry
     *
     * @param userId
     * @param cartId
     * @param entryNumber
     * @param quantity
     */
    MultiCartService.prototype.updateEntry = function (userId, cartId, entryNumber, quantity) {
        if (quantity > 0) {
            this.store.dispatch(new CartUpdateEntry({
                userId: userId,
                cartId: cartId,
                entryNumber: "" + entryNumber,
                quantity: quantity,
            }));
        }
        else {
            this.removeEntry(userId, cartId, entryNumber);
        }
    };
    /**
     * Get specific entry from cart
     *
     * @param cartId
     * @param productCode
     */
    MultiCartService.prototype.getEntry = function (cartId, productCode) {
        return this.store.pipe(select(getCartEntrySelectorFactory(cartId, productCode)));
    };
    /**
     * Assign email to the cart
     *
     * @param cartId
     * @param userId
     * @param email
     */
    MultiCartService.prototype.assignEmail = function (cartId, userId, email) {
        this.store.dispatch(new AddEmailToCart({
            userId: userId,
            cartId: cartId,
            email: email,
        }));
    };
    /**
     * Delete cart
     *
     * @param cartId
     * @param userId
     */
    MultiCartService.prototype.deleteCart = function (cartId, userId) {
        this.store.dispatch(new DeleteCart({
            userId: userId,
            cartId: cartId,
        }));
    };
    MultiCartService.ctorParameters = function () { return [
        { type: Store }
    ]; };
    MultiCartService.ɵprov = ɵɵdefineInjectable({ factory: function MultiCartService_Factory() { return new MultiCartService(ɵɵinject(Store)); }, token: MultiCartService, providedIn: "root" });
    MultiCartService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], MultiCartService);
    return MultiCartService;
}());

var ActiveCartService = /** @class */ (function () {
    function ActiveCartService(store, authService, multiCartService) {
        var _this = this;
        this.store = store;
        this.authService = authService;
        this.multiCartService = multiCartService;
        this.PREVIOUS_USER_ID_INITIAL_VALUE = 'PREVIOUS_USER_ID_INITIAL_VALUE';
        this.previousUserId = this.PREVIOUS_USER_ID_INITIAL_VALUE;
        this.userId = OCC_USER_ID_ANONYMOUS;
        this.activeCartId$ = this.store.pipe(select(getActiveCartId), map(function (cartId) {
            if (!cartId) {
                return OCC_CART_ID_CURRENT;
            }
            return cartId;
        }));
        this.cartSelector$ = this.activeCartId$.pipe(switchMap(function (cartId) { return _this.multiCartService.getCartEntity(cartId); }));
        this.authService.getOccUserId().subscribe(function (userId) {
            _this.userId = userId;
            if (_this.userId !== OCC_USER_ID_ANONYMOUS) {
                if (_this.isJustLoggedIn(userId)) {
                    _this.loadOrMerge(_this.cartId);
                }
            }
            _this.previousUserId = userId;
        });
        this.activeCartId$.subscribe(function (cartId) {
            _this.cartId = cartId;
        });
        this.initActiveCart();
    }
    ActiveCartService.prototype.initActiveCart = function () {
        var _this = this;
        this.activeCart$ = this.cartSelector$.pipe(withLatestFrom(this.activeCartId$), map(function (_a) {
            var _b = __read(_a, 2), cartEntity = _b[0], activeCartId = _b[1];
            return {
                cart: cartEntity.value,
                cartId: activeCartId,
                isStable: !cartEntity.loading && cartEntity.processesCount === 0,
                loaded: (cartEntity.error || cartEntity.success) && !cartEntity.loading,
            };
        }), 
        // we want to emit empty carts even if those are not stable
        // on merge cart action we want to switch to empty cart so no one would use old cartId which can be already obsolete
        // so on merge action the resulting stream looks like this: old_cart -> {} -> new_cart
        filter(function (_a) {
            var isStable = _a.isStable, cart = _a.cart;
            return isStable || _this.isEmpty(cart);
        }), tap(function (_a) {
            var cart = _a.cart, cartId = _a.cartId, loaded = _a.loaded, isStable = _a.isStable;
            if (isStable &&
                _this.isEmpty(cart) &&
                !loaded &&
                !isTempCartId(cartId)) {
                _this.load(cartId);
            }
        }), map(function (_a) {
            var cart = _a.cart;
            return (cart ? cart : {});
        }), tap(function (cart) {
            if (cart) {
                _this.cartUser = cart.user;
            }
        }), distinctUntilChanged(), shareReplay({ bufferSize: 1, refCount: true }));
    };
    /**
     * Returns active cart
     */
    ActiveCartService.prototype.getActive = function () {
        return this.activeCart$;
    };
    /**
     * Returns active cart id
     */
    ActiveCartService.prototype.getActiveCartId = function () {
        var _this = this;
        return this.activeCart$.pipe(map(function (cart) { return getCartIdByUserId(cart, _this.userId); }), distinctUntilChanged());
    };
    /**
     * Returns cart entries
     */
    ActiveCartService.prototype.getEntries = function () {
        var _this = this;
        return this.activeCartId$.pipe(switchMap(function (cartId) { return _this.multiCartService.getEntries(cartId); }), distinctUntilChanged());
    };
    /**
     * Returns cart loading state
     */
    ActiveCartService.prototype.getLoading = function () {
        return this.cartSelector$.pipe(map(function (cartEntity) { return cartEntity.loading; }), distinctUntilChanged());
    };
    /**
     * Returns true when cart is stable (not loading and not pending processes on cart)
     */
    ActiveCartService.prototype.isStable = function () {
        var _this = this;
        // Debounce is used here, to avoid flickering when we switch between different cart entities.
        // For example during `addEntry` method. We might try to load current cart, so `current cart will be then active id.
        // After load fails we might create new cart so we switch to `temp-${uuid}` cart entity used when creating cart.
        // At the end we finally switch to cart `code` for cart id. Between those switches cart `isStable` function should not flicker.
        return this.activeCartId$.pipe(switchMap(function (cartId) { return _this.multiCartService.isStable(cartId); }), debounce(function (state) { return (state ? timer(0) : EMPTY); }), distinctUntilChanged());
    };
    ActiveCartService.prototype.loadOrMerge = function (cartId) {
        // for login user, whenever there's an existing cart, we will load the user
        // current cart and merge it into the existing cart
        if (!cartId || cartId === OCC_CART_ID_CURRENT) {
            this.multiCartService.loadCart({
                userId: this.userId,
                cartId: OCC_CART_ID_CURRENT,
                extraData: {
                    active: true,
                },
            });
        }
        else if (this.isGuestCart()) {
            this.guestCartMerge(cartId);
        }
        else {
            this.multiCartService.mergeToCurrentCart({
                userId: this.userId,
                cartId: cartId,
                extraData: {
                    active: true,
                },
            });
        }
    };
    ActiveCartService.prototype.load = function (cartId) {
        if (this.userId !== OCC_USER_ID_ANONYMOUS) {
            this.multiCartService.loadCart({
                userId: this.userId,
                cartId: cartId ? cartId : OCC_CART_ID_CURRENT,
                extraData: {
                    active: true,
                },
            });
        }
        else if (cartId && cartId !== OCC_CART_ID_CURRENT) {
            this.multiCartService.loadCart({
                userId: this.userId,
                cartId: cartId,
                extraData: {
                    active: true,
                },
            });
        }
    };
    ActiveCartService.prototype.addEntriesGuestMerge = function (cartEntries) {
        var _this = this;
        var entriesToAdd = cartEntries.map(function (entry) { return ({
            productCode: entry.product.code,
            quantity: entry.quantity,
        }); });
        this.requireLoadedCartForGuestMerge().subscribe(function (cartState) {
            _this.multiCartService.addEntries(_this.userId, getCartIdByUserId(cartState.value, _this.userId), entriesToAdd);
        });
    };
    ActiveCartService.prototype.requireLoadedCartForGuestMerge = function () {
        var _this = this;
        return this.requireLoadedCart(this.cartSelector$.pipe(filter(function () { return !_this.isGuestCart(); })));
    };
    ActiveCartService.prototype.isCartCreating = function (cartState) {
        // cart creating is always represented with loading flags
        // when all loading flags are false it means that we restored wrong cart id
        // could happen on context change or reload right in the middle on cart create call
        return (isTempCartId(this.cartId) &&
            (cartState.loading || cartState.success || cartState.error));
    };
    ActiveCartService.prototype.requireLoadedCart = function (customCartSelector$) {
        var _this = this;
        // For guest cart merge we want to filter guest cart in the whole stream
        // We have to wait with load/create/addEntry after guest cart will be deleted.
        // That's why you can provide custom selector with this filter applied.
        var cartSelector$ = customCartSelector$
            ? customCartSelector$
            : this.cartSelector$;
        return cartSelector$.pipe(filter(function (cartState) { return !cartState.loading; }), 
        // Avoid load/create call when there are new cart creating at the moment
        filter(function (cartState) { return !_this.isCartCreating(cartState); }), take(1), switchMap(function (cartState) {
            // Try to load the cart, because it might have been created on another device between our login and add entry call
            if (_this.isEmpty(cartState.value) &&
                _this.userId !== OCC_USER_ID_ANONYMOUS) {
                _this.load(undefined);
            }
            return cartSelector$;
        }), filter(function (cartState) { return !cartState.loading; }), 
        // create cart can happen to anonymous user if it is not empty or to any other user if it is loaded and empty
        filter(function (cartState) {
            return _this.userId === OCC_USER_ID_ANONYMOUS ||
                cartState.success ||
                cartState.error;
        }), take(1), switchMap(function (cartState) {
            if (_this.isEmpty(cartState.value)) {
                _this.multiCartService.createCart({
                    userId: _this.userId,
                    extraData: {
                        active: true,
                    },
                });
            }
            return cartSelector$;
        }), filter(function (cartState) { return !cartState.loading; }), filter(function (cartState) { return cartState.success || cartState.error; }), 
        // wait for active cart id to point to code/guid to avoid some work on temp cart entity
        filter(function (cartState) { return !_this.isCartCreating(cartState); }), filter(function (cartState) { return !_this.isEmpty(cartState.value); }), take(1));
    };
    /**
     * Add entry to active cart
     *
     * @param productCode
     * @param quantity
     */
    ActiveCartService.prototype.addEntry = function (productCode, quantity) {
        var _this = this;
        this.requireLoadedCart().subscribe(function (cartState) {
            _this.multiCartService.addEntry(_this.userId, getCartIdByUserId(cartState.value, _this.userId), productCode, quantity);
        });
    };
    /**
     * Remove entry
     *
     * @param entry
     */
    ActiveCartService.prototype.removeEntry = function (entry) {
        this.multiCartService.removeEntry(this.userId, this.cartId, entry.entryNumber);
    };
    /**
     * Update entry
     *
     * @param entryNumber
     * @param quantity
     */
    ActiveCartService.prototype.updateEntry = function (entryNumber, quantity) {
        this.multiCartService.updateEntry(this.userId, this.cartId, entryNumber, quantity);
    };
    /**
     * Returns cart entry
     *
     * @param productCode
     */
    ActiveCartService.prototype.getEntry = function (productCode) {
        var _this = this;
        return this.activeCartId$.pipe(switchMap(function (cartId) {
            return _this.multiCartService.getEntry(cartId, productCode);
        }), distinctUntilChanged());
    };
    /**
     * Assign email to cart
     *
     * @param email
     */
    ActiveCartService.prototype.addEmail = function (email) {
        this.multiCartService.assignEmail(this.cartId, this.userId, email);
    };
    /**
     * Get assigned user to cart
     */
    ActiveCartService.prototype.getAssignedUser = function () {
        return this.getActive().pipe(map(function (cart) { return cart.user; }));
    };
    /**
     * Returns true for guest cart
     */
    ActiveCartService.prototype.isGuestCart = function () {
        return (this.cartUser &&
            (this.cartUser.name === OCC_USER_ID_GUEST ||
                this.isEmail(this.cartUser.uid.split('|').slice(1).join('|'))));
    };
    /**
     * Add multiple entries to a cart
     *
     * @param cartEntries : list of entries to add (OrderEntry[])
     */
    ActiveCartService.prototype.addEntries = function (cartEntries) {
        var _this = this;
        cartEntries.forEach(function (entry) {
            _this.addEntry(entry.product.code, entry.quantity);
        });
    };
    ActiveCartService.prototype.isEmail = function (str) {
        if (str) {
            return str.match(EMAIL_PATTERN) ? true : false;
        }
        return false;
    };
    // TODO: Remove once backend is updated
    /**
     * Temporary method to merge guest cart with user cart because of backend limitation
     * This is for an edge case
     */
    ActiveCartService.prototype.guestCartMerge = function (cartId) {
        var cartEntries;
        this.getEntries()
            .pipe(take(1))
            .subscribe(function (entries) {
            cartEntries = entries;
        });
        this.multiCartService.deleteCart(cartId, OCC_USER_ID_ANONYMOUS);
        this.addEntriesGuestMerge(cartEntries);
    };
    ActiveCartService.prototype.isEmpty = function (cart) {
        return (!cart || (typeof cart === 'object' && Object.keys(cart).length === 0));
    };
    ActiveCartService.prototype.isJustLoggedIn = function (userId) {
        return (this.previousUserId !== userId && // *just* logged in
            this.previousUserId !== this.PREVIOUS_USER_ID_INITIAL_VALUE // not app initialization
        );
    };
    ActiveCartService.ctorParameters = function () { return [
        { type: Store },
        { type: AuthService },
        { type: MultiCartService }
    ]; };
    ActiveCartService.ɵprov = ɵɵdefineInjectable({ factory: function ActiveCartService_Factory() { return new ActiveCartService(ɵɵinject(Store), ɵɵinject(AuthService), ɵɵinject(MultiCartService)); }, token: ActiveCartService, providedIn: "root" });
    ActiveCartService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], ActiveCartService);
    return ActiveCartService;
}());

/**
 *
 * Withdraw from the source observable when notifier emits a value
 *
 * Withdraw will result in resubscribing to the source observable
 * Operator is useful to kill ongoing emission transformation on notifier emission
 *
 * @param notifier
 */
function withdrawOn(notifier) {
    return function (source) {
        return notifier.pipe(startWith(undefined), switchMapTo(source));
    };
}

var CartEntryConnector = /** @class */ (function () {
    function CartEntryConnector(adapter) {
        this.adapter = adapter;
    }
    CartEntryConnector.prototype.add = function (userId, cartId, productCode, quantity) {
        return this.adapter.add(userId, cartId, productCode, quantity);
    };
    CartEntryConnector.prototype.update = function (userId, cartId, entryNumber, qty, pickupStore) {
        return this.adapter.update(userId, cartId, entryNumber, qty, pickupStore);
    };
    CartEntryConnector.prototype.remove = function (userId, cartId, entryNumber) {
        return this.adapter.remove(userId, cartId, entryNumber);
    };
    CartEntryConnector.ctorParameters = function () { return [
        { type: CartEntryAdapter }
    ]; };
    CartEntryConnector.ɵprov = ɵɵdefineInjectable({ factory: function CartEntryConnector_Factory() { return new CartEntryConnector(ɵɵinject(CartEntryAdapter)); }, token: CartEntryConnector, providedIn: "root" });
    CartEntryConnector = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], CartEntryConnector);
    return CartEntryConnector;
}());

var CartEntryEffects = /** @class */ (function () {
    function CartEntryEffects(actions$, cartEntryConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.cartEntryConnector = cartEntryConnector;
        this.contextChange$ = this.actions$.pipe(ofType(CURRENCY_CHANGE, LANGUAGE_CHANGE));
        this.addEntry$ = this.actions$.pipe(ofType(CART_ADD_ENTRY), map(function (action) { return action.payload; }), concatMap(function (payload) {
            return _this.cartEntryConnector
                .add(payload.userId, payload.cartId, payload.productCode, payload.quantity)
                .pipe(map(function (cartModification) {
                return new CartAddEntrySuccess(__assign(__assign({}, payload), cartModification));
            }), catchError(function (error) {
                return from([
                    new CartAddEntryFail(__assign(__assign({}, payload), { error: makeErrorSerializable(error) })),
                    new LoadCart({
                        cartId: payload.cartId,
                        userId: payload.userId,
                    }),
                ]);
            }));
        }), withdrawOn(this.contextChange$));
        this.removeEntry$ = this.actions$.pipe(ofType(CART_REMOVE_ENTRY), map(function (action) { return action.payload; }), concatMap(function (payload) {
            return _this.cartEntryConnector
                .remove(payload.userId, payload.cartId, payload.entryNumber)
                .pipe(map(function () {
                return new CartRemoveEntrySuccess(__assign({}, payload));
            }), catchError(function (error) {
                return from([
                    new CartRemoveEntryFail(__assign(__assign({}, payload), { error: makeErrorSerializable(error) })),
                    new LoadCart({
                        cartId: payload.cartId,
                        userId: payload.userId,
                    }),
                ]);
            }));
        }), withdrawOn(this.contextChange$));
        this.updateEntry$ = this.actions$.pipe(ofType(CART_UPDATE_ENTRY), map(function (action) { return action.payload; }), concatMap(function (payload) {
            return _this.cartEntryConnector
                .update(payload.userId, payload.cartId, payload.entryNumber, payload.quantity)
                .pipe(map(function () {
                return new CartUpdateEntrySuccess(__assign({}, payload));
            }), catchError(function (error) {
                return from([
                    new CartUpdateEntryFail(__assign(__assign({}, payload), { error: makeErrorSerializable(error) })),
                    new LoadCart({
                        cartId: payload.cartId,
                        userId: payload.userId,
                    }),
                ]);
            }));
        }), withdrawOn(this.contextChange$));
    }
    CartEntryEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: CartEntryConnector }
    ]; };
    __decorate([
        Effect()
    ], CartEntryEffects.prototype, "addEntry$", void 0);
    __decorate([
        Effect()
    ], CartEntryEffects.prototype, "removeEntry$", void 0);
    __decorate([
        Effect()
    ], CartEntryEffects.prototype, "updateEntry$", void 0);
    CartEntryEffects = __decorate([
        Injectable()
    ], CartEntryEffects);
    return CartEntryEffects;
}());

var CartVoucherConnector = /** @class */ (function () {
    function CartVoucherConnector(adapter) {
        this.adapter = adapter;
    }
    CartVoucherConnector.prototype.add = function (userId, cartId, voucherId) {
        return this.adapter.add(userId, cartId, voucherId);
    };
    CartVoucherConnector.prototype.remove = function (userId, cartId, voucherId) {
        return this.adapter.remove(userId, cartId, voucherId);
    };
    CartVoucherConnector.ctorParameters = function () { return [
        { type: CartVoucherAdapter }
    ]; };
    CartVoucherConnector.ɵprov = ɵɵdefineInjectable({ factory: function CartVoucherConnector_Factory() { return new CartVoucherConnector(ɵɵinject(CartVoucherAdapter)); }, token: CartVoucherConnector, providedIn: "root" });
    CartVoucherConnector = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], CartVoucherConnector);
    return CartVoucherConnector;
}());

var CartVoucherEffects = /** @class */ (function () {
    function CartVoucherEffects(actions$, cartVoucherConnector, messageService) {
        var _this = this;
        this.actions$ = actions$;
        this.cartVoucherConnector = cartVoucherConnector;
        this.messageService = messageService;
        this.addCartVoucher$ = this.actions$.pipe(ofType(CART_ADD_VOUCHER), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            return _this.cartVoucherConnector
                .add(payload.userId, payload.cartId, payload.voucherId)
                .pipe(map(function () {
                _this.showGlobalMessage('voucher.applyVoucherSuccess', payload.voucherId, GlobalMessageType.MSG_TYPE_CONFIRMATION);
                return new CartAddVoucherSuccess(__assign({}, payload));
            }), catchError(function (error) {
                return from([
                    new CartAddVoucherFail(__assign(__assign({}, payload), { error: makeErrorSerializable(error) })),
                    new CartProcessesDecrement(payload.cartId),
                    new LoadCart({
                        userId: payload.userId,
                        cartId: payload.cartId,
                    }),
                ]);
            }));
        }));
        this.removeCartVoucher$ = this.actions$.pipe(ofType(CART_REMOVE_VOUCHER), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            return _this.cartVoucherConnector
                .remove(payload.userId, payload.cartId, payload.voucherId)
                .pipe(map(function () {
                _this.showGlobalMessage('voucher.removeVoucherSuccess', payload.voucherId, GlobalMessageType.MSG_TYPE_INFO);
                return new CartRemoveVoucherSuccess({
                    userId: payload.userId,
                    cartId: payload.cartId,
                    voucherId: payload.voucherId,
                });
            }), catchError(function (error) {
                return from([
                    new CartRemoveVoucherFail({
                        error: makeErrorSerializable(error),
                        cartId: payload.cartId,
                        userId: payload.userId,
                        voucherId: payload.voucherId,
                    }),
                    new LoadCart({
                        userId: payload.userId,
                        cartId: payload.cartId,
                    }),
                ]);
            }));
        }));
    }
    CartVoucherEffects.prototype.showGlobalMessage = function (text, param, messageType) {
        this.messageService.add({ key: text, params: { voucherCode: param } }, messageType);
    };
    CartVoucherEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: CartVoucherConnector },
        { type: GlobalMessageService }
    ]; };
    __decorate([
        Effect()
    ], CartVoucherEffects.prototype, "addCartVoucher$", void 0);
    __decorate([
        Effect()
    ], CartVoucherEffects.prototype, "removeCartVoucher$", void 0);
    CartVoucherEffects = __decorate([
        Injectable()
    ], CartVoucherEffects);
    return CartVoucherEffects;
}());

var VERIFY_ADDRESS = '[Checkout] Verify Address';
var VERIFY_ADDRESS_FAIL = '[Checkout] Verify Address Fail';
var VERIFY_ADDRESS_SUCCESS = '[Checkout] Verify Address Success';
var CLEAR_ADDRESS_VERIFICATION_RESULTS = '[Checkout] Clear Address Verification Results';
var VerifyAddress = /** @class */ (function () {
    function VerifyAddress(payload) {
        this.payload = payload;
        this.type = VERIFY_ADDRESS;
    }
    return VerifyAddress;
}());
var VerifyAddressFail = /** @class */ (function () {
    function VerifyAddressFail(payload) {
        this.payload = payload;
        this.type = VERIFY_ADDRESS_FAIL;
    }
    return VerifyAddressFail;
}());
var VerifyAddressSuccess = /** @class */ (function () {
    function VerifyAddressSuccess(payload) {
        this.payload = payload;
        this.type = VERIFY_ADDRESS_SUCCESS;
    }
    return VerifyAddressSuccess;
}());
var ClearAddressVerificationResults = /** @class */ (function () {
    function ClearAddressVerificationResults() {
        this.type = CLEAR_ADDRESS_VERIFICATION_RESULTS;
    }
    return ClearAddressVerificationResults;
}());

var LOAD_CARD_TYPES = '[Checkout] Load Card Types';
var LOAD_CARD_TYPES_FAIL = '[Checkout] Load Card Fail';
var LOAD_CARD_TYPES_SUCCESS = '[Checkout] Load Card Success';
var LoadCardTypes = /** @class */ (function () {
    function LoadCardTypes() {
        this.type = LOAD_CARD_TYPES;
    }
    return LoadCardTypes;
}());
var LoadCardTypesFail = /** @class */ (function () {
    function LoadCardTypesFail(payload) {
        this.payload = payload;
        this.type = LOAD_CARD_TYPES_FAIL;
    }
    return LoadCardTypesFail;
}());
var LoadCardTypesSuccess = /** @class */ (function () {
    function LoadCardTypesSuccess(payload) {
        this.payload = payload;
        this.type = LOAD_CARD_TYPES_SUCCESS;
    }
    return LoadCardTypesSuccess;
}());

var CHECKOUT_FEATURE = 'checkout';
var CHECKOUT_DETAILS = '[Checkout] Checkout Details';
var SET_DELIVERY_ADDRESS_PROCESS_ID = 'setDeliveryAddress';
var SET_DELIVERY_MODE_PROCESS_ID = 'setDeliveryMode';
var SET_SUPPORTED_DELIVERY_MODE_PROCESS_ID = 'setSupportedDeliveryMode';
var SET_PAYMENT_DETAILS_PROCESS_ID = 'setPaymentDetails';

var CLEAR_CHECKOUT_DELIVERY_ADDRESS = '[Checkout] Clear Checkout Delivery Address';
var CLEAR_CHECKOUT_DELIVERY_ADDRESS_SUCCESS = '[Checkout] Clear Checkout Delivery Address Success';
var CLEAR_CHECKOUT_DELIVERY_ADDRESS_FAIL = '[Checkout] Clear Checkout Delivery Address Fail';
var CLEAR_CHECKOUT_DELIVERY_MODE = '[Checkout] Clear Checkout Delivery Mode';
var CLEAR_CHECKOUT_DELIVERY_MODE_SUCCESS = '[Checkout] Clear Checkout Delivery Mode Success';
var CLEAR_CHECKOUT_DELIVERY_MODE_FAIL = '[Checkout] Clear Checkout Delivery Mode Fail';
var ADD_DELIVERY_ADDRESS = '[Checkout] Add Delivery Address';
var ADD_DELIVERY_ADDRESS_FAIL = '[Checkout] Add Delivery Address Fail';
var ADD_DELIVERY_ADDRESS_SUCCESS = '[Checkout] Add Delivery Address Success';
var SET_DELIVERY_ADDRESS = '[Checkout] Set Delivery Address';
var SET_DELIVERY_ADDRESS_FAIL = '[Checkout] Set Delivery Address Fail';
var SET_DELIVERY_ADDRESS_SUCCESS = '[Checkout] Set Delivery Address Success';
var RESET_SET_DELIVERY_ADDRESS_PROCESS = '[Checkout] Reset Set Delivery Address Process';
var LOAD_SUPPORTED_DELIVERY_MODES = '[Checkout] Load Supported Delivery Modes';
var LOAD_SUPPORTED_DELIVERY_MODES_FAIL = '[Checkout] Load Supported Delivery Modes Fail';
var LOAD_SUPPORTED_DELIVERY_MODES_SUCCESS = '[Checkout] Load Supported Delivery Modes Success';
var CLEAR_SUPPORTED_DELIVERY_MODES = '[Checkout] Clear Supported Delivery Modes';
var SET_DELIVERY_MODE = '[Checkout] Set Delivery Mode';
var SET_DELIVERY_MODE_FAIL = '[Checkout] Set Delivery Mode Fail';
var SET_DELIVERY_MODE_SUCCESS = '[Checkout] Set Delivery Mode Success';
var RESET_SET_DELIVERY_MODE_PROCESS = '[Checkout] Reset Set Delivery Mode Process';
var SET_SUPPORTED_DELIVERY_MODES = '[Checkout] Set Supported Delivery Modes';
var SET_SUPPORTED_DELIVERY_MODES_FAIL = '[Checkout] Set Supported Delivery Modes Fail';
var SET_SUPPORTED_DELIVERY_MODES_SUCCESS = '[Checkout] Set Supported Delivery Modes Success';
var RESET_SUPPORTED_SET_DELIVERY_MODES_PROCESS = '[Checkout] Reset Set Supported Delivery Modes Process';
var CREATE_PAYMENT_DETAILS = '[Checkout] Create Payment Details';
var CREATE_PAYMENT_DETAILS_FAIL = '[Checkout] Create Payment Details Fail';
var CREATE_PAYMENT_DETAILS_SUCCESS = '[Checkout] Create Payment Details Success';
var SET_PAYMENT_DETAILS = '[Checkout] Set Payment Details';
var SET_PAYMENT_DETAILS_FAIL = '[Checkout] Set Payment Details Fail';
var SET_PAYMENT_DETAILS_SUCCESS = '[Checkout] Set Payment Details Success';
var RESET_SET_PAYMENT_DETAILS_PROCESS = '[Checkout] Reset Set Payment Details Process';
var PLACE_ORDER = '[Checkout] Place Order';
var PLACE_ORDER_FAIL = '[Checkout] Place Order Fail';
var PLACE_ORDER_SUCCESS = '[Checkout] Place Order Success';
var CLEAR_CHECKOUT_STEP = '[Checkout] Clear One Checkout Step';
var CLEAR_CHECKOUT_DATA = '[Checkout] Clear Checkout Data';
var LOAD_CHECKOUT_DETAILS = '[Checkout] Load Checkout Details';
var LOAD_CHECKOUT_DETAILS_FAIL = '[Checkout] Load Checkout Details Fail';
var LOAD_CHECKOUT_DETAILS_SUCCESS = '[Checkout] Load Checkout Details Success';
var CHECKOUT_CLEAR_MISCS_DATA = '[Checkout] Clear Miscs Data';
var PAYMENT_PROCESS_SUCCESS = '[Checkout] Payment Process Success';
var AddDeliveryAddress = /** @class */ (function () {
    function AddDeliveryAddress(payload) {
        this.payload = payload;
        this.type = ADD_DELIVERY_ADDRESS;
    }
    return AddDeliveryAddress;
}());
var AddDeliveryAddressFail = /** @class */ (function () {
    function AddDeliveryAddressFail(payload) {
        this.payload = payload;
        this.type = ADD_DELIVERY_ADDRESS_FAIL;
    }
    return AddDeliveryAddressFail;
}());
var AddDeliveryAddressSuccess = /** @class */ (function () {
    function AddDeliveryAddressSuccess(payload) {
        this.payload = payload;
        this.type = ADD_DELIVERY_ADDRESS_SUCCESS;
    }
    return AddDeliveryAddressSuccess;
}());
var SetDeliveryAddress = /** @class */ (function (_super) {
    __extends(SetDeliveryAddress, _super);
    function SetDeliveryAddress(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, SET_DELIVERY_ADDRESS_PROCESS_ID) || this;
        _this.payload = payload;
        _this.type = SET_DELIVERY_ADDRESS;
        return _this;
    }
    return SetDeliveryAddress;
}(EntityLoadAction));
var SetDeliveryAddressFail = /** @class */ (function (_super) {
    __extends(SetDeliveryAddressFail, _super);
    function SetDeliveryAddressFail(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, SET_DELIVERY_ADDRESS_PROCESS_ID, payload) || this;
        _this.payload = payload;
        _this.type = SET_DELIVERY_ADDRESS_FAIL;
        return _this;
    }
    return SetDeliveryAddressFail;
}(EntityFailAction));
var SetDeliveryAddressSuccess = /** @class */ (function (_super) {
    __extends(SetDeliveryAddressSuccess, _super);
    function SetDeliveryAddressSuccess(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, SET_DELIVERY_ADDRESS_PROCESS_ID) || this;
        _this.payload = payload;
        _this.type = SET_DELIVERY_ADDRESS_SUCCESS;
        return _this;
    }
    return SetDeliveryAddressSuccess;
}(EntitySuccessAction));
var ResetSetDeliveryAddressProcess = /** @class */ (function (_super) {
    __extends(ResetSetDeliveryAddressProcess, _super);
    function ResetSetDeliveryAddressProcess() {
        var _this = _super.call(this, PROCESS_FEATURE, SET_DELIVERY_ADDRESS_PROCESS_ID) || this;
        _this.type = RESET_SET_DELIVERY_ADDRESS_PROCESS;
        return _this;
    }
    return ResetSetDeliveryAddressProcess;
}(EntityLoaderResetAction));
var LoadSupportedDeliveryModes = /** @class */ (function (_super) {
    __extends(LoadSupportedDeliveryModes, _super);
    function LoadSupportedDeliveryModes(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, SET_SUPPORTED_DELIVERY_MODE_PROCESS_ID) || this;
        _this.payload = payload;
        _this.type = LOAD_SUPPORTED_DELIVERY_MODES;
        return _this;
    }
    return LoadSupportedDeliveryModes;
}(EntityLoadAction));
var LoadSupportedDeliveryModesFail = /** @class */ (function (_super) {
    __extends(LoadSupportedDeliveryModesFail, _super);
    function LoadSupportedDeliveryModesFail(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, SET_SUPPORTED_DELIVERY_MODE_PROCESS_ID) || this;
        _this.payload = payload;
        _this.type = LOAD_SUPPORTED_DELIVERY_MODES_FAIL;
        return _this;
    }
    return LoadSupportedDeliveryModesFail;
}(EntityFailAction));
var LoadSupportedDeliveryModesSuccess = /** @class */ (function (_super) {
    __extends(LoadSupportedDeliveryModesSuccess, _super);
    function LoadSupportedDeliveryModesSuccess(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, SET_SUPPORTED_DELIVERY_MODE_PROCESS_ID) || this;
        _this.payload = payload;
        _this.type = LOAD_SUPPORTED_DELIVERY_MODES_SUCCESS;
        return _this;
    }
    return LoadSupportedDeliveryModesSuccess;
}(EntitySuccessAction));
var ResetLoadSupportedDeliveryModesProcess = /** @class */ (function (_super) {
    __extends(ResetLoadSupportedDeliveryModesProcess, _super);
    function ResetLoadSupportedDeliveryModesProcess() {
        var _this = _super.call(this, PROCESS_FEATURE, SET_SUPPORTED_DELIVERY_MODE_PROCESS_ID) || this;
        _this.type = RESET_SUPPORTED_SET_DELIVERY_MODES_PROCESS;
        return _this;
    }
    return ResetLoadSupportedDeliveryModesProcess;
}(EntityLoaderResetAction));
var SetDeliveryMode = /** @class */ (function (_super) {
    __extends(SetDeliveryMode, _super);
    function SetDeliveryMode(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, SET_DELIVERY_MODE_PROCESS_ID) || this;
        _this.payload = payload;
        _this.type = SET_DELIVERY_MODE;
        return _this;
    }
    return SetDeliveryMode;
}(EntityLoadAction));
var SetDeliveryModeFail = /** @class */ (function (_super) {
    __extends(SetDeliveryModeFail, _super);
    function SetDeliveryModeFail(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, SET_DELIVERY_MODE_PROCESS_ID, payload) || this;
        _this.payload = payload;
        _this.type = SET_DELIVERY_MODE_FAIL;
        return _this;
    }
    return SetDeliveryModeFail;
}(EntityFailAction));
var SetDeliveryModeSuccess = /** @class */ (function (_super) {
    __extends(SetDeliveryModeSuccess, _super);
    function SetDeliveryModeSuccess(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, SET_DELIVERY_MODE_PROCESS_ID) || this;
        _this.payload = payload;
        _this.type = SET_DELIVERY_MODE_SUCCESS;
        return _this;
    }
    return SetDeliveryModeSuccess;
}(EntitySuccessAction));
var ResetSetDeliveryModeProcess = /** @class */ (function (_super) {
    __extends(ResetSetDeliveryModeProcess, _super);
    function ResetSetDeliveryModeProcess() {
        var _this = _super.call(this, PROCESS_FEATURE, SET_DELIVERY_MODE_PROCESS_ID) || this;
        _this.type = RESET_SET_DELIVERY_MODE_PROCESS;
        return _this;
    }
    return ResetSetDeliveryModeProcess;
}(EntityLoaderResetAction));
var CreatePaymentDetails = /** @class */ (function (_super) {
    __extends(CreatePaymentDetails, _super);
    function CreatePaymentDetails(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, SET_PAYMENT_DETAILS_PROCESS_ID) || this;
        _this.payload = payload;
        _this.type = CREATE_PAYMENT_DETAILS;
        return _this;
    }
    return CreatePaymentDetails;
}(EntityLoadAction));
var CreatePaymentDetailsFail = /** @class */ (function (_super) {
    __extends(CreatePaymentDetailsFail, _super);
    function CreatePaymentDetailsFail(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, SET_PAYMENT_DETAILS_PROCESS_ID) || this;
        _this.payload = payload;
        _this.type = CREATE_PAYMENT_DETAILS_FAIL;
        return _this;
    }
    return CreatePaymentDetailsFail;
}(EntityFailAction));
var CreatePaymentDetailsSuccess = /** @class */ (function () {
    function CreatePaymentDetailsSuccess(payload) {
        this.payload = payload;
        this.type = CREATE_PAYMENT_DETAILS_SUCCESS;
    }
    return CreatePaymentDetailsSuccess;
}());
var PaymentProcessSuccess = /** @class */ (function (_super) {
    __extends(PaymentProcessSuccess, _super);
    function PaymentProcessSuccess() {
        var _this = _super.call(this, PROCESS_FEATURE, SET_PAYMENT_DETAILS_PROCESS_ID) || this;
        _this.type = PAYMENT_PROCESS_SUCCESS;
        return _this;
    }
    return PaymentProcessSuccess;
}(EntitySuccessAction));
var SetPaymentDetails = /** @class */ (function (_super) {
    __extends(SetPaymentDetails, _super);
    function SetPaymentDetails(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, SET_PAYMENT_DETAILS_PROCESS_ID) || this;
        _this.payload = payload;
        _this.type = SET_PAYMENT_DETAILS;
        return _this;
    }
    return SetPaymentDetails;
}(EntityLoadAction));
var SetPaymentDetailsFail = /** @class */ (function (_super) {
    __extends(SetPaymentDetailsFail, _super);
    function SetPaymentDetailsFail(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, SET_PAYMENT_DETAILS_PROCESS_ID, payload) || this;
        _this.payload = payload;
        _this.type = SET_PAYMENT_DETAILS_FAIL;
        return _this;
    }
    return SetPaymentDetailsFail;
}(EntityFailAction));
var SetPaymentDetailsSuccess = /** @class */ (function (_super) {
    __extends(SetPaymentDetailsSuccess, _super);
    function SetPaymentDetailsSuccess(payload) {
        var _this = _super.call(this, PROCESS_FEATURE, SET_PAYMENT_DETAILS_PROCESS_ID) || this;
        _this.payload = payload;
        _this.type = SET_PAYMENT_DETAILS_SUCCESS;
        return _this;
    }
    return SetPaymentDetailsSuccess;
}(EntitySuccessAction));
var ResetSetPaymentDetailsProcess = /** @class */ (function (_super) {
    __extends(ResetSetPaymentDetailsProcess, _super);
    function ResetSetPaymentDetailsProcess() {
        var _this = _super.call(this, PROCESS_FEATURE, SET_PAYMENT_DETAILS_PROCESS_ID) || this;
        _this.type = RESET_SET_PAYMENT_DETAILS_PROCESS;
        return _this;
    }
    return ResetSetPaymentDetailsProcess;
}(EntityLoaderResetAction));
var PlaceOrder = /** @class */ (function () {
    function PlaceOrder(payload) {
        this.payload = payload;
        this.type = PLACE_ORDER;
    }
    return PlaceOrder;
}());
var PlaceOrderFail = /** @class */ (function () {
    function PlaceOrderFail(payload) {
        this.payload = payload;
        this.type = PLACE_ORDER_FAIL;
    }
    return PlaceOrderFail;
}());
var PlaceOrderSuccess = /** @class */ (function () {
    function PlaceOrderSuccess(payload) {
        this.payload = payload;
        this.type = PLACE_ORDER_SUCCESS;
    }
    return PlaceOrderSuccess;
}());
var ClearSupportedDeliveryModes = /** @class */ (function () {
    function ClearSupportedDeliveryModes() {
        this.type = CLEAR_SUPPORTED_DELIVERY_MODES;
    }
    return ClearSupportedDeliveryModes;
}());
var ClearCheckoutStep = /** @class */ (function () {
    function ClearCheckoutStep(payload) {
        this.payload = payload;
        this.type = CLEAR_CHECKOUT_STEP;
    }
    return ClearCheckoutStep;
}());
var ClearCheckoutData = /** @class */ (function () {
    function ClearCheckoutData() {
        this.type = CLEAR_CHECKOUT_DATA;
    }
    return ClearCheckoutData;
}());
var LoadCheckoutDetails = /** @class */ (function (_super) {
    __extends(LoadCheckoutDetails, _super);
    function LoadCheckoutDetails(payload) {
        var _this = _super.call(this, CHECKOUT_DETAILS) || this;
        _this.payload = payload;
        _this.type = LOAD_CHECKOUT_DETAILS;
        return _this;
    }
    return LoadCheckoutDetails;
}(LoaderLoadAction));
var LoadCheckoutDetailsFail = /** @class */ (function (_super) {
    __extends(LoadCheckoutDetailsFail, _super);
    function LoadCheckoutDetailsFail(payload) {
        var _this = _super.call(this, CHECKOUT_DETAILS, payload) || this;
        _this.payload = payload;
        _this.type = LOAD_CHECKOUT_DETAILS_FAIL;
        return _this;
    }
    return LoadCheckoutDetailsFail;
}(LoaderFailAction));
var LoadCheckoutDetailsSuccess = /** @class */ (function (_super) {
    __extends(LoadCheckoutDetailsSuccess, _super);
    function LoadCheckoutDetailsSuccess(payload) {
        var _this = _super.call(this, CHECKOUT_DETAILS) || this;
        _this.payload = payload;
        _this.type = LOAD_CHECKOUT_DETAILS_SUCCESS;
        return _this;
    }
    return LoadCheckoutDetailsSuccess;
}(LoaderSuccessAction));
var CheckoutClearMiscsData = /** @class */ (function () {
    function CheckoutClearMiscsData() {
        this.type = CHECKOUT_CLEAR_MISCS_DATA;
    }
    return CheckoutClearMiscsData;
}());
var ClearCheckoutDeliveryAddress = /** @class */ (function () {
    function ClearCheckoutDeliveryAddress(payload) {
        this.payload = payload;
        this.type = CLEAR_CHECKOUT_DELIVERY_ADDRESS;
    }
    return ClearCheckoutDeliveryAddress;
}());
var ClearCheckoutDeliveryAddressSuccess = /** @class */ (function () {
    function ClearCheckoutDeliveryAddressSuccess() {
        this.type = CLEAR_CHECKOUT_DELIVERY_ADDRESS_SUCCESS;
    }
    return ClearCheckoutDeliveryAddressSuccess;
}());
var ClearCheckoutDeliveryAddressFail = /** @class */ (function () {
    function ClearCheckoutDeliveryAddressFail(payload) {
        this.payload = payload;
        this.type = CLEAR_CHECKOUT_DELIVERY_ADDRESS_FAIL;
    }
    return ClearCheckoutDeliveryAddressFail;
}());
var ClearCheckoutDeliveryMode = /** @class */ (function (_super) {
    __extends(ClearCheckoutDeliveryMode, _super);
    function ClearCheckoutDeliveryMode(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.cartId) || this;
        _this.payload = payload;
        _this.type = CLEAR_CHECKOUT_DELIVERY_MODE;
        return _this;
    }
    return ClearCheckoutDeliveryMode;
}(EntityProcessesIncrementAction));
var ClearCheckoutDeliveryModeSuccess = /** @class */ (function (_super) {
    __extends(ClearCheckoutDeliveryModeSuccess, _super);
    function ClearCheckoutDeliveryModeSuccess(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.cartId) || this;
        _this.payload = payload;
        _this.type = CLEAR_CHECKOUT_DELIVERY_MODE_SUCCESS;
        return _this;
    }
    return ClearCheckoutDeliveryModeSuccess;
}(EntityProcessesDecrementAction));
var ClearCheckoutDeliveryModeFail = /** @class */ (function (_super) {
    __extends(ClearCheckoutDeliveryModeFail, _super);
    function ClearCheckoutDeliveryModeFail(payload) {
        var _this = _super.call(this, MULTI_CART_DATA, payload.cartId) || this;
        _this.payload = payload;
        _this.type = CLEAR_CHECKOUT_DELIVERY_MODE_FAIL;
        return _this;
    }
    return ClearCheckoutDeliveryModeFail;
}(EntityProcessesDecrementAction));



var checkoutGroup_actions = /*#__PURE__*/Object.freeze({
    __proto__: null,
    VERIFY_ADDRESS: VERIFY_ADDRESS,
    VERIFY_ADDRESS_FAIL: VERIFY_ADDRESS_FAIL,
    VERIFY_ADDRESS_SUCCESS: VERIFY_ADDRESS_SUCCESS,
    CLEAR_ADDRESS_VERIFICATION_RESULTS: CLEAR_ADDRESS_VERIFICATION_RESULTS,
    VerifyAddress: VerifyAddress,
    VerifyAddressFail: VerifyAddressFail,
    VerifyAddressSuccess: VerifyAddressSuccess,
    ClearAddressVerificationResults: ClearAddressVerificationResults,
    LOAD_CARD_TYPES: LOAD_CARD_TYPES,
    LOAD_CARD_TYPES_FAIL: LOAD_CARD_TYPES_FAIL,
    LOAD_CARD_TYPES_SUCCESS: LOAD_CARD_TYPES_SUCCESS,
    LoadCardTypes: LoadCardTypes,
    LoadCardTypesFail: LoadCardTypesFail,
    LoadCardTypesSuccess: LoadCardTypesSuccess,
    CLEAR_CHECKOUT_DELIVERY_ADDRESS: CLEAR_CHECKOUT_DELIVERY_ADDRESS,
    CLEAR_CHECKOUT_DELIVERY_ADDRESS_SUCCESS: CLEAR_CHECKOUT_DELIVERY_ADDRESS_SUCCESS,
    CLEAR_CHECKOUT_DELIVERY_ADDRESS_FAIL: CLEAR_CHECKOUT_DELIVERY_ADDRESS_FAIL,
    CLEAR_CHECKOUT_DELIVERY_MODE: CLEAR_CHECKOUT_DELIVERY_MODE,
    CLEAR_CHECKOUT_DELIVERY_MODE_SUCCESS: CLEAR_CHECKOUT_DELIVERY_MODE_SUCCESS,
    CLEAR_CHECKOUT_DELIVERY_MODE_FAIL: CLEAR_CHECKOUT_DELIVERY_MODE_FAIL,
    ADD_DELIVERY_ADDRESS: ADD_DELIVERY_ADDRESS,
    ADD_DELIVERY_ADDRESS_FAIL: ADD_DELIVERY_ADDRESS_FAIL,
    ADD_DELIVERY_ADDRESS_SUCCESS: ADD_DELIVERY_ADDRESS_SUCCESS,
    SET_DELIVERY_ADDRESS: SET_DELIVERY_ADDRESS,
    SET_DELIVERY_ADDRESS_FAIL: SET_DELIVERY_ADDRESS_FAIL,
    SET_DELIVERY_ADDRESS_SUCCESS: SET_DELIVERY_ADDRESS_SUCCESS,
    RESET_SET_DELIVERY_ADDRESS_PROCESS: RESET_SET_DELIVERY_ADDRESS_PROCESS,
    LOAD_SUPPORTED_DELIVERY_MODES: LOAD_SUPPORTED_DELIVERY_MODES,
    LOAD_SUPPORTED_DELIVERY_MODES_FAIL: LOAD_SUPPORTED_DELIVERY_MODES_FAIL,
    LOAD_SUPPORTED_DELIVERY_MODES_SUCCESS: LOAD_SUPPORTED_DELIVERY_MODES_SUCCESS,
    CLEAR_SUPPORTED_DELIVERY_MODES: CLEAR_SUPPORTED_DELIVERY_MODES,
    SET_DELIVERY_MODE: SET_DELIVERY_MODE,
    SET_DELIVERY_MODE_FAIL: SET_DELIVERY_MODE_FAIL,
    SET_DELIVERY_MODE_SUCCESS: SET_DELIVERY_MODE_SUCCESS,
    RESET_SET_DELIVERY_MODE_PROCESS: RESET_SET_DELIVERY_MODE_PROCESS,
    SET_SUPPORTED_DELIVERY_MODES: SET_SUPPORTED_DELIVERY_MODES,
    SET_SUPPORTED_DELIVERY_MODES_FAIL: SET_SUPPORTED_DELIVERY_MODES_FAIL,
    SET_SUPPORTED_DELIVERY_MODES_SUCCESS: SET_SUPPORTED_DELIVERY_MODES_SUCCESS,
    RESET_SUPPORTED_SET_DELIVERY_MODES_PROCESS: RESET_SUPPORTED_SET_DELIVERY_MODES_PROCESS,
    CREATE_PAYMENT_DETAILS: CREATE_PAYMENT_DETAILS,
    CREATE_PAYMENT_DETAILS_FAIL: CREATE_PAYMENT_DETAILS_FAIL,
    CREATE_PAYMENT_DETAILS_SUCCESS: CREATE_PAYMENT_DETAILS_SUCCESS,
    SET_PAYMENT_DETAILS: SET_PAYMENT_DETAILS,
    SET_PAYMENT_DETAILS_FAIL: SET_PAYMENT_DETAILS_FAIL,
    SET_PAYMENT_DETAILS_SUCCESS: SET_PAYMENT_DETAILS_SUCCESS,
    RESET_SET_PAYMENT_DETAILS_PROCESS: RESET_SET_PAYMENT_DETAILS_PROCESS,
    PLACE_ORDER: PLACE_ORDER,
    PLACE_ORDER_FAIL: PLACE_ORDER_FAIL,
    PLACE_ORDER_SUCCESS: PLACE_ORDER_SUCCESS,
    CLEAR_CHECKOUT_STEP: CLEAR_CHECKOUT_STEP,
    CLEAR_CHECKOUT_DATA: CLEAR_CHECKOUT_DATA,
    LOAD_CHECKOUT_DETAILS: LOAD_CHECKOUT_DETAILS,
    LOAD_CHECKOUT_DETAILS_FAIL: LOAD_CHECKOUT_DETAILS_FAIL,
    LOAD_CHECKOUT_DETAILS_SUCCESS: LOAD_CHECKOUT_DETAILS_SUCCESS,
    CHECKOUT_CLEAR_MISCS_DATA: CHECKOUT_CLEAR_MISCS_DATA,
    PAYMENT_PROCESS_SUCCESS: PAYMENT_PROCESS_SUCCESS,
    AddDeliveryAddress: AddDeliveryAddress,
    AddDeliveryAddressFail: AddDeliveryAddressFail,
    AddDeliveryAddressSuccess: AddDeliveryAddressSuccess,
    SetDeliveryAddress: SetDeliveryAddress,
    SetDeliveryAddressFail: SetDeliveryAddressFail,
    SetDeliveryAddressSuccess: SetDeliveryAddressSuccess,
    ResetSetDeliveryAddressProcess: ResetSetDeliveryAddressProcess,
    LoadSupportedDeliveryModes: LoadSupportedDeliveryModes,
    LoadSupportedDeliveryModesFail: LoadSupportedDeliveryModesFail,
    LoadSupportedDeliveryModesSuccess: LoadSupportedDeliveryModesSuccess,
    ResetLoadSupportedDeliveryModesProcess: ResetLoadSupportedDeliveryModesProcess,
    SetDeliveryMode: SetDeliveryMode,
    SetDeliveryModeFail: SetDeliveryModeFail,
    SetDeliveryModeSuccess: SetDeliveryModeSuccess,
    ResetSetDeliveryModeProcess: ResetSetDeliveryModeProcess,
    CreatePaymentDetails: CreatePaymentDetails,
    CreatePaymentDetailsFail: CreatePaymentDetailsFail,
    CreatePaymentDetailsSuccess: CreatePaymentDetailsSuccess,
    PaymentProcessSuccess: PaymentProcessSuccess,
    SetPaymentDetails: SetPaymentDetails,
    SetPaymentDetailsFail: SetPaymentDetailsFail,
    SetPaymentDetailsSuccess: SetPaymentDetailsSuccess,
    ResetSetPaymentDetailsProcess: ResetSetPaymentDetailsProcess,
    PlaceOrder: PlaceOrder,
    PlaceOrderFail: PlaceOrderFail,
    PlaceOrderSuccess: PlaceOrderSuccess,
    ClearSupportedDeliveryModes: ClearSupportedDeliveryModes,
    ClearCheckoutStep: ClearCheckoutStep,
    ClearCheckoutData: ClearCheckoutData,
    LoadCheckoutDetails: LoadCheckoutDetails,
    LoadCheckoutDetailsFail: LoadCheckoutDetailsFail,
    LoadCheckoutDetailsSuccess: LoadCheckoutDetailsSuccess,
    CheckoutClearMiscsData: CheckoutClearMiscsData,
    ClearCheckoutDeliveryAddress: ClearCheckoutDeliveryAddress,
    ClearCheckoutDeliveryAddressSuccess: ClearCheckoutDeliveryAddressSuccess,
    ClearCheckoutDeliveryAddressFail: ClearCheckoutDeliveryAddressFail,
    ClearCheckoutDeliveryMode: ClearCheckoutDeliveryMode,
    ClearCheckoutDeliveryModeSuccess: ClearCheckoutDeliveryModeSuccess,
    ClearCheckoutDeliveryModeFail: ClearCheckoutDeliveryModeFail
});

var CartConnector = /** @class */ (function () {
    function CartConnector(adapter) {
        this.adapter = adapter;
    }
    CartConnector.prototype.loadAll = function (userId) {
        return this.adapter.loadAll(userId);
    };
    CartConnector.prototype.load = function (userId, cartId) {
        return this.adapter.load(userId, cartId);
    };
    CartConnector.prototype.create = function (userId, oldCartId, toMergeCartGuid) {
        return this.adapter.create(userId, oldCartId, toMergeCartGuid);
    };
    CartConnector.prototype.delete = function (userId, cartId) {
        return this.adapter.delete(userId, cartId);
    };
    CartConnector.prototype.addEmail = function (userId, cartId, email) {
        return this.adapter.addEmail(userId, cartId, email);
    };
    CartConnector.ctorParameters = function () { return [
        { type: CartAdapter }
    ]; };
    CartConnector.ɵprov = ɵɵdefineInjectable({ factory: function CartConnector_Factory() { return new CartConnector(ɵɵinject(CartAdapter)); }, token: CartConnector, providedIn: "root" });
    CartConnector = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], CartConnector);
    return CartConnector;
}());

var CartEffects = /** @class */ (function () {
    function CartEffects(actions$, cartConnector, store) {
        var _this = this;
        this.actions$ = actions$;
        this.cartConnector = cartConnector;
        this.store = store;
        this.contextChange$ = this.actions$.pipe(ofType(CURRENCY_CHANGE, LANGUAGE_CHANGE));
        this.loadCart$ = this.actions$.pipe(ofType(LOAD_CART), map(function (action) { return action.payload; }), groupBy(function (payload) { return payload.cartId; }), mergeMap(function (group$) {
            return group$.pipe(switchMap(function (payload) {
                return of(payload).pipe(withLatestFrom(_this.store.pipe(select(getCartHasPendingProcessesSelectorFactory(payload.cartId)))));
            }), filter(function (_a) {
                var _b = __read(_a, 2), _ = _b[0], hasPendingProcesses = _b[1];
                return !hasPendingProcesses;
            }), map(function (_a) {
                var _b = __read(_a, 1), payload = _b[0];
                return payload;
            }), switchMap(function (payload) {
                return _this.cartConnector.load(payload.userId, payload.cartId).pipe(mergeMap(function (cart) {
                    var actions = [];
                    if (cart) {
                        actions.push(new LoadCartSuccess(__assign(__assign({}, payload), { cart: cart, cartId: getCartIdByUserId(cart, payload.userId) })));
                        if (payload.cartId === OCC_CART_ID_CURRENT) {
                            // Removing cart from entity object under `current` key as it is no longer needed.
                            // Current cart is loaded under it's code entity.
                            actions.push(new RemoveCart({ cartId: OCC_CART_ID_CURRENT }));
                        }
                    }
                    else {
                        actions = [
                            new LoadCartFail(__assign(__assign({}, payload), { error: {} })),
                        ];
                    }
                    return actions;
                }), catchError(function (error) {
                    var _a;
                    if ((_a = error === null || error === void 0 ? void 0 : error.error) === null || _a === void 0 ? void 0 : _a.errors) {
                        var couponExpiredErrors = error.error.errors.filter(function (err) { return err.reason === 'invalid'; });
                        if (couponExpiredErrors.length > 0) {
                            // Reload in case of expired coupon.
                            return of(new LoadCart(__assign({}, payload)));
                        }
                        var cartNotFoundErrors = error.error.errors.filter(function (err) {
                            return isCartNotFoundError(err) ||
                                err.reason === 'UnknownResourceError';
                        });
                        if (cartNotFoundErrors.length > 0) {
                            // Remove cart as it doesn't exist on backend (selective cart always exists).
                            return of(new RemoveCart({ cartId: payload.cartId }));
                        }
                    }
                    return of(new LoadCartFail(__assign(__assign({}, payload), { error: makeErrorSerializable(error) })));
                }));
            }));
        }), withdrawOn(this.contextChange$));
        this.createCart$ = this.actions$.pipe(ofType(CREATE_CART), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            return _this.cartConnector
                .create(payload.userId, payload.oldCartId, payload.toMergeCartGuid)
                .pipe(switchMap(function (cart) {
                var conditionalActions = [];
                if (payload.oldCartId) {
                    conditionalActions.push(new MergeCartSuccess({
                        extraData: payload.extraData,
                        userId: payload.userId,
                        tempCartId: payload.tempCartId,
                        cartId: getCartIdByUserId(cart, payload.userId),
                        oldCartId: payload.oldCartId,
                    }));
                }
                return __spread([
                    new CreateCartSuccess(__assign(__assign({}, payload), { cart: cart, cartId: getCartIdByUserId(cart, payload.userId) })),
                    new SetTempCart({
                        cart: cart,
                        tempCartId: payload.tempCartId,
                    })
                ], conditionalActions);
            }), catchError(function (error) {
                return of(new CreateCartFail(__assign(__assign({}, payload), { error: makeErrorSerializable(error) })));
            }));
        }), withdrawOn(this.contextChange$));
        this.mergeCart$ = this.actions$.pipe(ofType(MERGE_CART), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            return _this.cartConnector.load(payload.userId, OCC_CART_ID_CURRENT).pipe(mergeMap(function (currentCart) {
                return [
                    new CreateCart({
                        userId: payload.userId,
                        oldCartId: payload.cartId,
                        toMergeCartGuid: currentCart ? currentCart.guid : undefined,
                        extraData: payload.extraData,
                        tempCartId: payload.tempCartId,
                    }),
                ];
            }));
        }), withdrawOn(this.contextChange$));
        // TODO(#7241): Remove when AddVoucherSuccess actions will extend processes actions
        this.refresh$ = this.actions$.pipe(ofType(CART_ADD_VOUCHER_SUCCESS), map(function (action) { return action.payload; }), concatMap(function (payload) {
            return from([
                new CartProcessesDecrement(payload.cartId),
                new LoadCart({
                    userId: payload.userId,
                    cartId: payload.cartId,
                }),
            ]);
        }));
        // TODO: Switch to automatic cart reload on processes count reaching 0 for cart entity
        this.refreshWithoutProcesses$ = this.actions$.pipe(ofType(CART_ADD_ENTRY_SUCCESS, CART_REMOVE_ENTRY_SUCCESS, CART_UPDATE_ENTRY_SUCCESS, CART_REMOVE_VOUCHER_SUCCESS, CLEAR_CHECKOUT_DELIVERY_MODE_SUCCESS), map(function (action) { return action.payload; }), map(function (payload) {
            return new LoadCart({
                userId: payload.userId,
                cartId: payload.cartId,
            });
        }));
        this.resetCartDetailsOnSiteContextChange$ = this.actions$.pipe(ofType(LANGUAGE_CHANGE, CURRENCY_CHANGE), mergeMap(function () {
            return [new ResetCartDetails()];
        }));
        this.addEmail$ = this.actions$.pipe(ofType(ADD_EMAIL_TO_CART), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            return _this.cartConnector
                .addEmail(payload.userId, payload.cartId, payload.email)
                .pipe(mergeMap(function () {
                return [
                    new AddEmailToCartSuccess(__assign({}, payload)),
                    new LoadCart({
                        userId: payload.userId,
                        cartId: payload.cartId,
                    }),
                ];
            }), catchError(function (error) {
                return from([
                    new AddEmailToCartFail(__assign(__assign({}, payload), { error: makeErrorSerializable(error) })),
                    new LoadCart({
                        userId: payload.userId,
                        cartId: payload.cartId,
                    }),
                ]);
            }));
        }), withdrawOn(this.contextChange$));
        this.deleteCart$ = this.actions$.pipe(ofType(DELETE_CART), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            return _this.cartConnector.delete(payload.userId, payload.cartId).pipe(map(function () {
                return new DeleteCartSuccess(__assign({}, payload));
            }), catchError(function (error) {
                return from([
                    new DeleteCartFail(__assign(__assign({}, payload), { error: makeErrorSerializable(error) })),
                    // Error might happen in higher backend layer and cart could still be removed.
                    // When load fail with NotFound error then RemoveCart action will kick in and clear that cart in our state.
                    new LoadCart(__assign({}, payload)),
                ]);
            }));
        }));
    }
    CartEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: CartConnector },
        { type: Store }
    ]; };
    __decorate([
        Effect()
    ], CartEffects.prototype, "loadCart$", void 0);
    __decorate([
        Effect()
    ], CartEffects.prototype, "createCart$", void 0);
    __decorate([
        Effect()
    ], CartEffects.prototype, "mergeCart$", void 0);
    __decorate([
        Effect()
    ], CartEffects.prototype, "refresh$", void 0);
    __decorate([
        Effect()
    ], CartEffects.prototype, "refreshWithoutProcesses$", void 0);
    __decorate([
        Effect()
    ], CartEffects.prototype, "resetCartDetailsOnSiteContextChange$", void 0);
    __decorate([
        Effect()
    ], CartEffects.prototype, "addEmail$", void 0);
    __decorate([
        Effect()
    ], CartEffects.prototype, "deleteCart$", void 0);
    CartEffects = __decorate([
        Injectable()
    ], CartEffects);
    return CartEffects;
}());

var SaveCartConnector = /** @class */ (function () {
    function SaveCartConnector(adapter) {
        this.adapter = adapter;
    }
    SaveCartConnector.prototype.saveCart = function (userId, cartId, saveCartName, saveCartDescription) {
        return this.adapter.saveCart(userId, cartId, saveCartName, saveCartDescription);
    };
    SaveCartConnector.ctorParameters = function () { return [
        { type: SaveCartAdapter }
    ]; };
    SaveCartConnector.ɵprov = ɵɵdefineInjectable({ factory: function SaveCartConnector_Factory() { return new SaveCartConnector(ɵɵinject(SaveCartAdapter)); }, token: SaveCartConnector, providedIn: "root" });
    SaveCartConnector = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], SaveCartConnector);
    return SaveCartConnector;
}());

var WishListEffects = /** @class */ (function () {
    function WishListEffects(actions$, cartConnector, saveCartConnector, authService, store) {
        var _this = this;
        this.actions$ = actions$;
        this.cartConnector = cartConnector;
        this.saveCartConnector = saveCartConnector;
        this.authService = authService;
        this.store = store;
        this.createWishList$ = this.actions$.pipe(ofType(CREATE_WISH_LIST), map(function (action) { return action.payload; }), switchMap(function (payload) {
            return _this.cartConnector.create(payload.userId).pipe(switchMap(function (cart) {
                return _this.saveCartConnector
                    .saveCart(payload.userId, cart.code, payload.name, payload.description)
                    .pipe(switchMap(function (saveCartResult) { return [
                    new CreateWishListSuccess({
                        cart: saveCartResult.savedCartData,
                        userId: payload.userId,
                    }),
                ]; }), catchError(function (error) {
                    return from([
                        new CreateWishListFail({
                            cartId: cart.code,
                            error: makeErrorSerializable(error),
                        }),
                    ]);
                }));
            }));
        }));
        this.loadWishList$ = this.actions$.pipe(ofType(LOAD_WISH_LIST), map(function (action) { return action.payload; }), concatMap(function (payload) {
            var userId = payload.userId, customerId = payload.customerId, tempCartId = payload.tempCartId;
            return _this.cartConnector.loadAll(userId).pipe(switchMap(function (carts) {
                if (carts) {
                    var wishList = carts.find(function (cart) { return cart.name === getWishlistName(customerId); });
                    if (Boolean(wishList)) {
                        return [
                            new LoadWishListSuccess({
                                cart: wishList,
                                userId: userId,
                                tempCartId: tempCartId,
                                customerId: customerId,
                                cartId: getCartIdByUserId(wishList, userId),
                            }),
                            new RemoveCart({ cartId: tempCartId }),
                        ];
                    }
                    else {
                        return [
                            new CreateWishList({
                                userId: userId,
                                name: getWishlistName(customerId),
                            }),
                        ];
                    }
                }
            }), catchError(function (error) {
                return from([
                    new LoadWishListFail({
                        userId: userId,
                        cartId: tempCartId,
                        customerId: customerId,
                        error: makeErrorSerializable(error),
                    }),
                ]);
            }));
        }));
        this.resetWishList$ = this.actions$.pipe(ofType(LANGUAGE_CHANGE, CURRENCY_CHANGE), withLatestFrom(this.authService.getOccUserId(), this.store.pipe(select(getWishListId))), switchMap(function (_a) {
            var _b = __read(_a, 3), userId = _b[1], wishListId = _b[2];
            if (Boolean(wishListId)) {
                return _this.cartConnector.load(userId, wishListId).pipe(switchMap(function (wishList) { return [
                    new LoadWishListSuccess({
                        cart: wishList,
                        userId: userId,
                        cartId: getCartIdByUserId(wishList, userId),
                    }),
                ]; }), catchError(function (error) {
                    return from([
                        new LoadWishListFail({
                            userId: userId,
                            cartId: wishListId,
                            error: makeErrorSerializable(error),
                        }),
                    ]);
                }));
            }
            return EMPTY;
        }));
    }
    WishListEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: CartConnector },
        { type: SaveCartConnector },
        { type: AuthService },
        { type: Store }
    ]; };
    __decorate([
        Effect()
    ], WishListEffects.prototype, "createWishList$", void 0);
    __decorate([
        Effect()
    ], WishListEffects.prototype, "loadWishList$", void 0);
    __decorate([
        Effect()
    ], WishListEffects.prototype, "resetWishList$", void 0);
    WishListEffects = __decorate([
        Injectable()
    ], WishListEffects);
    return WishListEffects;
}());

var activeCartInitialState = '';
var wishListInitialState = '';
function activeCartReducer(state, action) {
    if (state === void 0) { state = activeCartInitialState; }
    var _a, _b, _c;
    switch (action.type) {
        case LOAD_CART_SUCCESS:
        case CREATE_CART_SUCCESS:
        // point to `temp-${uuid}` cart when we are creating/merging cart
        case CREATE_CART:
            if ((_b = (_a = action === null || action === void 0 ? void 0 : action.payload) === null || _a === void 0 ? void 0 : _a.extraData) === null || _b === void 0 ? void 0 : _b.active) {
                return action.meta.entityId;
            }
            else {
                return state;
            }
        case SET_ACTIVE_CART_ID:
            return action.payload;
        case REMOVE_CART:
        case DELETE_CART_SUCCESS:
            if (((_c = action.payload) === null || _c === void 0 ? void 0 : _c.cartId) === state) {
                return activeCartInitialState;
            }
            return state;
        case CLEAR_CART_STATE:
            return activeCartInitialState;
    }
    return state;
}
var cartEntitiesInitialState = undefined;
function cartEntitiesReducer(state, action) {
    if (state === void 0) { state = cartEntitiesInitialState; }
    switch (action.type) {
        case LOAD_CART_SUCCESS:
        case CREATE_CART_SUCCESS:
        case CREATE_WISH_LIST_SUCCESS:
        case LOAD_WISH_LIST_SUCCESS:
        case SET_TEMP_CART:
            return action.payload.cart;
    }
    return state;
}
function wishListReducer(state, action) {
    if (state === void 0) { state = wishListInitialState; }
    switch (action.type) {
        case CREATE_WISH_LIST_SUCCESS:
        case LOAD_WISH_LIST_SUCCESS:
            return action.meta.entityId;
        case CLEAR_CART_STATE:
            return wishListInitialState;
    }
    return state;
}

function clearMultiCartState(reducer) {
    return function (state, action) {
        if (action.type === LOGOUT) {
            state = undefined;
        }
        return reducer(state, action);
    };
}
var multiCartMetaReducers = [clearMultiCartState];
var multiCartReducerToken = new InjectionToken('MultiCartReducers');
function getMultiCartReducers() {
    return {
        carts: entityProcessesLoaderReducer(MULTI_CART_DATA, cartEntitiesReducer),
        active: activeCartReducer,
        wishList: wishListReducer,
    };
}
var multiCartReducerProvider = {
    provide: multiCartReducerToken,
    useFactory: getMultiCartReducers,
};

// =====================================================================
var CartAddEntryEvent = /** @class */ (function () {
    function CartAddEntryEvent() {
    }
    return CartAddEntryEvent;
}());
var CartAddEntrySuccessEvent = /** @class */ (function () {
    function CartAddEntrySuccessEvent() {
    }
    return CartAddEntrySuccessEvent;
}());
var CartAddEntryFailEvent = /** @class */ (function () {
    function CartAddEntryFailEvent() {
    }
    return CartAddEntryFailEvent;
}());

/**
 * Registers events for the active cart
 */
var CartEventBuilder = /** @class */ (function () {
    function CartEventBuilder(actionsSubject, event, activeCartService) {
        this.actionsSubject = actionsSubject;
        this.event = event;
        this.activeCartService = activeCartService;
        this.register();
    }
    /**
     * Registers events for the active cart
     */
    CartEventBuilder.prototype.register = function () {
        this.registerAddEntry();
    };
    /**
     * Register events for adding entry to the active cart
     */
    CartEventBuilder.prototype.registerAddEntry = function () {
        this.registerMapped({
            action: CART_ADD_ENTRY,
            event: CartAddEntryEvent,
        });
        this.registerMapped({
            action: CART_ADD_ENTRY_SUCCESS,
            event: CartAddEntrySuccessEvent,
        });
        this.registerMapped({
            action: CART_ADD_ENTRY_FAIL,
            event: CartAddEntryFailEvent,
        });
    };
    /**
     * Registers a stream of target events mapped from the source actions that contain the cart id equal to the active cart id.
     *
     * @param mapping mapping declaration - from `action` string type to `event` class type
     *   (an with optional `factory` function - by default `action.payload` will be assigned to the properties of the event instance).
     */
    CartEventBuilder.prototype.registerMapped = function (mapping) {
        var eventStream$ = this.getAction(mapping.action).pipe(withLatestFrom(this.activeCartService.getActiveCartId()), filter(function (_a) {
            var _b = __read(_a, 2), action = _b[0], activeCartId = _b[1];
            return action.payload['cartId'] === activeCartId;
        } // assuming that action's payload contains the cart id
        ), map(function (_a) {
            var _b = __read(_a, 1), action = _b[0];
            return createFrom(mapping.event, action.payload);
        }));
        return this.event.register(mapping.event, eventStream$);
    };
    /**
     * Returns a stream of actions only of a given type(s)
     *
     * @param actionType type(s) of actions
     */
    CartEventBuilder.prototype.getAction = function (actionType) {
        return this.actionsSubject.pipe(ofType.apply(void 0, __spread([].concat(actionType))));
    };
    CartEventBuilder.ctorParameters = function () { return [
        { type: ActionsSubject },
        { type: EventService },
        { type: ActiveCartService }
    ]; };
    CartEventBuilder.ɵprov = ɵɵdefineInjectable({ factory: function CartEventBuilder_Factory() { return new CartEventBuilder(ɵɵinject(ActionsSubject), ɵɵinject(EventService), ɵɵinject(ActiveCartService)); }, token: CartEventBuilder, providedIn: "root" });
    CartEventBuilder = __decorate([
        Injectable({ providedIn: 'root' })
    ], CartEventBuilder);
    return CartEventBuilder;
}());

var CartEventModule = /** @class */ (function () {
    function CartEventModule(_CartEventBuilder) {
    }
    CartEventModule.ctorParameters = function () { return [
        { type: CartEventBuilder }
    ]; };
    CartEventModule = __decorate([
        NgModule({})
    ], CartEventModule);
    return CartEventModule;
}());

var CMS_FEATURE = 'cms';
var NAVIGATION_DETAIL_ENTITY = '[Cms] Navigation Entity';
var COMPONENT_ENTITY = '[Cms] Component Entity';

var LOAD_CMS_COMPONENT = '[Cms] Load Component';
var LOAD_CMS_COMPONENT_FAIL = '[Cms] Load Component Fail';
var LOAD_CMS_COMPONENT_SUCCESS = '[Cms] Load Component Success';
var CMS_GET_COMPONENT_FROM_PAGE = '[Cms] Get Component from Page';
var LoadCmsComponent = /** @class */ (function (_super) {
    __extends(LoadCmsComponent, _super);
    function LoadCmsComponent(payload) {
        var _this = _super.call(this, COMPONENT_ENTITY, payload.uid) || this;
        _this.payload = payload;
        _this.type = LOAD_CMS_COMPONENT;
        return _this;
    }
    return LoadCmsComponent;
}(EntityLoadAction));
var LoadCmsComponentFail = /** @class */ (function (_super) {
    __extends(LoadCmsComponentFail, _super);
    function LoadCmsComponentFail(payload) {
        var _this = _super.call(this, COMPONENT_ENTITY, payload.uid, payload.error) || this;
        _this.payload = payload;
        _this.type = LOAD_CMS_COMPONENT_FAIL;
        return _this;
    }
    return LoadCmsComponentFail;
}(EntityFailAction));
var LoadCmsComponentSuccess = /** @class */ (function (_super) {
    __extends(LoadCmsComponentSuccess, _super);
    function LoadCmsComponentSuccess(payload) {
        var _this = _super.call(this, COMPONENT_ENTITY, payload.uid || payload.component.uid || '') || this;
        _this.payload = payload;
        _this.type = LOAD_CMS_COMPONENT_SUCCESS;
        return _this;
    }
    return LoadCmsComponentSuccess;
}(EntitySuccessAction));
var CmsGetComponentFromPage = /** @class */ (function (_super) {
    __extends(CmsGetComponentFromPage, _super);
    function CmsGetComponentFromPage(payload) {
        var _this = _super.call(this, COMPONENT_ENTITY, [].concat(payload).map(function (cmp) { return cmp.component.uid; })) || this;
        _this.payload = payload;
        _this.type = CMS_GET_COMPONENT_FROM_PAGE;
        return _this;
    }
    return CmsGetComponentFromPage;
}(EntitySuccessAction));

var LOAD_CMS_NAVIGATION_ITEMS = '[Cms] Load NavigationEntry items';
var LOAD_CMS_NAVIGATION_ITEMS_FAIL = '[Cms] Load NavigationEntry items Fail';
var LOAD_CMS_NAVIGATION_ITEMS_SUCCESS = '[Cms] Load NavigationEntry items Success';
var LoadCmsNavigationItems = /** @class */ (function (_super) {
    __extends(LoadCmsNavigationItems, _super);
    function LoadCmsNavigationItems(payload) {
        var _this = _super.call(this, NAVIGATION_DETAIL_ENTITY, payload.nodeId) || this;
        _this.payload = payload;
        _this.type = LOAD_CMS_NAVIGATION_ITEMS;
        return _this;
    }
    return LoadCmsNavigationItems;
}(EntityLoadAction));
var LoadCmsNavigationItemsFail = /** @class */ (function (_super) {
    __extends(LoadCmsNavigationItemsFail, _super);
    function LoadCmsNavigationItemsFail(nodeId, payload) {
        var _this = _super.call(this, NAVIGATION_DETAIL_ENTITY, nodeId, payload) || this;
        _this.payload = payload;
        _this.type = LOAD_CMS_NAVIGATION_ITEMS_FAIL;
        return _this;
    }
    return LoadCmsNavigationItemsFail;
}(EntityFailAction));
var LoadCmsNavigationItemsSuccess = /** @class */ (function (_super) {
    __extends(LoadCmsNavigationItemsSuccess, _super);
    function LoadCmsNavigationItemsSuccess(payload) {
        var _this = _super.call(this, NAVIGATION_DETAIL_ENTITY, payload.nodeId) || this;
        _this.payload = payload;
        _this.type = LOAD_CMS_NAVIGATION_ITEMS_SUCCESS;
        return _this;
    }
    return LoadCmsNavigationItemsSuccess;
}(EntitySuccessAction));

var LOAD_CMS_PAGE_DATA = '[Cms] Load Page Data';
var LOAD_CMS_PAGE_DATA_FAIL = '[Cms] Load Page Data Fail';
var LOAD_CMS_PAGE_DATA_SUCCESS = '[Cms] Load Page Data Success';
var CMS_SET_PAGE_SUCCESS_INDEX = '[Cms] Set Page Success Index';
var CMS_SET_PAGE_FAIL_INDEX = '[Cms] Set Page Fail Index';
var LoadCmsPageData = /** @class */ (function (_super) {
    __extends(LoadCmsPageData, _super);
    function LoadCmsPageData(payload) {
        var _this = _super.call(this, payload.type, payload.id) || this;
        _this.payload = payload;
        _this.type = LOAD_CMS_PAGE_DATA;
        return _this;
    }
    return LoadCmsPageData;
}(EntityLoadAction));
var LoadCmsPageDataFail = /** @class */ (function (_super) {
    __extends(LoadCmsPageDataFail, _super);
    function LoadCmsPageDataFail(pageContext, error) {
        var _this = _super.call(this, pageContext.type, pageContext.id, error) || this;
        _this.type = LOAD_CMS_PAGE_DATA_FAIL;
        return _this;
    }
    return LoadCmsPageDataFail;
}(EntityFailAction));
var LoadCmsPageDataSuccess = /** @class */ (function (_super) {
    __extends(LoadCmsPageDataSuccess, _super);
    function LoadCmsPageDataSuccess(pageContext, payload) {
        var _this = _super.call(this, pageContext.type, pageContext.id, payload) || this;
        _this.type = LOAD_CMS_PAGE_DATA_SUCCESS;
        return _this;
    }
    return LoadCmsPageDataSuccess;
}(EntitySuccessAction));
var CmsSetPageSuccessIndex = /** @class */ (function (_super) {
    __extends(CmsSetPageSuccessIndex, _super);
    function CmsSetPageSuccessIndex(pageContext, payload) {
        var _this = _super.call(this, pageContext.type, pageContext.id, payload) || this;
        _this.type = CMS_SET_PAGE_SUCCESS_INDEX;
        return _this;
    }
    return CmsSetPageSuccessIndex;
}(EntitySuccessAction));
var CmsSetPageFailIndex = /** @class */ (function (_super) {
    __extends(CmsSetPageFailIndex, _super);
    function CmsSetPageFailIndex(pageContext, payload) {
        var _this = _super.call(this, pageContext.type, pageContext.id) || this;
        _this.payload = payload;
        _this.type = CMS_SET_PAGE_FAIL_INDEX;
        return _this;
    }
    return CmsSetPageFailIndex;
}(EntityFailAction));



var cmsGroup_actions = /*#__PURE__*/Object.freeze({
    __proto__: null,
    LOAD_CMS_COMPONENT: LOAD_CMS_COMPONENT,
    LOAD_CMS_COMPONENT_FAIL: LOAD_CMS_COMPONENT_FAIL,
    LOAD_CMS_COMPONENT_SUCCESS: LOAD_CMS_COMPONENT_SUCCESS,
    CMS_GET_COMPONENT_FROM_PAGE: CMS_GET_COMPONENT_FROM_PAGE,
    LoadCmsComponent: LoadCmsComponent,
    LoadCmsComponentFail: LoadCmsComponentFail,
    LoadCmsComponentSuccess: LoadCmsComponentSuccess,
    CmsGetComponentFromPage: CmsGetComponentFromPage,
    LOAD_CMS_NAVIGATION_ITEMS: LOAD_CMS_NAVIGATION_ITEMS,
    LOAD_CMS_NAVIGATION_ITEMS_FAIL: LOAD_CMS_NAVIGATION_ITEMS_FAIL,
    LOAD_CMS_NAVIGATION_ITEMS_SUCCESS: LOAD_CMS_NAVIGATION_ITEMS_SUCCESS,
    LoadCmsNavigationItems: LoadCmsNavigationItems,
    LoadCmsNavigationItemsFail: LoadCmsNavigationItemsFail,
    LoadCmsNavigationItemsSuccess: LoadCmsNavigationItemsSuccess,
    LOAD_CMS_PAGE_DATA: LOAD_CMS_PAGE_DATA,
    LOAD_CMS_PAGE_DATA_FAIL: LOAD_CMS_PAGE_DATA_FAIL,
    LOAD_CMS_PAGE_DATA_SUCCESS: LOAD_CMS_PAGE_DATA_SUCCESS,
    CMS_SET_PAGE_SUCCESS_INDEX: CMS_SET_PAGE_SUCCESS_INDEX,
    CMS_SET_PAGE_FAIL_INDEX: CMS_SET_PAGE_FAIL_INDEX,
    LoadCmsPageData: LoadCmsPageData,
    LoadCmsPageDataFail: LoadCmsPageDataFail,
    LoadCmsPageDataSuccess: LoadCmsPageDataSuccess,
    CmsSetPageSuccessIndex: CmsSetPageSuccessIndex,
    CmsSetPageFailIndex: CmsSetPageFailIndex
});

var getCmsState = createFeatureSelector(CMS_FEATURE);

var ɵ0$w = function (state) { return state.components; };
var getComponentsState = createSelector(getCmsState, ɵ0$w);
var componentsContextSelectorFactory = function (uid) {
    return createSelector(getComponentsState, function (componentsState) {
        return entitySelector(componentsState, uid);
    });
};
var componentsLoaderStateSelectorFactory = function (uid, context) {
    return createSelector(componentsContextSelectorFactory(uid), function (componentsContext) {
        return (componentsContext &&
            componentsContext.pageContext &&
            componentsContext.pageContext[context]) ||
            initialLoaderState;
    });
};
/**
 * This selector will return:
 *   - true: component for this context exists
 *   - false: component for this context doesn't exist
 *   - undefined: if the exists status for component is unknown
 *
 * @param uid
 * @param context
 */
var componentsContextExistsSelectorFactory = function (uid, context) {
    return createSelector(componentsLoaderStateSelectorFactory(uid, context), function (loaderState) { return loaderValueSelector(loaderState); });
};
var componentsDataSelectorFactory = function (uid) {
    return createSelector(componentsContextSelectorFactory(uid), function (state) {
        return state ? state.component : undefined;
    });
};
/**
 * This selector will return:
 *   - CmsComponent instance: if we have component data for specified context
 *   - null: if there is no component data for specified context
 *   - undefined: if status of component data for specified context is unknown
 *
 * @param uid
 * @param context
 */
var componentsSelectorFactory = function (uid, context) {
    return createSelector(componentsDataSelectorFactory(uid), componentsContextExistsSelectorFactory(uid, context), function (componentState, exists) {
        switch (exists) {
            case true:
                return componentState;
            case false:
                return null;
            case undefined:
                return undefined;
        }
    });
};

var ɵ0$x = function (state) { return state.navigation; };
var getNavigationEntryItemState = createSelector(getCmsState, ɵ0$x);
var getSelectedNavigationEntryItemState = function (nodeId) {
    return createSelector(getNavigationEntryItemState, function (nodes) {
        return entityLoaderStateSelector(nodes, nodeId);
    });
};
var getNavigationEntryItems = function (nodeId) {
    return createSelector(getSelectedNavigationEntryItemState(nodeId), function (itemState) { return loaderValueSelector(itemState); });
};

var getPageEntitiesSelector = function (state) { return state.pageData.entities; };
var ɵ0$y = getPageEntitiesSelector;
var getIndexByType = function (index, type) {
    switch (type) {
        case PageType.CONTENT_PAGE: {
            return index.content;
        }
        case PageType.PRODUCT_PAGE: {
            return index.product;
        }
        case PageType.CATEGORY_PAGE: {
            return index.category;
        }
        case PageType.CATALOG_PAGE: {
            return index.catalog;
        }
    }
    return { entities: {} };
};
var ɵ1$o = getIndexByType;
var getPageComponentTypesSelector = function (page) {
    var e_1, _a, e_2, _b;
    var componentTypes = new Set();
    if (page && page.slots) {
        try {
            for (var _c = __values(Object.keys(page.slots)), _d = _c.next(); !_d.done; _d = _c.next()) {
                var slot = _d.value;
                try {
                    for (var _e = (e_2 = void 0, __values(page.slots[slot].components || [])), _f = _e.next(); !_f.done; _f = _e.next()) {
                        var component = _f.value;
                        componentTypes.add(component.flexType);
                    }
                }
                catch (e_2_1) { e_2 = { error: e_2_1 }; }
                finally {
                    try {
                        if (_f && !_f.done && (_b = _e.return)) _b.call(_e);
                    }
                    finally { if (e_2) throw e_2.error; }
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_d && !_d.done && (_a = _c.return)) _a.call(_c);
            }
            finally { if (e_1) throw e_1.error; }
        }
    }
    return Array.from(componentTypes);
};
var ɵ2$h = getPageComponentTypesSelector;
var ɵ3$9 = function (state) { return state.page; };
var getPageState = createSelector(getCmsState, ɵ3$9);
var ɵ4$2 = function (page) { return page.index; };
var getPageStateIndex = createSelector(getPageState, ɵ4$2);
var getPageStateIndexEntityLoaderState = function (pageContext) {
    return createSelector(getPageStateIndex, function (index) {
        return getIndexByType(index, pageContext.type);
    });
};
var getPageStateIndexLoaderState = function (pageContext) {
    return createSelector(getPageStateIndexEntityLoaderState(pageContext), function (indexState) {
        return entityLoaderStateSelector(indexState, pageContext.id);
    });
};
var getPageStateIndexValue = function (pageContext) {
    return createSelector(getPageStateIndexLoaderState(pageContext), function (entity) {
        return loaderValueSelector(entity);
    });
};
var getPageEntities = createSelector(getPageState, getPageEntitiesSelector);
var getPageData = function (pageContext) {
    return createSelector(getPageEntities, getPageStateIndexValue(pageContext), function (entities, indexValue) {
        return entities[indexValue];
    });
};
var getPageComponentTypes = function (pageContext) {
    return createSelector(getPageData(pageContext), function (pageData) {
        return getPageComponentTypesSelector(pageData);
    });
};
var getCurrentSlotSelectorFactory = function (pageContext, position) {
    return createSelector(getPageData(pageContext), function (entity) {
        if (entity) {
            return entity.slots[position] || { components: [] };
        }
    });
};



var cmsGroup_selectors = /*#__PURE__*/Object.freeze({
    __proto__: null,
    getComponentsState: getComponentsState,
    componentsContextSelectorFactory: componentsContextSelectorFactory,
    componentsLoaderStateSelectorFactory: componentsLoaderStateSelectorFactory,
    componentsContextExistsSelectorFactory: componentsContextExistsSelectorFactory,
    componentsDataSelectorFactory: componentsDataSelectorFactory,
    componentsSelectorFactory: componentsSelectorFactory,
    ɵ0: ɵ0$w,
    getCmsState: getCmsState,
    getNavigationEntryItemState: getNavigationEntryItemState,
    getSelectedNavigationEntryItemState: getSelectedNavigationEntryItemState,
    getNavigationEntryItems: getNavigationEntryItems,
    getPageState: getPageState,
    getPageStateIndex: getPageStateIndex,
    getPageStateIndexEntityLoaderState: getPageStateIndexEntityLoaderState,
    getPageStateIndexLoaderState: getPageStateIndexLoaderState,
    getPageStateIndexValue: getPageStateIndexValue,
    getPageEntities: getPageEntities,
    getPageData: getPageData,
    getPageComponentTypes: getPageComponentTypes,
    getCurrentSlotSelectorFactory: getCurrentSlotSelectorFactory,
    ɵ1: ɵ1$o,
    ɵ2: ɵ2$h,
    ɵ3: ɵ3$9,
    ɵ4: ɵ4$2
});

var CURRENT_CONTEXT_KEY = 'current';
/**
 *
 * Serializes the provided page context.
 * The pattern used for serialization is: `pageContext.type-pageContext.id`.
 *
 * @param pageContext to serialize
 * @param ignoreContentPageId if set to true, and the PageType is of type ContentPage, then the serialized page context will not contain the ID.
 * Otherwise, the page context if fully serialized.
 */
function serializePageContext(pageContext, ignoreContentPageId) {
    if (!pageContext) {
        return CURRENT_CONTEXT_KEY;
    }
    if (ignoreContentPageId && pageContext.type === PageType.CONTENT_PAGE) {
        return "" + pageContext.type;
    }
    return pageContext.type + "-" + pageContext.id;
}

var CmsService = /** @class */ (function () {
    function CmsService(store, routingService) {
        this.store = store;
        this.routingService = routingService;
        this.components = {};
    }
    /**
     * Get current CMS page data
     */
    CmsService.prototype.getCurrentPage = function () {
        var _this = this;
        return this.routingService
            .getPageContext()
            .pipe(switchMap(function (pageContext) {
            return _this.store.select(getPageData(pageContext));
        }));
    };
    /**
     * Get CMS component data by uid
     *
     * This method can be safely and optimally used to load multiple components data at the same time.
     * Calling getComponentData multiple times for different components will always result in optimized
     * back-end request: all components requested at the same time (in one event loop) will be loaded in one network call.
     *
     * In case the component data is not present, the method will load it.
     * Otherwise, if the page context is not provided, the current page context from the router state will be used instead.
     *
     * @param uid CMS component uid
     * @param pageContext if provided, it will be used to lookup the component data.
     */
    CmsService.prototype.getComponentData = function (uid, pageContext) {
        var context = serializePageContext(pageContext, true);
        if (!this.components[uid]) {
            // create the component data structure, if it doesn't already exist
            this.components[uid] = {};
        }
        var component = this.components[uid];
        if (!component[context]) {
            // create the component data and assign it to the component's context
            component[context] = this.createComponentData(uid, pageContext);
        }
        return component[context];
    };
    CmsService.prototype.createComponentData = function (uid, pageContext) {
        var _this = this;
        if (!pageContext) {
            return this.routingService.getPageContext().pipe(filter(function (currentContext) { return !!currentContext; }), switchMap(function (currentContext) {
                return _this.getComponentData(uid, currentContext);
            }));
        }
        var context = serializePageContext(pageContext, true);
        var loading$ = combineLatest([
            this.routingService.getNextPageContext(),
            this.store.pipe(select(componentsLoaderStateSelectorFactory(uid, context))),
        ]).pipe(observeOn(queueScheduler), tap(function (_a) {
            var _b = __read(_a, 2), nextContext = _b[0], loadingState = _b[1];
            var attemptedLoad = loadingState.loading || loadingState.success || loadingState.error;
            // if the requested context is the same as the one that's currently being navigated to
            // (as it might already been triggered and might be available shortly from page data)
            // TODO(issue:3649), TODO(issue:3668) - this optimization could be removed
            var couldBeLoadedWithPageData = nextContext
                ? serializePageContext(nextContext, true) === context
                : false;
            if (!attemptedLoad && !couldBeLoadedWithPageData) {
                _this.store.dispatch(new LoadCmsComponent({ uid: uid, pageContext: pageContext }));
            }
        }));
        var component$ = this.store.pipe(select(componentsSelectorFactory(uid, context)), filter(function (component) { return component !== undefined; }));
        return using(function () { return loading$.subscribe(); }, function () { return component$; }).pipe(shareReplay({ bufferSize: 1, refCount: true }));
    };
    /**
     * Given the position, get the content slot data
     * @param position : content slot position
     */
    CmsService.prototype.getContentSlot = function (position) {
        var _this = this;
        return this.routingService
            .getPageContext()
            .pipe(switchMap(function (pageContext) {
            return _this.store.pipe(select(getCurrentSlotSelectorFactory(pageContext, position)), filter(Boolean));
        }));
    };
    /**
     * Given navigation node uid, get items (with id and type) inside the navigation entries
     * @param navigationNodeUid : uid of the navigation node
     */
    CmsService.prototype.getNavigationEntryItems = function (navigationNodeUid) {
        return this.store.pipe(select(getNavigationEntryItems(navigationNodeUid)));
    };
    /**
     * Load navigation items data
     * @param rootUid : the uid of the root navigation node
     * @param itemList : list of items (with id and type)
     */
    CmsService.prototype.loadNavigationItems = function (rootUid, itemList) {
        this.store.dispatch(new LoadCmsNavigationItems({
            nodeId: rootUid,
            items: itemList,
        }));
    };
    /**
     * Refresh the content of the latest cms page
     */
    CmsService.prototype.refreshLatestPage = function () {
        var _this = this;
        this.routingService
            .getPageContext()
            .pipe(take(1))
            .subscribe(function (pageContext) {
            return _this.store.dispatch(new LoadCmsPageData(pageContext));
        });
    };
    /**
     * Refresh the cms page content by page Id
     * @param pageId
     */
    CmsService.prototype.refreshPageById = function (pageId) {
        var pageContext = { id: pageId };
        this.store.dispatch(new LoadCmsPageData(pageContext));
    };
    /**
     * Refresh cms component's content
     * @param uid component uid
     * @param pageContext an optional parameter that enables the caller to specify for which context the component should be refreshed.
     * If not specified, 'current' page context is used.
     */
    CmsService.prototype.refreshComponent = function (uid, pageContext) {
        this.store.dispatch(new LoadCmsComponent({ uid: uid, pageContext: pageContext }));
    };
    /**
     * Given pageContext, return the CMS page data
     * @param pageContext
     */
    CmsService.prototype.getPageState = function (pageContext) {
        return this.store.pipe(select(getPageData(pageContext)));
    };
    /**
     * Given pageContext, return the CMS page data
     * @param pageContext
     */
    CmsService.prototype.getPageComponentTypes = function (pageContext) {
        return this.store.pipe(select(getPageComponentTypes(pageContext)));
    };
    /**
     * Given pageContext, return whether the CMS page data exists or not
     * @param pageContext
     */
    CmsService.prototype.hasPage = function (pageContext, forceReload) {
        var _this = this;
        if (forceReload === void 0) { forceReload = false; }
        return this.store.pipe(select(getPageStateIndexLoaderState(pageContext)), tap(function (entity) {
            var attemptedLoad = entity.loading || entity.success || entity.error;
            var shouldReload = forceReload && !entity.loading;
            if (!attemptedLoad || shouldReload) {
                _this.store.dispatch(new LoadCmsPageData(pageContext));
                forceReload = false;
            }
        }), filter(function (entity) {
            if (!entity.hasOwnProperty('value')) {
                // if we have incomplete state from SSR failed load transfer state,
                // we should wait for reload and actual value
                return false;
            }
            return entity.success || (entity.error && !entity.loading);
        }), pluck('success'), catchError(function () { return of(false); }));
    };
    /**
     * Given pageContext, return the CMS page data
     **/
    CmsService.prototype.getPage = function (pageContext, forceReload) {
        var _this = this;
        if (forceReload === void 0) { forceReload = false; }
        return this.hasPage(pageContext, forceReload).pipe(switchMap(function (hasPage) {
            return hasPage ? _this.getPageState(pageContext) : of(null);
        }));
    };
    CmsService.prototype.getPageIndex = function (pageContext) {
        return this.store.pipe(select(getPageStateIndexValue(pageContext)));
    };
    CmsService.prototype.setPageFailIndex = function (pageContext, value) {
        this.store.dispatch(new CmsSetPageFailIndex(pageContext, value));
    };
    CmsService.ctorParameters = function () { return [
        { type: Store },
        { type: RoutingService }
    ]; };
    CmsService.ɵprov = ɵɵdefineInjectable({ factory: function CmsService_Factory() { return new CmsService(ɵɵinject(Store), ɵɵinject(RoutingService)); }, token: CmsService, providedIn: "root" });
    CmsService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], CmsService);
    return CmsService;
}());

var PageRobotsMeta;
(function (PageRobotsMeta) {
    PageRobotsMeta["INDEX"] = "INDEX";
    PageRobotsMeta["NOINDEX"] = "NOINDEX";
    PageRobotsMeta["FOLLOW"] = "FOLLOW";
    PageRobotsMeta["NOFOLLOW"] = "NOFOLLOW";
})(PageRobotsMeta || (PageRobotsMeta = {}));

/**
 * Resolves the page metadata for the Cart page (Using the `PageType.CONTENT_PAGE`
 * and the `CartPageTemplate`). If the cart page matches this template, the more
 * generic `ContentPageMetaResolver` is overriden by this resolver.
 *
 * The page title and robots are resolved in this implementation only.
 */
var CartPageMetaResolver = /** @class */ (function (_super) {
    __extends(CartPageMetaResolver, _super);
    function CartPageMetaResolver(cms) {
        var _this = _super.call(this) || this;
        _this.cms = cms;
        _this.cms$ = _this.cms
            .getCurrentPage()
            .pipe(filter(function (page) { return !!page; }));
        _this.pageType = PageType.CONTENT_PAGE;
        _this.pageTemplate = 'CartPageTemplate';
        return _this;
    }
    /**
     * Resolves the page title, which is driven by the backend.
     */
    CartPageMetaResolver.prototype.resolveTitle = function () {
        return this.cms$.pipe(map(function (p) { return p.title; }));
    };
    /**
     * Returns robots for the cart pages, which default to NOINDEX and NOFOLLOW.
     */
    CartPageMetaResolver.prototype.resolveRobots = function () {
        return of([PageRobotsMeta.NOFOLLOW, PageRobotsMeta.NOINDEX]);
    };
    CartPageMetaResolver.ctorParameters = function () { return [
        { type: CmsService }
    ]; };
    CartPageMetaResolver.ɵprov = ɵɵdefineInjectable({ factory: function CartPageMetaResolver_Factory() { return new CartPageMetaResolver(ɵɵinject(CmsService)); }, token: CartPageMetaResolver, providedIn: "root" });
    CartPageMetaResolver = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], CartPageMetaResolver);
    return CartPageMetaResolver;
}(PageMetaResolver));

var MultiCartStatePersistenceService = /** @class */ (function () {
    function MultiCartStatePersistenceService(statePersistenceService, store, siteContextParamsService) {
        this.statePersistenceService = statePersistenceService;
        this.store = store;
        this.siteContextParamsService = siteContextParamsService;
    }
    MultiCartStatePersistenceService.prototype.sync = function () {
        var _this = this;
        this.statePersistenceService.syncWithStorage({
            key: 'cart',
            state$: this.getCartState(),
            context$: this.siteContextParamsService.getValues([BASE_SITE_CONTEXT_ID]),
            onRead: function (state) { return _this.onRead(state); },
        });
    };
    MultiCartStatePersistenceService.prototype.getCartState = function () {
        return this.store.pipe(select(getMultiCartState), filter(function (state) { return !!state; }), distinctUntilKeyChanged('active'), map(function (state) {
            return {
                active: state.active,
            };
        }));
    };
    MultiCartStatePersistenceService.prototype.onRead = function (state) {
        this.store.dispatch(new ClearCartState());
        if (state) {
            this.store.dispatch(new SetActiveCartId(state.active));
        }
    };
    MultiCartStatePersistenceService.ctorParameters = function () { return [
        { type: StatePersistenceService },
        { type: Store },
        { type: SiteContextParamsService }
    ]; };
    MultiCartStatePersistenceService.ɵprov = ɵɵdefineInjectable({ factory: function MultiCartStatePersistenceService_Factory() { return new MultiCartStatePersistenceService(ɵɵinject(StatePersistenceService), ɵɵinject(Store), ɵɵinject(SiteContextParamsService)); }, token: MultiCartStatePersistenceService, providedIn: "root" });
    MultiCartStatePersistenceService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], MultiCartStatePersistenceService);
    return MultiCartStatePersistenceService;
}());

var MultiCartEffects = /** @class */ (function () {
    function MultiCartEffects(actions$) {
        this.actions$ = actions$;
        this.setTempCart$ = this.actions$.pipe(ofType(SET_TEMP_CART), map(function (action) {
            return new RemoveCart({ cartId: action.payload.tempCartId });
        }));
        // TODO(#7241): Remove when we drop ADD_VOUCHER process and we sort out checkout and cart dependencies
        this.processesIncrement$ = this.actions$.pipe(ofType(CART_ADD_VOUCHER), map(function (action) { return action.payload; }), map(function (payload) { return new CartProcessesIncrement(payload.cartId); }));
    }
    MultiCartEffects.ctorParameters = function () { return [
        { type: Actions }
    ]; };
    __decorate([
        Effect()
    ], MultiCartEffects.prototype, "setTempCart$", void 0);
    __decorate([
        Effect()
    ], MultiCartEffects.prototype, "processesIncrement$", void 0);
    MultiCartEffects = __decorate([
        Injectable()
    ], MultiCartEffects);
    return MultiCartEffects;
}());

var effects$4 = [
    CartEffects,
    CartEntryEffects,
    CartVoucherEffects,
    WishListEffects,
    MultiCartEffects,
];
var MultiCartStoreModule = /** @class */ (function () {
    function MultiCartStoreModule() {
    }
    MultiCartStoreModule = __decorate([
        NgModule({
            imports: [
                CommonModule,
                StateModule,
                StoreModule.forFeature(MULTI_CART_FEATURE, multiCartReducerToken, {
                    metaReducers: multiCartMetaReducers,
                }),
                EffectsModule.forFeature(effects$4),
            ],
            providers: [multiCartReducerProvider],
        })
    ], MultiCartStoreModule);
    return MultiCartStoreModule;
}());

function cartStatePersistenceFactory(cartStatePersistenceService, configInit) {
    var result = function () {
        return configInit.getStableConfig('context').then(function () {
            cartStatePersistenceService.sync();
        });
    };
    return result;
}
var CartModule = /** @class */ (function () {
    function CartModule() {
    }
    CartModule_1 = CartModule;
    CartModule.forRoot = function () {
        return {
            ngModule: CartModule_1,
            providers: [
                {
                    provide: PageMetaResolver,
                    useExisting: CartPageMetaResolver,
                    multi: true,
                },
                {
                    provide: APP_INITIALIZER,
                    useFactory: cartStatePersistenceFactory,
                    deps: [MultiCartStatePersistenceService, ConfigInitializerService],
                    multi: true,
                },
            ],
        };
    };
    var CartModule_1;
    CartModule = CartModule_1 = __decorate([
        NgModule({
            imports: [MultiCartStoreModule, CartEventModule],
        })
    ], CartModule);
    return CartModule;
}());

var CartConfig = /** @class */ (function () {
    function CartConfig() {
    }
    CartConfig.ɵprov = ɵɵdefineInjectable({ factory: function CartConfig_Factory() { return ɵɵinject(Config); }, token: CartConfig, providedIn: "root" });
    CartConfig = __decorate([
        Injectable({
            providedIn: 'root',
            useExisting: Config,
        })
    ], CartConfig);
    return CartConfig;
}());

var CartVoucherService = /** @class */ (function () {
    function CartVoucherService(store, authService, activeCartService) {
        this.store = store;
        this.authService = authService;
        this.activeCartService = activeCartService;
    }
    CartVoucherService.prototype.addVoucher = function (voucherId, cartId) {
        var _this = this;
        this.combineUserAndCartId(cartId).subscribe(function (_a) {
            var _b = __read(_a, 2), occUserId = _b[0], cartIdentifier = _b[1];
            return _this.store.dispatch(new CartAddVoucher({
                userId: occUserId,
                cartId: cartIdentifier,
                voucherId: voucherId,
            }));
        });
    };
    CartVoucherService.prototype.removeVoucher = function (voucherId, cartId) {
        var _this = this;
        this.combineUserAndCartId(cartId).subscribe(function (_a) {
            var _b = __read(_a, 2), occUserId = _b[0], cartIdentifier = _b[1];
            return _this.store.dispatch(new CartRemoveVoucher({
                userId: occUserId,
                cartId: cartIdentifier,
                voucherId: voucherId,
            }));
        });
    };
    // TODO(#7241): Remove when switching to event system for add voucher
    /**
     * Get add voucher process error flag
     * @deprecated since 2.0
     */
    CartVoucherService.prototype.getAddVoucherResultError = function () {
        return this.store.pipe(select(getProcessErrorFactory(ADD_VOUCHER_PROCESS_ID)));
    };
    // TODO(#7241): Remove when switching to event system for add voucher
    /**
     * Get add voucher process success flag
     * @deprecated since 2.0
     */
    CartVoucherService.prototype.getAddVoucherResultSuccess = function () {
        return this.store.pipe(select(getProcessSuccessFactory(ADD_VOUCHER_PROCESS_ID)));
    };
    // TODO(#7241): Remove when switching to event system for add voucher
    /**
     * Get add voucher process loading flag
     * @deprecated since 2.0
     */
    CartVoucherService.prototype.getAddVoucherResultLoading = function () {
        return this.store.pipe(select(getProcessLoadingFactory(ADD_VOUCHER_PROCESS_ID)));
    };
    // TODO(#7241): Remove when switching to event system for add voucher
    /**
     * Reset add voucher process
     * @deprecated since 2.0
     */
    CartVoucherService.prototype.resetAddVoucherProcessingState = function () {
        this.store.dispatch(new CartResetAddVoucher());
    };
    CartVoucherService.prototype.combineUserAndCartId = function (cartId) {
        if (cartId) {
            return this.authService.getOccUserId().pipe(take(1), map(function (userId) { return [userId, cartId]; }));
        }
        else {
            return combineLatest([
                this.authService.getOccUserId(),
                this.activeCartService.getActiveCartId(),
            ]).pipe(take(1));
        }
    };
    CartVoucherService.ctorParameters = function () { return [
        { type: Store },
        { type: AuthService },
        { type: ActiveCartService }
    ]; };
    CartVoucherService.ɵprov = ɵɵdefineInjectable({ factory: function CartVoucherService_Factory() { return new CartVoucherService(ɵɵinject(Store), ɵɵinject(AuthService), ɵɵinject(ActiveCartService)); }, token: CartVoucherService, providedIn: "root" });
    CartVoucherService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], CartVoucherService);
    return CartVoucherService;
}());

var UserService = /** @class */ (function () {
    function UserService(store, authService) {
        this.store = store;
        this.authService = authService;
    }
    /**
     * Returns a user
     */
    UserService.prototype.get = function () {
        var _this = this;
        return this.store.pipe(select(getDetails), tap(function (details) {
            if (Object.keys(details).length === 0) {
                _this.load();
            }
        }));
    };
    /**
     * Loads the user's details
     */
    UserService.prototype.load = function () {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            if (userId !== OCC_USER_ID_ANONYMOUS) {
                _this.store.dispatch(new LoadUserDetails(userId));
            }
        });
    };
    /**
     * Register a new user
     *
     * @param submitFormData as UserRegisterFormData
     */
    UserService.prototype.register = function (userRegisterFormData) {
        this.store.dispatch(new RegisterUser(userRegisterFormData));
    };
    /**
     * Register a new user from guest
     *
     * @param guid
     * @param password
     */
    UserService.prototype.registerGuest = function (guid, password) {
        this.store.dispatch(new RegisterGuest({ guid: guid, password: password }));
    };
    /**
     * Returns the register user process loading flag
     */
    UserService.prototype.getRegisterUserResultLoading = function () {
        return this.store.pipe(select(getProcessLoadingFactory(REGISTER_USER_PROCESS_ID)));
    };
    /**
     * Returns the register user process success flag
     */
    UserService.prototype.getRegisterUserResultSuccess = function () {
        return this.store.pipe(select(getProcessSuccessFactory(REGISTER_USER_PROCESS_ID)));
    };
    /**
     * Returns the register user process error flag
     */
    UserService.prototype.getRegisterUserResultError = function () {
        return this.store.pipe(select(getProcessErrorFactory(REGISTER_USER_PROCESS_ID)));
    };
    /**
     * Resets the register user process flags
     */
    UserService.prototype.resetRegisterUserProcessState = function () {
        return this.store.dispatch(new ResetRegisterUserProcess());
    };
    /**
     * Remove user account, that's also called close user's account
     */
    UserService.prototype.remove = function () {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new RemoveUser(userId));
        });
    };
    /**
     * Returns the remove user loading flag
     */
    UserService.prototype.getRemoveUserResultLoading = function () {
        return this.store.pipe(select(getProcessLoadingFactory(REMOVE_USER_PROCESS_ID)));
    };
    /**
     * Returns the remove user failure outcome.
     */
    UserService.prototype.getRemoveUserResultError = function () {
        return this.store.pipe(select(getProcessErrorFactory(REMOVE_USER_PROCESS_ID)));
    };
    /**
     * Returns the remove user process success outcome.
     */
    UserService.prototype.getRemoveUserResultSuccess = function () {
        return this.store.pipe(select(getProcessSuccessFactory(REMOVE_USER_PROCESS_ID)));
    };
    /**
     * Resets the remove user process state. The state needs to be reset after the process
     * concludes, regardless if it's a success or an error
     */
    UserService.prototype.resetRemoveUserProcessState = function () {
        this.store.dispatch(new RemoveUserReset());
    };
    /**
     * Returns titles
     */
    UserService.prototype.getTitles = function () {
        return this.store.pipe(select(getAllTitles));
    };
    /**
     * Retrieves titles
     */
    UserService.prototype.loadTitles = function () {
        this.store.dispatch(new LoadTitles());
    };
    /**
     * Return whether user's password is successfully reset
     */
    UserService.prototype.isPasswordReset = function () {
        return this.store.pipe(select(getResetPassword));
    };
    /**
     * Updates the user's details
     * @param userDetails to be updated
     */
    UserService.prototype.updatePersonalDetails = function (userDetails) {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new UpdateUserDetails({
                username: userId,
                userDetails: userDetails,
            }));
        });
    };
    /**
     * Returns the update user's personal details loading flag
     */
    UserService.prototype.getUpdatePersonalDetailsResultLoading = function () {
        return this.store.pipe(select(getProcessLoadingFactory(UPDATE_USER_DETAILS_PROCESS_ID)));
    };
    /**
     * Returns the update user's personal details error flag
     */
    UserService.prototype.getUpdatePersonalDetailsResultError = function () {
        return this.store.pipe(select(getProcessErrorFactory(UPDATE_USER_DETAILS_PROCESS_ID)));
    };
    /**
     * Returns the update user's personal details success flag
     */
    UserService.prototype.getUpdatePersonalDetailsResultSuccess = function () {
        return this.store.pipe(select(getProcessSuccessFactory(UPDATE_USER_DETAILS_PROCESS_ID)));
    };
    /**
     * Resets the update user details processing state
     */
    UserService.prototype.resetUpdatePersonalDetailsProcessingState = function () {
        this.store.dispatch(new ResetUpdateUserDetails());
    };
    /**
     * Reset new password.  Part of the forgot password flow.
     * @param token
     * @param password
     */
    UserService.prototype.resetPassword = function (token, password) {
        this.store.dispatch(new ResetPassword({ token: token, password: password }));
    };
    /*
     * Request an email to reset a forgotten password.
     */
    UserService.prototype.requestForgotPasswordEmail = function (userEmailAddress) {
        this.store.dispatch(new ForgotPasswordEmailRequest(userEmailAddress));
    };
    /**
     * Updates the user's email
     */
    UserService.prototype.updateEmail = function (password, newUid) {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new UpdateEmailAction({
                uid: userId,
                password: password,
                newUid: newUid,
            }));
        });
    };
    /**
     * Returns the update user's email success flag
     */
    UserService.prototype.getUpdateEmailResultSuccess = function () {
        return this.store.pipe(select(getProcessSuccessFactory(UPDATE_EMAIL_PROCESS_ID)));
    };
    /**
     * Returns the update user's email error flag
     */
    UserService.prototype.getUpdateEmailResultError = function () {
        return this.store.pipe(select(getProcessErrorFactory(UPDATE_EMAIL_PROCESS_ID)));
    };
    /**
     * Returns the update user's email loading flag
     */
    UserService.prototype.getUpdateEmailResultLoading = function () {
        return this.store.pipe(select(getProcessLoadingFactory(UPDATE_EMAIL_PROCESS_ID)));
    };
    /**
     * Resets the update user's email processing state
     */
    UserService.prototype.resetUpdateEmailResultState = function () {
        this.store.dispatch(new ResetUpdateEmailAction());
    };
    /**
     * Updates the password for the user
     * @param oldPassword the current password that will be changed
     * @param newPassword the new password
     */
    UserService.prototype.updatePassword = function (oldPassword, newPassword) {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new UpdatePassword({
                userId: userId,
                oldPassword: oldPassword,
                newPassword: newPassword,
            }));
        });
    };
    /**
     * Returns the update password loading flag
     */
    UserService.prototype.getUpdatePasswordResultLoading = function () {
        return this.store.pipe(select(getProcessLoadingFactory(UPDATE_PASSWORD_PROCESS_ID)));
    };
    /**
     * Returns the update password failure outcome.
     */
    UserService.prototype.getUpdatePasswordResultError = function () {
        return this.store.pipe(select(getProcessErrorFactory(UPDATE_PASSWORD_PROCESS_ID)));
    };
    /**
     * Returns the update password process success outcome.
     */
    UserService.prototype.getUpdatePasswordResultSuccess = function () {
        return this.store.pipe(select(getProcessSuccessFactory(UPDATE_PASSWORD_PROCESS_ID)));
    };
    /**
     * Resets the update password process state. The state needs to be reset after the process
     * concludes, regardless if it's a success or an error
     */
    UserService.prototype.resetUpdatePasswordProcessState = function () {
        this.store.dispatch(new UpdatePasswordReset());
    };
    UserService.ctorParameters = function () { return [
        { type: Store },
        { type: AuthService }
    ]; };
    UserService.ɵprov = ɵɵdefineInjectable({ factory: function UserService_Factory() { return new UserService(ɵɵinject(Store), ɵɵinject(AuthService)); }, token: UserService, providedIn: "root" });
    UserService = __decorate([
        Injectable({ providedIn: 'root' })
    ], UserService);
    return UserService;
}());

var CartConfigService = /** @class */ (function () {
    function CartConfigService(config) {
        this.config = config;
    }
    CartConfigService.prototype.isSelectiveCartEnabled = function () {
        var _a, _b, _c;
        return Boolean((_c = (_b = (_a = this.config) === null || _a === void 0 ? void 0 : _a.cart) === null || _b === void 0 ? void 0 : _b.selectiveCart) === null || _c === void 0 ? void 0 : _c.enabled);
    };
    CartConfigService.ctorParameters = function () { return [
        { type: CartConfig }
    ]; };
    CartConfigService.ɵprov = ɵɵdefineInjectable({ factory: function CartConfigService_Factory() { return new CartConfigService(ɵɵinject(CartConfig)); }, token: CartConfigService, providedIn: "root" });
    CartConfigService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], CartConfigService);
    return CartConfigService;
}());

var SelectiveCartService = /** @class */ (function () {
    function SelectiveCartService(store, userService, authService, multiCartService, baseSiteService, cartConfigService) {
        var _this = this;
        this.store = store;
        this.userService = userService;
        this.authService = authService;
        this.multiCartService = multiCartService;
        this.baseSiteService = baseSiteService;
        this.cartConfigService = cartConfigService;
        this.cartId$ = new BehaviorSubject(undefined);
        this.PREVIOUS_USER_ID_INITIAL_VALUE = 'PREVIOUS_USER_ID_INITIAL_VALUE';
        this.previousUserId = this.PREVIOUS_USER_ID_INITIAL_VALUE;
        this.cartSelector$ = this.cartId$.pipe(switchMap(function (cartId) {
            _this.cartId = cartId;
            return _this.multiCartService.getCartEntity(cartId);
        }));
        combineLatest([
            this.userService.get(),
            this.baseSiteService.getActive(),
        ]).subscribe(function (_a) {
            var _b = __read(_a, 2), user = _b[0], activeBaseSite = _b[1];
            if (user && user.customerId && activeBaseSite) {
                _this.customerId = user.customerId;
                _this.cartId$.next("selectivecart" + activeBaseSite + _this.customerId);
            }
            else if (user && !user.customerId) {
                _this.cartId$.next(undefined);
            }
        });
        this.authService.getOccUserId().subscribe(function (userId) {
            _this.userId = userId;
            if (_this.isJustLoggedIn(userId)) {
                _this.load();
            }
            _this.previousUserId = userId;
        });
        this.selectiveCart$ = this.cartSelector$.pipe(map(function (cartEntity) {
            return {
                cart: cartEntity.value,
                loading: cartEntity.loading,
                loaded: (cartEntity.error || cartEntity.success) && !cartEntity.loading,
            };
        }), filter(function (_a) {
            var loading = _a.loading;
            return !loading;
        }), tap(function (_a) {
            var cart = _a.cart, loaded = _a.loaded;
            if (_this.cartId && _this.isEmpty(cart) && !loaded) {
                _this.load();
            }
        }), map(function (_a) {
            var cart = _a.cart;
            return (cart ? cart : {});
        }), shareReplay({ bufferSize: 1, refCount: true }));
    }
    SelectiveCartService.prototype.getCart = function () {
        return this.selectiveCart$;
    };
    SelectiveCartService.prototype.getEntries = function () {
        return this.multiCartService.getEntries(this.cartId);
    };
    SelectiveCartService.prototype.getLoaded = function () {
        return this.cartSelector$.pipe(map(function (cart) { return (cart.success || cart.error) && !cart.loading; }));
    };
    SelectiveCartService.prototype.load = function () {
        if (this.isLoggedIn(this.userId) && this.cartId) {
            this.multiCartService.loadCart({
                userId: this.userId,
                cartId: this.cartId,
            });
        }
    };
    SelectiveCartService.prototype.addEntry = function (productCode, quantity) {
        var _this = this;
        var loadAttempted = false;
        this.cartSelector$
            .pipe(filter(function () { return !loadAttempted; }), switchMap(function (cartState) {
            if (_this.isEmpty(cartState.value) && !cartState.loading) {
                loadAttempted = true;
                _this.load();
            }
            return of(cartState);
        }), filter(function (cartState) { return !_this.isEmpty(cartState.value); }), take(1))
            .subscribe(function () {
            _this.multiCartService.addEntry(_this.userId, _this.cartId, productCode, quantity);
        });
    };
    SelectiveCartService.prototype.removeEntry = function (entry) {
        this.multiCartService.removeEntry(this.userId, this.cartId, entry.entryNumber);
    };
    SelectiveCartService.prototype.updateEntry = function (entryNumber, quantity) {
        this.multiCartService.updateEntry(this.userId, this.cartId, entryNumber, quantity);
    };
    SelectiveCartService.prototype.getEntry = function (productCode) {
        return this.multiCartService.getEntry(this.cartId, productCode);
    };
    /**
     * Indicates if selectiveCart feature is enabled based on cart configuration.
     */
    SelectiveCartService.prototype.isEnabled = function () {
        return this.cartConfigService.isSelectiveCartEnabled();
    };
    SelectiveCartService.prototype.isEmpty = function (cart) {
        return (!cart || (typeof cart === 'object' && Object.keys(cart).length === 0));
    };
    SelectiveCartService.prototype.isJustLoggedIn = function (userId) {
        return (this.isLoggedIn(userId) &&
            this.previousUserId !== userId && // *just* logged in
            this.previousUserId !== this.PREVIOUS_USER_ID_INITIAL_VALUE // not app initialization
        );
    };
    SelectiveCartService.prototype.isLoggedIn = function (userId) {
        return typeof userId !== 'undefined' && userId !== OCC_USER_ID_ANONYMOUS;
    };
    SelectiveCartService.ctorParameters = function () { return [
        { type: Store },
        { type: UserService },
        { type: AuthService },
        { type: MultiCartService },
        { type: BaseSiteService },
        { type: CartConfigService }
    ]; };
    SelectiveCartService.ɵprov = ɵɵdefineInjectable({ factory: function SelectiveCartService_Factory() { return new SelectiveCartService(ɵɵinject(Store), ɵɵinject(UserService), ɵɵinject(AuthService), ɵɵinject(MultiCartService), ɵɵinject(BaseSiteService), ɵɵinject(CartConfigService)); }, token: SelectiveCartService, providedIn: "root" });
    SelectiveCartService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], SelectiveCartService);
    return SelectiveCartService;
}());

var WishListService = /** @class */ (function () {
    function WishListService(store, authService, userService, multiCartService) {
        this.store = store;
        this.authService = authService;
        this.userService = userService;
        this.multiCartService = multiCartService;
    }
    WishListService.prototype.createWishList = function (userId, name, description) {
        this.store.dispatch(new CreateWishList({ userId: userId, name: name, description: description }));
    };
    WishListService.prototype.getWishList = function () {
        var _this = this;
        return combineLatest([
            this.getWishListId(),
            this.userService.get(),
            this.authService.getOccUserId(),
        ]).pipe(distinctUntilChanged(), tap(function (_a) {
            var _b = __read(_a, 3), wishListId = _b[0], user = _b[1], userId = _b[2];
            if (!Boolean(wishListId) &&
                userId !== OCC_USER_ID_ANONYMOUS &&
                Boolean(user) &&
                Boolean(user.customerId)) {
                _this.loadWishList(userId, user.customerId);
            }
        }), filter(function (_a) {
            var _b = __read(_a, 1), wishListId = _b[0];
            return Boolean(wishListId);
        }), switchMap(function (_a) {
            var _b = __read(_a, 1), wishListId = _b[0];
            return _this.multiCartService.getCart(wishListId);
        }));
    };
    WishListService.prototype.loadWishList = function (userId, customerId) {
        this.store.dispatch(new LoadWishList({
            userId: userId,
            customerId: customerId,
            tempCartId: getWishlistName(customerId),
        }));
    };
    WishListService.prototype.addEntry = function (productCode) {
        var _this = this;
        this.getWishListId()
            .pipe(distinctUntilChanged(), withLatestFrom(this.authService.getOccUserId(), this.userService.get()), tap(function (_a) {
            var _b = __read(_a, 3), wishListId = _b[0], userId = _b[1], user = _b[2];
            if (!Boolean(wishListId) &&
                Boolean(user) &&
                Boolean(user.customerId)) {
                _this.loadWishList(userId, user.customerId);
            }
        }), filter(function (_a) {
            var _b = __read(_a, 1), wishListId = _b[0];
            return Boolean(wishListId);
        }), take(1))
            .subscribe(function (_a) {
            var _b = __read(_a, 2), wishListId = _b[0], userId = _b[1];
            return _this.multiCartService.addEntry(userId, wishListId, productCode, 1);
        });
    };
    WishListService.prototype.removeEntry = function (entry) {
        var _this = this;
        this.getWishListId()
            .pipe(distinctUntilChanged(), withLatestFrom(this.authService.getOccUserId(), this.userService.get()), tap(function (_a) {
            var _b = __read(_a, 3), wishListId = _b[0], userId = _b[1], user = _b[2];
            if (!Boolean(wishListId) &&
                Boolean(user) &&
                Boolean(user.customerId)) {
                _this.loadWishList(userId, user.customerId);
            }
        }), filter(function (_a) {
            var _b = __read(_a, 1), wishListId = _b[0];
            return Boolean(wishListId);
        }), take(1))
            .subscribe(function (_a) {
            var _b = __read(_a, 2), wishListId = _b[0], userId = _b[1];
            return _this.multiCartService.removeEntry(userId, wishListId, entry.entryNumber);
        });
    };
    WishListService.prototype.getWishListLoading = function () {
        var _this = this;
        return this.getWishListId().pipe(switchMap(function (wishListId) {
            return _this.multiCartService
                .isStable(wishListId)
                .pipe(map(function (stable) { return !stable; }));
        }));
    };
    WishListService.prototype.getWishListId = function () {
        return this.store.pipe(select(getWishListId));
    };
    WishListService.ctorParameters = function () { return [
        { type: Store },
        { type: AuthService },
        { type: UserService },
        { type: MultiCartService }
    ]; };
    WishListService.ɵprov = ɵɵdefineInjectable({ factory: function WishListService_Factory() { return new WishListService(ɵɵinject(Store), ɵɵinject(AuthService), ɵɵinject(UserService), ɵɵinject(MultiCartService)); }, token: WishListService, providedIn: "root" });
    WishListService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], WishListService);
    return WishListService;
}());

var TranslationService = /** @class */ (function () {
    function TranslationService() {
    }
    return TranslationService;
}());

/**
 * Resolves the page data for all Content Pages based on the `PageType.CONTENT_PAGE`
 * and the `MultiStepCheckoutSummaryPageTemplate`. If the checkout page matches this template,
 * the more generic `ContentPageMetaResolver` is overriden by this resolver.
 *
 * The page title and robots are resolved in this implementation only.
 */
var CheckoutPageMetaResolver = /** @class */ (function (_super) {
    __extends(CheckoutPageMetaResolver, _super);
    function CheckoutPageMetaResolver(translation, activeCartService) {
        var _this = _super.call(this) || this;
        _this.translation = translation;
        _this.activeCartService = activeCartService;
        _this.cart$ = _this.activeCartService.getActive();
        _this.pageType = PageType.CONTENT_PAGE;
        _this.pageTemplate = 'MultiStepCheckoutSummaryPageTemplate';
        return _this;
    }
    CheckoutPageMetaResolver.prototype.resolveTitle = function () {
        var _this = this;
        return this.cart$.pipe(switchMap(function (c) {
            return _this.translation.translate('pageMetaResolver.checkout.title', {
                count: c.totalItems,
            });
        }));
    };
    CheckoutPageMetaResolver.prototype.resolveRobots = function () {
        return of([PageRobotsMeta.NOFOLLOW, PageRobotsMeta.NOINDEX]);
    };
    CheckoutPageMetaResolver.ctorParameters = function () { return [
        { type: TranslationService },
        { type: ActiveCartService }
    ]; };
    CheckoutPageMetaResolver.ɵprov = ɵɵdefineInjectable({ factory: function CheckoutPageMetaResolver_Factory() { return new CheckoutPageMetaResolver(ɵɵinject(TranslationService), ɵɵinject(ActiveCartService)); }, token: CheckoutPageMetaResolver, providedIn: "root" });
    CheckoutPageMetaResolver = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], CheckoutPageMetaResolver);
    return CheckoutPageMetaResolver;
}(PageMetaResolver));

var initialState$9 = {
    results: {},
};
function reducer$9(state, action) {
    if (state === void 0) { state = initialState$9; }
    switch (action.type) {
        case VERIFY_ADDRESS_SUCCESS: {
            var results = action.payload;
            return __assign(__assign({}, state), { results: results });
        }
        case VERIFY_ADDRESS_FAIL: {
            return __assign(__assign({}, state), { results: 'FAIL' });
        }
        case CLEAR_ADDRESS_VERIFICATION_RESULTS: {
            return __assign(__assign({}, state), { results: {} });
        }
    }
    return state;
}
var getAddressVerificationResults = function (state) { return state.results; };

var initialState$a = {
    entities: {},
};
function reducer$a(state, action) {
    if (state === void 0) { state = initialState$a; }
    switch (action.type) {
        case LOAD_CARD_TYPES_SUCCESS: {
            var cardTypes = action.payload;
            var entities = cardTypes.reduce(function (cardTypesEntities, name) {
                var _a;
                return __assign(__assign({}, cardTypesEntities), (_a = {}, _a[name.code] = name, _a));
            }, __assign({}, state.entities));
            return __assign(__assign({}, state), { entities: entities });
        }
        case CHECKOUT_CLEAR_MISCS_DATA: {
            return initialState$a;
        }
    }
    return state;
}
var getCardTypesEntites = function (state) { return state.entities; };

var initialState$b = {
    address: {},
    deliveryMode: {
        supported: {},
        selected: '',
    },
    paymentDetails: {},
    orderDetails: {},
};
function reducer$b(state, action) {
    if (state === void 0) { state = initialState$b; }
    switch (action.type) {
        case ADD_DELIVERY_ADDRESS_SUCCESS:
        case SET_DELIVERY_ADDRESS_SUCCESS: {
            var address = action.payload;
            return __assign(__assign({}, state), { address: address });
        }
        case LOAD_SUPPORTED_DELIVERY_MODES_SUCCESS: {
            var supportedModes = action.payload;
            if (!supportedModes) {
                return state;
            }
            var supported = supportedModes.reduce(function (modes, mode) {
                var _a;
                return __assign(__assign({}, modes), (_a = {}, _a[mode.code] = mode, _a));
            }, __assign({}, state.deliveryMode.supported));
            return __assign(__assign({}, state), { deliveryMode: __assign(__assign({}, state.deliveryMode), { supported: supported }) });
        }
        case SET_DELIVERY_MODE_SUCCESS: {
            var selected = action.payload;
            return __assign(__assign({}, state), { deliveryMode: __assign(__assign({}, state.deliveryMode), { selected: selected }) });
        }
        case CREATE_PAYMENT_DETAILS_SUCCESS:
        case SET_PAYMENT_DETAILS_SUCCESS: {
            return __assign(__assign({}, state), { paymentDetails: action.payload });
        }
        case CREATE_PAYMENT_DETAILS_FAIL: {
            var paymentDetails = action.payload;
            if (paymentDetails['hasError']) {
                return __assign(__assign({}, state), { paymentDetails: paymentDetails });
            }
            return state;
        }
        case PLACE_ORDER_SUCCESS: {
            var orderDetails = action.payload;
            return __assign(__assign({}, state), { orderDetails: orderDetails });
        }
        case CLEAR_CHECKOUT_DATA: {
            return initialState$b;
        }
        case CLEAR_CHECKOUT_STEP: {
            var stepNumber = action.payload;
            switch (stepNumber) {
                case 1: {
                    return __assign(__assign({}, state), { address: {} });
                }
                case 2: {
                    return __assign(__assign({}, state), { deliveryMode: __assign(__assign({}, state.deliveryMode), { supported: {}, selected: '' }) });
                }
                case 3: {
                    return __assign(__assign({}, state), { paymentDetails: {} });
                }
            }
            return state;
        }
        case CLEAR_SUPPORTED_DELIVERY_MODES:
        case CHECKOUT_CLEAR_MISCS_DATA: {
            return __assign(__assign({}, state), { deliveryMode: __assign(__assign({}, state.deliveryMode), { supported: {} }) });
        }
        case LOAD_CHECKOUT_DETAILS_SUCCESS: {
            return __assign(__assign({}, state), { address: action.payload.deliveryAddress, deliveryMode: __assign(__assign({}, state.deliveryMode), { selected: action.payload.deliveryMode && action.payload.deliveryMode.code }), paymentDetails: action.payload.paymentInfo });
        }
        case CLEAR_CHECKOUT_DELIVERY_ADDRESS: {
            return __assign(__assign({}, state), { address: {} });
        }
        case CLEAR_CHECKOUT_DELIVERY_MODE: {
            return __assign(__assign({}, state), { deliveryMode: __assign(__assign({}, state.deliveryMode), { selected: '' }) });
        }
    }
    return state;
}

function getReducers$5() {
    return {
        steps: loaderReducer(CHECKOUT_DETAILS, reducer$b),
        cardTypes: reducer$a,
        addressVerification: reducer$9,
    };
}
var reducerToken$5 = new InjectionToken('CheckoutReducers');
var reducerProvider$5 = {
    provide: reducerToken$5,
    useFactory: getReducers$5,
};

var UserAddressConnector = /** @class */ (function () {
    function UserAddressConnector(adapter) {
        this.adapter = adapter;
    }
    UserAddressConnector.prototype.getAll = function (userId) {
        return this.adapter.loadAll(userId);
    };
    UserAddressConnector.prototype.add = function (userId, address) {
        return this.adapter.add(userId, address);
    };
    UserAddressConnector.prototype.update = function (userId, addressId, address) {
        return this.adapter.update(userId, addressId, address);
    };
    UserAddressConnector.prototype.verify = function (userId, address) {
        return this.adapter.verify(userId, address);
    };
    UserAddressConnector.prototype.delete = function (userId, addressId) {
        return this.adapter.delete(userId, addressId);
    };
    UserAddressConnector.ctorParameters = function () { return [
        { type: UserAddressAdapter }
    ]; };
    UserAddressConnector.ɵprov = ɵɵdefineInjectable({ factory: function UserAddressConnector_Factory() { return new UserAddressConnector(ɵɵinject(UserAddressAdapter)); }, token: UserAddressConnector, providedIn: "root" });
    UserAddressConnector = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], UserAddressConnector);
    return UserAddressConnector;
}());

var AddressVerificationEffect = /** @class */ (function () {
    function AddressVerificationEffect(actions$, userAddressConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.userAddressConnector = userAddressConnector;
        this.verifyAddress$ = this.actions$.pipe(ofType(VERIFY_ADDRESS), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            return _this.userAddressConnector.verify(payload.userId, payload.address).pipe(map(function (data) { return new VerifyAddressSuccess(data); }), catchError(function (error) {
                return of(new VerifyAddressFail(makeErrorSerializable(error)));
            }));
        }));
    }
    AddressVerificationEffect.ctorParameters = function () { return [
        { type: Actions },
        { type: UserAddressConnector }
    ]; };
    __decorate([
        Effect()
    ], AddressVerificationEffect.prototype, "verifyAddress$", void 0);
    AddressVerificationEffect = __decorate([
        Injectable()
    ], AddressVerificationEffect);
    return AddressVerificationEffect;
}());

var CheckoutPaymentConnector = /** @class */ (function () {
    function CheckoutPaymentConnector(adapter) {
        this.adapter = adapter;
    }
    CheckoutPaymentConnector.prototype.create = function (userId, cartId, paymentDetails) {
        return this.adapter.create(userId, cartId, paymentDetails);
    };
    CheckoutPaymentConnector.prototype.set = function (userId, cartId, paymentDetailsId) {
        return this.adapter.set(userId, cartId, paymentDetailsId);
    };
    CheckoutPaymentConnector.prototype.getCardTypes = function () {
        return this.adapter.loadCardTypes();
    };
    CheckoutPaymentConnector.ctorParameters = function () { return [
        { type: CheckoutPaymentAdapter }
    ]; };
    CheckoutPaymentConnector.ɵprov = ɵɵdefineInjectable({ factory: function CheckoutPaymentConnector_Factory() { return new CheckoutPaymentConnector(ɵɵinject(CheckoutPaymentAdapter)); }, token: CheckoutPaymentConnector, providedIn: "root" });
    CheckoutPaymentConnector = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], CheckoutPaymentConnector);
    return CheckoutPaymentConnector;
}());

var CardTypesEffects = /** @class */ (function () {
    function CardTypesEffects(actions$, checkoutPaymentConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.checkoutPaymentConnector = checkoutPaymentConnector;
        this.loadCardTypes$ = this.actions$.pipe(ofType(LOAD_CARD_TYPES), switchMap(function () {
            return _this.checkoutPaymentConnector.getCardTypes().pipe(map(function (cardTypes) { return new LoadCardTypesSuccess(cardTypes); }), catchError(function (error) {
                return of(new LoadCardTypesFail(makeErrorSerializable(error)));
            }));
        }));
    }
    CardTypesEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: CheckoutPaymentConnector }
    ]; };
    __decorate([
        Effect()
    ], CardTypesEffects.prototype, "loadCardTypes$", void 0);
    CardTypesEffects = __decorate([
        Injectable()
    ], CardTypesEffects);
    return CardTypesEffects;
}());

var CheckoutConnector = /** @class */ (function () {
    function CheckoutConnector(adapter) {
        this.adapter = adapter;
    }
    CheckoutConnector.prototype.placeOrder = function (userId, cartId) {
        return this.adapter.placeOrder(userId, cartId);
    };
    CheckoutConnector.prototype.loadCheckoutDetails = function (userId, cartId) {
        return this.adapter.loadCheckoutDetails(userId, cartId);
    };
    CheckoutConnector.prototype.clearCheckoutDeliveryAddress = function (userId, cartId) {
        return this.adapter.clearCheckoutDeliveryAddress(userId, cartId);
    };
    CheckoutConnector.prototype.clearCheckoutDeliveryMode = function (userId, cartId) {
        return this.adapter.clearCheckoutDeliveryMode(userId, cartId);
    };
    CheckoutConnector.ctorParameters = function () { return [
        { type: CheckoutAdapter }
    ]; };
    CheckoutConnector.ɵprov = ɵɵdefineInjectable({ factory: function CheckoutConnector_Factory() { return new CheckoutConnector(ɵɵinject(CheckoutAdapter)); }, token: CheckoutConnector, providedIn: "root" });
    CheckoutConnector = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], CheckoutConnector);
    return CheckoutConnector;
}());

var CheckoutDeliveryConnector = /** @class */ (function () {
    function CheckoutDeliveryConnector(adapter) {
        this.adapter = adapter;
    }
    CheckoutDeliveryConnector.prototype.createAddress = function (userId, cartId, address) {
        return this.adapter.createAddress(userId, cartId, address);
    };
    CheckoutDeliveryConnector.prototype.setAddress = function (userId, cartId, addressId) {
        return this.adapter.setAddress(userId, cartId, addressId);
    };
    CheckoutDeliveryConnector.prototype.setMode = function (userId, cartId, deliveryModeId) {
        return this.adapter.setMode(userId, cartId, deliveryModeId);
    };
    CheckoutDeliveryConnector.prototype.getMode = function (userId, cartId) {
        return this.adapter.getMode(userId, cartId);
    };
    CheckoutDeliveryConnector.prototype.getSupportedModes = function (userId, cartId) {
        return this.adapter.getSupportedModes(userId, cartId);
    };
    CheckoutDeliveryConnector.ctorParameters = function () { return [
        { type: CheckoutDeliveryAdapter }
    ]; };
    CheckoutDeliveryConnector.ɵprov = ɵɵdefineInjectable({ factory: function CheckoutDeliveryConnector_Factory() { return new CheckoutDeliveryConnector(ɵɵinject(CheckoutDeliveryAdapter)); }, token: CheckoutDeliveryConnector, providedIn: "root" });
    CheckoutDeliveryConnector = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], CheckoutDeliveryConnector);
    return CheckoutDeliveryConnector;
}());

var CheckoutEffects = /** @class */ (function () {
    function CheckoutEffects(actions$, checkoutDeliveryConnector, checkoutPaymentConnector, checkoutConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.checkoutDeliveryConnector = checkoutDeliveryConnector;
        this.checkoutPaymentConnector = checkoutPaymentConnector;
        this.checkoutConnector = checkoutConnector;
        this.contextChange$ = this.actions$.pipe(ofType(CURRENCY_CHANGE, LANGUAGE_CHANGE));
        this.addDeliveryAddress$ = this.actions$.pipe(ofType(ADD_DELIVERY_ADDRESS), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            return _this.checkoutDeliveryConnector
                .createAddress(payload.userId, payload.cartId, payload.address)
                .pipe(mergeMap(function (address) {
                address['titleCode'] = payload.address.titleCode;
                if (payload.address.region && payload.address.region.isocodeShort) {
                    Object.assign(address.region, {
                        isocodeShort: payload.address.region.isocodeShort,
                    });
                }
                if (payload.userId === OCC_USER_ID_ANONYMOUS) {
                    return [
                        new SetDeliveryAddress({
                            userId: payload.userId,
                            cartId: payload.cartId,
                            address: address,
                        }),
                    ];
                }
                else {
                    return [
                        new LoadUserAddresses(payload.userId),
                        new SetDeliveryAddress({
                            userId: payload.userId,
                            cartId: payload.cartId,
                            address: address,
                        }),
                    ];
                }
            }), catchError(function (error) {
                return of(new AddDeliveryAddressFail(makeErrorSerializable(error)));
            }));
        }), withdrawOn(this.contextChange$));
        this.setDeliveryAddress$ = this.actions$.pipe(ofType(SET_DELIVERY_ADDRESS), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            return _this.checkoutDeliveryConnector
                .setAddress(payload.userId, payload.cartId, payload.address.id)
                .pipe(mergeMap(function () { return [
                new SetDeliveryAddressSuccess(payload.address),
                new ClearCheckoutDeliveryMode({
                    userId: payload.userId,
                    cartId: payload.cartId,
                }),
                new ClearSupportedDeliveryModes(),
                new ResetLoadSupportedDeliveryModesProcess(),
                new LoadSupportedDeliveryModes({
                    userId: payload.userId,
                    cartId: payload.cartId,
                }),
            ]; }), catchError(function (error) {
                return of(new SetDeliveryAddressFail(makeErrorSerializable(error)));
            }));
        }), withdrawOn(this.contextChange$));
        this.loadSupportedDeliveryModes$ = this.actions$.pipe(ofType(LOAD_SUPPORTED_DELIVERY_MODES), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            return _this.checkoutDeliveryConnector
                .getSupportedModes(payload.userId, payload.cartId)
                .pipe(map(function (data) {
                return new LoadSupportedDeliveryModesSuccess(data);
            }), catchError(function (error) {
                return of(new LoadSupportedDeliveryModesFail(makeErrorSerializable(error)));
            }));
        }), withdrawOn(this.contextChange$));
        this.clearCheckoutMiscsDataOnLanguageChange$ = this.actions$.pipe(ofType(LANGUAGE_CHANGE), mergeMap(function () { return [
            new CheckoutClearMiscsData(),
            new ResetLoadSupportedDeliveryModesProcess(),
        ]; }));
        this.clearDeliveryModesOnCurrencyChange$ = this.actions$.pipe(ofType(CURRENCY_CHANGE), map(function () { return new ClearSupportedDeliveryModes(); }));
        this.clearCheckoutDataOnLogout$ = this.actions$.pipe(ofType(LOGOUT), map(function () { return new ClearCheckoutData(); }));
        this.clearCheckoutDataOnLogin$ = this.actions$.pipe(ofType(LOGIN), map(function () { return new ClearCheckoutData(); }));
        this.setDeliveryMode$ = this.actions$.pipe(ofType(SET_DELIVERY_MODE), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            return _this.checkoutDeliveryConnector
                .setMode(payload.userId, payload.cartId, payload.selectedModeId)
                .pipe(mergeMap(function () {
                return [
                    new SetDeliveryModeSuccess(payload.selectedModeId),
                    new LoadCart({
                        userId: payload.userId,
                        cartId: payload.cartId,
                    }),
                ];
            }), catchError(function (error) {
                return of(new SetDeliveryModeFail(makeErrorSerializable(error)));
            }));
        }), withdrawOn(this.contextChange$));
        this.createPaymentDetails$ = this.actions$.pipe(ofType(CREATE_PAYMENT_DETAILS), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            // get information for creating a subscription directly with payment provider
            return _this.checkoutPaymentConnector
                .create(payload.userId, payload.cartId, payload.paymentDetails)
                .pipe(mergeMap(function (details) {
                if (payload.userId === OCC_USER_ID_ANONYMOUS) {
                    return [new CreatePaymentDetailsSuccess(details)];
                }
                else {
                    return [
                        new LoadUserPaymentMethods(payload.userId),
                        new CreatePaymentDetailsSuccess(details),
                    ];
                }
            }), catchError(function (error) {
                return of(new CreatePaymentDetailsFail(makeErrorSerializable(error)));
            }));
        }), withdrawOn(this.contextChange$));
        this.setPaymentDetails$ = this.actions$.pipe(ofType(SET_PAYMENT_DETAILS), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            return _this.checkoutPaymentConnector
                .set(payload.userId, payload.cartId, payload.paymentDetails.id)
                .pipe(map(function () {
                return new SetPaymentDetailsSuccess(payload.paymentDetails);
            }), catchError(function (error) {
                return of(new SetPaymentDetailsFail(makeErrorSerializable(error)));
            }));
        }), withdrawOn(this.contextChange$));
        this.placeOrder$ = this.actions$.pipe(ofType(PLACE_ORDER), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            return _this.checkoutConnector
                .placeOrder(payload.userId, payload.cartId)
                .pipe(switchMap(function (data) { return [
                new RemoveCart({ cartId: payload.cartId }),
                new PlaceOrderSuccess(data),
            ]; }), catchError(function (error) {
                return of(new PlaceOrderFail(makeErrorSerializable(error)));
            }));
        }), withdrawOn(this.contextChange$));
        this.loadCheckoutDetails$ = this.actions$.pipe(ofType(LOAD_CHECKOUT_DETAILS), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            return _this.checkoutConnector
                .loadCheckoutDetails(payload.userId, payload.cartId)
                .pipe(map(function (data) {
                return new LoadCheckoutDetailsSuccess(data);
            }), catchError(function (error) {
                return of(new LoadCheckoutDetailsFail(makeErrorSerializable(error)));
            }));
        }), withdrawOn(this.contextChange$));
        this.reloadDetailsOnMergeCart$ = this.actions$.pipe(ofType(MERGE_CART_SUCCESS), map(function (action) { return action.payload; }), map(function (payload) {
            return new LoadCheckoutDetails({
                userId: payload.userId,
                cartId: payload.cartId,
            });
        }));
        this.clearCheckoutDeliveryAddress$ = this.actions$.pipe(ofType(CLEAR_CHECKOUT_DELIVERY_ADDRESS), map(function (action) { return action.payload; }), filter(function (payload) { return Boolean(payload.cartId); }), switchMap(function (payload) {
            return _this.checkoutConnector
                .clearCheckoutDeliveryAddress(payload.userId, payload.cartId)
                .pipe(map(function () { return new ClearCheckoutDeliveryAddressSuccess(); }), catchError(function (error) {
                return of(new ClearCheckoutDeliveryAddressFail(makeErrorSerializable(error)));
            }));
        }), withdrawOn(this.contextChange$));
        this.clearCheckoutDeliveryMode$ = this.actions$.pipe(ofType(CLEAR_CHECKOUT_DELIVERY_MODE), map(function (action) { return action.payload; }), filter(function (payload) { return Boolean(payload.cartId); }), concatMap(function (payload) {
            return _this.checkoutConnector
                .clearCheckoutDeliveryMode(payload.userId, payload.cartId)
                .pipe(map(function () {
                return new ClearCheckoutDeliveryModeSuccess(__assign({}, payload));
            }), catchError(function (error) {
                return from([
                    new ClearCheckoutDeliveryModeFail(__assign(__assign({}, payload), { error: makeErrorSerializable(error) })),
                    new LoadCart({
                        cartId: payload.cartId,
                        userId: payload.userId,
                    }),
                ]);
            }));
        }), withdrawOn(this.contextChange$));
    }
    CheckoutEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: CheckoutDeliveryConnector },
        { type: CheckoutPaymentConnector },
        { type: CheckoutConnector }
    ]; };
    __decorate([
        Effect()
    ], CheckoutEffects.prototype, "addDeliveryAddress$", void 0);
    __decorate([
        Effect()
    ], CheckoutEffects.prototype, "setDeliveryAddress$", void 0);
    __decorate([
        Effect()
    ], CheckoutEffects.prototype, "loadSupportedDeliveryModes$", void 0);
    __decorate([
        Effect()
    ], CheckoutEffects.prototype, "clearCheckoutMiscsDataOnLanguageChange$", void 0);
    __decorate([
        Effect()
    ], CheckoutEffects.prototype, "clearDeliveryModesOnCurrencyChange$", void 0);
    __decorate([
        Effect()
    ], CheckoutEffects.prototype, "clearCheckoutDataOnLogout$", void 0);
    __decorate([
        Effect()
    ], CheckoutEffects.prototype, "clearCheckoutDataOnLogin$", void 0);
    __decorate([
        Effect()
    ], CheckoutEffects.prototype, "setDeliveryMode$", void 0);
    __decorate([
        Effect()
    ], CheckoutEffects.prototype, "createPaymentDetails$", void 0);
    __decorate([
        Effect()
    ], CheckoutEffects.prototype, "setPaymentDetails$", void 0);
    __decorate([
        Effect()
    ], CheckoutEffects.prototype, "placeOrder$", void 0);
    __decorate([
        Effect()
    ], CheckoutEffects.prototype, "loadCheckoutDetails$", void 0);
    __decorate([
        Effect()
    ], CheckoutEffects.prototype, "reloadDetailsOnMergeCart$", void 0);
    __decorate([
        Effect()
    ], CheckoutEffects.prototype, "clearCheckoutDeliveryAddress$", void 0);
    __decorate([
        Effect()
    ], CheckoutEffects.prototype, "clearCheckoutDeliveryMode$", void 0);
    CheckoutEffects = __decorate([
        Injectable()
    ], CheckoutEffects);
    return CheckoutEffects;
}());

var effects$5 = [
    CheckoutEffects,
    AddressVerificationEffect,
    CardTypesEffects,
];

var CheckoutStoreModule = /** @class */ (function () {
    function CheckoutStoreModule() {
    }
    CheckoutStoreModule = __decorate([
        NgModule({
            imports: [
                CommonModule,
                HttpClientModule,
                StoreModule.forFeature(CHECKOUT_FEATURE, reducerToken$5),
                EffectsModule.forFeature(effects$5),
            ],
            providers: [reducerProvider$5],
        })
    ], CheckoutStoreModule);
    return CheckoutStoreModule;
}());

var CheckoutModule = /** @class */ (function () {
    function CheckoutModule() {
    }
    CheckoutModule_1 = CheckoutModule;
    CheckoutModule.forRoot = function () {
        return {
            ngModule: CheckoutModule_1,
            providers: [
                {
                    provide: PageMetaResolver,
                    useExisting: CheckoutPageMetaResolver,
                    multi: true,
                },
            ],
        };
    };
    var CheckoutModule_1;
    CheckoutModule = CheckoutModule_1 = __decorate([
        NgModule({
            imports: [CheckoutStoreModule],
        })
    ], CheckoutModule);
    return CheckoutModule;
}());

var getDeliveryAddressSelector = function (state) { return state.address; };
var ɵ0$z = getDeliveryAddressSelector;
var getDeliveryModeSelector = function (state) {
    return state.deliveryMode;
};
var ɵ1$p = getDeliveryModeSelector;
var getPaymentDetailsSelector = function (state) {
    return state.paymentDetails;
};
var ɵ2$i = getPaymentDetailsSelector;
var getOrderDetailsSelector = function (state) {
    return state.orderDetails;
};
var ɵ3$a = getOrderDetailsSelector;
var getCheckoutState = createFeatureSelector(CHECKOUT_FEATURE);
var ɵ4$3 = function (checkoutState) { return checkoutState.steps; };
var getCheckoutStepsState = createSelector(getCheckoutState, ɵ4$3);
var ɵ5$2 = function (state) {
    return loaderValueSelector(state);
};
var getCheckoutSteps = createSelector(getCheckoutStepsState, ɵ5$2);
var getDeliveryAddress = createSelector(getCheckoutSteps, getDeliveryAddressSelector);
var getDeliveryMode = createSelector(getCheckoutSteps, getDeliveryModeSelector);
var ɵ6 = function (deliveryMode) {
    return (deliveryMode &&
        Object.keys(deliveryMode.supported).map(function (code) { return deliveryMode.supported[code]; }));
};
var getSupportedDeliveryModes = createSelector(getDeliveryMode, ɵ6);
var ɵ7 = function (deliveryMode) {
    return deliveryMode && deliveryMode.selected;
};
var getSelectedDeliveryModeCode = createSelector(getDeliveryMode, ɵ7);
var ɵ8 = function (deliveryMode) {
    if (deliveryMode.selected !== '') {
        if (Object.keys(deliveryMode.supported).length === 0) {
            return null;
        }
        return deliveryMode.supported[deliveryMode.selected];
    }
};
var getSelectedDeliveryMode = createSelector(getDeliveryMode, ɵ8);
var getPaymentDetails = createSelector(getCheckoutSteps, getPaymentDetailsSelector);
var getCheckoutOrderDetails = createSelector(getCheckoutSteps, getOrderDetailsSelector);
var ɵ9 = function (state) {
    return loaderSuccessSelector(state) &&
        !loaderLoadingSelector(state);
};
var getCheckoutDetailsLoaded = createSelector(getCheckoutStepsState, ɵ9);

var ɵ0$A = function (state) { return state.addressVerification; };
var getAddressVerificationResultsState = createSelector(getCheckoutState, ɵ0$A);
var getAddressVerificationResults$1 = createSelector(getAddressVerificationResultsState, getAddressVerificationResults);

var ɵ0$B = function (state) { return state.cardTypes; };
var getCardTypesState = createSelector(getCheckoutState, ɵ0$B);
var getCardTypesEntites$1 = createSelector(getCardTypesState, getCardTypesEntites);
var ɵ1$q = function (entites) {
    return Object.keys(entites).map(function (code) { return entites[code]; });
};
var getAllCardTypes = createSelector(getCardTypesEntites$1, ɵ1$q);



var checkoutGroup_selectors = /*#__PURE__*/Object.freeze({
    __proto__: null,
    getAddressVerificationResultsState: getAddressVerificationResultsState,
    getAddressVerificationResults: getAddressVerificationResults$1,
    ɵ0: ɵ0$A,
    getCardTypesState: getCardTypesState,
    getCardTypesEntites: getCardTypesEntites$1,
    getAllCardTypes: getAllCardTypes,
    ɵ1: ɵ1$q,
    getCheckoutState: getCheckoutState,
    getCheckoutStepsState: getCheckoutStepsState,
    getCheckoutSteps: getCheckoutSteps,
    getDeliveryAddress: getDeliveryAddress,
    getDeliveryMode: getDeliveryMode,
    getSupportedDeliveryModes: getSupportedDeliveryModes,
    getSelectedDeliveryModeCode: getSelectedDeliveryModeCode,
    getSelectedDeliveryMode: getSelectedDeliveryMode,
    getPaymentDetails: getPaymentDetails,
    getCheckoutOrderDetails: getCheckoutOrderDetails,
    getCheckoutDetailsLoaded: getCheckoutDetailsLoaded,
    ɵ2: ɵ2$i,
    ɵ3: ɵ3$a,
    ɵ4: ɵ4$3,
    ɵ5: ɵ5$2,
    ɵ6: ɵ6,
    ɵ7: ɵ7,
    ɵ8: ɵ8,
    ɵ9: ɵ9
});

var CheckoutService = /** @class */ (function () {
    function CheckoutService(checkoutStore, authService, activeCartService) {
        this.checkoutStore = checkoutStore;
        this.authService = authService;
        this.activeCartService = activeCartService;
    }
    /**
     * Places an order
     */
    CheckoutService.prototype.placeOrder = function () {
        if (this.actionAllowed()) {
            var userId_1;
            this.authService
                .getOccUserId()
                .subscribe(function (occUserId) { return (userId_1 = occUserId); })
                .unsubscribe();
            var cartId_1;
            this.activeCartService
                .getActiveCartId()
                .subscribe(function (activeCartId) { return (cartId_1 = activeCartId); })
                .unsubscribe();
            if (userId_1 && cartId_1) {
                this.checkoutStore.dispatch(new PlaceOrder({
                    userId: userId_1,
                    cartId: cartId_1,
                }));
            }
        }
    };
    /**
     * Clear checkout data
     */
    CheckoutService.prototype.clearCheckoutData = function () {
        this.checkoutStore.dispatch(new ClearCheckoutData());
    };
    /**
     * Clear checkout step
     * @param stepNumber : the step number to be cleared
     */
    CheckoutService.prototype.clearCheckoutStep = function (stepNumber) {
        this.checkoutStore.dispatch(new ClearCheckoutStep(stepNumber));
    };
    /**
     * Load checkout details data
     * @param cartId : string Cart ID of loaded cart
     */
    CheckoutService.prototype.loadCheckoutDetails = function (cartId) {
        var userId;
        this.authService
            .getOccUserId()
            .subscribe(function (occUserId) { return (userId = occUserId); })
            .unsubscribe();
        if (userId) {
            this.checkoutStore.dispatch(new LoadCheckoutDetails({
                userId: userId,
                cartId: cartId,
            }));
        }
    };
    /**
     * Get status of checkout details loaded
     */
    CheckoutService.prototype.getCheckoutDetailsLoaded = function () {
        return this.checkoutStore.pipe(select(getCheckoutDetailsLoaded));
    };
    /**
     * Get order details
     */
    CheckoutService.prototype.getOrderDetails = function () {
        return this.checkoutStore.pipe(select(getCheckoutOrderDetails));
    };
    CheckoutService.prototype.actionAllowed = function () {
        var userId;
        this.authService
            .getOccUserId()
            .subscribe(function (occUserId) { return (userId = occUserId); })
            .unsubscribe();
        return ((userId && userId !== OCC_USER_ID_ANONYMOUS) ||
            this.activeCartService.isGuestCart());
    };
    CheckoutService.ctorParameters = function () { return [
        { type: Store },
        { type: AuthService },
        { type: ActiveCartService }
    ]; };
    CheckoutService.ɵprov = ɵɵdefineInjectable({ factory: function CheckoutService_Factory() { return new CheckoutService(ɵɵinject(Store), ɵɵinject(AuthService), ɵɵinject(ActiveCartService)); }, token: CheckoutService, providedIn: "root" });
    CheckoutService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], CheckoutService);
    return CheckoutService;
}());

var CheckoutDeliveryService = /** @class */ (function () {
    function CheckoutDeliveryService(checkoutStore, authService, activeCartService) {
        this.checkoutStore = checkoutStore;
        this.authService = authService;
        this.activeCartService = activeCartService;
    }
    /**
     * Get supported delivery modes
     */
    CheckoutDeliveryService.prototype.getSupportedDeliveryModes = function () {
        var _this = this;
        return this.checkoutStore.pipe(select(getSupportedDeliveryModes), withLatestFrom(this.checkoutStore.pipe(select(getProcessStateFactory(SET_SUPPORTED_DELIVERY_MODE_PROCESS_ID)))), tap(function (_a) {
            var _b = __read(_a, 2), loadingState = _b[1];
            if (!(loadingState.loading || loadingState.success || loadingState.error)) {
                _this.loadSupportedDeliveryModes();
            }
        }), pluck(0), shareReplay({ bufferSize: 1, refCount: true }));
    };
    /**
     * Get selected delivery mode
     */
    CheckoutDeliveryService.prototype.getSelectedDeliveryMode = function () {
        return this.checkoutStore.pipe(select(getSelectedDeliveryMode));
    };
    /**
     * Get selected delivery mode code
     */
    CheckoutDeliveryService.prototype.getSelectedDeliveryModeCode = function () {
        return this.checkoutStore.pipe(select(getSelectedDeliveryModeCode));
    };
    /**
     * Get delivery address
     */
    CheckoutDeliveryService.prototype.getDeliveryAddress = function () {
        return this.checkoutStore.pipe(select(getDeliveryAddress));
    };
    /**
     * Get status about successfully set Delivery Address
     */
    CheckoutDeliveryService.prototype.getSetDeliveryAddressProcess = function () {
        return this.checkoutStore.pipe(select(getProcessStateFactory(SET_DELIVERY_ADDRESS_PROCESS_ID)));
    };
    /**
     * Clear info about process of setting Delivery Address
     */
    CheckoutDeliveryService.prototype.resetSetDeliveryAddressProcess = function () {
        this.checkoutStore.dispatch(new ResetSetDeliveryAddressProcess());
    };
    /**
     * Get status about of set Delivery Mode process
     */
    CheckoutDeliveryService.prototype.getSetDeliveryModeProcess = function () {
        return this.checkoutStore.pipe(select(getProcessStateFactory(SET_DELIVERY_MODE_PROCESS_ID)));
    };
    /**
     * Clear info about process of setting Delivery Mode
     */
    CheckoutDeliveryService.prototype.resetSetDeliveryModeProcess = function () {
        this.checkoutStore.dispatch(new ResetSetDeliveryModeProcess());
    };
    /**
     * Clear info about process of setting Supported Delivery Modes
     */
    CheckoutDeliveryService.prototype.resetLoadSupportedDeliveryModesProcess = function () {
        this.checkoutStore.dispatch(new ResetLoadSupportedDeliveryModesProcess());
    };
    /**
     * Get status about of set supported Delivery Modes process
     */
    CheckoutDeliveryService.prototype.getLoadSupportedDeliveryModeProcess = function () {
        return this.checkoutStore.pipe(select(getProcessStateFactory(SET_SUPPORTED_DELIVERY_MODE_PROCESS_ID)));
    };
    /**
     * Clear supported delivery modes loaded in last checkout process
     */
    CheckoutDeliveryService.prototype.clearCheckoutDeliveryModes = function () {
        this.checkoutStore.dispatch(new ClearSupportedDeliveryModes());
    };
    /**
     * Get address verification results
     */
    CheckoutDeliveryService.prototype.getAddressVerificationResults = function () {
        return this.checkoutStore.pipe(select(getAddressVerificationResults$1), filter(function (results) { return Object.keys(results).length !== 0; }));
    };
    /**
     * Create and set a delivery address using the address param
     * @param address : the Address to be created and set
     */
    CheckoutDeliveryService.prototype.createAndSetAddress = function (address) {
        if (this.actionAllowed()) {
            var userId_1;
            this.authService
                .getOccUserId()
                .subscribe(function (occUserId) { return (userId_1 = occUserId); })
                .unsubscribe();
            var cartId_1;
            this.activeCartService
                .getActiveCartId()
                .subscribe(function (activeCartId) { return (cartId_1 = activeCartId); })
                .unsubscribe();
            if (userId_1 && cartId_1) {
                this.checkoutStore.dispatch(new AddDeliveryAddress({
                    userId: userId_1,
                    cartId: cartId_1,
                    address: address,
                }));
            }
        }
    };
    /**
     * Load supported delivery modes
     */
    CheckoutDeliveryService.prototype.loadSupportedDeliveryModes = function () {
        if (this.actionAllowed()) {
            var userId_2;
            this.authService
                .getOccUserId()
                .subscribe(function (occUserId) { return (userId_2 = occUserId); })
                .unsubscribe();
            var cartId_2;
            this.activeCartService
                .getActiveCartId()
                .subscribe(function (activeCartId) { return (cartId_2 = activeCartId); })
                .unsubscribe();
            if (userId_2 && cartId_2) {
                this.checkoutStore.dispatch(new LoadSupportedDeliveryModes({
                    userId: userId_2,
                    cartId: cartId_2,
                }));
            }
        }
    };
    /**
     * Set delivery mode
     * @param mode : The delivery mode to be set
     */
    CheckoutDeliveryService.prototype.setDeliveryMode = function (mode) {
        if (this.actionAllowed()) {
            var userId_3;
            this.authService
                .getOccUserId()
                .subscribe(function (occUserId) { return (userId_3 = occUserId); })
                .unsubscribe();
            var cartId_3;
            this.activeCartService
                .getActiveCartId()
                .subscribe(function (activeCartId) { return (cartId_3 = activeCartId); })
                .unsubscribe();
            if (userId_3 && cartId_3) {
                this.checkoutStore.dispatch(new SetDeliveryMode({
                    userId: userId_3,
                    cartId: cartId_3,
                    selectedModeId: mode,
                }));
            }
        }
    };
    /**
     * Verifies the address
     * @param address : the address to be verified
     */
    CheckoutDeliveryService.prototype.verifyAddress = function (address) {
        if (this.actionAllowed()) {
            var userId_4;
            this.authService
                .getOccUserId()
                .subscribe(function (occUserId) { return (userId_4 = occUserId); })
                .unsubscribe();
            if (userId_4) {
                this.checkoutStore.dispatch(new VerifyAddress({
                    userId: userId_4,
                    address: address,
                }));
            }
        }
    };
    /**
     * Set delivery address
     * @param address : The address to be set
     */
    CheckoutDeliveryService.prototype.setDeliveryAddress = function (address) {
        if (this.actionAllowed()) {
            var userId_5;
            this.authService
                .getOccUserId()
                .subscribe(function (occUserId) { return (userId_5 = occUserId); })
                .unsubscribe();
            var cartId_4;
            this.activeCartService
                .getActiveCartId()
                .subscribe(function (activeCartId) { return (cartId_4 = activeCartId); })
                .unsubscribe();
            if (cartId_4 && userId_5) {
                this.checkoutStore.dispatch(new SetDeliveryAddress({
                    userId: userId_5,
                    cartId: cartId_4,
                    address: address,
                }));
            }
        }
    };
    /**
     * Clear address verification results
     */
    CheckoutDeliveryService.prototype.clearAddressVerificationResults = function () {
        this.checkoutStore.dispatch(new ClearAddressVerificationResults());
    };
    /**
     * Clear address already setup in last checkout process
     */
    CheckoutDeliveryService.prototype.clearCheckoutDeliveryAddress = function () {
        var userId;
        this.authService
            .getOccUserId()
            .subscribe(function (occUserId) { return (userId = occUserId); })
            .unsubscribe();
        var cartId;
        this.activeCartService
            .getActiveCartId()
            .subscribe(function (activeCartId) { return (cartId = activeCartId); })
            .unsubscribe();
        if (userId && cartId) {
            this.checkoutStore.dispatch(new ClearCheckoutDeliveryAddress({
                userId: userId,
                cartId: cartId,
            }));
        }
    };
    /**
     * Clear selected delivery mode setup in last checkout process
     */
    CheckoutDeliveryService.prototype.clearCheckoutDeliveryMode = function () {
        var userId;
        this.authService
            .getOccUserId()
            .subscribe(function (occUserId) { return (userId = occUserId); })
            .unsubscribe();
        var cartId;
        this.activeCartService
            .getActiveCartId()
            .subscribe(function (activeCartId) { return (cartId = activeCartId); })
            .unsubscribe();
        if (userId && cartId) {
            this.checkoutStore.dispatch(new ClearCheckoutDeliveryMode({
                userId: userId,
                cartId: cartId,
            }));
        }
    };
    /**
     * Clear address and delivery mode already setup in last checkout process
     */
    CheckoutDeliveryService.prototype.clearCheckoutDeliveryDetails = function () {
        this.clearCheckoutDeliveryAddress();
        this.clearCheckoutDeliveryMode();
        this.clearCheckoutDeliveryModes();
    };
    CheckoutDeliveryService.prototype.actionAllowed = function () {
        var userId;
        this.authService
            .getOccUserId()
            .subscribe(function (occUserId) { return (userId = occUserId); })
            .unsubscribe();
        return ((userId && userId !== OCC_USER_ID_ANONYMOUS) ||
            this.activeCartService.isGuestCart());
    };
    CheckoutDeliveryService.ctorParameters = function () { return [
        { type: Store },
        { type: AuthService },
        { type: ActiveCartService }
    ]; };
    CheckoutDeliveryService.ɵprov = ɵɵdefineInjectable({ factory: function CheckoutDeliveryService_Factory() { return new CheckoutDeliveryService(ɵɵinject(Store), ɵɵinject(AuthService), ɵɵinject(ActiveCartService)); }, token: CheckoutDeliveryService, providedIn: "root" });
    CheckoutDeliveryService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], CheckoutDeliveryService);
    return CheckoutDeliveryService;
}());

var CheckoutPaymentService = /** @class */ (function () {
    function CheckoutPaymentService(checkoutStore, authService, activeCartService) {
        this.checkoutStore = checkoutStore;
        this.authService = authService;
        this.activeCartService = activeCartService;
    }
    /**
     * Get card types
     */
    CheckoutPaymentService.prototype.getCardTypes = function () {
        return this.checkoutStore.pipe(select(getAllCardTypes));
    };
    /**
     * Get payment details
     */
    CheckoutPaymentService.prototype.getPaymentDetails = function () {
        return this.checkoutStore.pipe(select(getPaymentDetails));
    };
    /**
     * Get status about set Payment Details process
     */
    CheckoutPaymentService.prototype.getSetPaymentDetailsResultProcess = function () {
        return this.checkoutStore.pipe(select(getProcessStateFactory(SET_PAYMENT_DETAILS_PROCESS_ID)));
    };
    /**
     * Clear info about process of setting Payment Details
     */
    CheckoutPaymentService.prototype.resetSetPaymentDetailsProcess = function () {
        this.checkoutStore.dispatch(new ResetSetPaymentDetailsProcess());
    };
    /**
     * Load the supported card types
     */
    CheckoutPaymentService.prototype.loadSupportedCardTypes = function () {
        this.checkoutStore.dispatch(new LoadCardTypes());
    };
    /**
     * Create payment details using the given paymentDetails param
     * @param paymentDetails: the PaymentDetails to be created
     */
    CheckoutPaymentService.prototype.createPaymentDetails = function (paymentDetails) {
        if (this.actionAllowed()) {
            var userId_1;
            this.authService
                .getOccUserId()
                .subscribe(function (occUserId) { return (userId_1 = occUserId); })
                .unsubscribe();
            var cartId_1;
            this.activeCartService
                .getActiveCartId()
                .subscribe(function (activeCartId) { return (cartId_1 = activeCartId); })
                .unsubscribe();
            if (userId_1 && cartId_1) {
                this.checkoutStore.dispatch(new CreatePaymentDetails({
                    userId: userId_1,
                    cartId: cartId_1,
                    paymentDetails: paymentDetails,
                }));
            }
        }
    };
    /**
     * Set payment details
     * @param paymentDetails : the PaymentDetails to be set
     */
    CheckoutPaymentService.prototype.setPaymentDetails = function (paymentDetails) {
        if (this.actionAllowed()) {
            var userId_2;
            this.authService
                .getOccUserId()
                .subscribe(function (occUserId) { return (userId_2 = occUserId); })
                .unsubscribe();
            var cart_1;
            this.activeCartService
                .getActive()
                .subscribe(function (activeCart) { return (cart_1 = activeCart); })
                .unsubscribe();
            if (userId_2 && cart_1) {
                this.checkoutStore.dispatch(new SetPaymentDetails({
                    userId: userId_2,
                    cartId: cart_1.code,
                    paymentDetails: paymentDetails,
                }));
            }
        }
    };
    /**
     * Sets payment loading to true without having the flicker issue (GH-3102)
     */
    CheckoutPaymentService.prototype.paymentProcessSuccess = function () {
        this.checkoutStore.dispatch(new PaymentProcessSuccess());
    };
    CheckoutPaymentService.prototype.actionAllowed = function () {
        var userId;
        this.authService
            .getOccUserId()
            .subscribe(function (occUserId) { return (userId = occUserId); })
            .unsubscribe();
        return ((userId && userId !== OCC_USER_ID_ANONYMOUS) ||
            this.activeCartService.isGuestCart());
    };
    CheckoutPaymentService.ctorParameters = function () { return [
        { type: Store },
        { type: AuthService },
        { type: ActiveCartService }
    ]; };
    CheckoutPaymentService.ɵprov = ɵɵdefineInjectable({ factory: function CheckoutPaymentService_Factory() { return new CheckoutPaymentService(ɵɵinject(Store), ɵɵinject(AuthService), ɵɵinject(ActiveCartService)); }, token: CheckoutPaymentService, providedIn: "root" });
    CheckoutPaymentService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], CheckoutPaymentService);
    return CheckoutPaymentService;
}());

var defaultCmsModuleConfig = {
    backend: {
        occ: {
            endpoints: {
                component: 'cms/components/${id}',
                components: 'cms/components',
                pages: 'cms/pages',
                page: 'cms/pages/${id}',
            },
            legacy: false,
        },
    },
    cmsComponents: {},
};

/**
 * Resolves the page data for all Content Pages based on the `PageType.CONTENT_PAGE`.
 * More specific resolvers for content pages can be implemented by making them more
 * specific, for example by using the page template (see `CartPageMetaResolver`).
 *
 * The page title, and breadcrumbs are resolved in this implementation only.
 */
var ContentPageMetaResolver = /** @class */ (function (_super) {
    __extends(ContentPageMetaResolver, _super);
    function ContentPageMetaResolver(cms, translation) {
        var _this = _super.call(this) || this;
        _this.cms = cms;
        _this.translation = translation;
        /** helper to provie access to the current CMS page */
        _this.cms$ = _this.cms
            .getCurrentPage()
            .pipe(filter(function (p) { return Boolean(p); }));
        _this.pageType = PageType.CONTENT_PAGE;
        return _this;
    }
    /**
     * Resolves the page title for the ContentPage by taking the title
     * from the backend data.
     */
    ContentPageMetaResolver.prototype.resolveTitle = function () {
        return this.cms$.pipe(map(function (p) { return p.title; }));
    };
    /**
     * Resolves a single breacrumb item to the home page for each `ContentPage`.
     * The home page label is resolved from the translation service.
     */
    ContentPageMetaResolver.prototype.resolveBreadcrumbs = function () {
        return this.translation
            .translate('common.home')
            .pipe(map(function (label) { return [{ label: label, link: '/' }]; }));
    };
    ContentPageMetaResolver.ctorParameters = function () { return [
        { type: CmsService },
        { type: TranslationService }
    ]; };
    ContentPageMetaResolver.ɵprov = ɵɵdefineInjectable({ factory: function ContentPageMetaResolver_Factory() { return new ContentPageMetaResolver(ɵɵinject(CmsService), ɵɵinject(TranslationService)); }, token: ContentPageMetaResolver, providedIn: "root" });
    ContentPageMetaResolver = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], ContentPageMetaResolver);
    return ContentPageMetaResolver;
}(PageMetaResolver));

var CmsPageTitleModule = /** @class */ (function () {
    function CmsPageTitleModule() {
    }
    CmsPageTitleModule = __decorate([
        NgModule({
            providers: [
                {
                    provide: PageMetaResolver,
                    useExisting: ContentPageMetaResolver,
                    multi: true,
                },
            ],
        })
    ], CmsPageTitleModule);
    return CmsPageTitleModule;
}());

function bufferDebounceTime(time, scheduler) {
    if (time === void 0) { time = 0; }
    return function (source) {
        var bufferedValues = [];
        return source.pipe(tap(function (value) { return bufferedValues.push(value); }), debounceTime(time, scheduler), map(function () { return bufferedValues; }), tap(function () { return (bufferedValues = []); }));
    };
}

function getCookie(cookie, name) {
    var regExp = new RegExp('(?:^|;\\s*)' + name + '=([^;]*)', 'g');
    var result = regExp.exec(cookie);
    return (result && decodeURIComponent(result[1])) || '';
}

var TEST_CONFIG_COOKIE_NAME = new InjectionToken('TEST_CONFIG_COOKIE_NAME');
function parseConfigJSON(config) {
    try {
        return JSON.parse(decodeURIComponent(config));
    }
    catch (_) {
        return {};
    }
}
function configFromCookieFactory(cookieName, platform, document) {
    if (isPlatformBrowser(platform) && cookieName) {
        var config = getCookie(document.cookie, cookieName);
        return parseConfigJSON(config);
    }
    return {};
}
/**
 * Designed/intended to provide dynamic configuration for testing scenarios ONLY (e.g. e2e tests).
 *
 * CAUTION: DON'T USE IT IN PRODUCTION! IT HASN'T BEEN REVIEWED FOR SECURITY ISSUES.
 */
var TestConfigModule = /** @class */ (function () {
    function TestConfigModule() {
    }
    TestConfigModule_1 = TestConfigModule;
    /**
     * Injects JSON config from the cookie of the given name.
     *
     * Be aware of the cookie limitations (4096 bytes).
     *
     * CAUTION: DON'T USE IT IN PRODUCTION! IT HASN'T BEEN REVIEWED FOR SECURITY ISSUES.
     */
    TestConfigModule.forRoot = function (options) {
        return {
            ngModule: TestConfigModule_1,
            providers: [
                {
                    provide: TEST_CONFIG_COOKIE_NAME,
                    useValue: options && options.cookie,
                },
                provideConfigFactory(configFromCookieFactory, [
                    TEST_CONFIG_COOKIE_NAME,
                    PLATFORM_ID,
                    DOCUMENT,
                ]),
            ],
        };
    };
    var TestConfigModule_1;
    TestConfigModule = TestConfigModule_1 = __decorate([
        NgModule({})
    ], TestConfigModule);
    return TestConfigModule;
}());

function configValidatorFactory(configInitializer, validators) {
    var validate = function () {
        if (isDevMode()) {
            configInitializer
                .getStableConfig()
                .then(function (config) { return validateConfig(config, validators || []); });
        }
    };
    return validate;
}
/**
 * Should stay private in 1.x
 * as forRoot() is used internally by ConfigInitializerModule
 *
 * issue: #5279
 */
var ConfigValidatorModule = /** @class */ (function () {
    function ConfigValidatorModule() {
    }
    ConfigValidatorModule_1 = ConfigValidatorModule;
    ConfigValidatorModule.forRoot = function () {
        return {
            ngModule: ConfigValidatorModule_1,
            providers: [
                {
                    provide: APP_INITIALIZER,
                    multi: true,
                    useFactory: configValidatorFactory,
                    deps: [
                        ConfigInitializerService,
                        [new Optional(), ConfigValidatorToken],
                    ],
                },
            ],
        };
    };
    var ConfigValidatorModule_1;
    ConfigValidatorModule = ConfigValidatorModule_1 = __decorate([
        NgModule()
    ], ConfigValidatorModule);
    return ConfigValidatorModule;
}());

function configInitializerFactory(configInitializer, initializers) {
    var isReady = function () { return configInitializer.initialize(initializers); };
    return isReady;
}
var ConfigInitializerModule = /** @class */ (function () {
    function ConfigInitializerModule() {
    }
    ConfigInitializerModule_1 = ConfigInitializerModule;
    ConfigInitializerModule.forRoot = function () {
        return {
            ngModule: ConfigInitializerModule_1,
            providers: [
                {
                    provide: CONFIG_INITIALIZER_FORROOT_GUARD,
                    useValue: true,
                },
                {
                    provide: APP_INITIALIZER,
                    multi: true,
                    useFactory: configInitializerFactory,
                    deps: [
                        ConfigInitializerService,
                        [new Optional(), CONFIG_INITIALIZER],
                    ],
                },
            ],
        };
    };
    var ConfigInitializerModule_1;
    ConfigInitializerModule = ConfigInitializerModule_1 = __decorate([
        NgModule({})
    ], ConfigInitializerModule);
    return ConfigInitializerModule;
}());

/**
 * The `CmsStructureConfig` is used to build pages in Spartacus by configuration
 * instead of using a backend CMS system. The configuration can be used to build
 * complete pages or parts of a page. The `CmsStructureConfig` is optimized to
 * only require the necessary properties. Adapter logic is applied to serialize
 * the `CmsStructureConfig` into the required UI model.
 */
var CmsStructureConfig = /** @class */ (function (_super) {
    __extends(CmsStructureConfig, _super);
    function CmsStructureConfig() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    CmsStructureConfig.ɵprov = ɵɵdefineInjectable({ factory: function CmsStructureConfig_Factory() { return ɵɵinject(Config); }, token: CmsStructureConfig, providedIn: "root" });
    CmsStructureConfig = __decorate([
        Injectable({
            providedIn: 'root',
            useExisting: Config,
        })
    ], CmsStructureConfig);
    return CmsStructureConfig;
}(CmsConfig));

/**
 * Service that provides access to CMS structure from a static
 * configuration or configuration file. This class uses static
 * configuration is designed in async fashion so that configurations
 * can be loaded from a file or stream.
 *
 * The intent of the `CmsStructureConfigService` however is to provide
 * fast loading pages and default cms structure for commodity commerce.
 */
var CmsStructureConfigService = /** @class */ (function () {
    function CmsStructureConfigService(cmsDataConfig) {
        this.cmsDataConfig = cmsDataConfig;
    }
    /**
     * Merge the cms structure to the pageStructure. The page structure
     * can either hold complete page structures or global structures that
     * might apply to all pages (such has header coponents).
     */
    CmsStructureConfigService.prototype.mergePageStructure = function (pageId, pageStructure) {
        var _this = this;
        return this.mergePage(pageId, pageStructure).pipe(switchMap(function (page) { return _this.mergeSlots(page); }));
    };
    /**
     *
     * Returns boolean observable to indicate whether the page should not be
     * loaded from the backend. This is useful for pages which are comoditized
     * and follow best practice.
     *
     * By default, configurable pages are driven by static configuration,
     * in order to allow for fast loading pages (preventing network delays).
     */
    CmsStructureConfigService.prototype.shouldIgnoreBackend = function (pageId) {
        return this.getPageFromConfig(pageId).pipe(map(function (page) { return !!page && !!page.ignoreBackend; }));
    };
    /**
     * returns an Observable component data from the static configuration.
     */
    CmsStructureConfigService.prototype.getComponentFromConfig = function (componentId) {
        return of(this.getComponentById(componentId));
    };
    /**
     * returns an Observable components data from the static configuration.
     */
    CmsStructureConfigService.prototype.getComponentsFromConfig = function (ids) {
        var _this = this;
        return of(ids.map(function (id) { return _this.getComponentById(id); }));
    };
    /**
     * returns an observable with the `PageConfig`.
     */
    CmsStructureConfigService.prototype.getPageFromConfig = function (pageId) {
        return of(this.cmsDataConfig.cmsStructure && this.cmsDataConfig.cmsStructure.pages
            ? this.cmsDataConfig.cmsStructure.pages.find(function (p) { return p.pageId === pageId; })
            : null);
    };
    /**
     * Merge page data from the configuration into the given structure, if any.
     * If the given page structure is empty, a page is created and the page slots are
     * are merged into the page.
     */
    CmsStructureConfigService.prototype.mergePage = function (pageId, pageStructure) {
        var _this = this;
        return this.getPageFromConfig(pageId).pipe(switchMap(function (page) {
            if (page) {
                // serialize page data
                if (!pageStructure.page) {
                    pageStructure.page = __assign({}, page);
                    pageStructure.page.slots = {};
                }
                if (!pageStructure.page.slots) {
                    pageStructure.page.slots = {};
                }
                return _this.mergeSlots(pageStructure, page.slots);
            }
            else {
                return of(pageStructure);
            }
        }));
    };
    /**
     * Adds any pre-configured slots for pages that do not use them.
     * If pages have a slot for the given position, the configiuration
     * is ingored. Even if the slot does not have inner structure (such as
     * components), so that the cms structure is able to override the (static)
     * configuration.
     */
    CmsStructureConfigService.prototype.mergeSlots = function (pageStructure, slots) {
        var e_1, _a, e_2, _b;
        // if no slots have been given, we use the global configured slots
        if (!slots &&
            this.cmsDataConfig.cmsStructure &&
            this.cmsDataConfig.cmsStructure.slots) {
            slots = this.cmsDataConfig.cmsStructure.slots;
        }
        if (!slots) {
            return of(pageStructure);
        }
        try {
            for (var _c = __values(Object.keys(slots)), _d = _c.next(); !_d.done; _d = _c.next()) {
                var position = _d.value;
                if (!Object.keys(pageStructure.page.slots).includes(position)) {
                    // the global slot isn't yet part of the page structure
                    pageStructure.page.slots[position] = {};
                    try {
                        for (var _e = (e_2 = void 0, __values(this.getComponentsByPosition(slots, position))), _f = _e.next(); !_f.done; _f = _e.next()) {
                            var component = _f.value;
                            if (!pageStructure.page.slots[position].components) {
                                pageStructure.page.slots[position].components = [];
                            }
                            pageStructure.page.slots[position].components.push({
                                uid: component.uid,
                                flexType: component.flexType,
                                typeCode: component.typeCode,
                            });
                            if (!pageStructure.components) {
                                pageStructure.components = [];
                            }
                            pageStructure.components.push(component);
                        }
                    }
                    catch (e_2_1) { e_2 = { error: e_2_1 }; }
                    finally {
                        try {
                            if (_f && !_f.done && (_b = _e.return)) _b.call(_e);
                        }
                        finally { if (e_2) throw e_2.error; }
                    }
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_d && !_d.done && (_a = _c.return)) _a.call(_c);
            }
            finally { if (e_1) throw e_1.error; }
        }
        return of(pageStructure);
    };
    CmsStructureConfigService.prototype.getComponentsByPosition = function (slots, position) {
        var e_3, _a;
        var components = [];
        if (slots[position] && slots[position].componentIds) {
            try {
                for (var _b = __values(slots[position].componentIds), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var componentId = _c.value;
                    if (this.cmsDataConfig.cmsStructure &&
                        this.cmsDataConfig.cmsStructure.components) {
                        var component = this.cmsDataConfig.cmsStructure.components[componentId];
                        if (component) {
                            components.push(__assign({ uid: componentId }, component));
                        }
                    }
                }
            }
            catch (e_3_1) { e_3 = { error: e_3_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_3) throw e_3.error; }
            }
        }
        return components;
    };
    CmsStructureConfigService.prototype.getComponentById = function (componentId) {
        return this.cmsDataConfig.cmsStructure &&
            this.cmsDataConfig.cmsStructure.components
            ? this.cmsDataConfig.cmsStructure.components[componentId]
            : undefined;
    };
    CmsStructureConfigService.ctorParameters = function () { return [
        { type: CmsStructureConfig }
    ]; };
    CmsStructureConfigService.ɵprov = ɵɵdefineInjectable({ factory: function CmsStructureConfigService_Factory() { return new CmsStructureConfigService(ɵɵinject(CmsStructureConfig)); }, token: CmsStructureConfigService, providedIn: "root" });
    CmsStructureConfigService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], CmsStructureConfigService);
    return CmsStructureConfigService;
}());

var CmsComponentConnector = /** @class */ (function () {
    function CmsComponentConnector(cmsStructureConfigService, adapter, config) {
        this.cmsStructureConfigService = cmsStructureConfigService;
        this.adapter = adapter;
        this.config = config;
    }
    CmsComponentConnector.prototype.get = function (id, pageContext) {
        var _this = this;
        return this.cmsStructureConfigService
            .getComponentFromConfig(id)
            .pipe(switchMap(function (configuredComponent) {
            return configuredComponent
                ? of(configuredComponent)
                : _this.adapter.load(id, pageContext);
        }));
    };
    CmsComponentConnector.prototype.getList = function (ids, pageContext) {
        var _this = this;
        return this.cmsStructureConfigService.getComponentsFromConfig(ids).pipe(switchMap(function (configuredComponents) {
            // check if we have some components that are not loaded from configuration
            var missingIds = configuredComponents.reduce(function (acc, component, index) {
                if (component === undefined) {
                    acc.push(ids[index]);
                }
                return acc;
            }, []);
            if (missingIds.length > 0) {
                return (_this.config.backend.occ.legacy
                    ? _this.adapter.findComponentsByIdsLegacy(missingIds, pageContext)
                    : _this.adapter.findComponentsByIds(missingIds, pageContext)).pipe(map(function (loadedComponents) { return __spread(configuredComponents.filter(Boolean), loadedComponents); }));
            }
            else {
                return of(configuredComponents);
            }
        }));
    };
    CmsComponentConnector.ctorParameters = function () { return [
        { type: CmsStructureConfigService },
        { type: CmsComponentAdapter },
        { type: OccConfig }
    ]; };
    CmsComponentConnector.ɵprov = ɵɵdefineInjectable({ factory: function CmsComponentConnector_Factory() { return new CmsComponentConnector(ɵɵinject(CmsStructureConfigService), ɵɵinject(CmsComponentAdapter), ɵɵinject(OccConfig)); }, token: CmsComponentConnector, providedIn: "root" });
    CmsComponentConnector = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], CmsComponentConnector);
    return CmsComponentConnector;
}());

var ComponentsEffects = /** @class */ (function () {
    function ComponentsEffects(actions$, cmsComponentConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.cmsComponentConnector = cmsComponentConnector;
        this.contextChange$ = this.actions$.pipe(ofType(LANGUAGE_CHANGE, LOGOUT, LOGIN));
        this.loadComponent$ = createEffect(function () { return function (_a) {
            var _b = _a === void 0 ? {} : _a, scheduler = _b.scheduler, _c = _b.debounce, debounce = _c === void 0 ? 0 : _c;
            return _this.actions$.pipe(ofType(LOAD_CMS_COMPONENT), groupBy(function (actions) { return serializePageContext(actions.payload.pageContext); }), mergeMap(function (actionGroup) {
                return actionGroup.pipe(bufferDebounceTime(debounce, scheduler), mergeMap(function (actions) {
                    return _this.loadComponentsEffect(actions.map(function (action) { return action.payload.uid; }), actions[0].payload.pageContext);
                }));
            }), withdrawOn(_this.contextChange$));
        }; });
    }
    ComponentsEffects.prototype.loadComponentsEffect = function (componentUids, pageContext) {
        return this.cmsComponentConnector.getList(componentUids, pageContext).pipe(switchMap(function (components) {
            var e_1, _a;
            var actions = [];
            var uidsLeft = new Set(componentUids);
            try {
                for (var components_1 = __values(components), components_1_1 = components_1.next(); !components_1_1.done; components_1_1 = components_1.next()) {
                    var component = components_1_1.value;
                    actions.push(new LoadCmsComponentSuccess({
                        component: component,
                        uid: component.uid,
                        pageContext: pageContext,
                    }));
                    uidsLeft.delete(component.uid);
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (components_1_1 && !components_1_1.done && (_a = components_1.return)) _a.call(components_1);
                }
                finally { if (e_1) throw e_1.error; }
            }
            // we have to emit LoadCmsComponentFail for all component's uids that
            // are missing from the response
            uidsLeft.forEach(function (uid) {
                actions.push(new LoadCmsComponentFail({
                    uid: uid,
                    pageContext: pageContext,
                }));
            });
            return from(actions);
        }), catchError(function (error) {
            return from(componentUids.map(function (uid) {
                return new LoadCmsComponentFail({
                    uid: uid,
                    error: makeErrorSerializable(error),
                    pageContext: pageContext,
                });
            }));
        }));
    };
    ComponentsEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: CmsComponentConnector }
    ]; };
    ComponentsEffects = __decorate([
        Injectable()
    ], ComponentsEffects);
    return ComponentsEffects;
}());

/**
 * @license
 * The MIT License
 * Copyright (c) 2010-2019 Google LLC. http://angular.io/license
 *
 * See:
 * - https://github.com/angular/angular/blob/6f5f481fdae03f1d8db36284b64c7b82d9519d85/packages/service-worker/config/src/glob.ts
 * - https://github.com/angular/angular/blob/6f5f481fdae03f1d8db36284b64c7b82d9519d85/aio/tests/deployment/shared/helpers.ts#L17
 * - https://github.com/angular/angular/blob/6f5f481fdae03f1d8db36284b64c7b82d9519d85/packages/service-worker/config/src/generator.ts#L86
 */
var QUESTION_MARK = '[^/]';
var WILD_SINGLE = '[^/]*';
var WILD_OPEN = '(?:.+\\/)?';
var TO_ESCAPE_BASE = [
    { replace: /\./g, with: '\\.' },
    { replace: /\+/g, with: '\\+' },
    { replace: /\*/g, with: WILD_SINGLE },
];
var TO_ESCAPE_WILDCARD_QM = __spread(TO_ESCAPE_BASE, [
    { replace: /\?/g, with: QUESTION_MARK },
]);
var TO_ESCAPE_LITERAL_QM = __spread(TO_ESCAPE_BASE, [
    { replace: /\?/g, with: '\\?' },
]);
/**
 * Converts the glob-like pattern into regex string.
 *
 * Patterns use a limited glob format:
 * `**` matches 0 or more path segments
 * `*` matches 0 or more characters excluding `/`
 * `?` matches exactly one character excluding `/` (but when @param literalQuestionMark is true, `?` is treated as normal character)
 * The `!` prefix marks the pattern as being negative, meaning that only URLs that don't match the pattern will be included
 *
 * @param glob glob-like pattern
 * @param literalQuestionMark when true, it tells that `?` is treated as a normal character
 */
function globToRegex(glob, literalQuestionMark) {
    if (literalQuestionMark === void 0) { literalQuestionMark = false; }
    var toEscape = literalQuestionMark
        ? TO_ESCAPE_LITERAL_QM
        : TO_ESCAPE_WILDCARD_QM;
    var segments = glob.split('/').reverse();
    var regex = '';
    while (segments.length > 0) {
        var segment = segments.pop();
        if (segment === '**') {
            if (segments.length > 0) {
                regex += WILD_OPEN;
            }
            else {
                regex += '.*';
            }
        }
        else {
            var processed = toEscape.reduce(function (seg, escape) { return seg.replace(escape.replace, escape.with); }, segment);
            regex += processed;
            if (segments.length > 0) {
                regex += '\\/';
            }
        }
    }
    return regex;
}
/**
 * For given list of glob-like patterns, returns a matcher function.
 *
 * The matcher returns true for given URL only when ANY of the positive patterns is matched and NONE of the negative ones.
 */
function getGlobMatcher(patterns) {
    var processedPatterns = processGlobPatterns(patterns).map(function (_a) {
        var positive = _a.positive, regex = _a.regex;
        return ({
            positive: positive,
            regex: new RegExp(regex),
        });
    });
    var includePatterns = processedPatterns.filter(function (spec) { return spec.positive; });
    var excludePatterns = processedPatterns.filter(function (spec) { return !spec.positive; });
    return function (url) {
        return includePatterns.some(function (pattern) { return pattern.regex.test(url); }) &&
            !excludePatterns.some(function (pattern) { return pattern.regex.test(url); });
    };
}
/**
 * Converts list of glob-like patterns into list of RegExps with information whether the glob pattern is positive or negative
 */
function processGlobPatterns(urls) {
    return urls.map(function (url) {
        var positive = !url.startsWith('!');
        url = positive ? url : url.substr(1);
        return { positive: positive, regex: "^" + globToRegex(url) + "$" };
    });
}

var GlobService = /** @class */ (function () {
    function GlobService() {
    }
    /**
     * For given list of glob-like patterns, returns a validator function.
     *
     * The validator returns true for given URL only when ANY of the positive patterns is matched and NONE of the negative ones.
     */
    GlobService.prototype.getValidator = function (patterns) {
        var processedPatterns = processGlobPatterns(patterns).map(function (_a) {
            var positive = _a.positive, regex = _a.regex;
            return ({
                positive: positive,
                regex: new RegExp(regex),
            });
        });
        var includePatterns = processedPatterns.filter(function (spec) { return spec.positive; });
        var excludePatterns = processedPatterns.filter(function (spec) { return !spec.positive; });
        return function (url) {
            return includePatterns.some(function (pattern) { return pattern.regex.test(url); }) &&
                !excludePatterns.some(function (pattern) { return pattern.regex.test(url); });
        };
    };
    GlobService.ɵprov = ɵɵdefineInjectable({ factory: function GlobService_Factory() { return new GlobService(); }, token: GlobService, providedIn: "root" });
    GlobService = __decorate([
        Injectable({ providedIn: 'root' })
    ], GlobService);
    return GlobService;
}());

var UrlMatcherService = /** @class */ (function () {
    function UrlMatcherService(globService) {
        this.globService = globService;
    }
    /**
     * Returns a matcher that is always fails
     */
    UrlMatcherService.prototype.getFalsy = function () {
        return function falsyUrlMatcher() {
            return null;
        };
    };
    /**
     * Returns a matcher for given list of paths
     */
    UrlMatcherService.prototype.getFromPaths = function (paths) {
        var _this = this;
        var matchers = paths.map(function (path) { return _this.getFromPath(path); });
        var matcher = this.getCombined(matchers);
        if (isDevMode()) {
            matcher['_paths'] = paths; // property added for easier debugging of routes
        }
        return matcher;
    };
    /**
     * Returns a matcher that combines the given matchers
     * */
    UrlMatcherService.prototype.getCombined = function (matchers) {
        var matcher = function combinedUrlMatchers(segments, segmentGroup, route) {
            for (var i = 0; i < matchers.length; i++) {
                var result = matchers[i](segments, segmentGroup, route);
                if (result) {
                    return result;
                }
            }
            return null;
        };
        if (isDevMode()) {
            matcher['_matchers'] = matchers; // property added for easier debugging of routes
        }
        return matcher;
    };
    /**
     * Similar to Angular's defaultUrlMatcher. Differences:
     * - the `path` comes from function's argument, not from `route.path`
     * - the empty path `''` is handled here, but in Angular is handled one level higher in the match() function
     */
    UrlMatcherService.prototype.getFromPath = function (path) {
        if (path === void 0) { path = ''; }
        var matcher = function pathUrlMatcher(segments, segmentGroup, route) {
            /**
             * @license
             * The MIT License
             * Copyright (c) 2010-2019 Google LLC. http://angular.io/license
             *
             * See:
             * - https://github.com/angular/angular/blob/6f5f481fdae03f1d8db36284b64c7b82d9519d85/packages/router/src/shared.ts#L121
             */
            // use function's argument, not the `route.path`
            if (path === '') {
                if (route.pathMatch === 'full' &&
                    (segmentGroup.hasChildren() || segments.length > 0)) {
                    return null;
                }
                return { consumed: [], posParams: {} };
            }
            var parts = path.split('/'); // use function's argument, not the `route.path`
            if (parts.length > segments.length) {
                // The actual URL is shorter than the config, no match
                return null;
            }
            if (route.pathMatch === 'full' &&
                (segmentGroup.hasChildren() || parts.length < segments.length)) {
                // The config is longer than the actual URL but we are looking for a full match, return null
                return null;
            }
            var posParams = {};
            // Check each config part against the actual URL
            for (var index = 0; index < parts.length; index++) {
                var part = parts[index];
                var segment = segments[index];
                var isParameter = part.startsWith(':');
                if (isParameter) {
                    posParams[part.substring(1)] = segment;
                }
                else if (part !== segment.path) {
                    // The actual URL part does not match the config, no match
                    return null;
                }
            }
            return { consumed: segments.slice(0, parts.length), posParams: posParams };
        };
        if (isDevMode()) {
            matcher['_path'] = path; // property added for easier debugging of routes
        }
        return matcher;
    };
    /**
     * Returns URL matcher that accepts almost everything (like `**` route), but not paths accepted by the given matcher
     */
    UrlMatcherService.prototype.getOpposite = function (originalMatcher) {
        var matcher = function oppositeUrlMatcher(segments, group, route) {
            return originalMatcher(segments, group, route)
                ? null
                : { consumed: segments, posParams: {} };
        };
        if (isDevMode()) {
            matcher['_originalMatcher'] = originalMatcher; // property added for easier debugging of routes
        }
        return matcher;
    };
    /**
     * Returns URL matcher for the given list of glob-like patterns. Each pattern must start with `/` or `!/`.
     */
    UrlMatcherService.prototype.getFromGlob = function (globPatterns) {
        var globValidator = this.globService.getValidator(globPatterns);
        var matcher = function globUrlMatcher(segments) {
            var fullPath = "/" + segments.map(function (s) { return s.path; }).join('/');
            return globValidator(fullPath)
                ? { consumed: segments, posParams: {} }
                : null;
        };
        if (isDevMode()) {
            matcher['_globPatterns'] = globPatterns; // property added for easier debugging of routes
        }
        return matcher;
    };
    UrlMatcherService.ctorParameters = function () { return [
        { type: GlobService }
    ]; };
    UrlMatcherService.ɵprov = ɵɵdefineInjectable({ factory: function UrlMatcherService_Factory() { return new UrlMatcherService(ɵɵinject(GlobService)); }, token: UrlMatcherService, providedIn: "root" });
    UrlMatcherService = __decorate([
        Injectable({ providedIn: 'root' })
    ], UrlMatcherService);
    return UrlMatcherService;
}());

var ConfigurableRoutesService = /** @class */ (function () {
    function ConfigurableRoutesService(injector, routingConfigService, urlMatcherService) {
        this.injector = injector;
        this.routingConfigService = routingConfigService;
        this.urlMatcherService = urlMatcherService;
        this.initCalled = false; // guard not to call init() more than once
    }
    /**
     * Enhances existing Angular routes using the routing config of Spartacus.
     * Can be called only once.
     */
    ConfigurableRoutesService.prototype.init = function () {
        if (!this.initCalled) {
            this.initCalled = true;
            this.configure();
        }
    };
    /**
     * Enhances existing Angular routes using the routing config of Spartacus.
     */
    ConfigurableRoutesService.prototype.configure = function () {
        // Router could not be injected in constructor due to cyclic dependency with APP_INITIALIZER:
        var router = this.injector.get(Router);
        router.resetConfig(this.configureRoutes(router.config));
    };
    /**
     * Sets the property `path` or `matcher` for the given routes, based on the Spartacus' routing configuration.
     *
     * @param routes list of Angular `Route` objects
     */
    ConfigurableRoutesService.prototype.configureRoutes = function (routes) {
        var _this = this;
        return routes.map(function (route) {
            var configuredRoute = _this.configureRoute(route);
            if (route.children && route.children.length) {
                configuredRoute.children = _this.configureRoutes(route.children);
            }
            return configuredRoute;
        });
    };
    /**
     * Sets the property `path` or `matcher` of the `Route`, based on the Spartacus' routing configuration.
     * Uses the property `data.cxRoute` to determine the name of the route.
     * It's the same name used as a key in the routing configuration: `routing.routes[ROUTE NAME]`.
     *
     * @param route Angular `Route` object
     */
    ConfigurableRoutesService.prototype.configureRoute = function (route) {
        var _a;
        var routeName = this.getRouteName(route);
        if (routeName) {
            var routeConfig = this.routingConfigService.getRouteConfig(routeName);
            this.validateRouteConfig(routeConfig, routeName, route);
            if (routeConfig === null || routeConfig === void 0 ? void 0 : routeConfig.disabled) {
                delete route.path;
                return __assign(__assign({}, route), { matcher: this.urlMatcherService.getFalsy() });
            }
            else if (routeConfig === null || routeConfig === void 0 ? void 0 : routeConfig.matchers) {
                delete route.path;
                return __assign(__assign({}, route), { matcher: this.resolveUrlMatchers(route, routeConfig === null || routeConfig === void 0 ? void 0 : routeConfig.matchers) });
            }
            else if (((_a = routeConfig === null || routeConfig === void 0 ? void 0 : routeConfig.paths) === null || _a === void 0 ? void 0 : _a.length) === 1) {
                delete route.matcher;
                return __assign(__assign({}, route), { path: routeConfig === null || routeConfig === void 0 ? void 0 : routeConfig.paths[0] });
            }
            else {
                delete route.path;
                return __assign(__assign({}, route), { matcher: this.urlMatcherService.getFromPaths((routeConfig === null || routeConfig === void 0 ? void 0 : routeConfig.paths) || []) });
            }
        }
        return route; // if route doesn't have a name, just pass the original route
    };
    /**
     * Creates a single `UrlMatcher` based on given matchers and factories of matchers.
     *
     * @param route Route object
     * @param matchersOrFactories `UrlMatcher`s or injection tokens with a factory functions
     *  that create UrlMatchers based on the given route.
     */
    ConfigurableRoutesService.prototype.resolveUrlMatchers = function (route, matchersOrFactories) {
        var _this = this;
        var matchers = matchersOrFactories.map(function (matcherOrFactory) {
            return typeof matcherOrFactory === 'function'
                ? matcherOrFactory // matcher
                : _this.resolveUrlMatcherFactory(route, matcherOrFactory); // factory injection token
        });
        return this.urlMatcherService.getCombined(matchers);
    };
    /**
     * Creates an `UrlMatcher` based on the given route, using the factory function coming from the given injection token.
     *
     * @param route Route object
     * @param factoryToken injection token with a factory function that will create an UrlMatcher using given route
     */
    ConfigurableRoutesService.prototype.resolveUrlMatcherFactory = function (route, factoryToken) {
        var factory = this.injector.get(factoryToken);
        return factory(route);
    };
    /**
     * Returns the name of the Route stored in its property `data.cxRoute`
     * @param route
     */
    ConfigurableRoutesService.prototype.getRouteName = function (route) {
        return route.data && route.data.cxRoute;
    };
    ConfigurableRoutesService.prototype.validateRouteConfig = function (routeConfig, routeName, route) {
        if (isDevMode()) {
            // - null value of routeConfig or routeConfig.paths means explicit switching off the route - it's valid config
            // - routeConfig with defined `matchers` is valid, even if `paths` are undefined
            if (routeConfig === null ||
                routeConfig.paths === null || (routeConfig === null || routeConfig === void 0 ? void 0 : routeConfig.matchers)) {
                return;
            }
            // undefined value of routeConfig or routeConfig.paths is a misconfiguration
            if (!(routeConfig === null || routeConfig === void 0 ? void 0 : routeConfig.paths)) {
                this.warn("Could not configure the named route '" + routeName + "'", route, "due to undefined config or undefined 'paths' property for this route");
                return;
            }
        }
    };
    ConfigurableRoutesService.prototype.warn = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        if (isDevMode()) {
            console.warn.apply(console, __spread(args));
        }
    };
    ConfigurableRoutesService.ctorParameters = function () { return [
        { type: Injector },
        { type: RoutingConfigService },
        { type: UrlMatcherService }
    ]; };
    ConfigurableRoutesService.ɵprov = ɵɵdefineInjectable({ factory: function ConfigurableRoutesService_Factory() { return new ConfigurableRoutesService(ɵɵinject(INJECTOR), ɵɵinject(RoutingConfigService), ɵɵinject(UrlMatcherService)); }, token: ConfigurableRoutesService, providedIn: "root" });
    ConfigurableRoutesService = __decorate([
        Injectable({ providedIn: 'root' })
    ], ConfigurableRoutesService);
    return ConfigurableRoutesService;
}());

var UrlPipe = /** @class */ (function () {
    function UrlPipe(urlService) {
        this.urlService = urlService;
    }
    UrlPipe.prototype.transform = function (commands) {
        return this.urlService.transform(commands);
    };
    UrlPipe.ctorParameters = function () { return [
        { type: SemanticPathService }
    ]; };
    UrlPipe = __decorate([
        Pipe({
            name: 'cxUrl',
        })
    ], UrlPipe);
    return UrlPipe;
}());

var ProductURLPipe = /** @class */ (function () {
    function ProductURLPipe(semanticPath) {
        this.semanticPath = semanticPath;
    }
    ProductURLPipe.prototype.transform = function (product) {
        return this.semanticPath.transform({ cxRoute: 'product', params: product });
    };
    ProductURLPipe.ctorParameters = function () { return [
        { type: SemanticPathService }
    ]; };
    ProductURLPipe = __decorate([
        Pipe({
            name: 'cxProductUrl',
        })
    ], ProductURLPipe);
    return ProductURLPipe;
}());

var UrlModule = /** @class */ (function () {
    function UrlModule() {
    }
    UrlModule = __decorate([
        NgModule({
            imports: [CommonModule],
            declarations: [UrlPipe, ProductURLPipe],
            exports: [UrlPipe, ProductURLPipe],
        })
    ], UrlModule);
    return UrlModule;
}());

var ExternalRoutesConfig = /** @class */ (function () {
    function ExternalRoutesConfig() {
    }
    ExternalRoutesConfig.ɵprov = ɵɵdefineInjectable({ factory: function ExternalRoutesConfig_Factory() { return ɵɵinject(Config); }, token: ExternalRoutesConfig, providedIn: "root" });
    ExternalRoutesConfig = __decorate([
        Injectable({
            providedIn: 'root',
            useExisting: Config,
        })
    ], ExternalRoutesConfig);
    return ExternalRoutesConfig;
}());

var ExternalRoutesGuard = /** @class */ (function () {
    function ExternalRoutesGuard(winRef, platformId) {
        this.winRef = winRef;
        this.platformId = platformId;
    }
    /**
     * Redirects to different storefront system for anticipated URL
     */
    ExternalRoutesGuard.prototype.canActivate = function (route, state) {
        if (isPlatformBrowser(this.platformId)) {
            this.redirect(route, state);
        }
        return false;
    };
    /**
     * Redirects to anticipated URL using full page reload, not Angular routing
     */
    ExternalRoutesGuard.prototype.redirect = function (_, state) {
        var window = this.winRef.nativeWindow;
        if (window && window.location) {
            window.location.href = state.url;
        }
    };
    ExternalRoutesGuard.ctorParameters = function () { return [
        { type: WindowRef },
        { type: Object, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] }
    ]; };
    ExternalRoutesGuard.ɵprov = ɵɵdefineInjectable({ factory: function ExternalRoutesGuard_Factory() { return new ExternalRoutesGuard(ɵɵinject(WindowRef), ɵɵinject(PLATFORM_ID)); }, token: ExternalRoutesGuard, providedIn: "root" });
    ExternalRoutesGuard = __decorate([
        Injectable({ providedIn: 'root' }),
        __param(1, Inject(PLATFORM_ID))
    ], ExternalRoutesGuard);
    return ExternalRoutesGuard;
}());

function addExternalRoutesFactory(service) {
    var result = function () {
        service.addRoutes();
    };
    return result;
}

/**
 * Service that helps redirecting to different storefront systems for configured URLs
 */
var ExternalRoutesService = /** @class */ (function () {
    function ExternalRoutesService(config, urlMatcherService, injector) {
        this.config = config;
        this.urlMatcherService = urlMatcherService;
        this.injector = injector;
    }
    Object.defineProperty(ExternalRoutesService.prototype, "internalUrlPatterns", {
        get: function () {
            return ((this.config && this.config.routing && this.config.routing.internal) || []);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Prepends routes (to the Router.config) that are responsible for redirecting to a different storefront system
     */
    ExternalRoutesService.prototype.addRoutes = function () {
        var router = this.injector.get(Router);
        var newRoutes = this.getRoutes();
        if (newRoutes.length) {
            router.resetConfig(__spread(newRoutes, router.config));
        }
    };
    /**
     * Returns routes that are responsible for redirection to different storefront systems
     */
    ExternalRoutesService.prototype.getRoutes = function () {
        if (!this.internalUrlPatterns.length) {
            return [];
        }
        var routes = [];
        routes.push({
            pathMatch: 'full',
            matcher: this.getUrlMatcher(),
            canActivate: [ExternalRoutesGuard],
            component: {},
        });
        return routes;
    };
    /**
     * Returns the URL matcher for the external route
     */
    ExternalRoutesService.prototype.getUrlMatcher = function () {
        var matcher = this.urlMatcherService.getFromGlob(this.internalUrlPatterns);
        return this.urlMatcherService.getOpposite(matcher); // the external route should be activated only when it's NOT an internal route
    };
    ExternalRoutesService.ctorParameters = function () { return [
        { type: ExternalRoutesConfig },
        { type: UrlMatcherService },
        { type: Injector }
    ]; };
    ExternalRoutesService.ɵprov = ɵɵdefineInjectable({ factory: function ExternalRoutesService_Factory() { return new ExternalRoutesService(ɵɵinject(ExternalRoutesConfig), ɵɵinject(UrlMatcherService), ɵɵinject(INJECTOR)); }, token: ExternalRoutesService, providedIn: "root" });
    ExternalRoutesService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], ExternalRoutesService);
    return ExternalRoutesService;
}());

/**
 * Prepends the external route that redirects to a different storefront system for configured URLs
 */
var ExternalRoutesModule = /** @class */ (function () {
    function ExternalRoutesModule() {
    }
    ExternalRoutesModule_1 = ExternalRoutesModule;
    ExternalRoutesModule.forRoot = function () {
        return {
            ngModule: ExternalRoutesModule_1,
            providers: [
                {
                    provide: APP_INITIALIZER,
                    multi: true,
                    useFactory: addExternalRoutesFactory,
                    deps: [ExternalRoutesService],
                },
            ],
        };
    };
    var ExternalRoutesModule_1;
    ExternalRoutesModule = ExternalRoutesModule_1 = __decorate([
        NgModule()
    ], ExternalRoutesModule);
    return ExternalRoutesModule;
}());

var PageContext = /** @class */ (function () {
    function PageContext(id, type) {
        this.id = id;
        this.type = type;
    }
    return PageContext;
}());

var ProtectedRoutesService = /** @class */ (function () {
    function ProtectedRoutesService(config) {
        var _this = this;
        this.config = config;
        this.nonProtectedPaths = []; // arrays of paths' segments list
        if (this.shouldProtect) {
            // pre-process config for performance:
            this.nonProtectedPaths = this.getNonProtectedPaths().map(function (path) {
                return _this.getSegments(path);
            });
        }
    }
    Object.defineProperty(ProtectedRoutesService.prototype, "routingConfig", {
        get: function () {
            return this.config && this.config.routing;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ProtectedRoutesService.prototype, "shouldProtect", {
        /**
         * Returns 'protected' property (boolean) from routing config
         *
         * @returns boolean
         */
        get: function () {
            return this.routingConfig.protected;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Tells if the url is protected
     */
    ProtectedRoutesService.prototype.isUrlProtected = function (urlSegments) {
        return (this.shouldProtect &&
            !this.matchAnyPath(urlSegments, this.nonProtectedPaths));
    };
    /**
     * Tells whether the url matches at least one of the paths
     */
    ProtectedRoutesService.prototype.matchAnyPath = function (urlSegments, pathsSegments) {
        var _this = this;
        return pathsSegments.some(function (pathSegments) {
            return _this.matchPath(urlSegments, pathSegments);
        });
    };
    /**
     * Tells whether the url matches the path
     */
    ProtectedRoutesService.prototype.matchPath = function (urlSegments, pathSegments) {
        if (urlSegments.length !== pathSegments.length) {
            return false;
        }
        for (var i = 0; i < pathSegments.length; i++) {
            var pathSeg = pathSegments[i];
            var urlSeg = urlSegments[i];
            // compare only static segments:
            if (!pathSeg.startsWith(':') && pathSeg !== urlSeg) {
                return false;
            }
        }
        return true;
    };
    /**
     * Returns a list of paths that are not protected
     */
    ProtectedRoutesService.prototype.getNonProtectedPaths = function () {
        return Object.values(this.routingConfig.routes).reduce(function (acc, routeConfig) {
            return routeConfig.protected === false && // must be explicitly false, ignore undefined
                routeConfig.paths &&
                routeConfig.paths.length
                ? acc.concat(routeConfig.paths)
                : acc;
        }, []);
    };
    /**
     * Splits the url by slashes
     */
    ProtectedRoutesService.prototype.getSegments = function (url) {
        return (url || '').split('/');
    };
    ProtectedRoutesService.ctorParameters = function () { return [
        { type: RoutingConfig }
    ]; };
    ProtectedRoutesService.ɵprov = ɵɵdefineInjectable({ factory: function ProtectedRoutesService_Factory() { return new ProtectedRoutesService(ɵɵinject(RoutingConfig)); }, token: ProtectedRoutesService, providedIn: "root" });
    ProtectedRoutesService = __decorate([
        Injectable({ providedIn: 'root' })
    ], ProtectedRoutesService);
    return ProtectedRoutesService;
}());

var ProtectedRoutesGuard = /** @class */ (function () {
    function ProtectedRoutesGuard(service, authGuard) {
        this.service = service;
        this.authGuard = authGuard;
    }
    /**
     * When the anticipated url is protected, it switches to the AuthGuard. Otherwise emits true.
     */
    ProtectedRoutesGuard.prototype.canActivate = function (route) {
        var urlSegments = route.url.map(function (seg) { return seg.path; });
        // For the root path `/` ActivatedRoute contains an empty array of segments:
        urlSegments = urlSegments.length ? urlSegments : [''];
        if (this.service.isUrlProtected(urlSegments)) {
            return this.authGuard.canActivate();
        }
        return of(true);
    };
    ProtectedRoutesGuard.ctorParameters = function () { return [
        { type: ProtectedRoutesService },
        { type: AuthGuard }
    ]; };
    ProtectedRoutesGuard.ɵprov = ɵɵdefineInjectable({ factory: function ProtectedRoutesGuard_Factory() { return new ProtectedRoutesGuard(ɵɵinject(ProtectedRoutesService), ɵɵinject(AuthGuard)); }, token: ProtectedRoutesGuard, providedIn: "root" });
    ProtectedRoutesGuard = __decorate([
        Injectable({ providedIn: 'root' })
    ], ProtectedRoutesGuard);
    return ProtectedRoutesGuard;
}());

var RouterEffects = /** @class */ (function () {
    function RouterEffects(actions$, router, location) {
        var _this = this;
        this.actions$ = actions$;
        this.router = router;
        this.location = location;
        this.navigate$ = this.actions$.pipe(ofType(ROUTER_GO), map(function (action) { return action.payload; }), tap(function (_a) {
            var path = _a.path, queryParams = _a.query, extras = _a.extras;
            _this.router.navigate(path, __assign({ queryParams: queryParams }, extras));
        }));
        this.navigateBuUrl$ = this.actions$.pipe(ofType(ROUTER_GO_BY_URL), map(function (action) { return action.payload; }), tap(function (url) {
            _this.router.navigateByUrl(url);
        }));
        this.clearCmsRoutes$ = this.actions$.pipe(ofType(LANGUAGE_CHANGE, LOGOUT, LOGIN), tap(function () {
            var filteredConfig = _this.router.config.filter(function (route) { return !(route.data && route.data.cxCmsRouteContext); });
            if (filteredConfig.length !== _this.router.config.length) {
                _this.router.resetConfig(filteredConfig);
            }
        }));
        this.navigateBack$ = this.actions$.pipe(ofType(ROUTER_BACK), tap(function () { return _this.location.back(); }));
        this.navigateForward$ = this.actions$.pipe(ofType(ROUTER_FORWARD), tap(function () { return _this.location.forward(); }));
    }
    RouterEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: Router },
        { type: Location }
    ]; };
    __decorate([
        Effect({ dispatch: false })
    ], RouterEffects.prototype, "navigate$", void 0);
    __decorate([
        Effect({ dispatch: false })
    ], RouterEffects.prototype, "navigateBuUrl$", void 0);
    __decorate([
        Effect({ dispatch: false })
    ], RouterEffects.prototype, "clearCmsRoutes$", void 0);
    __decorate([
        Effect({ dispatch: false })
    ], RouterEffects.prototype, "navigateBack$", void 0);
    __decorate([
        Effect({ dispatch: false })
    ], RouterEffects.prototype, "navigateForward$", void 0);
    RouterEffects = __decorate([
        Injectable()
    ], RouterEffects);
    return RouterEffects;
}());

var effects$6 = [RouterEffects];

var initialState$c = {
    navigationId: 0,
    state: {
        url: '',
        queryParams: {},
        params: {},
        context: {
            id: '',
        },
        cmsRequired: false,
    },
    nextState: undefined,
};
function getReducers$6() {
    return {
        router: reducer$c,
    };
}
function reducer$c(state, action) {
    if (state === void 0) { state = initialState$c; }
    switch (action.type) {
        case ROUTER_NAVIGATION: {
            return __assign(__assign({}, state), { nextState: action.payload.routerState, navigationId: action.payload.event.id });
        }
        case ROUTER_ERROR:
        case ROUTER_CANCEL: {
            return __assign(__assign({}, state), { nextState: undefined });
        }
        case ROUTER_NAVIGATED: {
            return {
                state: action.payload.routerState,
                navigationId: action.payload.event.id,
                nextState: undefined,
            };
        }
        default: {
            return state;
        }
    }
}
var reducerToken$6 = new InjectionToken('RouterReducers');
var reducerProvider$6 = {
    provide: reducerToken$6,
    useFactory: getReducers$6,
};
/* The serializer is there to parse the RouterStateSnapshot,
and to reduce the amount of properties to be passed to the reducer.
 */
var CustomSerializer = /** @class */ (function () {
    function CustomSerializer() {
    }
    CustomSerializer.prototype.serialize = function (routerState) {
        var url = routerState.url;
        var queryParams = routerState.root.queryParams;
        var state = routerState.root;
        var cmsRequired = false;
        var context;
        while (state.firstChild) {
            state = state.firstChild;
            // we use context information embedded in Cms driven routes from any parent route
            if (state.data && state.data.cxCmsRouteContext) {
                context = state.data.cxCmsRouteContext;
            }
            // we assume, that any route that has CmsPageGuard or it's child
            // is cmsRequired
            if (!cmsRequired &&
                (context ||
                    (state.routeConfig &&
                        state.routeConfig.canActivate &&
                        state.routeConfig.canActivate.find(function (x) { return x && x.guardName === 'CmsPageGuard'; })))) {
                cmsRequired = true;
            }
        }
        var params = state.params;
        // we give smartedit preview page a PageContext
        if (state.url.length > 0 && state.url[0].path === 'cx-preview') {
            context = {
                id: 'smartedit-preview',
                type: PageType.CONTENT_PAGE,
            };
        }
        else {
            if (params['productCode']) {
                context = { id: params['productCode'], type: PageType.PRODUCT_PAGE };
            }
            else if (params['categoryCode']) {
                context = { id: params['categoryCode'], type: PageType.CATEGORY_PAGE };
            }
            else if (params['brandCode']) {
                context = { id: params['brandCode'], type: PageType.CATEGORY_PAGE };
            }
            else if (state.data.pageLabel !== undefined) {
                context = { id: state.data.pageLabel, type: PageType.CONTENT_PAGE };
            }
            else if (!context) {
                if (state.url.length > 0) {
                    var pageLabel = '/' + state.url.map(function (urlSegment) { return urlSegment.path; }).join('/');
                    context = {
                        id: pageLabel,
                        type: PageType.CONTENT_PAGE,
                    };
                }
                else {
                    context = {
                        id: 'homepage',
                        type: PageType.CONTENT_PAGE,
                    };
                }
            }
        }
        return { url: url, queryParams: queryParams, params: params, context: context, cmsRequired: cmsRequired };
    };
    return CustomSerializer;
}());

function initConfigurableRoutes(service) {
    var result = function () { return service.init(); }; // workaround for AOT compilation (see https://stackoverflow.com/a/51977115)
    return result;
}
var RoutingModule = /** @class */ (function () {
    function RoutingModule() {
    }
    RoutingModule_1 = RoutingModule;
    RoutingModule.forRoot = function () {
        return {
            ngModule: RoutingModule_1,
            providers: [
                reducerProvider$6,
                {
                    provide: RouterStateSerializer,
                    useClass: CustomSerializer,
                },
                {
                    provide: APP_INITIALIZER,
                    useFactory: initConfigurableRoutes,
                    deps: [ConfigurableRoutesService],
                    multi: true,
                },
            ],
        };
    };
    var RoutingModule_1;
    RoutingModule = RoutingModule_1 = __decorate([
        NgModule({
            imports: [
                StoreModule.forFeature(ROUTING_FEATURE, reducerToken$6),
                EffectsModule.forFeature(effects$6),
                StoreRouterConnectingModule.forRoot({
                    routerState: 1 /* Minimal */,
                    stateKey: ROUTING_FEATURE,
                }),
            ],
        })
    ], RoutingModule);
    return RoutingModule;
}());

function getDefaultUrlMatcherFactory(routingConfigService, urlMatcherService) {
    var factory = function (route) {
        var routeName = route.data && route.data['cxRoute'];
        var routeConfig = routingConfigService.getRouteConfig(routeName);
        var paths = (routeConfig && routeConfig.paths) || [];
        return urlMatcherService.getFromPaths(paths);
    };
    return factory;
}
/**
 * Injection token with url matcher factory for spartacus routes containing property `data.cxRoute`.
 * The provided url matcher matches the configured `paths` from routing config.
 *
 * If this matcher doesn't fit the requirements, it can be replaced with custom matcher
 * or additional matchers can be added for a specific route. See for example PRODUCT_DETAILS_URL_MATCHER.
 *
 * Note: Matchers will "match" a route, but do not contribute to the creation of the route, nor do they guard routes.
 */
var DEFAULT_URL_MATCHER = new InjectionToken('DEFAULT_URL_MATCHER', {
    providedIn: 'root',
    factory: function () {
        return getDefaultUrlMatcherFactory(inject(RoutingConfigService), inject(UrlMatcherService));
    },
});

var NavigationEntryItemEffects = /** @class */ (function () {
    function NavigationEntryItemEffects(actions$, cmsComponentConnector, routingService) {
        var _this = this;
        this.actions$ = actions$;
        this.cmsComponentConnector = cmsComponentConnector;
        this.routingService = routingService;
        this.loadNavigationItems$ = this.actions$.pipe(ofType(LOAD_CMS_NAVIGATION_ITEMS), map(function (action) { return action.payload; }), map(function (payload) {
            return {
                ids: _this.getIdListByItemType(payload.items),
                nodeId: payload.nodeId,
            };
        }), mergeMap(function (data) {
            if (data.ids.componentIds.length > 0) {
                return _this.routingService.getRouterState().pipe(filter(function (routerState) { return routerState !== undefined; }), map(function (routerState) { return routerState.state.context; }), take(1), mergeMap(function (pageContext) {
                    // download all items in one request
                    return _this.cmsComponentConnector
                        .getList(data.ids.componentIds, pageContext)
                        .pipe(map(function (components) {
                        return new LoadCmsNavigationItemsSuccess({
                            nodeId: data.nodeId,
                            components: components,
                        });
                    }), catchError(function (error) {
                        return of(new LoadCmsNavigationItemsFail(data.nodeId, makeErrorSerializable(error)));
                    }));
                }));
            }
            else if (data.ids.pageIds.length > 0) {
                // TODO: future work
                // dispatch action to load cms page one by one
            }
            else if (data.ids.mediaIds.length > 0) {
                // TODO: future work
                // send request to get list of media
            }
            else {
                return of(new LoadCmsNavigationItemsFail(data.nodeId, 'navigation nodes are empty'));
            }
        }));
    }
    // We only consider 3 item types: cms page, cms component, and media.
    NavigationEntryItemEffects.prototype.getIdListByItemType = function (itemList) {
        var pageIds = [];
        var componentIds = [];
        var mediaIds = [];
        itemList.forEach(function (item) {
            if (item.superType === 'AbstractCMSComponent') {
                componentIds.push(item.id);
            }
            else if (item.superType === 'AbstractPage') {
                pageIds.push(item.id);
            }
            else if (item.superType === 'AbstractMedia') {
                mediaIds.push(item.id);
            }
        });
        return { pageIds: pageIds, componentIds: componentIds, mediaIds: mediaIds };
    };
    NavigationEntryItemEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: CmsComponentConnector },
        { type: RoutingService }
    ]; };
    __decorate([
        Effect()
    ], NavigationEntryItemEffects.prototype, "loadNavigationItems$", void 0);
    NavigationEntryItemEffects = __decorate([
        Injectable()
    ], NavigationEntryItemEffects);
    return NavigationEntryItemEffects;
}());

var CmsPageConnector = /** @class */ (function () {
    function CmsPageConnector(cmsPageAdapter, cmsStructureConfigService) {
        this.cmsPageAdapter = cmsPageAdapter;
        this.cmsStructureConfigService = cmsStructureConfigService;
    }
    /**
     * Returns an observable with the page structure. The page structure is
     * typically loaded from a backend, but can also be returned from static
     * configuration (see `CmsStructureConfigService`).
     */
    CmsPageConnector.prototype.get = function (pageContext) {
        var _this = this;
        return this.cmsStructureConfigService
            .shouldIgnoreBackend(pageContext.id)
            .pipe(switchMap(function (loadFromConfig) {
            if (!loadFromConfig) {
                return _this.cmsPageAdapter.load(pageContext).pipe(catchError(function (error) {
                    if (error instanceof HttpErrorResponse &&
                        error.status === 400) {
                        return of({});
                    }
                    else {
                        return throwError(error);
                    }
                }));
            }
            else {
                return of({});
            }
        }), switchMap(function (page) { return _this.mergeDefaultPageStructure(pageContext, page); }));
    };
    /**
     *
     * Merge default page structure inot the given `CmsStructureModel`.
     * This is benefitial for a fast setup of the UI without necessary
     * finegrained CMS setup.
     */
    CmsPageConnector.prototype.mergeDefaultPageStructure = function (pageContext, pageStructure) {
        return this.cmsStructureConfigService.mergePageStructure(pageContext.id, pageStructure);
    };
    CmsPageConnector.ctorParameters = function () { return [
        { type: CmsPageAdapter },
        { type: CmsStructureConfigService }
    ]; };
    CmsPageConnector.ɵprov = ɵɵdefineInjectable({ factory: function CmsPageConnector_Factory() { return new CmsPageConnector(ɵɵinject(CmsPageAdapter), ɵɵinject(CmsStructureConfigService)); }, token: CmsPageConnector, providedIn: "root" });
    CmsPageConnector = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], CmsPageConnector);
    return CmsPageConnector;
}());

var PageEffects = /** @class */ (function () {
    function PageEffects(actions$, cmsPageConnector, routingService) {
        var _this = this;
        this.actions$ = actions$;
        this.cmsPageConnector = cmsPageConnector;
        this.routingService = routingService;
        this.refreshPage$ = this.actions$.pipe(ofType(LANGUAGE_CHANGE, LOGOUT, LOGIN), switchMap(function () {
            return _this.routingService.getRouterState().pipe(filter(function (routerState) {
                return routerState &&
                    routerState.state &&
                    routerState.state.cmsRequired &&
                    !routerState.nextState;
            }), take(1), map(function (routerState) { return routerState.state.context; }), mergeMap(function (context) { return of(new LoadCmsPageData(context)); }));
        }));
        this.loadPageData$ = this.actions$.pipe(ofType(LOAD_CMS_PAGE_DATA), map(function (action) { return action.payload; }), groupBy(function (pageContext) { return serializePageContext(pageContext); }), mergeMap(function (group) {
            return group.pipe(switchMap(function (pageContext) {
                return _this.cmsPageConnector.get(pageContext).pipe(mergeMap(function (cmsStructure) {
                    var actions = [
                        new CmsGetComponentFromPage(cmsStructure.components.map(function (component) { return ({
                            component: component,
                            pageContext: pageContext,
                        }); })),
                        new LoadCmsPageDataSuccess(pageContext, cmsStructure.page),
                    ];
                    var pageLabel = cmsStructure.page.label;
                    // For content pages the page label returned from backend can be different than page ID initially assumed from route.
                    // In such a case let's save the success response not only for initially assumed page ID, but also for correct page label.
                    if (pageLabel && pageLabel !== pageContext.id) {
                        actions.unshift(new CmsSetPageSuccessIndex({ id: pageLabel, type: pageContext.type }, cmsStructure.page));
                    }
                    return actions;
                }), catchError(function (error) {
                    return of(new LoadCmsPageDataFail(pageContext, makeErrorSerializable(error)));
                }));
            }));
        }));
    }
    PageEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: CmsPageConnector },
        { type: RoutingService }
    ]; };
    __decorate([
        Effect()
    ], PageEffects.prototype, "refreshPage$", void 0);
    __decorate([
        Effect()
    ], PageEffects.prototype, "loadPageData$", void 0);
    PageEffects = __decorate([
        Injectable()
    ], PageEffects);
    return PageEffects;
}());

var effects$7 = [
    PageEffects,
    ComponentsEffects,
    NavigationEntryItemEffects,
];

var initialState$d = {
    component: undefined,
    pageContext: {},
};
function componentExistsReducer(state, action) {
    switch (action.type) {
        case LOAD_CMS_COMPONENT_FAIL:
            return false;
        case CMS_GET_COMPONENT_FROM_PAGE:
        case LOAD_CMS_COMPONENT_SUCCESS:
            return true;
    }
    return state;
}
function reducer$d(state, action) {
    var _a, _b, _c, _d;
    if (state === void 0) { state = initialState$d; }
    switch (action.type) {
        case LOAD_CMS_COMPONENT: {
            var pageContextReducer = loaderReducer(action.meta.entityType, componentExistsReducer);
            var context = serializePageContext(action.payload.pageContext, true);
            return __assign(__assign({}, state), { pageContext: __assign(__assign({}, state.pageContext), (_a = {}, _a[context] = pageContextReducer(state.pageContext[context], action), _a)) });
        }
        case LOAD_CMS_COMPONENT_FAIL: {
            var pageContextReducer = loaderReducer(action.meta.entityType, componentExistsReducer);
            var context = serializePageContext(action.payload.pageContext, true);
            return __assign(__assign({}, state), { pageContext: __assign(__assign({}, state.pageContext), (_b = {}, _b[context] = pageContextReducer(state.pageContext[context], action), _b)) });
        }
        case LOAD_CMS_COMPONENT_SUCCESS: {
            var pageContextReducer = loaderReducer(action.meta.entityType, componentExistsReducer);
            var context = serializePageContext(action.payload.pageContext, true);
            return __assign(__assign({}, state), { component: action.payload.component, pageContext: __assign(__assign({}, state.pageContext), (_c = {}, _c[context] = pageContextReducer(state.pageContext[context], action), _c)) });
        }
        case CMS_GET_COMPONENT_FROM_PAGE: {
            var pageContextReducer = loaderReducer(action.meta.entityType, componentExistsReducer);
            if (!Array.isArray(action.payload)) {
                var context = serializePageContext(action.payload.pageContext, true);
                return __assign(__assign({}, state), { component: action.payload.component, pageContext: __assign(__assign({}, state.pageContext), (_d = {}, _d[context] = pageContextReducer(state.pageContext[context], action), _d)) });
            }
        }
    }
    return state;
}

var initialState$e = undefined;
function reducer$e(state, action) {
    if (state === void 0) { state = initialState$e; }
    switch (action.type) {
        case LOAD_CMS_NAVIGATION_ITEMS_SUCCESS: {
            if (action.payload.components) {
                var components = action.payload.components;
                var newItem = components.reduce(function (compItems, component) {
                    var _a;
                    return __assign(__assign({}, compItems), (_a = {}, _a[component.uid + "_AbstractCMSComponent"] = component, _a));
                }, __assign({}));
                return __assign(__assign({}, state), newItem);
            }
        }
    }
    return state;
}

var initialState$f = { entities: {} };
function reducer$f(state, action) {
    var _a;
    if (state === void 0) { state = initialState$f; }
    switch (action.type) {
        case LOAD_CMS_PAGE_DATA_SUCCESS: {
            var page = action.payload;
            return __assign(__assign({}, state), { entities: __assign(__assign({}, state.entities), (_a = {}, _a[page.pageId] = page, _a)) });
        }
    }
    return state;
}

var initialState$g = undefined;
function reducer$g(entityType) {
    return function (state, action) {
        if (state === void 0) { state = initialState$g; }
        if (action.meta && action.meta.entityType === entityType) {
            switch (action.type) {
                case LOAD_CMS_PAGE_DATA_SUCCESS: {
                    return action.payload.pageId;
                }
                case LOAD_CMS_PAGE_DATA_FAIL: {
                    return initialState$g;
                }
                case CMS_SET_PAGE_FAIL_INDEX: {
                    return action.payload;
                }
                case CMS_SET_PAGE_SUCCESS_INDEX: {
                    return action.payload.pageId;
                }
            }
        }
        return state;
    };
}

function getReducers$7() {
    return {
        page: combineReducers({
            pageData: reducer$f,
            index: combineReducers({
                content: entityLoaderReducer(PageType.CONTENT_PAGE, reducer$g(PageType.CONTENT_PAGE)),
                product: entityLoaderReducer(PageType.PRODUCT_PAGE, reducer$g(PageType.PRODUCT_PAGE)),
                category: entityLoaderReducer(PageType.CATEGORY_PAGE, reducer$g(PageType.CATEGORY_PAGE)),
                catalog: entityLoaderReducer(PageType.CATALOG_PAGE, reducer$g(PageType.CATALOG_PAGE)),
            }),
        }),
        components: entityReducer(COMPONENT_ENTITY, reducer$d),
        navigation: entityLoaderReducer(NAVIGATION_DETAIL_ENTITY, reducer$e),
    };
}
var reducerToken$7 = new InjectionToken('CmsReducers');
var reducerProvider$7 = {
    provide: reducerToken$7,
    useFactory: getReducers$7,
};
function clearCmsState(reducer) {
    return function (state, action) {
        if (action.type === LANGUAGE_CHANGE ||
            action.type === LOGOUT ||
            action.type === LOGIN) {
            state = undefined;
        }
        return reducer(state, action);
    };
}
var metaReducers$3 = [clearCmsState];

function cmsStoreConfigFactory() {
    var _a;
    // if we want to reuse CMS_FEATURE const in config, we have to use factory instead of plain object
    var config = {
        state: {
            ssrTransfer: {
                keys: (_a = {}, _a[CMS_FEATURE] = StateTransferType.TRANSFER_STATE, _a),
            },
        },
    };
    return config;
}
var CmsStoreModule = /** @class */ (function () {
    function CmsStoreModule() {
    }
    CmsStoreModule = __decorate([
        NgModule({
            imports: [
                CommonModule,
                HttpClientModule,
                StateModule,
                StoreModule.forFeature(CMS_FEATURE, reducerToken$7, { metaReducers: metaReducers$3 }),
                EffectsModule.forFeature(effects$7),
            ],
            providers: [
                provideDefaultConfigFactory(cmsStoreConfigFactory),
                reducerProvider$7,
            ],
        })
    ], CmsStoreModule);
    return CmsStoreModule;
}());

var CmsModule = /** @class */ (function () {
    function CmsModule() {
    }
    CmsModule_1 = CmsModule;
    CmsModule.forRoot = function () {
        return {
            ngModule: CmsModule_1,
            providers: [CmsService, provideDefaultConfig(defaultCmsModuleConfig)],
        };
    };
    var CmsModule_1;
    CmsModule = CmsModule_1 = __decorate([
        NgModule({
            imports: [CmsStoreModule, CmsPageTitleModule],
        })
    ], CmsModule);
    return CmsModule;
}());

var PageMetaService = /** @class */ (function () {
    function PageMetaService(resolvers, cms) {
        this.resolvers = resolvers;
        this.cms = cms;
        /**
         * The list of resolver interfaces will be evaluated for the pageResolvers.
         *
         * TOOD: optimize browser vs SSR resolvers; image, robots and description
         *       aren't needed during browsing.
         * TODO: we can make the list of resolver types configurable
         */
        this.resolverMethods = {
            title: 'resolveTitle',
            heading: 'resolveHeading',
            description: 'resolveDescription',
            breadcrumbs: 'resolveBreadcrumbs',
            image: 'resolveImage',
            robots: 'resolveRobots',
        };
        this.resolvers = this.resolvers || [];
    }
    PageMetaService.prototype.getMeta = function () {
        var _this = this;
        return this.cms.getCurrentPage().pipe(filter(Boolean), switchMap(function (page) {
            var metaResolver = _this.getMetaResolver(page);
            if (metaResolver) {
                return _this.resolve(metaResolver);
            }
            else {
                // we do not have a page resolver
                return of(null);
            }
        }));
    };
    /**
     * If a `PageResolver` has implemented a resolver interface, the resolved data
     * is merged into the `PageMeta` object.
     * @param metaResolver
     */
    PageMetaService.prototype.resolve = function (metaResolver) {
        var _this = this;
        var resolveMethods = Object.keys(this.resolverMethods)
            .filter(function (key) { return metaResolver[_this.resolverMethods[key]]; })
            .map(function (key) {
            return metaResolver[_this.resolverMethods[key]]().pipe(map(function (data) {
                var _a;
                return (_a = {},
                    _a[key] = data,
                    _a);
            }));
        });
        return combineLatest(resolveMethods).pipe(debounceTime(0), // avoid partial data emissions when all methods resolve at the same time
        map(function (data) { return Object.assign.apply(Object, __spread([{}], data)); }));
    };
    /**
     * Return the resolver with the best match, based on a score
     * generated by the resolver.
     *
     * Resolvers match by default on `PageType` and `page.template`.
     */
    PageMetaService.prototype.getMetaResolver = function (page) {
        return resolveApplicable(this.resolvers, [page], [page]);
    };
    PageMetaService.ctorParameters = function () { return [
        { type: Array, decorators: [{ type: Optional }, { type: Inject, args: [PageMetaResolver,] }] },
        { type: CmsService }
    ]; };
    PageMetaService.ɵprov = ɵɵdefineInjectable({ factory: function PageMetaService_Factory() { return new PageMetaService(ɵɵinject(PageMetaResolver, 8), ɵɵinject(CmsService)); }, token: PageMetaService, providedIn: "root" });
    PageMetaService = __decorate([
        Injectable({
            providedIn: 'root',
        }),
        __param(0, Optional()),
        __param(0, Inject(PageMetaResolver))
    ], PageMetaService);
    return PageMetaService;
}());

var SmartEditService = /** @class */ (function () {
    function SmartEditService(cmsService, routingService, baseSiteService, zone, winRef) {
        var _this = this;
        this.cmsService = cmsService;
        this.routingService = routingService;
        this.baseSiteService = baseSiteService;
        this.zone = zone;
        this.winRef = winRef;
        this.isPreviewPage = false;
        this._launchedInSmartEdit = false;
        this.getCmsTicket();
        if (winRef.nativeWindow) {
            var window_1 = winRef.nativeWindow;
            // rerender components and slots after editing
            window_1.smartedit = window_1.smartedit || {};
            window_1.smartedit.renderComponent = function (componentId, componentType, parentId) {
                return _this.renderComponent(componentId, componentType, parentId);
            };
            // reprocess page
            window_1.smartedit.reprocessPage = this.reprocessPage;
        }
    }
    Object.defineProperty(SmartEditService.prototype, "cmsTicketId", {
        get: function () {
            return this._cmsTicketId;
        },
        enumerable: true,
        configurable: true
    });
    SmartEditService.prototype.getCmsTicket = function () {
        var _this = this;
        combineLatest([
            this.cmsService.getCurrentPage(),
            this.routingService.getRouterState(),
        ])
            .pipe(takeWhile(function (_a) {
            var _b = __read(_a, 1), cmsPage = _b[0];
            return cmsPage === undefined;
        }), filter(function (_a) {
            var _b = __read(_a, 2), routerState = _b[1];
            if (routerState.nextState && !_this._cmsTicketId) {
                _this._cmsTicketId =
                    routerState.nextState.queryParams['cmsTicketId'];
                if (_this._cmsTicketId) {
                    return true;
                }
            }
            return false;
        }), take(1))
            .subscribe(function () {
            _this._launchedInSmartEdit = true;
            _this.getDefaultPreviewCode();
        });
    };
    SmartEditService.prototype.getDefaultPreviewCode = function () {
        var _this = this;
        this.baseSiteService
            .getBaseSiteData()
            .pipe(filter(function (site) { return Object.keys(site).length !== 0; }), take(1))
            .subscribe(function (site) {
            _this.defaultPreviewCategoryCode = site.defaultPreviewCategoryCode;
            _this.defaultPreviewProductCode = site.defaultPreviewProductCode;
            _this.addPageContract();
        });
    };
    SmartEditService.prototype.addPageContract = function () {
        var _this = this;
        this.cmsService.getCurrentPage().subscribe(function (cmsPage) {
            if (cmsPage && _this._cmsTicketId) {
                _this._currentPageId = cmsPage.pageId;
                // before adding contract to page, we need redirect to that page
                _this.goToPreviewPage(cmsPage);
                // remove old page contract
                var previousContract_1 = [];
                Array.from(_this.winRef.document.body.classList).forEach(function (attr) {
                    return previousContract_1.push(attr);
                });
                previousContract_1.forEach(function (attr) {
                    return _this.winRef.document.body.classList.remove(attr);
                });
                // add new page contract
                if (cmsPage.properties && cmsPage.properties.smartedit) {
                    var seClasses = cmsPage.properties.smartedit.classes.split(' ');
                    seClasses.forEach(function (classItem) {
                        _this.winRef.document.body.classList.add(classItem);
                    });
                }
            }
        });
    };
    SmartEditService.prototype.goToPreviewPage = function (cmsPage) {
        // only the first page is the smartedit preview page
        if (!this.isPreviewPage) {
            this.isPreviewPage = true;
            if (cmsPage.type === PageType.PRODUCT_PAGE &&
                this.defaultPreviewProductCode) {
                this.routingService.go({
                    cxRoute: 'product',
                    params: { code: this.defaultPreviewProductCode, name: '' },
                });
            }
            else if (cmsPage.type === PageType.CATEGORY_PAGE &&
                this.defaultPreviewCategoryCode) {
                this.routingService.go({
                    cxRoute: 'category',
                    params: { code: this.defaultPreviewCategoryCode },
                });
            }
        }
    };
    SmartEditService.prototype.renderComponent = function (componentId, componentType, parentId) {
        var _this = this;
        if (componentId) {
            this.zone.run(function () {
                // without parentId, it is slot
                if (!parentId) {
                    if (_this._currentPageId) {
                        _this.cmsService.refreshPageById(_this._currentPageId);
                    }
                    else {
                        _this.cmsService.refreshLatestPage();
                    }
                }
                else if (componentType) {
                    _this.cmsService.refreshComponent(componentId);
                }
            });
        }
        return true;
    };
    SmartEditService.prototype.reprocessPage = function () {
        // TODO: reprocess page API
    };
    /**
     * Whether the app launched in smart edit
     */
    SmartEditService.prototype.isLaunchedInSmartEdit = function () {
        return this._launchedInSmartEdit;
    };
    SmartEditService.ctorParameters = function () { return [
        { type: CmsService },
        { type: RoutingService },
        { type: BaseSiteService },
        { type: NgZone },
        { type: WindowRef }
    ]; };
    SmartEditService.ɵprov = ɵɵdefineInjectable({ factory: function SmartEditService_Factory() { return new SmartEditService(ɵɵinject(CmsService), ɵɵinject(RoutingService), ɵɵinject(BaseSiteService), ɵɵinject(NgZone), ɵɵinject(WindowRef)); }, token: SmartEditService, providedIn: "root" });
    SmartEditService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], SmartEditService);
    return SmartEditService;
}());

var DynamicAttributeService = /** @class */ (function () {
    function DynamicAttributeService(smartEditService) {
        this.smartEditService = smartEditService;
    }
    /**
     * Add dynamic attributes to DOM. These attributes are extracted from the properties of cms items received from backend.
     * There can by many different groups of properties, one of them is smartedit. But EC allows addons to create different groups.
     * For example, personalization may add 'script' group etc.
     * @param element: slot or cms component element
     * @param renderer
     * @param cmsRenderingContext: an object containing properties in each cms item response data
     */
    DynamicAttributeService.prototype.addDynamicAttributes = function (element, renderer, cmsRenderingContext) {
        var _a, _b;
        var properties = ((_a = cmsRenderingContext.componentData) === null || _a === void 0 ? void 0 : _a.properties) || ((_b = cmsRenderingContext.slotData) === null || _b === void 0 ? void 0 : _b.properties);
        if (properties && this.smartEditService.isLaunchedInSmartEdit()) {
            // check each group of properties, e.g. smartedit
            Object.keys(properties).forEach(function (group) {
                var name = 'data-' + group + '-';
                var groupProps = properties[group];
                // check each property in the group
                Object.keys(groupProps).forEach(function (propName) {
                    var propValue = groupProps[propName];
                    if (propName === 'classes') {
                        var classes = propValue.split(' ');
                        classes.forEach(function (classItem) {
                            element.classList.add(classItem);
                        });
                    }
                    else {
                        renderer.setAttribute(element, name +
                            propName
                                .split(/(?=[A-Z])/)
                                .join('-')
                                .toLowerCase(), propValue);
                    }
                });
            });
        }
    };
    DynamicAttributeService.ctorParameters = function () { return [
        { type: SmartEditService }
    ]; };
    DynamicAttributeService.ɵprov = ɵɵdefineInjectable({ factory: function DynamicAttributeService_Factory() { return new DynamicAttributeService(ɵɵinject(SmartEditService)); }, token: DynamicAttributeService, providedIn: "root" });
    DynamicAttributeService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], DynamicAttributeService);
    return DynamicAttributeService;
}());

var FeaturesConfig = /** @class */ (function () {
    function FeaturesConfig() {
    }
    FeaturesConfig.ɵprov = ɵɵdefineInjectable({ factory: function FeaturesConfig_Factory() { return ɵɵinject(Config); }, token: FeaturesConfig, providedIn: "root" });
    FeaturesConfig = __decorate([
        Injectable({
            providedIn: 'root',
            useExisting: Config,
        })
    ], FeaturesConfig);
    return FeaturesConfig;
}());

function isFeatureConfig(config) {
    return typeof config === 'object' && config.features;
}
function isInLevel(level, version) {
    if (level === '*') {
        return true;
    }
    var levelParts = level.split('.');
    var versionParts = version.split('.');
    for (var i = 0; i < versionParts.length; i++) {
        var versionNumberPart = Number(versionParts[i]);
        var levelNumberPart = Number(levelParts[i]) || 0;
        if (versionNumberPart !== levelNumberPart) {
            return levelNumberPart > versionNumberPart;
        }
    }
    return true;
}
function isFeatureLevel(config, level) {
    if (isFeatureConfig(config)) {
        return level[0] === '!'
            ? !isInLevel(config.features.level, level.substr(1, level.length))
            : isInLevel(config.features.level, level);
    }
}
function isFeatureEnabled(config, feature) {
    if (isFeatureConfig(config)) {
        var featureConfig = feature[0] === '!'
            ? config.features[feature.substr(1, feature.length)]
            : config.features[feature];
        var result = typeof featureConfig === 'string'
            ? isFeatureLevel(config, featureConfig)
            : featureConfig;
        return feature[0] === '!' ? !result : result;
    }
}

var FeatureConfigService = /** @class */ (function () {
    function FeatureConfigService(config) {
        this.config = config;
    }
    FeatureConfigService.prototype.isLevel = function (version) {
        return isFeatureLevel(this.config, version);
    };
    FeatureConfigService.prototype.isEnabled = function (feature) {
        return isFeatureEnabled(this.config, feature);
    };
    FeatureConfigService.ctorParameters = function () { return [
        { type: FeaturesConfig }
    ]; };
    FeatureConfigService.ɵprov = ɵɵdefineInjectable({ factory: function FeatureConfigService_Factory() { return new FeatureConfigService(ɵɵinject(FeaturesConfig)); }, token: FeatureConfigService, providedIn: "root" });
    FeatureConfigService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], FeatureConfigService);
    return FeatureConfigService;
}());

var FeatureLevelDirective = /** @class */ (function () {
    function FeatureLevelDirective(templateRef, viewContainer, featureConfig) {
        this.templateRef = templateRef;
        this.viewContainer = viewContainer;
        this.featureConfig = featureConfig;
        this.hasView = false;
    }
    Object.defineProperty(FeatureLevelDirective.prototype, "cxFeatureLevel", {
        set: function (level) {
            if (this.featureConfig.isLevel(level.toString()) && !this.hasView) {
                this.viewContainer.createEmbeddedView(this.templateRef);
                this.hasView = true;
            }
            else if (!this.featureConfig.isLevel(level.toString()) && this.hasView) {
                this.viewContainer.clear();
                this.hasView = false;
            }
        },
        enumerable: true,
        configurable: true
    });
    FeatureLevelDirective.ctorParameters = function () { return [
        { type: TemplateRef },
        { type: ViewContainerRef },
        { type: FeatureConfigService }
    ]; };
    __decorate([
        Input()
    ], FeatureLevelDirective.prototype, "cxFeatureLevel", null);
    FeatureLevelDirective = __decorate([
        Directive({
            selector: '[cxFeatureLevel]',
        })
    ], FeatureLevelDirective);
    return FeatureLevelDirective;
}());

var FeatureDirective = /** @class */ (function () {
    function FeatureDirective(templateRef, viewContainer, featureConfig) {
        this.templateRef = templateRef;
        this.viewContainer = viewContainer;
        this.featureConfig = featureConfig;
        this.hasView = false;
    }
    Object.defineProperty(FeatureDirective.prototype, "cxFeature", {
        set: function (feature) {
            if (this.featureConfig.isEnabled(feature) && !this.hasView) {
                this.viewContainer.createEmbeddedView(this.templateRef);
                this.hasView = true;
            }
            else if (!this.featureConfig.isEnabled(feature) && this.hasView) {
                this.viewContainer.clear();
                this.hasView = false;
            }
        },
        enumerable: true,
        configurable: true
    });
    FeatureDirective.ctorParameters = function () { return [
        { type: TemplateRef },
        { type: ViewContainerRef },
        { type: FeatureConfigService }
    ]; };
    __decorate([
        Input()
    ], FeatureDirective.prototype, "cxFeature", null);
    FeatureDirective = __decorate([
        Directive({
            selector: '[cxFeature]',
        })
    ], FeatureDirective);
    return FeatureDirective;
}());

var FeaturesConfigModule = /** @class */ (function () {
    function FeaturesConfigModule() {
    }
    FeaturesConfigModule_1 = FeaturesConfigModule;
    FeaturesConfigModule.forRoot = function (defaultLevel) {
        return {
            ngModule: FeaturesConfigModule_1,
            providers: [
                provideDefaultConfig({
                    features: {
                        level: defaultLevel || '*',
                    },
                }),
            ],
        };
    };
    var FeaturesConfigModule_1;
    FeaturesConfigModule = FeaturesConfigModule_1 = __decorate([
        NgModule({
            declarations: [FeatureLevelDirective, FeatureDirective],
            exports: [FeatureLevelDirective, FeatureDirective],
        })
    ], FeaturesConfigModule);
    return FeaturesConfigModule;
}());

// type CxDatePipe, not DatePipe, due to conflict with Angular's DatePipe - problem occurs for the backward compatibility compiler of Ivy
var CxDatePipe = /** @class */ (function (_super) {
    __extends(CxDatePipe, _super);
    function CxDatePipe(language) {
        var _this = _super.call(this, null) || this;
        _this.language = language;
        return _this;
    }
    CxDatePipe.prototype.transform = function (value, format, timezone) {
        return _super.prototype.transform.call(this, value, format, timezone, this.getLang());
    };
    CxDatePipe.prototype.getLang = function () {
        var lang = this.getActiveLang();
        try {
            getLocaleId(lang);
            return lang;
        }
        catch (_a) {
            this.reportMissingLocaleData(lang);
            return 'en';
        }
    };
    CxDatePipe.prototype.getActiveLang = function () {
        var result;
        this.language
            .getActive()
            .subscribe(function (lang) { return (result = lang); })
            .unsubscribe();
        return result;
    };
    CxDatePipe.prototype.reportMissingLocaleData = function (lang) {
        if (isDevMode()) {
            console.warn("cxDate pipe: No locale data registered for '" + lang + "' (see https://angular.io/api/common/registerLocaleData).");
        }
    };
    CxDatePipe.ctorParameters = function () { return [
        { type: LanguageService }
    ]; };
    CxDatePipe = __decorate([
        Pipe({ name: 'cxDate' })
    ], CxDatePipe);
    return CxDatePipe;
}(DatePipe));

var TranslatePipe = /** @class */ (function () {
    function TranslatePipe(service, cd) {
        this.service = service;
        this.cd = cd;
    }
    TranslatePipe.prototype.transform = function (input, options) {
        if (options === void 0) { options = {}; }
        if (input.raw) {
            return input.raw;
        }
        var key = typeof input === 'string' ? input : input.key;
        if (typeof input !== 'string') {
            options = __assign(__assign({}, options), input.params);
        }
        this.translate(key, options);
        return this.translatedValue;
    };
    TranslatePipe.prototype.translate = function (key, options) {
        var _this = this;
        if (key !== this.lastKey ||
            !shallowEqualObjects(options, this.lastOptions)) {
            this.lastKey = key;
            this.lastOptions = options;
            if (this.sub) {
                this.sub.unsubscribe();
            }
            this.sub = this.service
                .translate(key, options, true)
                .subscribe(function (val) { return _this.markForCheck(val); });
        }
    };
    TranslatePipe.prototype.markForCheck = function (value) {
        this.translatedValue = value;
        this.cd.markForCheck();
    };
    TranslatePipe.prototype.ngOnDestroy = function () {
        if (this.sub) {
            this.sub.unsubscribe();
        }
    };
    TranslatePipe.ctorParameters = function () { return [
        { type: TranslationService },
        { type: ChangeDetectorRef }
    ]; };
    TranslatePipe = __decorate([
        Pipe({ name: 'cxTranslate', pure: false })
    ], TranslatePipe);
    return TranslatePipe;
}());

var I18nConfig = /** @class */ (function () {
    function I18nConfig() {
    }
    I18nConfig.ɵprov = ɵɵdefineInjectable({ factory: function I18nConfig_Factory() { return ɵɵinject(Config); }, token: I18nConfig, providedIn: "root" });
    I18nConfig = __decorate([
        Injectable({
            providedIn: 'root',
            useExisting: Config,
        })
    ], I18nConfig);
    return I18nConfig;
}());

var TranslationChunkService = /** @class */ (function () {
    function TranslationChunkService(config) {
        var _this = this;
        this.config = config;
        this.duplicates = {};
        this.chunks = {};
        this.KEY_SEPARATOR = '.';
        var chunks = (config.i18n && config.i18n.chunks) || {};
        Object.keys(chunks).forEach(function (chunk) {
            chunks[chunk].forEach(function (key) {
                if (_this.chunks.hasOwnProperty(key)) {
                    if (!_this.duplicates[key]) {
                        _this.duplicates[key] = [_this.chunks[key]];
                    }
                    _this.duplicates[key].push(chunk);
                }
                else {
                    _this.chunks[key] = chunk;
                }
            });
        });
        if (Object.keys(this.duplicates).length > 0 && isDevMode()) {
            this.warnDuplicates(this.duplicates);
        }
    }
    TranslationChunkService.prototype.getChunkNameForKey = function (key) {
        var mainKey = (key || '').split(this.KEY_SEPARATOR)[0];
        var chunk = this.chunks && this.chunks[mainKey];
        if (!chunk) {
            return mainKey; // fallback to main key as a chunk
        }
        return chunk;
    };
    TranslationChunkService.prototype.warnDuplicates = function (items) {
        var _this = this;
        var dupes = [];
        Object.keys(items).forEach(function (key) {
            dupes.push("* '" + key + "' found in chunks: " + items[key].join(', ') + ". Used '" + _this.chunks[key] + "." + key + "'.");
        });
        console.warn("Duplicated keys has been found in the config of i18n chunks:\n" + dupes.join('\n'));
    };
    TranslationChunkService.ctorParameters = function () { return [
        { type: I18nConfig }
    ]; };
    TranslationChunkService.ɵprov = ɵɵdefineInjectable({ factory: function TranslationChunkService_Factory() { return new TranslationChunkService(ɵɵinject(I18nConfig)); }, token: TranslationChunkService, providedIn: "root" });
    TranslationChunkService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], TranslationChunkService);
    return TranslationChunkService;
}());

var defaultI18nConfig = {
    i18n: {
        fallbackLang: false,
        debug: false,
    },
};

function i18nextInit(configInit, languageService, httpClient, serverRequestOrigin) {
    return function () {
        return configInit.getStableConfig('i18n').then(function (config) {
            var i18nextConfig = {
                ns: [],
                fallbackLng: config.i18n.fallbackLang,
                debug: config.i18n.debug,
                interpolation: {
                    escapeValue: false,
                },
            };
            if (config.i18n.backend) {
                i18next.use(i18nextXhrBackend);
                var loadPath = getLoadPath(config.i18n.backend.loadPath, serverRequestOrigin);
                var backend = {
                    loadPath: loadPath,
                    ajax: i18nextGetHttpClient(httpClient),
                };
                i18nextConfig = __assign(__assign({}, i18nextConfig), { backend: backend });
            }
            return i18next.init(i18nextConfig, function () {
                // Don't use i18next's 'resources' config key for adding static translations,
                // because it will disable loading chunks from backend. We add resources here, in the init's callback.
                i18nextAddTranslations(config.i18n.resources);
                syncI18nextWithSiteContext(languageService);
            });
        });
    };
}
function i18nextAddTranslations(resources) {
    if (resources === void 0) { resources = {}; }
    Object.keys(resources).forEach(function (lang) {
        Object.keys(resources[lang]).forEach(function (chunkName) {
            i18next.addResourceBundle(lang, chunkName, resources[lang][chunkName], true, true);
        });
    });
}
function syncI18nextWithSiteContext(language) {
    // always update language of i18next on site context (language) change
    language.getActive().subscribe(function (lang) { return i18next.changeLanguage(lang); });
}
/**
 * Returns a function appropriate for i18next to make http calls for JSON files.
 * See docs for `i18next-xhr-backend`: https://github.com/i18next/i18next-xhr-backend#backend-options
 *
 * It uses Angular HttpClient under the hood, so it works in SSR.
 * @param httpClient Angular http client
 */
function i18nextGetHttpClient(httpClient) {
    return function (url, _options, callback, _data) {
        httpClient.get(url, { responseType: 'text' }).subscribe(function (data) { return callback(data, { status: 200 }); }, function (error) { return callback(null, { status: error.status }); });
    };
}
/**
 * Resolves the relative path to the absolute one in SSR, using the server request's origin.
 * It's needed, because Angular Universal doesn't support relative URLs in HttpClient. See Angular issues:
 * - https://github.com/angular/angular/issues/19224
 * - https://github.com/angular/universal/issues/858
 */
function getLoadPath(path, serverRequestOrigin) {
    if (!path) {
        return undefined;
    }
    if (serverRequestOrigin && !path.match(/^http(s)?:\/\//)) {
        if (path.startsWith('/')) {
            path = path.slice(1);
        }
        if (path.startsWith('./')) {
            path = path.slice(2);
        }
        var result = serverRequestOrigin + "/" + path;
        return result;
    }
    return path;
}

var ɵ0$C = i18nextInit;
var i18nextProviders = [
    {
        provide: APP_INITIALIZER,
        useFactory: ɵ0$C,
        deps: [
            ConfigInitializerService,
            LanguageService,
            HttpClient,
            [new Optional(), SERVER_REQUEST_ORIGIN],
        ],
        multi: true,
    },
];

var I18nextTranslationService = /** @class */ (function () {
    function I18nextTranslationService(config, translationChunk) {
        this.config = config;
        this.translationChunk = translationChunk;
        this.NON_BREAKING_SPACE = String.fromCharCode(160);
        this.NAMESPACE_SEPARATOR = ':';
    }
    I18nextTranslationService.prototype.translate = function (key, options, whitespaceUntilLoaded) {
        // If we've already loaded the chunk (or failed to load), we should immediately emit the value
        // (or the fallback value in case the key is missing).
        var _this = this;
        if (options === void 0) { options = {}; }
        if (whitespaceUntilLoaded === void 0) { whitespaceUntilLoaded = false; }
        // Moreover, we SHOULD emit a value (or a fallback value) synchronously (not in a promise/setTimeout).
        // Otherwise, we the will trigger additional deferred change detection in a view that consumes the returned observable,
        // which together with `switchMap` operator may lead to an infinite loop.
        var chunkName = this.translationChunk.getChunkNameForKey(key);
        var namespacedKey = this.getNamespacedKey(key, chunkName);
        return new Observable(function (subscriber) {
            var translate = function () {
                if (!i18next.isInitialized) {
                    return;
                }
                if (i18next.exists(namespacedKey, options)) {
                    subscriber.next(i18next.t(namespacedKey, options));
                }
                else {
                    if (whitespaceUntilLoaded) {
                        subscriber.next(_this.NON_BREAKING_SPACE);
                    }
                    i18next.loadNamespaces(chunkName, function () {
                        if (!i18next.exists(namespacedKey, options)) {
                            _this.reportMissingKey(key, chunkName);
                            subscriber.next(_this.getFallbackValue(namespacedKey));
                        }
                        else {
                            subscriber.next(i18next.t(namespacedKey, options));
                        }
                    });
                }
            };
            translate();
            i18next.on('languageChanged', translate);
            return function () { return i18next.off('languageChanged', translate); };
        });
    };
    I18nextTranslationService.prototype.loadChunks = function (chunkNames) {
        return i18next.loadNamespaces(chunkNames);
    };
    /**
     * Returns a fallback value in case when the given key is missing
     * @param key
     */
    I18nextTranslationService.prototype.getFallbackValue = function (key) {
        return isDevMode() ? "[" + key + "]" : this.NON_BREAKING_SPACE;
    };
    I18nextTranslationService.prototype.reportMissingKey = function (key, chunkName) {
        if (isDevMode()) {
            console.warn("Translation key missing '" + key + "' in the chunk '" + chunkName + "'");
        }
    };
    I18nextTranslationService.prototype.getNamespacedKey = function (key, chunk) {
        return chunk + this.NAMESPACE_SEPARATOR + key;
    };
    I18nextTranslationService.ctorParameters = function () { return [
        { type: I18nConfig },
        { type: TranslationChunkService }
    ]; };
    I18nextTranslationService.ɵprov = ɵɵdefineInjectable({ factory: function I18nextTranslationService_Factory() { return new I18nextTranslationService(ɵɵinject(I18nConfig), ɵɵinject(TranslationChunkService)); }, token: I18nextTranslationService, providedIn: "root" });
    I18nextTranslationService = __decorate([
        Injectable({ providedIn: 'root' })
    ], I18nextTranslationService);
    return I18nextTranslationService;
}());

var I18nModule = /** @class */ (function () {
    function I18nModule() {
    }
    I18nModule_1 = I18nModule;
    I18nModule.forRoot = function () {
        return {
            ngModule: I18nModule_1,
            providers: __spread([
                provideDefaultConfig(defaultI18nConfig),
                { provide: TranslationService, useExisting: I18nextTranslationService }
            ], i18nextProviders),
        };
    };
    var I18nModule_1;
    I18nModule = I18nModule_1 = __decorate([
        NgModule({
            declarations: [TranslatePipe, CxDatePipe],
            exports: [TranslatePipe, CxDatePipe],
        })
    ], I18nModule);
    return I18nModule;
}());

function mockTranslate(key, options) {
    if (options === void 0) { options = {}; }
    var optionsString = Object.keys(options)
        .sort()
        .map(function (optionName) { return optionName + ":" + options[optionName]; })
        .join(' ');
    return optionsString ? key + " " + optionsString : key;
}

var MockTranslatePipe = /** @class */ (function () {
    function MockTranslatePipe() {
    }
    MockTranslatePipe.prototype.transform = function (input, options) {
        if (options === void 0) { options = {}; }
        if (input.raw) {
            return input.raw;
        }
        var key = typeof input === 'string' ? input : input.key;
        if (typeof input !== 'string') {
            options = __assign(__assign({}, options), input.params);
        }
        return mockTranslate(key, options);
    };
    MockTranslatePipe = __decorate([
        Pipe({ name: 'cxTranslate' })
    ], MockTranslatePipe);
    return MockTranslatePipe;
}());

var MockTranslationService = /** @class */ (function () {
    function MockTranslationService() {
    }
    MockTranslationService.prototype.translate = function (key, options, _whitespaceUntilLoaded) {
        if (options === void 0) { options = {}; }
        if (_whitespaceUntilLoaded === void 0) { _whitespaceUntilLoaded = false; }
        return new Observable(function (subscriber) {
            var value = mockTranslate(key, options);
            subscriber.next(value);
            subscriber.complete();
        });
    };
    MockTranslationService.prototype.loadChunks = function (_chunks) {
        return Promise.resolve();
    };
    MockTranslationService = __decorate([
        Injectable()
    ], MockTranslationService);
    return MockTranslationService;
}());

var MockDatePipe = /** @class */ (function (_super) {
    __extends(MockDatePipe, _super);
    function MockDatePipe() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    MockDatePipe.prototype.transform = function (value, format, timezone) {
        return _super.prototype.transform.call(this, value, format, timezone, 'en');
    };
    MockDatePipe = __decorate([
        Pipe({ name: 'cxDate' })
    ], MockDatePipe);
    return MockDatePipe;
}(DatePipe));

var I18nTestingModule = /** @class */ (function () {
    function I18nTestingModule() {
    }
    I18nTestingModule = __decorate([
        NgModule({
            declarations: [MockTranslatePipe, MockDatePipe],
            exports: [MockTranslatePipe, MockDatePipe],
            providers: [
                { provide: TranslationService, useClass: MockTranslationService },
            ],
        })
    ], I18nTestingModule);
    return I18nTestingModule;
}());

var KymaConfig = /** @class */ (function (_super) {
    __extends(KymaConfig, _super);
    function KymaConfig() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    KymaConfig.ɵprov = ɵɵdefineInjectable({ factory: function KymaConfig_Factory() { return ɵɵinject(Config); }, token: KymaConfig, providedIn: "root" });
    KymaConfig = __decorate([
        Injectable({
            providedIn: 'root',
            useExisting: Config,
        })
    ], KymaConfig);
    return KymaConfig;
}(OccConfig));

var KYMA_FEATURE = 'kyma';
var OPEN_ID_TOKEN_DATA = '[Kyma Auth] Open ID Token Data';

var LOAD_OPEN_ID_TOKEN = '[Kyma] Load Open ID Token';
var LOAD_OPEN_ID_TOKEN_FAIL = '[Kyma] Load Open ID Token Fail';
var LOAD_OPEN_ID_TOKEN_SUCCESS = '[Kyma] Load Open ID Token Success';
var LoadOpenIdToken = /** @class */ (function (_super) {
    __extends(LoadOpenIdToken, _super);
    function LoadOpenIdToken(payload) {
        var _this = _super.call(this, OPEN_ID_TOKEN_DATA) || this;
        _this.payload = payload;
        _this.type = LOAD_OPEN_ID_TOKEN;
        return _this;
    }
    return LoadOpenIdToken;
}(LoaderLoadAction));
var LoadOpenIdTokenFail = /** @class */ (function (_super) {
    __extends(LoadOpenIdTokenFail, _super);
    function LoadOpenIdTokenFail(payload) {
        var _this = _super.call(this, OPEN_ID_TOKEN_DATA, payload) || this;
        _this.payload = payload;
        _this.type = LOAD_OPEN_ID_TOKEN_FAIL;
        return _this;
    }
    return LoadOpenIdTokenFail;
}(LoaderFailAction));
var LoadOpenIdTokenSuccess = /** @class */ (function (_super) {
    __extends(LoadOpenIdTokenSuccess, _super);
    function LoadOpenIdTokenSuccess(payload) {
        var _this = _super.call(this, OPEN_ID_TOKEN_DATA) || this;
        _this.payload = payload;
        _this.type = LOAD_OPEN_ID_TOKEN_SUCCESS;
        return _this;
    }
    return LoadOpenIdTokenSuccess;
}(LoaderSuccessAction));



var kymaGroup_actions = /*#__PURE__*/Object.freeze({
    __proto__: null,
    LOAD_OPEN_ID_TOKEN: LOAD_OPEN_ID_TOKEN,
    LOAD_OPEN_ID_TOKEN_FAIL: LOAD_OPEN_ID_TOKEN_FAIL,
    LOAD_OPEN_ID_TOKEN_SUCCESS: LOAD_OPEN_ID_TOKEN_SUCCESS,
    LoadOpenIdToken: LoadOpenIdToken,
    LoadOpenIdTokenFail: LoadOpenIdTokenFail,
    LoadOpenIdTokenSuccess: LoadOpenIdTokenSuccess
});

var getKymaState = createFeatureSelector(KYMA_FEATURE);

var ɵ0$D = function (state) { return state.openIdToken; };
var getOpenIdTokenState = createSelector(getKymaState, ɵ0$D);
var getOpenIdTokenValue = createSelector(getOpenIdTokenState, loaderValueSelector);
var getOpenIdTokenLoading = createSelector(getOpenIdTokenState, loaderLoadingSelector);
var getOpenIdTokenSuccess = createSelector(getOpenIdTokenState, loaderSuccessSelector);
var getOpenIdTokenError = createSelector(getOpenIdTokenState, loaderErrorSelector);



var kymaGroup_selectors = /*#__PURE__*/Object.freeze({
    __proto__: null,
    getKymaState: getKymaState,
    getOpenIdTokenState: getOpenIdTokenState,
    getOpenIdTokenValue: getOpenIdTokenValue,
    getOpenIdTokenLoading: getOpenIdTokenLoading,
    getOpenIdTokenSuccess: getOpenIdTokenSuccess,
    getOpenIdTokenError: getOpenIdTokenError,
    ɵ0: ɵ0$D
});

var KymaService = /** @class */ (function () {
    function KymaService(store) {
        this.store = store;
    }
    /**
     * Authorizes using the Kyma OAuth client with scope `openid`.
     *
     * @param username a username
     * @param password a password
     */
    KymaService.prototype.authorizeOpenId = function (username, password) {
        this.store.dispatch(new LoadOpenIdToken({ username: username, password: password }));
    };
    /**
     * Returns the `OpenIdToken`, which was previously retrieved using `authorizeOpenId` method.
     */
    KymaService.prototype.getOpenIdToken = function () {
        return this.store.pipe(select(getOpenIdTokenValue));
    };
    KymaService.ctorParameters = function () { return [
        { type: Store }
    ]; };
    KymaService.ɵprov = ɵɵdefineInjectable({ factory: function KymaService_Factory() { return new KymaService(ɵɵinject(Store)); }, token: KymaService, providedIn: "root" });
    KymaService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], KymaService);
    return KymaService;
}());

var defaultKymaConfig = {
    authentication: {
        kyma_client_id: 'client4kyma',
        kyma_client_secret: 'secret',
    },
};

var OAUTH_ENDPOINT$2 = '/authorizationserver/oauth/token';
var OpenIdAuthenticationTokenService = /** @class */ (function () {
    function OpenIdAuthenticationTokenService(config, http) {
        this.config = config;
        this.http = http;
    }
    OpenIdAuthenticationTokenService.prototype.loadOpenIdAuthenticationToken = function (username, password) {
        var url = this.getOAuthEndpoint();
        var params = new HttpParams()
            .set('client_id', encodeURIComponent(this.config.authentication.kyma_client_id))
            .set('client_secret', encodeURIComponent(this.config.authentication.kyma_client_secret))
            .set('grant_type', 'password') // authorization_code, client_credentials, password
            .set('username', username)
            .set('password', password)
            .set('scope', 'openid');
        var headers = new HttpHeaders({
            'Content-Type': 'application/x-www-form-urlencoded',
        });
        return this.http
            .post(url, params, { headers: headers })
            .pipe(catchError(function (error) { return throwError(error); }));
    };
    OpenIdAuthenticationTokenService.prototype.getOAuthEndpoint = function () {
        return (this.config.backend.occ.baseUrl || '') + OAUTH_ENDPOINT$2;
    };
    OpenIdAuthenticationTokenService.ctorParameters = function () { return [
        { type: KymaConfig },
        { type: HttpClient }
    ]; };
    OpenIdAuthenticationTokenService.ɵprov = ɵɵdefineInjectable({ factory: function OpenIdAuthenticationTokenService_Factory() { return new OpenIdAuthenticationTokenService(ɵɵinject(KymaConfig), ɵɵinject(HttpClient)); }, token: OpenIdAuthenticationTokenService, providedIn: "root" });
    OpenIdAuthenticationTokenService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], OpenIdAuthenticationTokenService);
    return OpenIdAuthenticationTokenService;
}());

var OpenIdTokenEffect = /** @class */ (function () {
    function OpenIdTokenEffect(actions$, openIdTokenService) {
        var _this = this;
        this.actions$ = actions$;
        this.openIdTokenService = openIdTokenService;
        this.triggerOpenIdTokenLoading$ = this.actions$.pipe(ofType(LOAD_USER_TOKEN_SUCCESS), withLatestFrom(this.actions$.pipe(ofType(LOAD_USER_TOKEN))), map(function (_a) {
            var _b = __read(_a, 2), loginAction = _b[1];
            return new LoadOpenIdToken({
                username: loginAction.payload.userId,
                password: loginAction.payload.password,
            });
        }));
        this.loadOpenIdToken$ = this.actions$.pipe(ofType(LOAD_OPEN_ID_TOKEN), map(function (action) { return action.payload; }), exhaustMap(function (payload) {
            return _this.openIdTokenService
                .loadOpenIdAuthenticationToken(payload.username, payload.password)
                .pipe(map(function (token) { return new LoadOpenIdTokenSuccess(token); }), catchError(function (error) {
                return of(new LoadOpenIdTokenFail(makeErrorSerializable(error)));
            }));
        }));
    }
    OpenIdTokenEffect.ctorParameters = function () { return [
        { type: Actions },
        { type: OpenIdAuthenticationTokenService }
    ]; };
    __decorate([
        Effect()
    ], OpenIdTokenEffect.prototype, "triggerOpenIdTokenLoading$", void 0);
    __decorate([
        Effect()
    ], OpenIdTokenEffect.prototype, "loadOpenIdToken$", void 0);
    OpenIdTokenEffect = __decorate([
        Injectable()
    ], OpenIdTokenEffect);
    return OpenIdTokenEffect;
}());

var effects$8 = [OpenIdTokenEffect];

function getReducers$8() {
    return {
        openIdToken: loaderReducer(OPEN_ID_TOKEN_DATA),
    };
}
var reducerToken$8 = new InjectionToken('KymaReducers');
var reducerProvider$8 = {
    provide: reducerToken$8,
    useFactory: getReducers$8,
};
function clearKymaState(reducer) {
    return function (state, action) {
        if (action.type === LOGOUT) {
            state = __assign(__assign({}, state), { openIdToken: undefined });
        }
        return reducer(state, action);
    };
}
var metaReducers$4 = [clearKymaState];

function kymaStoreConfigFactory() {
    // if we want to reuse KYMA_FEATURE const in config, we have to use factory instead of plain object
    var config = {
        state: {
            storageSync: {
                keys: {
                    'kyma.openIdToken.value': StorageSyncType.LOCAL_STORAGE,
                },
            },
        },
    };
    return config;
}
var KymaStoreModule = /** @class */ (function () {
    function KymaStoreModule() {
    }
    KymaStoreModule = __decorate([
        NgModule({
            imports: [
                CommonModule,
                HttpClientModule,
                StateModule,
                StoreModule.forFeature(KYMA_FEATURE, reducerToken$8, { metaReducers: metaReducers$4 }),
                EffectsModule.forFeature(effects$8),
            ],
            providers: [
                provideDefaultConfigFactory(kymaStoreConfigFactory),
                reducerProvider$8,
            ],
        })
    ], KymaStoreModule);
    return KymaStoreModule;
}());

var KymaModule = /** @class */ (function () {
    function KymaModule() {
    }
    KymaModule = __decorate([
        NgModule({
            imports: [CommonModule, HttpClientModule, KymaStoreModule],
            providers: [provideDefaultConfig(defaultKymaConfig)],
        })
    ], KymaModule);
    return KymaModule;
}());

var defaultPersonalizationConfig = {
    personalization: {
        enabled: false,
        httpHeaderName: {
            id: 'Occ-Personalization-Id',
            timestamp: 'Occ-Personalization-Time',
        },
        context: {
            slotPosition: 'PlaceholderContentSlot',
            componentId: 'PersonalizationScriptComponent',
        },
    },
};

var PersonalizationConfig = /** @class */ (function () {
    function PersonalizationConfig() {
    }
    PersonalizationConfig.ɵprov = ɵɵdefineInjectable({ factory: function PersonalizationConfig_Factory() { return ɵɵinject(Config); }, token: PersonalizationConfig, providedIn: "root" });
    PersonalizationConfig = __decorate([
        Injectable({
            providedIn: 'root',
            useExisting: Config,
        })
    ], PersonalizationConfig);
    return PersonalizationConfig;
}());

var PERSONALIZATION_ID_KEY = 'personalization-id';
var OccPersonalizationIdInterceptor = /** @class */ (function () {
    function OccPersonalizationIdInterceptor(config, occEndpoints, winRef, platform) {
        this.config = config;
        this.occEndpoints = occEndpoints;
        this.winRef = winRef;
        this.platform = platform;
        this.enabled = false;
        if (isPlatformBrowser(this.platform)) {
            this.enabled =
                (this.winRef.localStorage && this.config.personalization.enabled) ||
                    false;
            if (this.enabled) {
                this.requestHeader = this.config.personalization.httpHeaderName.id.toLowerCase();
                this.personalizationId = this.winRef.localStorage.getItem(PERSONALIZATION_ID_KEY);
            }
            else if (this.winRef.localStorage.getItem(PERSONALIZATION_ID_KEY)) {
                this.winRef.localStorage.removeItem(PERSONALIZATION_ID_KEY);
            }
        }
    }
    OccPersonalizationIdInterceptor.prototype.intercept = function (request, next) {
        var _a;
        var _this = this;
        if (!this.enabled) {
            return next.handle(request);
        }
        if (this.personalizationId &&
            request.url.includes(this.occEndpoints.getBaseEndpoint())) {
            request = request.clone({
                setHeaders: (_a = {},
                    _a[this.requestHeader] = this.personalizationId,
                    _a),
            });
        }
        return next.handle(request).pipe(tap(function (event) {
            if (event instanceof HttpResponse) {
                if (event.headers.keys().includes(_this.requestHeader)) {
                    var receivedId = event.headers.get(_this.requestHeader);
                    if (_this.personalizationId !== receivedId) {
                        _this.personalizationId = receivedId;
                        _this.winRef.localStorage.setItem(PERSONALIZATION_ID_KEY, _this.personalizationId);
                    }
                }
            }
        }));
    };
    OccPersonalizationIdInterceptor.ctorParameters = function () { return [
        { type: PersonalizationConfig },
        { type: OccEndpointsService },
        { type: WindowRef },
        { type: undefined, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] }
    ]; };
    OccPersonalizationIdInterceptor.ɵprov = ɵɵdefineInjectable({ factory: function OccPersonalizationIdInterceptor_Factory() { return new OccPersonalizationIdInterceptor(ɵɵinject(PersonalizationConfig), ɵɵinject(OccEndpointsService), ɵɵinject(WindowRef), ɵɵinject(PLATFORM_ID)); }, token: OccPersonalizationIdInterceptor, providedIn: "root" });
    OccPersonalizationIdInterceptor = __decorate([
        Injectable({ providedIn: 'root' }),
        __param(3, Inject(PLATFORM_ID))
    ], OccPersonalizationIdInterceptor);
    return OccPersonalizationIdInterceptor;
}());

var PERSONALIZATION_TIME_KEY = 'personalization-time';
var OccPersonalizationTimeInterceptor = /** @class */ (function () {
    function OccPersonalizationTimeInterceptor(config, occEndpoints, winRef, platform) {
        this.config = config;
        this.occEndpoints = occEndpoints;
        this.winRef = winRef;
        this.platform = platform;
        this.enabled = false;
        if (isPlatformBrowser(this.platform)) {
            this.enabled =
                (this.winRef.localStorage && this.config.personalization.enabled) ||
                    false;
            if (this.enabled) {
                this.requestHeader = this.config.personalization.httpHeaderName.timestamp.toLowerCase();
                this.timestamp = this.winRef.localStorage.getItem(PERSONALIZATION_TIME_KEY);
            }
            else if (this.winRef.localStorage.getItem(PERSONALIZATION_TIME_KEY)) {
                this.winRef.localStorage.removeItem(PERSONALIZATION_TIME_KEY);
            }
        }
    }
    OccPersonalizationTimeInterceptor.prototype.intercept = function (request, next) {
        var _a;
        var _this = this;
        if (!this.enabled) {
            return next.handle(request);
        }
        if (this.timestamp &&
            request.url.includes(this.occEndpoints.getBaseEndpoint())) {
            request = request.clone({
                setHeaders: (_a = {},
                    _a[this.requestHeader] = this.timestamp,
                    _a),
            });
        }
        return next.handle(request).pipe(tap(function (event) {
            if (event instanceof HttpResponse) {
                if (event.headers.keys().includes(_this.requestHeader)) {
                    var receivedTimestamp = event.headers.get(_this.requestHeader);
                    if (_this.timestamp !== receivedTimestamp) {
                        _this.timestamp = receivedTimestamp;
                        _this.winRef.localStorage.setItem(PERSONALIZATION_TIME_KEY, _this.timestamp);
                    }
                }
            }
        }));
    };
    OccPersonalizationTimeInterceptor.ctorParameters = function () { return [
        { type: PersonalizationConfig },
        { type: OccEndpointsService },
        { type: WindowRef },
        { type: undefined, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] }
    ]; };
    OccPersonalizationTimeInterceptor.ɵprov = ɵɵdefineInjectable({ factory: function OccPersonalizationTimeInterceptor_Factory() { return new OccPersonalizationTimeInterceptor(ɵɵinject(PersonalizationConfig), ɵɵinject(OccEndpointsService), ɵɵinject(WindowRef), ɵɵinject(PLATFORM_ID)); }, token: OccPersonalizationTimeInterceptor, providedIn: "root" });
    OccPersonalizationTimeInterceptor = __decorate([
        Injectable({ providedIn: 'root' }),
        __param(3, Inject(PLATFORM_ID))
    ], OccPersonalizationTimeInterceptor);
    return OccPersonalizationTimeInterceptor;
}());

var interceptors$3 = [
    {
        provide: HTTP_INTERCEPTORS,
        useExisting: OccPersonalizationIdInterceptor,
        multi: true,
    },
    {
        provide: HTTP_INTERCEPTORS,
        useExisting: OccPersonalizationTimeInterceptor,
        multi: true,
    },
];

var PersonalizationModule = /** @class */ (function () {
    function PersonalizationModule() {
    }
    PersonalizationModule_1 = PersonalizationModule;
    PersonalizationModule.forRoot = function () {
        return {
            ngModule: PersonalizationModule_1,
            providers: __spread([
                provideDefaultConfig(defaultPersonalizationConfig)
            ], interceptors$3),
        };
    };
    var PersonalizationModule_1;
    PersonalizationModule = PersonalizationModule_1 = __decorate([
        NgModule({})
    ], PersonalizationModule);
    return PersonalizationModule;
}());

var PersonalizationContextService = /** @class */ (function () {
    function PersonalizationContextService(config, cmsService) {
        this.config = config;
        this.cmsService = cmsService;
    }
    PersonalizationContextService.prototype.getPersonalizationContext = function () {
        var _this = this;
        return this.cmsService.getCurrentPage().pipe(filter(Boolean), map(function (page) {
            return page.slots[_this.config.personalization.context.slotPosition];
        }), filter(Boolean), map(function (slot) {
            return slot.components.find(function (i) { return i.uid === _this.config.personalization.context.componentId; });
        }), filter(Boolean), map(function (component) {
            return _this.buildPersonalizationContext(component.properties.script.data);
        }));
    };
    PersonalizationContextService.prototype.buildPersonalizationContext = function (data) {
        var context = JSON.parse(atob(data));
        context.actions.forEach(function (action) {
            Object.keys(action).forEach(function (key) {
                action[key] = atob(action[key]);
            });
        });
        for (var i = 0; i < context.segments.length; i++) {
            context.segments[i] = atob(context.segments[i]);
        }
        return context;
    };
    PersonalizationContextService.ctorParameters = function () { return [
        { type: PersonalizationConfig },
        { type: CmsService }
    ]; };
    PersonalizationContextService.ɵprov = ɵɵdefineInjectable({ factory: function PersonalizationContextService_Factory() { return new PersonalizationContextService(ɵɵinject(PersonalizationConfig), ɵɵinject(CmsService)); }, token: PersonalizationContextService, providedIn: "root" });
    PersonalizationContextService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], PersonalizationContextService);
    return PersonalizationContextService;
}());

function getReducers$9() {
    return entityLoaderReducer(PROCESS_FEATURE);
}
var reducerToken$9 = new InjectionToken('ProcessReducers');
var reducerProvider$9 = {
    provide: reducerToken$9,
    useFactory: getReducers$9,
};

var ProcessStoreModule = /** @class */ (function () {
    function ProcessStoreModule() {
    }
    ProcessStoreModule = __decorate([
        NgModule({
            imports: [StateModule, StoreModule.forFeature(PROCESS_FEATURE, reducerToken$9)],
            providers: [reducerProvider$9],
        })
    ], ProcessStoreModule);
    return ProcessStoreModule;
}());

var ProcessModule = /** @class */ (function () {
    function ProcessModule() {
    }
    ProcessModule_1 = ProcessModule;
    ProcessModule.forRoot = function () {
        return {
            ngModule: ProcessModule_1,
            providers: [],
        };
    };
    var ProcessModule_1;
    ProcessModule = ProcessModule_1 = __decorate([
        NgModule({
            imports: [ProcessStoreModule],
        })
    ], ProcessModule);
    return ProcessModule;
}());

var ProductConnector = /** @class */ (function () {
    function ProductConnector(adapter) {
        this.adapter = adapter;
    }
    ProductConnector.prototype.get = function (productCode, scope) {
        if (scope === void 0) { scope = ''; }
        return this.adapter.load(productCode, scope);
    };
    ProductConnector.prototype.getMany = function (products) {
        var _this = this;
        if (!this.adapter.loadMany) {
            return products.map(function (product) { return (__assign(__assign({}, product), { data$: _this.adapter.load(product.code, product.scope) })); });
        }
        return this.adapter.loadMany(products);
    };
    ProductConnector.ctorParameters = function () { return [
        { type: ProductAdapter }
    ]; };
    ProductConnector.ɵprov = ɵɵdefineInjectable({ factory: function ProductConnector_Factory() { return new ProductConnector(ɵɵinject(ProductAdapter)); }, token: ProductConnector, providedIn: "root" });
    ProductConnector = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], ProductConnector);
    return ProductConnector;
}());

var ProductReferencesConnector = /** @class */ (function () {
    function ProductReferencesConnector(adapter) {
        this.adapter = adapter;
    }
    ProductReferencesConnector.prototype.get = function (productCode, referenceType, pageSize) {
        return this.adapter.load(productCode, referenceType, pageSize);
    };
    ProductReferencesConnector.ctorParameters = function () { return [
        { type: ProductReferencesAdapter }
    ]; };
    ProductReferencesConnector.ɵprov = ɵɵdefineInjectable({ factory: function ProductReferencesConnector_Factory() { return new ProductReferencesConnector(ɵɵinject(ProductReferencesAdapter)); }, token: ProductReferencesConnector, providedIn: "root" });
    ProductReferencesConnector = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], ProductReferencesConnector);
    return ProductReferencesConnector;
}());

var ProductReviewsConnector = /** @class */ (function () {
    function ProductReviewsConnector(adapter) {
        this.adapter = adapter;
    }
    ProductReviewsConnector.prototype.get = function (productCode, maxCount) {
        return this.adapter.load(productCode, maxCount);
    };
    ProductReviewsConnector.prototype.add = function (productCode, review) {
        return this.adapter.post(productCode, review);
    };
    ProductReviewsConnector.ctorParameters = function () { return [
        { type: ProductReviewsAdapter }
    ]; };
    ProductReviewsConnector.ɵprov = ɵɵdefineInjectable({ factory: function ProductReviewsConnector_Factory() { return new ProductReviewsConnector(ɵɵinject(ProductReviewsAdapter)); }, token: ProductReviewsConnector, providedIn: "root" });
    ProductReviewsConnector = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], ProductReviewsConnector);
    return ProductReviewsConnector;
}());

var ProductSearchConnector = /** @class */ (function () {
    function ProductSearchConnector(adapter) {
        this.adapter = adapter;
    }
    ProductSearchConnector.prototype.search = function (query, searchConfig) {
        return this.adapter.search(query, searchConfig);
    };
    ProductSearchConnector.prototype.getSuggestions = function (term, pageSize) {
        return this.adapter.loadSuggestions(term, pageSize);
    };
    ProductSearchConnector.ctorParameters = function () { return [
        { type: ProductSearchAdapter }
    ]; };
    ProductSearchConnector.ɵprov = ɵɵdefineInjectable({ factory: function ProductSearchConnector_Factory() { return new ProductSearchConnector(ɵɵinject(ProductSearchAdapter)); }, token: ProductSearchConnector, providedIn: "root" });
    ProductSearchConnector = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], ProductSearchConnector);
    return ProductSearchConnector;
}());

var LOAD_PRODUCT_REFERENCES = '[Product] Load Product References Data';
var LOAD_PRODUCT_REFERENCES_FAIL = '[Product] Load Product References Data Fail';
var LOAD_PRODUCT_REFERENCES_SUCCESS = '[Product] Load Product References Data Success';
var CLEAN_PRODUCT_REFERENCES = '[Product] Clean Product References';
var LoadProductReferences = /** @class */ (function () {
    function LoadProductReferences(payload) {
        this.payload = payload;
        this.type = LOAD_PRODUCT_REFERENCES;
    }
    return LoadProductReferences;
}());
var LoadProductReferencesFail = /** @class */ (function () {
    function LoadProductReferencesFail(payload) {
        this.payload = payload;
        this.type = LOAD_PRODUCT_REFERENCES_FAIL;
    }
    return LoadProductReferencesFail;
}());
var LoadProductReferencesSuccess = /** @class */ (function () {
    function LoadProductReferencesSuccess(payload) {
        this.payload = payload;
        this.type = LOAD_PRODUCT_REFERENCES_SUCCESS;
    }
    return LoadProductReferencesSuccess;
}());
var CleanProductReferences = /** @class */ (function () {
    function CleanProductReferences() {
        this.type = CLEAN_PRODUCT_REFERENCES;
    }
    return CleanProductReferences;
}());

var LOAD_PRODUCT_REVIEWS = '[Product] Load Product Reviews Data';
var LOAD_PRODUCT_REVIEWS_FAIL = '[Product] Load Product Reviews Data Fail';
var LOAD_PRODUCT_REVIEWS_SUCCESS = '[Product] Load Product Reviews Data Success';
var POST_PRODUCT_REVIEW = '[Product] Post Product Review';
var POST_PRODUCT_REVIEW_FAIL = '[Product] Post Product Review Fail';
var POST_PRODUCT_REVIEW_SUCCESS = '[Product] Post Product Review Success';
var LoadProductReviews = /** @class */ (function () {
    function LoadProductReviews(payload) {
        this.payload = payload;
        this.type = LOAD_PRODUCT_REVIEWS;
    }
    return LoadProductReviews;
}());
var LoadProductReviewsFail = /** @class */ (function () {
    function LoadProductReviewsFail(payload) {
        this.payload = payload;
        this.type = LOAD_PRODUCT_REVIEWS_FAIL;
    }
    return LoadProductReviewsFail;
}());
var LoadProductReviewsSuccess = /** @class */ (function () {
    function LoadProductReviewsSuccess(payload) {
        this.payload = payload;
        this.type = LOAD_PRODUCT_REVIEWS_SUCCESS;
    }
    return LoadProductReviewsSuccess;
}());
var PostProductReview = /** @class */ (function () {
    function PostProductReview(payload) {
        this.payload = payload;
        this.type = POST_PRODUCT_REVIEW;
    }
    return PostProductReview;
}());
var PostProductReviewFail = /** @class */ (function () {
    function PostProductReviewFail(payload) {
        this.payload = payload;
        this.type = POST_PRODUCT_REVIEW_FAIL;
    }
    return PostProductReviewFail;
}());
var PostProductReviewSuccess = /** @class */ (function () {
    function PostProductReviewSuccess(payload) {
        this.payload = payload;
        this.type = POST_PRODUCT_REVIEW_SUCCESS;
    }
    return PostProductReviewSuccess;
}());

var SEARCH_PRODUCTS = '[Product] Search Products';
var SEARCH_PRODUCTS_FAIL = '[Product] Search Products Fail';
var SEARCH_PRODUCTS_SUCCESS = '[Product] Search Products Success';
var GET_PRODUCT_SUGGESTIONS = '[Product] Get Product Suggestions';
var GET_PRODUCT_SUGGESTIONS_SUCCESS = '[Product] Get Product Suggestions Success';
var GET_PRODUCT_SUGGESTIONS_FAIL = '[Product] Get Product Suggestions Fail';
var CLEAR_PRODUCT_SEARCH_RESULT = '[Product] Clear Product Search Result';
var SearchProducts = /** @class */ (function () {
    function SearchProducts(payload, auxiliary) {
        this.payload = payload;
        this.auxiliary = auxiliary;
        this.type = SEARCH_PRODUCTS;
    }
    return SearchProducts;
}());
var SearchProductsFail = /** @class */ (function () {
    function SearchProductsFail(payload, auxiliary) {
        this.payload = payload;
        this.auxiliary = auxiliary;
        this.type = SEARCH_PRODUCTS_FAIL;
    }
    return SearchProductsFail;
}());
var SearchProductsSuccess = /** @class */ (function () {
    function SearchProductsSuccess(payload, auxiliary) {
        this.payload = payload;
        this.auxiliary = auxiliary;
        this.type = SEARCH_PRODUCTS_SUCCESS;
    }
    return SearchProductsSuccess;
}());
var GetProductSuggestions = /** @class */ (function () {
    function GetProductSuggestions(payload) {
        this.payload = payload;
        this.type = GET_PRODUCT_SUGGESTIONS;
    }
    return GetProductSuggestions;
}());
var GetProductSuggestionsSuccess = /** @class */ (function () {
    function GetProductSuggestionsSuccess(payload) {
        this.payload = payload;
        this.type = GET_PRODUCT_SUGGESTIONS_SUCCESS;
    }
    return GetProductSuggestionsSuccess;
}());
var GetProductSuggestionsFail = /** @class */ (function () {
    function GetProductSuggestionsFail(payload) {
        this.payload = payload;
        this.type = GET_PRODUCT_SUGGESTIONS_FAIL;
    }
    return GetProductSuggestionsFail;
}());
var ClearProductSearchResult = /** @class */ (function () {
    function ClearProductSearchResult(payload) {
        if (payload === void 0) { payload = {
            clearPageResults: false,
            clearSearchboxResults: false,
        }; }
        this.payload = payload;
        this.type = CLEAR_PRODUCT_SEARCH_RESULT;
    }
    return ClearProductSearchResult;
}());

var PRODUCT_FEATURE = 'product';
var PRODUCT_DETAIL_ENTITY = '[Product] Detail Entity';

var EntityScopedLoaderActions;
(function (EntityScopedLoaderActions) {
    function entityScopedLoadMeta(entityType, id, scope) {
        return __assign(__assign({}, entityLoadMeta(entityType, id)), { scope: scope });
    }
    EntityScopedLoaderActions.entityScopedLoadMeta = entityScopedLoadMeta;
    function entityScopedFailMeta(entityType, id, scope, error) {
        return __assign(__assign({}, entityFailMeta(entityType, id, error)), { scope: scope });
    }
    EntityScopedLoaderActions.entityScopedFailMeta = entityScopedFailMeta;
    function entityScopedSuccessMeta(entityType, id, scope) {
        return __assign(__assign({}, entitySuccessMeta(entityType, id)), { scope: scope });
    }
    EntityScopedLoaderActions.entityScopedSuccessMeta = entityScopedSuccessMeta;
    function entityScopedResetMeta(entityType, id, scope) {
        return __assign(__assign({}, entityResetMeta(entityType, id)), { scope: scope });
    }
    EntityScopedLoaderActions.entityScopedResetMeta = entityScopedResetMeta;
    var EntityScopedLoadAction = /** @class */ (function () {
        function EntityScopedLoadAction(entityType, id, scope) {
            this.type = ENTITY_LOAD_ACTION;
            this.meta = entityScopedLoadMeta(entityType, id, scope);
        }
        return EntityScopedLoadAction;
    }());
    EntityScopedLoaderActions.EntityScopedLoadAction = EntityScopedLoadAction;
    var EntityScopedFailAction = /** @class */ (function () {
        function EntityScopedFailAction(entityType, id, scope, error) {
            this.type = ENTITY_FAIL_ACTION;
            this.meta = entityScopedFailMeta(entityType, id, scope, error);
        }
        return EntityScopedFailAction;
    }());
    EntityScopedLoaderActions.EntityScopedFailAction = EntityScopedFailAction;
    var EntityScopedSuccessAction = /** @class */ (function () {
        function EntityScopedSuccessAction(entityType, id, scope, payload) {
            this.payload = payload;
            this.type = ENTITY_SUCCESS_ACTION;
            this.meta = entityScopedSuccessMeta(entityType, id, scope);
        }
        return EntityScopedSuccessAction;
    }());
    EntityScopedLoaderActions.EntityScopedSuccessAction = EntityScopedSuccessAction;
    var EntityScopedResetAction = /** @class */ (function () {
        function EntityScopedResetAction(entityType, id, scope) {
            this.type = ENTITY_RESET_ACTION;
            this.meta = entityScopedResetMeta(entityType, id, scope);
        }
        return EntityScopedResetAction;
    }());
    EntityScopedLoaderActions.EntityScopedResetAction = EntityScopedResetAction;
})(EntityScopedLoaderActions || (EntityScopedLoaderActions = {}));

var LOAD_PRODUCT = '[Product] Load Product Data';
var LOAD_PRODUCT_FAIL = '[Product] Load Product Data Fail';
var LOAD_PRODUCT_SUCCESS = '[Product] Load Product Data Success';
var LoadProduct = /** @class */ (function (_super) {
    __extends(LoadProduct, _super);
    function LoadProduct(payload, scope) {
        if (scope === void 0) { scope = ''; }
        var _this = _super.call(this, PRODUCT_DETAIL_ENTITY, payload, scope) || this;
        _this.payload = payload;
        _this.type = LOAD_PRODUCT;
        return _this;
    }
    return LoadProduct;
}(EntityScopedLoaderActions.EntityScopedLoadAction));
var LoadProductFail = /** @class */ (function (_super) {
    __extends(LoadProductFail, _super);
    function LoadProductFail(productCode, payload, scope) {
        if (scope === void 0) { scope = ''; }
        var _this = _super.call(this, PRODUCT_DETAIL_ENTITY, productCode, scope, payload) || this;
        _this.payload = payload;
        _this.type = LOAD_PRODUCT_FAIL;
        return _this;
    }
    return LoadProductFail;
}(EntityScopedLoaderActions.EntityScopedFailAction));
var LoadProductSuccess = /** @class */ (function (_super) {
    __extends(LoadProductSuccess, _super);
    function LoadProductSuccess(payload, scope) {
        if (scope === void 0) { scope = ''; }
        var _this = _super.call(this, PRODUCT_DETAIL_ENTITY, payload.code, scope) || this;
        _this.payload = payload;
        _this.type = LOAD_PRODUCT_SUCCESS;
        return _this;
    }
    return LoadProductSuccess;
}(EntityScopedLoaderActions.EntityScopedSuccessAction));



var productGroup_actions = /*#__PURE__*/Object.freeze({
    __proto__: null,
    LOAD_PRODUCT_REFERENCES: LOAD_PRODUCT_REFERENCES,
    LOAD_PRODUCT_REFERENCES_FAIL: LOAD_PRODUCT_REFERENCES_FAIL,
    LOAD_PRODUCT_REFERENCES_SUCCESS: LOAD_PRODUCT_REFERENCES_SUCCESS,
    CLEAN_PRODUCT_REFERENCES: CLEAN_PRODUCT_REFERENCES,
    LoadProductReferences: LoadProductReferences,
    LoadProductReferencesFail: LoadProductReferencesFail,
    LoadProductReferencesSuccess: LoadProductReferencesSuccess,
    CleanProductReferences: CleanProductReferences,
    LOAD_PRODUCT_REVIEWS: LOAD_PRODUCT_REVIEWS,
    LOAD_PRODUCT_REVIEWS_FAIL: LOAD_PRODUCT_REVIEWS_FAIL,
    LOAD_PRODUCT_REVIEWS_SUCCESS: LOAD_PRODUCT_REVIEWS_SUCCESS,
    POST_PRODUCT_REVIEW: POST_PRODUCT_REVIEW,
    POST_PRODUCT_REVIEW_FAIL: POST_PRODUCT_REVIEW_FAIL,
    POST_PRODUCT_REVIEW_SUCCESS: POST_PRODUCT_REVIEW_SUCCESS,
    LoadProductReviews: LoadProductReviews,
    LoadProductReviewsFail: LoadProductReviewsFail,
    LoadProductReviewsSuccess: LoadProductReviewsSuccess,
    PostProductReview: PostProductReview,
    PostProductReviewFail: PostProductReviewFail,
    PostProductReviewSuccess: PostProductReviewSuccess,
    SEARCH_PRODUCTS: SEARCH_PRODUCTS,
    SEARCH_PRODUCTS_FAIL: SEARCH_PRODUCTS_FAIL,
    SEARCH_PRODUCTS_SUCCESS: SEARCH_PRODUCTS_SUCCESS,
    GET_PRODUCT_SUGGESTIONS: GET_PRODUCT_SUGGESTIONS,
    GET_PRODUCT_SUGGESTIONS_SUCCESS: GET_PRODUCT_SUGGESTIONS_SUCCESS,
    GET_PRODUCT_SUGGESTIONS_FAIL: GET_PRODUCT_SUGGESTIONS_FAIL,
    CLEAR_PRODUCT_SEARCH_RESULT: CLEAR_PRODUCT_SEARCH_RESULT,
    SearchProducts: SearchProducts,
    SearchProductsFail: SearchProductsFail,
    SearchProductsSuccess: SearchProductsSuccess,
    GetProductSuggestions: GetProductSuggestions,
    GetProductSuggestionsSuccess: GetProductSuggestionsSuccess,
    GetProductSuggestionsFail: GetProductSuggestionsFail,
    ClearProductSearchResult: ClearProductSearchResult,
    LOAD_PRODUCT: LOAD_PRODUCT,
    LOAD_PRODUCT_FAIL: LOAD_PRODUCT_FAIL,
    LOAD_PRODUCT_SUCCESS: LOAD_PRODUCT_SUCCESS,
    LoadProduct: LoadProduct,
    LoadProductFail: LoadProductFail,
    LoadProductSuccess: LoadProductSuccess
});

var getProductsState = createFeatureSelector(PRODUCT_FEATURE);

var ɵ0$E = function (state) { return state.references; };
var getProductReferencesState = createSelector(getProductsState, ɵ0$E);
var getSelectedProductReferencesFactory = function (productCode, referenceType) {
    return createSelector(getProductReferencesState, function (referenceTypeData) {
        if (referenceTypeData.productCode === productCode) {
            if (!!referenceTypeData.list) {
                if (referenceType) {
                    return referenceTypeData.list.filter(function (item) { return item.referenceType === referenceType; });
                }
                return referenceTypeData.list;
            }
            else {
                return [];
            }
        }
    });
};

var ɵ0$F = function (state) { return state.reviews; };
var getProductReviewsState = createSelector(getProductsState, ɵ0$F);
var getSelectedProductReviewsFactory = function (productCode) {
    return createSelector(getProductReviewsState, function (reviewData) {
        if (reviewData.productCode === productCode) {
            return reviewData.list;
        }
    });
};

var initialState$h = {
    results: {},
    suggestions: [],
    auxResults: {},
};
function reducer$h(state, action) {
    if (state === void 0) { state = initialState$h; }
    switch (action.type) {
        case SEARCH_PRODUCTS_SUCCESS: {
            var results = action.payload;
            var res = action.auxiliary ? { auxResults: results } : { results: results };
            return __assign(__assign({}, state), res);
        }
        case GET_PRODUCT_SUGGESTIONS_SUCCESS: {
            var suggestions = action.payload;
            return __assign(__assign({}, state), { suggestions: suggestions });
        }
        case CLEAR_PRODUCT_SEARCH_RESULT: {
            return __assign(__assign({}, state), { results: action.payload.clearPageResults ? {} : state.results, suggestions: action.payload.clearSearchboxResults
                    ? []
                    : state.suggestions, auxResults: action.payload.clearSearchboxResults
                    ? {}
                    : state.auxResults });
        }
    }
    return state;
}
var getSearchResults = function (state) { return state.results; };
var getAuxSearchResults = function (state) { return state.auxResults; };
var getProductSuggestions = function (state) { return state.suggestions; };

var ɵ0$G = function (state) { return state.search; };
var getProductsSearchState = createSelector(getProductsState, ɵ0$G);
var getSearchResults$1 = createSelector(getProductsSearchState, getSearchResults);
var getAuxSearchResults$1 = createSelector(getProductsSearchState, getAuxSearchResults);
var getProductSuggestions$1 = createSelector(getProductsSearchState, getProductSuggestions);

var ɵ0$H = function (state) { return state.details; };
var getProductState = createSelector(getProductsState, ɵ0$H);
var getSelectedProductStateFactory = function (code, scope) {
    if (scope === void 0) { scope = ''; }
    return createSelector(getProductState, function (details) {
        return entityLoaderStateSelector(details, code)[scope] ||
            initialLoaderState;
    });
};
var getSelectedProductFactory = function (code, scope) {
    if (scope === void 0) { scope = ''; }
    return createSelector(getSelectedProductStateFactory(code, scope), function (productState) { return loaderValueSelector(productState); });
};
var getSelectedProductLoadingFactory = function (code, scope) {
    if (scope === void 0) { scope = ''; }
    return createSelector(getSelectedProductStateFactory(code, scope), function (productState) { return loaderLoadingSelector(productState); });
};
var getSelectedProductSuccessFactory = function (code, scope) {
    if (scope === void 0) { scope = ''; }
    return createSelector(getSelectedProductStateFactory(code, scope), function (productState) { return loaderSuccessSelector(productState); });
};
var getSelectedProductErrorFactory = function (code, scope) {
    if (scope === void 0) { scope = ''; }
    return createSelector(getSelectedProductStateFactory(code, scope), function (productState) { return loaderErrorSelector(productState); });
};
var ɵ1$r = function (details) {
    return Object.keys(details.entities);
};
var getAllProductCodes = createSelector(getProductState, ɵ1$r);



var productGroup_selectors = /*#__PURE__*/Object.freeze({
    __proto__: null,
    getProductsState: getProductsState,
    getProductReferencesState: getProductReferencesState,
    getSelectedProductReferencesFactory: getSelectedProductReferencesFactory,
    ɵ0: ɵ0$E,
    getProductReviewsState: getProductReviewsState,
    getSelectedProductReviewsFactory: getSelectedProductReviewsFactory,
    getProductsSearchState: getProductsSearchState,
    getSearchResults: getSearchResults$1,
    getAuxSearchResults: getAuxSearchResults$1,
    getProductSuggestions: getProductSuggestions$1,
    getProductState: getProductState,
    getSelectedProductStateFactory: getSelectedProductStateFactory,
    getSelectedProductFactory: getSelectedProductFactory,
    getSelectedProductLoadingFactory: getSelectedProductLoadingFactory,
    getSelectedProductSuccessFactory: getSelectedProductSuccessFactory,
    getSelectedProductErrorFactory: getSelectedProductErrorFactory,
    getAllProductCodes: getAllProductCodes,
    ɵ1: ɵ1$r
});

var ProductReferenceService = /** @class */ (function () {
    function ProductReferenceService(store) {
        this.store = store;
    }
    ProductReferenceService.prototype.get = function (productCode, referenceType, pageSize) {
        var _this = this;
        return this.store.pipe(select(getSelectedProductReferencesFactory(productCode, referenceType)), tap(function (references) {
            if (references === undefined && productCode !== undefined) {
                _this.store.dispatch(new LoadProductReferences({
                    productCode: productCode,
                    referenceType: referenceType,
                    pageSize: pageSize,
                }));
            }
        }));
    };
    ProductReferenceService.prototype.cleanReferences = function () {
        this.store.dispatch(new CleanProductReferences());
    };
    ProductReferenceService.ctorParameters = function () { return [
        { type: Store }
    ]; };
    ProductReferenceService.ɵprov = ɵɵdefineInjectable({ factory: function ProductReferenceService_Factory() { return new ProductReferenceService(ɵɵinject(Store)); }, token: ProductReferenceService, providedIn: "root" });
    ProductReferenceService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], ProductReferenceService);
    return ProductReferenceService;
}());

var ProductReviewService = /** @class */ (function () {
    function ProductReviewService(store) {
        this.store = store;
    }
    ProductReviewService.prototype.getByProductCode = function (productCode) {
        var _this = this;
        return this.store.pipe(select(getSelectedProductReviewsFactory(productCode)), tap(function (reviews) {
            if (reviews === undefined && productCode !== undefined) {
                _this.store.dispatch(new LoadProductReviews(productCode));
            }
        }));
    };
    ProductReviewService.prototype.add = function (productCode, review) {
        this.store.dispatch(new PostProductReview({
            productCode: productCode,
            review: review,
        }));
    };
    ProductReviewService.ctorParameters = function () { return [
        { type: Store }
    ]; };
    ProductReviewService.ɵprov = ɵɵdefineInjectable({ factory: function ProductReviewService_Factory() { return new ProductReviewService(ɵɵinject(Store)); }, token: ProductReviewService, providedIn: "root" });
    ProductReviewService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], ProductReviewService);
    return ProductReviewService;
}());

var ProductSearchService = /** @class */ (function () {
    function ProductSearchService(store) {
        this.store = store;
    }
    ProductSearchService.prototype.search = function (query, searchConfig) {
        this.store.dispatch(new SearchProducts({
            queryText: query,
            searchConfig: searchConfig,
        }));
    };
    ProductSearchService.prototype.getResults = function () {
        return this.store.pipe(select(getSearchResults$1));
    };
    ProductSearchService.prototype.clearResults = function () {
        this.store.dispatch(new ClearProductSearchResult({
            clearPageResults: true,
        }));
    };
    ProductSearchService.ctorParameters = function () { return [
        { type: Store }
    ]; };
    ProductSearchService.ɵprov = ɵɵdefineInjectable({ factory: function ProductSearchService_Factory() { return new ProductSearchService(ɵɵinject(Store)); }, token: ProductSearchService, providedIn: "root" });
    ProductSearchService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], ProductSearchService);
    return ProductSearchService;
}());

var ProductLoadingService = /** @class */ (function () {
    function ProductLoadingService(store, loadingScopes, actions$, platformId) {
        this.store = store;
        this.loadingScopes = loadingScopes;
        this.actions$ = actions$;
        this.platformId = platformId;
        this.products = {};
    }
    ProductLoadingService.prototype.get = function (productCode, scopes) {
        scopes = this.loadingScopes.expand('product', scopes);
        this.initProductScopes(productCode, scopes);
        return this.products[productCode][this.getScopesIndex(scopes)];
    };
    ProductLoadingService.prototype.initProductScopes = function (productCode, scopes) {
        var e_1, _a;
        var _this = this;
        if (!this.products[productCode]) {
            this.products[productCode] = {};
        }
        try {
            for (var scopes_1 = __values(scopes), scopes_1_1 = scopes_1.next(); !scopes_1_1.done; scopes_1_1 = scopes_1.next()) {
                var scope = scopes_1_1.value;
                if (!this.products[productCode][scope]) {
                    this.products[productCode][scope] = this.getProductForScope(productCode, scope);
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (scopes_1_1 && !scopes_1_1.done && (_a = scopes_1.return)) _a.call(scopes_1);
            }
            finally { if (e_1) throw e_1.error; }
        }
        if (scopes.length > 1) {
            this.products[productCode][this.getScopesIndex(scopes)] = combineLatest(scopes.map(function (scope) { return _this.products[productCode][scope]; })).pipe(auditTime(0), map(function (productParts) {
                return productParts.every(Boolean)
                    ? deepMerge.apply(void 0, __spread([{}], productParts)) : undefined;
            }), distinctUntilChanged());
        }
    };
    ProductLoadingService.prototype.getScopesIndex = function (scopes) {
        return scopes.join('ɵ');
    };
    /**
     * Creates observable for providing specified product data for the scope
     *
     * @param productCode
     * @param scope
     */
    ProductLoadingService.prototype.getProductForScope = function (productCode, scope) {
        var _this = this;
        var shouldLoad$ = this.store.pipe(select(getSelectedProductStateFactory(productCode, scope)), map(function (productState) {
            return !productState.loading && !productState.success && !productState.error;
        }), distinctUntilChanged(), filter(function (x) { return x; }));
        var isLoading$ = this.store.pipe(select(getSelectedProductLoadingFactory(productCode, scope)));
        var productLoadLogic$ = merge.apply(void 0, __spread([shouldLoad$], this.getProductReloadTriggers(productCode, scope))).pipe(debounceTime(0), withLatestFrom(isLoading$), tap(function (_a) {
            var _b = __read(_a, 2), isLoading = _b[1];
            if (!isLoading) {
                _this.store.dispatch(new LoadProduct(productCode, scope));
            }
        }));
        var productData$ = this.store.pipe(select(getSelectedProductFactory(productCode, scope)));
        return using(function () { return productLoadLogic$.subscribe(); }, function () { return productData$; }).pipe(shareReplay({ bufferSize: 1, refCount: true }));
    };
    /**
     * Returns reload triggers for product per scope
     *
     * @param productCode
     * @param scope
     */
    ProductLoadingService.prototype.getProductReloadTriggers = function (productCode, scope) {
        var triggers = [];
        // max age trigger add
        var maxAge = this.loadingScopes.getMaxAge('product', scope);
        if (maxAge && isPlatformBrowser(this.platformId)) {
            // we want to grab load product success and load product fail for this product and scope
            var loadFinish$ = this.actions$.pipe(filter(function (action) {
                return (action.type === LOAD_PRODUCT_SUCCESS ||
                    action.type === LOAD_PRODUCT_FAIL) &&
                    action.meta.entityId === productCode &&
                    action.meta.scope === scope;
            }));
            var loadStart$ = this.actions$.pipe(ofType(LOAD_PRODUCT), filter(function (action) {
                return action.payload === productCode && action.meta.scope === scope;
            }));
            triggers.push(this.getMaxAgeTrigger(loadStart$, loadFinish$, maxAge));
        }
        return triggers;
    };
    /**
     * Generic method that returns stream triggering reload by maxAge
     *
     * Could be refactored to separate service in future to use in other
     * max age reload implementations
     *
     * @param loadStart$ Stream that emits on load start
     * @param loadFinish$ Stream that emits on load finish
     * @param maxAge max age
     */
    ProductLoadingService.prototype.getMaxAgeTrigger = function (loadStart$, loadFinish$, maxAge, scheduler) {
        var timestamp = 0;
        var now = function () { return (scheduler ? scheduler.now() : Date.now()); };
        var timestamp$ = loadFinish$.pipe(tap(function () { return (timestamp = now()); }));
        var shouldReload$ = defer(function () {
            var age = now() - timestamp;
            var timestampRefresh$ = timestamp$.pipe(delay(maxAge, scheduler), mapTo(true), withdrawOn(loadStart$));
            if (age > maxAge) {
                // we should emit first value immediately
                return merge(of(true), timestampRefresh$);
            }
            else if (age === 0) {
                // edge case, we should emit max age timeout after next load success
                // could happen with artificial schedulers
                return timestampRefresh$;
            }
            else {
                // we should emit first value when age will expire
                return merge(of(true).pipe(delay(maxAge - age, scheduler)), timestampRefresh$);
            }
        });
        return shouldReload$;
    };
    ProductLoadingService.ctorParameters = function () { return [
        { type: Store },
        { type: LoadingScopesService },
        { type: Actions },
        { type: undefined, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] }
    ]; };
    ProductLoadingService.ɵprov = ɵɵdefineInjectable({ factory: function ProductLoadingService_Factory() { return new ProductLoadingService(ɵɵinject(Store), ɵɵinject(LoadingScopesService), ɵɵinject(Actions), ɵɵinject(PLATFORM_ID)); }, token: ProductLoadingService, providedIn: "root" });
    ProductLoadingService = __decorate([
        Injectable({
            providedIn: 'root',
        }),
        __param(3, Inject(PLATFORM_ID))
    ], ProductLoadingService);
    return ProductLoadingService;
}());

var ProductService = /** @class */ (function () {
    function ProductService(store, productLoading) {
        this.store = store;
        this.productLoading = productLoading;
    }
    /**
     * Returns the product observable. The product will be loaded
     * whenever there's no value observed.
     *
     * The underlying product loader ensures that the product is
     * only loaded once, even in case of parallel observers.
     *
     * You should provide product data scope you are interested in to not load all
     * the data if not needed. You can provide more than one scope.
     *
     * @param productCode Product code to load
     * @param scopes Scope or scopes of the product data
     */
    ProductService.prototype.get = function (productCode, scopes) {
        if (scopes === void 0) { scopes = DEFAULT_SCOPE; }
        return productCode
            ? this.productLoading.get(productCode, [].concat(scopes))
            : of(undefined);
    };
    /**
     * Returns boolean observable for product's loading state
     */
    ProductService.prototype.isLoading = function (productCode, scope) {
        if (scope === void 0) { scope = ''; }
        return this.store.pipe(select(getSelectedProductLoadingFactory(productCode, scope)));
    };
    /**
     * Returns boolean observable for product's load success state
     */
    ProductService.prototype.isSuccess = function (productCode, scope) {
        if (scope === void 0) { scope = ''; }
        return this.store.pipe(select(getSelectedProductSuccessFactory(productCode, scope)));
    };
    /**
     * Returns boolean observable for product's load error state
     */
    ProductService.prototype.hasError = function (productCode, scope) {
        if (scope === void 0) { scope = ''; }
        return this.store.pipe(select(getSelectedProductErrorFactory(productCode, scope)));
    };
    /**
     * Reloads the product. The product is loaded implicetly
     * whenever selected by the `get`, but in some cases an
     * explicit reload might be needed.
     */
    ProductService.prototype.reload = function (productCode, scope) {
        if (scope === void 0) { scope = ''; }
        this.store.dispatch(new LoadProduct(productCode, scope));
    };
    ProductService.ctorParameters = function () { return [
        { type: Store },
        { type: ProductLoadingService }
    ]; };
    ProductService.ɵprov = ɵɵdefineInjectable({ factory: function ProductService_Factory() { return new ProductService(ɵɵinject(Store), ɵɵinject(ProductLoadingService)); }, token: ProductService, providedIn: "root" });
    ProductService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], ProductService);
    return ProductService;
}());

var SearchboxService = /** @class */ (function (_super) {
    __extends(SearchboxService, _super);
    function SearchboxService() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    /**
     * dispatch the search for the search box
     */
    SearchboxService.prototype.search = function (query, searchConfig) {
        this.store.dispatch(new SearchProducts({
            queryText: query,
            searchConfig: searchConfig,
        }, true));
    };
    SearchboxService.prototype.getResults = function () {
        return this.store.pipe(select(getAuxSearchResults$1));
    };
    /**
     * clears the products and suggestions
     */
    SearchboxService.prototype.clearResults = function () {
        this.store.dispatch(new ClearProductSearchResult({
            clearSearchboxResults: true,
        }));
    };
    SearchboxService.prototype.getSuggestionResults = function () {
        return this.store.pipe(select(getProductSuggestions$1));
    };
    SearchboxService.prototype.searchSuggestions = function (query, searchConfig) {
        this.store.dispatch(new GetProductSuggestions({
            term: query,
            searchConfig: searchConfig,
        }));
    };
    SearchboxService.ɵprov = ɵɵdefineInjectable({ factory: function SearchboxService_Factory() { return new SearchboxService(ɵɵinject(Store)); }, token: SearchboxService, providedIn: "root" });
    SearchboxService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], SearchboxService);
    return SearchboxService;
}(ProductSearchService));

/**
 * Resolves the page data for the Product Listing Page.
 *
 * The page title, and breadcrumbs are resolved in this implementation only.
 */
var CategoryPageMetaResolver = /** @class */ (function (_super) {
    __extends(CategoryPageMetaResolver, _super);
    function CategoryPageMetaResolver(productSearchService, cms, translation) {
        var _this = _super.call(this) || this;
        _this.productSearchService = productSearchService;
        _this.cms = cms;
        _this.translation = translation;
        // reusable observable for search page data
        _this.searchPage$ = _this.cms.getCurrentPage().pipe(filter(Boolean), switchMap(function (page) {
            // only the existence of a plp component tells us if products
            // are rendered or if this is an ordinary content page
            return _this.hasProductListComponent(page)
                ? _this.productSearchService.getResults().pipe(filter(Boolean))
                : of(page);
        }));
        _this.pageType = PageType.CATEGORY_PAGE;
        return _this;
    }
    CategoryPageMetaResolver.prototype.resolveTitle = function () {
        var _this = this;
        return this.searchPage$.pipe(filter(function (page) { return !!page.pagination; }), switchMap(function (p) {
            var _a;
            return _this.translation.translate('pageMetaResolver.category.title', {
                count: p.pagination.totalResults,
                query: ((_a = p.breadcrumbs) === null || _a === void 0 ? void 0 : _a.length) ? p.breadcrumbs[0].facetValueName
                    : undefined,
            });
        }));
    };
    CategoryPageMetaResolver.prototype.resolveBreadcrumbs = function () {
        var _this = this;
        return combineLatest([
            this.searchPage$.pipe(),
            this.translation.translate('common.home'),
        ]).pipe(map(function (_a) {
            var _b = __read(_a, 2), p = _b[0], label = _b[1];
            return p.breadcrumbs
                ? _this.resolveBreadcrumbData(p, label)
                : null;
        }));
    };
    CategoryPageMetaResolver.prototype.resolveBreadcrumbData = function (page, label) {
        var e_1, _a;
        var breadcrumbs = [];
        breadcrumbs.push({ label: label, link: '/' });
        try {
            for (var _b = __values(page.breadcrumbs), _c = _b.next(); !_c.done; _c = _b.next()) {
                var br = _c.value;
                if (br.facetCode === 'category' || br.facetCode === 'allCategories') {
                    breadcrumbs.push({
                        label: br.facetValueName,
                        link: "/c/" + br.facetValueCode,
                    });
                }
                if (br.facetCode === 'brand') {
                    breadcrumbs.push({
                        label: br.facetValueName,
                        link: "/Brands/" + br.facetValueName + "/c/" + br.facetValueCode,
                    });
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
        return breadcrumbs;
    };
    CategoryPageMetaResolver.prototype.hasProductListComponent = function (page) {
        return !!Object.keys(page.slots).find(function (key) {
            return !!page.slots[key].components.find(function (comp) {
                return comp.typeCode === 'CMSProductListComponent' ||
                    comp.typeCode === 'ProductGridComponent';
            });
        });
    };
    CategoryPageMetaResolver.ctorParameters = function () { return [
        { type: ProductSearchService },
        { type: CmsService },
        { type: TranslationService }
    ]; };
    CategoryPageMetaResolver.ɵprov = ɵɵdefineInjectable({ factory: function CategoryPageMetaResolver_Factory() { return new CategoryPageMetaResolver(ɵɵinject(ProductSearchService), ɵɵinject(CmsService), ɵɵinject(TranslationService)); }, token: CategoryPageMetaResolver, providedIn: "root" });
    CategoryPageMetaResolver = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], CategoryPageMetaResolver);
    return CategoryPageMetaResolver;
}(PageMetaResolver));

/**
 * Resolves page meta data for the search result page, in case it's used
 * to query coupons. This is done by adding a `couponcode` query parameter
 * to the search page route.
 *
 * The page resolves an alternative page title and breadcrumb.
 */
var CouponSearchPageResolver = /** @class */ (function (_super) {
    __extends(CouponSearchPageResolver, _super);
    function CouponSearchPageResolver(productSearchService, translation, authService, route, semanticPathService) {
        var _this = _super.call(this) || this;
        _this.productSearchService = productSearchService;
        _this.translation = translation;
        _this.authService = authService;
        _this.route = route;
        _this.semanticPathService = semanticPathService;
        _this.total$ = _this.productSearchService.getResults().pipe(filter(function (data) { return !!(data === null || data === void 0 ? void 0 : data.pagination); }), map(function (results) { return results.pagination.totalResults; }));
        _this.pageType = PageType.CONTENT_PAGE;
        _this.pageTemplate = 'SearchResultsListPageTemplate';
        return _this;
    }
    CouponSearchPageResolver.prototype.resolveBreadcrumbs = function () {
        var _this = this;
        return combineLatest([
            this.translation.translate('common.home'),
            this.translation.translate('myCoupons.myCoupons'),
            this.authService.isUserLoggedIn(),
        ]).pipe(map(function (_a) {
            var _b = __read(_a, 3), homeLabel = _b[0], couponLabel = _b[1], isLoggedIn = _b[2];
            var breadcrumbs = [];
            breadcrumbs.push({ label: homeLabel, link: '/' });
            if (isLoggedIn) {
                breadcrumbs.push({
                    label: couponLabel,
                    link: _this.semanticPathService.transform({
                        cxRoute: 'coupons',
                    }),
                });
            }
            return breadcrumbs;
        }));
    };
    CouponSearchPageResolver.prototype.resolveTitle = function () {
        var _this = this;
        return this.total$.pipe(switchMap(function (total) {
            return _this.translation.translate('pageMetaResolver.search.findProductTitle', {
                count: total,
                coupon: _this.couponCode,
            });
        }));
    };
    CouponSearchPageResolver.prototype.getScore = function (page) {
        return _super.prototype.getScore.call(this, page) + (this.couponCode ? 1 : -1);
    };
    Object.defineProperty(CouponSearchPageResolver.prototype, "couponCode", {
        get: function () {
            var _a, _b;
            return (_b = (_a = this.route.snapshot) === null || _a === void 0 ? void 0 : _a.queryParams) === null || _b === void 0 ? void 0 : _b.couponcode;
        },
        enumerable: true,
        configurable: true
    });
    CouponSearchPageResolver.ctorParameters = function () { return [
        { type: ProductSearchService },
        { type: TranslationService },
        { type: AuthService },
        { type: ActivatedRoute },
        { type: SemanticPathService }
    ]; };
    CouponSearchPageResolver.ɵprov = ɵɵdefineInjectable({ factory: function CouponSearchPageResolver_Factory() { return new CouponSearchPageResolver(ɵɵinject(ProductSearchService), ɵɵinject(TranslationService), ɵɵinject(AuthService), ɵɵinject(ActivatedRoute), ɵɵinject(SemanticPathService)); }, token: CouponSearchPageResolver, providedIn: "root" });
    CouponSearchPageResolver = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], CouponSearchPageResolver);
    return CouponSearchPageResolver;
}(PageMetaResolver));

/**
 * Resolves the page data for the Product Detail Page
 * based on the `PageType.PRODUCT_PAGE`.
 *
 * The page title, heading, description, breadcrumbs and
 * first GALLERY image are resolved if available in the data.
 */
var ProductPageMetaResolver = /** @class */ (function (_super) {
    __extends(ProductPageMetaResolver, _super);
    function ProductPageMetaResolver(routingService, productService, translation) {
        var _this = _super.call(this) || this;
        _this.routingService = routingService;
        _this.productService = productService;
        _this.translation = translation;
        // reusable observable for product data based on the current page
        _this.product$ = _this.routingService.getRouterState().pipe(map(function (state) { return state.state.params['productCode']; }), filter(function (code) { return !!code; }), switchMap(function (code) { return _this.productService.get(code, ProductScope.DETAILS); }), filter(Boolean));
        _this.pageType = PageType.PRODUCT_PAGE;
        return _this;
    }
    /**
     * Resolves the page heading for the Product Detail Page.
     * The page heading is used in the UI (`<h1>`), where as the page
     * title is used by the browser and crawlers.
     */
    ProductPageMetaResolver.prototype.resolveHeading = function () {
        var _this = this;
        return this.product$.pipe(switchMap(function (p) {
            return _this.translation.translate('pageMetaResolver.product.heading', {
                heading: p.name,
            });
        }));
    };
    /**
     * Resolves the page title for the Product Detail Page. The page title
     * is resolved with the product name, the first category and the manufactorer.
     * The page title used by the browser (history, tabs) and crawlers.
     */
    ProductPageMetaResolver.prototype.resolveTitle = function () {
        var _this = this;
        return this.product$.pipe(switchMap(function (p) {
            var title = p.name;
            title += _this.resolveFirstCategory(p);
            title += _this.resolveManufacturer(p);
            return _this.translation.translate('pageMetaResolver.product.title', {
                title: title,
            });
        }));
    };
    /**
     * Resolves the page description for the Product Detail Page. The description
     * is based on the `product.summary`.
     */
    ProductPageMetaResolver.prototype.resolveDescription = function () {
        var _this = this;
        return this.product$.pipe(switchMap(function (p) {
            return _this.translation.translate('pageMetaResolver.product.description', {
                description: p.summary,
            });
        }));
    };
    /**
     * Resolves breadcrumbs for the Product Detail Page. The breadcrumbs are driven by
     * a static home page crum and a crumb for each category.
     */
    ProductPageMetaResolver.prototype.resolveBreadcrumbs = function () {
        return combineLatest([
            this.product$.pipe(),
            this.translation.translate('common.home'),
        ]).pipe(map(function (_a) {
            var e_1, _b;
            var _c = __read(_a, 2), p = _c[0], label = _c[1];
            var breadcrumbs = [];
            breadcrumbs.push({ label: label, link: '/' });
            try {
                for (var _d = __values(p.categories || []), _e = _d.next(); !_e.done; _e = _d.next()) {
                    var _f = _e.value, name_1 = _f.name, code = _f.code, url = _f.url;
                    breadcrumbs.push({
                        label: name_1 || code,
                        link: url,
                    });
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_e && !_e.done && (_b = _d.return)) _b.call(_d);
                }
                finally { if (e_1) throw e_1.error; }
            }
            return breadcrumbs;
        }));
    };
    /**
     * Resolves the main page image for the Product Detail Page. The product image
     * is based on the PRIMARY product image. The zoom format is used by default.
     */
    ProductPageMetaResolver.prototype.resolveImage = function () {
        return this.product$.pipe(map(function (p) {
            var _a, _b, _c;
            return ((_c = (_b = (_a = p.images) === null || _a === void 0 ? void 0 : _a.PRIMARY) === null || _b === void 0 ? void 0 : _b.zoom) === null || _c === void 0 ? void 0 : _c.url) ? p.images.PRIMARY.zoom.url
                : null;
        }));
    };
    ProductPageMetaResolver.prototype.resolveFirstCategory = function (product) {
        var _a;
        var firstCategory;
        if (((_a = product.categories) === null || _a === void 0 ? void 0 : _a.length) > 0) {
            firstCategory = product.categories[0];
        }
        return firstCategory
            ? " | " + (firstCategory.name || firstCategory.code)
            : '';
    };
    ProductPageMetaResolver.prototype.resolveManufacturer = function (product) {
        return product.manufacturer ? " | " + product.manufacturer : '';
    };
    /**
     * Resolves the robot information for the Product Detail Page. The
     * robot instruction defaults to FOLLOW and INDEX for all product pages,
     * regardless of whether they're purchasable or not.
     */
    ProductPageMetaResolver.prototype.resolveRobots = function () {
        return of([PageRobotsMeta.FOLLOW, PageRobotsMeta.INDEX]);
    };
    ProductPageMetaResolver.ctorParameters = function () { return [
        { type: RoutingService },
        { type: ProductService },
        { type: TranslationService }
    ]; };
    ProductPageMetaResolver.ɵprov = ɵɵdefineInjectable({ factory: function ProductPageMetaResolver_Factory() { return new ProductPageMetaResolver(ɵɵinject(RoutingService), ɵɵinject(ProductService), ɵɵinject(TranslationService)); }, token: ProductPageMetaResolver, providedIn: "root" });
    ProductPageMetaResolver = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], ProductPageMetaResolver);
    return ProductPageMetaResolver;
}(PageMetaResolver));

/**
 * Resolves the page data for the Search Result Page based on the
 * `PageType.CATEGORY_PAGE` and the `SearchResultsListPageTemplate` template.
 *
 * Only the page title is resolved in the standard implemenation.
 */
var SearchPageMetaResolver = /** @class */ (function (_super) {
    __extends(SearchPageMetaResolver, _super);
    function SearchPageMetaResolver(routingService, productSearchService, translation) {
        var _this = _super.call(this) || this;
        _this.routingService = routingService;
        _this.productSearchService = productSearchService;
        _this.translation = translation;
        _this.total$ = _this.productSearchService.getResults().pipe(filter(function (data) { return !!(data === null || data === void 0 ? void 0 : data.pagination); }), map(function (results) { return results.pagination.totalResults; }));
        _this.query$ = _this.routingService
            .getRouterState()
            .pipe(map(function (state) { return state.state.params['query']; }));
        _this.pageType = PageType.CONTENT_PAGE;
        _this.pageTemplate = 'SearchResultsListPageTemplate';
        return _this;
    }
    SearchPageMetaResolver.prototype.resolveTitle = function () {
        var _this = this;
        var sources = [this.total$, this.query$];
        return combineLatest(sources).pipe(switchMap(function (_a) {
            var _b = __read(_a, 2), t = _b[0], q = _b[1];
            return _this.translation.translate('pageMetaResolver.search.title', {
                count: t,
                query: q,
            });
        }));
    };
    SearchPageMetaResolver.ctorParameters = function () { return [
        { type: RoutingService },
        { type: ProductSearchService },
        { type: TranslationService }
    ]; };
    SearchPageMetaResolver.ɵprov = ɵɵdefineInjectable({ factory: function SearchPageMetaResolver_Factory() { return new SearchPageMetaResolver(ɵɵinject(RoutingService), ɵɵinject(ProductSearchService), ɵɵinject(TranslationService)); }, token: SearchPageMetaResolver, providedIn: "root" });
    SearchPageMetaResolver = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], SearchPageMetaResolver);
    return SearchPageMetaResolver;
}(PageMetaResolver));

var ProductReferencesEffects = /** @class */ (function () {
    function ProductReferencesEffects(actions$, productReferencesConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.productReferencesConnector = productReferencesConnector;
        this.loadProductReferences$ = this.actions$.pipe(ofType(LOAD_PRODUCT_REFERENCES), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            return _this.productReferencesConnector
                .get(payload.productCode, payload.referenceType, payload.pageSize)
                .pipe(map(function (data) {
                return new LoadProductReferencesSuccess({
                    productCode: payload.productCode,
                    list: data,
                });
            }), catchError(function (_error) {
                return of(new LoadProductReferencesFail({
                    message: payload.productCode,
                }));
            }));
        }));
    }
    ProductReferencesEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: ProductReferencesConnector }
    ]; };
    __decorate([
        Effect()
    ], ProductReferencesEffects.prototype, "loadProductReferences$", void 0);
    ProductReferencesEffects = __decorate([
        Injectable()
    ], ProductReferencesEffects);
    return ProductReferencesEffects;
}());

var ProductReviewsEffects = /** @class */ (function () {
    function ProductReviewsEffects(actions$, productReviewsConnector, globalMessageService) {
        var _this = this;
        this.actions$ = actions$;
        this.productReviewsConnector = productReviewsConnector;
        this.globalMessageService = globalMessageService;
        this.loadProductReviews$ = this.actions$.pipe(ofType(LOAD_PRODUCT_REVIEWS), map(function (action) { return action.payload; }), mergeMap(function (productCode) {
            return _this.productReviewsConnector.get(productCode).pipe(map(function (data) {
                return new LoadProductReviewsSuccess({
                    productCode: productCode,
                    list: data,
                });
            }), catchError(function (_error) {
                return of(new LoadProductReviewsFail({
                    message: productCode,
                }));
            }));
        }));
        this.postProductReview = this.actions$.pipe(ofType(POST_PRODUCT_REVIEW), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            return _this.productReviewsConnector
                .add(payload.productCode, payload.review)
                .pipe(map(function (reviewResponse) {
                return new PostProductReviewSuccess(reviewResponse);
            }), catchError(function (_error) {
                return of(new PostProductReviewFail(payload.productCode));
            }));
        }));
        this.showGlobalMessageOnPostProductReviewSuccess$ = this.actions$.pipe(ofType(POST_PRODUCT_REVIEW_SUCCESS), tap(function () {
            _this.globalMessageService.add({ key: 'productReview.thankYouForReview' }, GlobalMessageType.MSG_TYPE_CONFIRMATION);
        }));
    }
    ProductReviewsEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: ProductReviewsConnector },
        { type: GlobalMessageService }
    ]; };
    __decorate([
        Effect()
    ], ProductReviewsEffects.prototype, "loadProductReviews$", void 0);
    __decorate([
        Effect()
    ], ProductReviewsEffects.prototype, "postProductReview", void 0);
    __decorate([
        Effect({ dispatch: false })
    ], ProductReviewsEffects.prototype, "showGlobalMessageOnPostProductReviewSuccess$", void 0);
    ProductReviewsEffects = __decorate([
        Injectable()
    ], ProductReviewsEffects);
    return ProductReviewsEffects;
}());

var ProductsSearchEffects = /** @class */ (function () {
    function ProductsSearchEffects(actions$, productSearchConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.productSearchConnector = productSearchConnector;
        this.searchProducts$ = this.actions$.pipe(ofType(SEARCH_PRODUCTS), groupBy(function (action) { return action.auxiliary; }), mergeMap(function (group) {
            return group.pipe(switchMap(function (action) {
                return _this.productSearchConnector
                    .search(action.payload.queryText, action.payload.searchConfig)
                    .pipe(map(function (data) {
                    return new SearchProductsSuccess(data, action.auxiliary);
                }), catchError(function (error) {
                    return of(new SearchProductsFail(makeErrorSerializable(error), action.auxiliary));
                }));
            }));
        }));
        this.getProductSuggestions$ = this.actions$.pipe(ofType(GET_PRODUCT_SUGGESTIONS), map(function (action) { return action.payload; }), switchMap(function (payload) {
            return _this.productSearchConnector
                .getSuggestions(payload.term, payload.searchConfig.pageSize)
                .pipe(map(function (suggestions) {
                if (suggestions === undefined) {
                    return new GetProductSuggestionsSuccess([]);
                }
                return new GetProductSuggestionsSuccess(suggestions);
            }), catchError(function (error) {
                return of(new GetProductSuggestionsFail(makeErrorSerializable(error)));
            }));
        }));
    }
    ProductsSearchEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: ProductSearchConnector }
    ]; };
    __decorate([
        Effect()
    ], ProductsSearchEffects.prototype, "searchProducts$", void 0);
    __decorate([
        Effect()
    ], ProductsSearchEffects.prototype, "getProductSuggestions$", void 0);
    ProductsSearchEffects = __decorate([
        Injectable()
    ], ProductsSearchEffects);
    return ProductsSearchEffects;
}());

var ProductEffects = /** @class */ (function () {
    function ProductEffects(actions$, productConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.productConnector = productConnector;
        // we want to cancel all ongoing requests when currency or language changes,
        this.contextChange$ = this.actions$.pipe(ofType(CURRENCY_CHANGE, LANGUAGE_CHANGE));
        this.loadProduct$ = createEffect(function () { return function (_a) {
            var _b = _a === void 0 ? {} : _a, scheduler = _b.scheduler, _c = _b.debounce, debounce = _c === void 0 ? 0 : _c;
            return _this.actions$.pipe(ofType(LOAD_PRODUCT), map(function (action) { return ({
                code: action.payload,
                scope: action.meta.scope,
            }); }), 
            // we are grouping all load actions that happens at the same time
            // to optimize loading and pass them all to productConnector.getMany
            bufferDebounceTime(debounce, scheduler), mergeMap(function (products) {
                return merge.apply(void 0, __spread(_this.productConnector
                    .getMany(products)
                    .map(_this.productLoadEffect)));
            }), withdrawOn(_this.contextChange$));
        }; });
    }
    ProductEffects.prototype.productLoadEffect = function (productLoad) {
        return productLoad.data$.pipe(map(function (data) {
            return new LoadProductSuccess(__assign({ code: productLoad.code }, data), productLoad.scope);
        }), catchError(function (error) {
            return of(new LoadProductFail(productLoad.code, makeErrorSerializable(error), productLoad.scope));
        }));
    };
    ProductEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: ProductConnector }
    ]; };
    ProductEffects = __decorate([
        Injectable()
    ], ProductEffects);
    return ProductEffects;
}());

var effects$9 = [
    ProductsSearchEffects,
    ProductEffects,
    ProductReviewsEffects,
    ProductReferencesEffects,
];

var initialState$i = {
    productCode: '',
    list: [],
};
function reducer$i(state, action) {
    if (state === void 0) { state = initialState$i; }
    switch (action.type) {
        case LOAD_PRODUCT_REFERENCES_SUCCESS: {
            var productCode = action.payload.productCode;
            var list = action.payload.list;
            return __assign(__assign({}, state), { list: __spread(state.list, (list ? list : [])).reduce(function (productReferences, productReference) {
                    if (!productReferences.some(function (obj) {
                        return obj.referenceType === productReference.referenceType &&
                            obj.target.code === productReference.target.code;
                    })) {
                        productReferences.push(productReference);
                    }
                    return productReferences;
                }, []), productCode: productCode });
        }
        case CLEAN_PRODUCT_REFERENCES: {
            return initialState$i;
        }
    }
    return state;
}
var getProductReferenceList = function (state) { return state.list; };
var getProductReferenceProductCode = function (state) { return state.productCode; };

var initialState$j = {
    productCode: '',
    list: [],
};
function reducer$j(state, action) {
    if (state === void 0) { state = initialState$j; }
    switch (action.type) {
        case LOAD_PRODUCT_REVIEWS_SUCCESS: {
            var productCode = action.payload.productCode;
            var list = action.payload.list;
            return __assign(__assign({}, state), { productCode: productCode,
                list: list });
        }
    }
    return state;
}
var getReviewList = function (state) {
    return state.list;
};
var getReviewProductCode = function (state) {
    return state.productCode;
};

var initialScopedLoaderState = {};
/**
 * Higher order reducer designed to add scope support for loader reducer
 *
 * @param entityType
 * @param reducer
 */
function scopedLoaderReducer(entityType, reducer) {
    var loader = loaderReducer(entityType, reducer);
    return function (state, action) {
        var _a;
        if (state === void 0) { state = initialScopedLoaderState; }
        var _b;
        if (action && action.meta && action.meta.entityType === entityType) {
            return __assign(__assign({}, state), (_a = {}, _a[(_b = action.meta.scope) !== null && _b !== void 0 ? _b : ''] = loader(state[action.meta.scope], action), _a));
        }
        return state;
    };
}

/**
 * Higher order reducer that wraps scopedLoaderReducer and EntityReducer enhancing
 * single state reducer to support multiple entities with generic loading flags and scopes
 */
function entityScopedLoaderReducer(entityType, reducer) {
    return entityReducer(entityType, scopedLoaderReducer(entityType, reducer));
}

function getReducers$a() {
    return {
        search: reducer$h,
        details: entityScopedLoaderReducer(PRODUCT_DETAIL_ENTITY),
        reviews: reducer$j,
        references: reducer$i,
    };
}
var reducerToken$a = new InjectionToken('ProductReducers');
var reducerProvider$a = {
    provide: reducerToken$a,
    useFactory: getReducers$a,
};
function clearProductsState(reducer) {
    return function (state, action) {
        if (action.type === CURRENCY_CHANGE ||
            action.type === LANGUAGE_CHANGE) {
            state = undefined;
        }
        return reducer(state, action);
    };
}
var metaReducers$5 = [clearProductsState];

function productStoreConfigFactory() {
    var _a;
    // if we want to reuse PRODUCT_FEATURE const in config, we have to use factory instead of plain object
    var config = {
        state: {
            ssrTransfer: {
                keys: (_a = {}, _a[PRODUCT_FEATURE] = StateTransferType.TRANSFER_STATE, _a),
            },
        },
    };
    return config;
}
var ProductStoreModule = /** @class */ (function () {
    function ProductStoreModule() {
    }
    ProductStoreModule = __decorate([
        NgModule({
            imports: [
                CommonModule,
                HttpClientModule,
                StoreModule.forFeature(PRODUCT_FEATURE, reducerToken$a, { metaReducers: metaReducers$5 }),
                EffectsModule.forFeature(effects$9),
            ],
            providers: [
                provideDefaultConfigFactory(productStoreConfigFactory),
                reducerProvider$a,
            ],
        })
    ], ProductStoreModule);
    return ProductStoreModule;
}());

var pageTitleResolvers = [
    {
        provide: PageMetaResolver,
        useExisting: ProductPageMetaResolver,
        multi: true,
    },
    {
        provide: PageMetaResolver,
        useExisting: CategoryPageMetaResolver,
        multi: true,
    },
    {
        provide: PageMetaResolver,
        useExisting: SearchPageMetaResolver,
        multi: true,
    },
    {
        provide: PageMetaResolver,
        useExisting: CouponSearchPageResolver,
        multi: true,
    },
];
var ProductModule = /** @class */ (function () {
    function ProductModule() {
    }
    ProductModule_1 = ProductModule;
    ProductModule.forRoot = function () {
        return {
            ngModule: ProductModule_1,
            providers: __spread(pageTitleResolvers),
        };
    };
    var ProductModule_1;
    ProductModule = ProductModule_1 = __decorate([
        NgModule({
            imports: [ProductStoreModule],
        })
    ], ProductModule);
    return ProductModule;
}());

var CmsTicketInterceptor = /** @class */ (function () {
    function CmsTicketInterceptor(service) {
        this.service = service;
    }
    CmsTicketInterceptor.prototype.intercept = function (request, next) {
        if (request.url.includes('/cms/') && this.service.cmsTicketId) {
            request = request.clone({
                setParams: {
                    cmsTicketId: this.service.cmsTicketId,
                },
            });
        }
        return next.handle(request);
    };
    CmsTicketInterceptor.ctorParameters = function () { return [
        { type: SmartEditService }
    ]; };
    CmsTicketInterceptor.ɵprov = ɵɵdefineInjectable({ factory: function CmsTicketInterceptor_Factory() { return new CmsTicketInterceptor(ɵɵinject(SmartEditService)); }, token: CmsTicketInterceptor, providedIn: "root" });
    CmsTicketInterceptor = __decorate([
        Injectable({ providedIn: 'root' })
    ], CmsTicketInterceptor);
    return CmsTicketInterceptor;
}());

var interceptors$4 = [
    {
        provide: HTTP_INTERCEPTORS,
        useExisting: CmsTicketInterceptor,
        multi: true,
    },
];

var SmartEditModule = /** @class */ (function () {
    function SmartEditModule() {
    }
    SmartEditModule_1 = SmartEditModule;
    SmartEditModule.forRoot = function () {
        return {
            ngModule: SmartEditModule_1,
            providers: __spread(interceptors$4),
        };
    };
    var SmartEditModule_1;
    SmartEditModule = SmartEditModule_1 = __decorate([
        NgModule({})
    ], SmartEditModule);
    return SmartEditModule;
}());

/**
 * The wrapper over the standard ngExpressEngine, that provides tokens for Spartacus
 * @param ngExpressEngine
 */
var NgExpressEngineDecorator = /** @class */ (function () {
    function NgExpressEngineDecorator() {
    }
    /**
     * Returns the higher order ngExpressEngine with provided tokens for Spartacus
     *
     * @param ngExpressEngine
     */
    NgExpressEngineDecorator.get = function (ngExpressEngine) {
        var result = function cxNgExpressEngine(setupOptions) {
            return function (filePath, options, callback) {
                var engineInstance = ngExpressEngine(__assign(__assign({}, setupOptions), { providers: __spread(getServerRequestProviders(options), (setupOptions.providers || [])) }));
                return engineInstance(filePath, options, callback);
            };
        };
        return result;
    };
    return NgExpressEngineDecorator;
}());
/**
 * Returns Spartacus' providers to be passed to the Angular express engine (in SSR)
 *
 * @param options
 */
function getServerRequestProviders(options) {
    return [
        {
            provide: SERVER_REQUEST_URL,
            useValue: getRequestUrl(options.req),
        },
        {
            provide: SERVER_REQUEST_ORIGIN,
            useValue: getRequestOrigin(options.req),
        },
    ];
}
function getRequestUrl(req) {
    return getRequestOrigin(req) + req.originalUrl;
}
function getRequestOrigin(req) {
    return req.protocol + '://' + req.get('host');
}

var StoreFinderConfig = /** @class */ (function () {
    function StoreFinderConfig() {
    }
    StoreFinderConfig.ɵprov = ɵɵdefineInjectable({ factory: function StoreFinderConfig_Factory() { return ɵɵinject(Config); }, token: StoreFinderConfig, providedIn: "root" });
    StoreFinderConfig = __decorate([
        Injectable({
            providedIn: 'root',
            useExisting: Config,
        })
    ], StoreFinderConfig);
    return StoreFinderConfig;
}());

var STORE_FINDER_FEATURE = 'stores';
var STORE_FINDER_DATA = '[StoreFinder] Store Finder Data';

var FIND_STORES_ON_HOLD = '[StoreFinder] On Hold';
var FIND_STORES = '[StoreFinder] Find Stores';
var FIND_STORES_FAIL = '[StoreFinder] Find Stores Fail';
var FIND_STORES_SUCCESS = '[StoreFinder] Find Stores Success';
var FIND_STORE_BY_ID = '[StoreFinder] Find a Store by Id';
var FIND_STORE_BY_ID_FAIL = '[StoreFinder] Find a Store by Id Fail';
var FIND_STORE_BY_ID_SUCCESS = '[StoreFinder] Find a Store by Id Success';
var FindStoresOnHold = /** @class */ (function (_super) {
    __extends(FindStoresOnHold, _super);
    function FindStoresOnHold() {
        var _this = _super.call(this, STORE_FINDER_DATA) || this;
        _this.type = FIND_STORES_ON_HOLD;
        return _this;
    }
    return FindStoresOnHold;
}(LoaderLoadAction));
var FindStores = /** @class */ (function (_super) {
    __extends(FindStores, _super);
    function FindStores(payload) {
        var _this = _super.call(this, STORE_FINDER_DATA) || this;
        _this.payload = payload;
        _this.type = FIND_STORES;
        return _this;
    }
    return FindStores;
}(LoaderLoadAction));
var FindStoresFail = /** @class */ (function (_super) {
    __extends(FindStoresFail, _super);
    function FindStoresFail(payload) {
        var _this = _super.call(this, STORE_FINDER_DATA, payload) || this;
        _this.payload = payload;
        _this.type = FIND_STORES_FAIL;
        return _this;
    }
    return FindStoresFail;
}(LoaderFailAction));
var FindStoresSuccess = /** @class */ (function (_super) {
    __extends(FindStoresSuccess, _super);
    function FindStoresSuccess(payload) {
        var _this = _super.call(this, STORE_FINDER_DATA) || this;
        _this.payload = payload;
        _this.type = FIND_STORES_SUCCESS;
        return _this;
    }
    return FindStoresSuccess;
}(LoaderSuccessAction));
var FindStoreById = /** @class */ (function (_super) {
    __extends(FindStoreById, _super);
    function FindStoreById(payload) {
        var _this = _super.call(this, STORE_FINDER_DATA) || this;
        _this.payload = payload;
        _this.type = FIND_STORE_BY_ID;
        return _this;
    }
    return FindStoreById;
}(LoaderLoadAction));
var FindStoreByIdFail = /** @class */ (function (_super) {
    __extends(FindStoreByIdFail, _super);
    function FindStoreByIdFail(payload) {
        var _this = _super.call(this, STORE_FINDER_DATA, payload) || this;
        _this.payload = payload;
        _this.type = FIND_STORE_BY_ID_FAIL;
        return _this;
    }
    return FindStoreByIdFail;
}(LoaderFailAction));
var FindStoreByIdSuccess = /** @class */ (function (_super) {
    __extends(FindStoreByIdSuccess, _super);
    function FindStoreByIdSuccess(payload) {
        var _this = _super.call(this, STORE_FINDER_DATA) || this;
        _this.payload = payload;
        _this.type = FIND_STORE_BY_ID_SUCCESS;
        return _this;
    }
    return FindStoreByIdSuccess;
}(LoaderSuccessAction));

var VIEW_ALL_STORES = '[StoreFinder] View All Stores';
var VIEW_ALL_STORES_FAIL = '[StoreFinder] View All Stores Fail';
var VIEW_ALL_STORES_SUCCESS = '[StoreFinder] View All Stores Success';
var ViewAllStores = /** @class */ (function (_super) {
    __extends(ViewAllStores, _super);
    function ViewAllStores() {
        var _this = _super.call(this, STORE_FINDER_DATA) || this;
        _this.type = VIEW_ALL_STORES;
        return _this;
    }
    return ViewAllStores;
}(LoaderLoadAction));
var ViewAllStoresFail = /** @class */ (function (_super) {
    __extends(ViewAllStoresFail, _super);
    function ViewAllStoresFail(payload) {
        var _this = _super.call(this, STORE_FINDER_DATA, payload) || this;
        _this.payload = payload;
        _this.type = VIEW_ALL_STORES_FAIL;
        return _this;
    }
    return ViewAllStoresFail;
}(LoaderFailAction));
var ViewAllStoresSuccess = /** @class */ (function (_super) {
    __extends(ViewAllStoresSuccess, _super);
    function ViewAllStoresSuccess(payload) {
        var _this = _super.call(this, STORE_FINDER_DATA) || this;
        _this.payload = payload;
        _this.type = VIEW_ALL_STORES_SUCCESS;
        return _this;
    }
    return ViewAllStoresSuccess;
}(LoaderSuccessAction));



var storeFinderGroup_actions = /*#__PURE__*/Object.freeze({
    __proto__: null,
    FIND_STORES_ON_HOLD: FIND_STORES_ON_HOLD,
    FIND_STORES: FIND_STORES,
    FIND_STORES_FAIL: FIND_STORES_FAIL,
    FIND_STORES_SUCCESS: FIND_STORES_SUCCESS,
    FIND_STORE_BY_ID: FIND_STORE_BY_ID,
    FIND_STORE_BY_ID_FAIL: FIND_STORE_BY_ID_FAIL,
    FIND_STORE_BY_ID_SUCCESS: FIND_STORE_BY_ID_SUCCESS,
    FindStoresOnHold: FindStoresOnHold,
    FindStores: FindStores,
    FindStoresFail: FindStoresFail,
    FindStoresSuccess: FindStoresSuccess,
    FindStoreById: FindStoreById,
    FindStoreByIdFail: FindStoreByIdFail,
    FindStoreByIdSuccess: FindStoreByIdSuccess,
    VIEW_ALL_STORES: VIEW_ALL_STORES,
    VIEW_ALL_STORES_FAIL: VIEW_ALL_STORES_FAIL,
    VIEW_ALL_STORES_SUCCESS: VIEW_ALL_STORES_SUCCESS,
    ViewAllStores: ViewAllStores,
    ViewAllStoresFail: ViewAllStoresFail,
    ViewAllStoresSuccess: ViewAllStoresSuccess
});

var getStoreFinderState = createFeatureSelector(STORE_FINDER_FEATURE);

var ɵ0$I = function (storesState) { return storesState.findStores; };
var getFindStoresState = createSelector(getStoreFinderState, ɵ0$I);
var ɵ1$s = function (state) {
    return loaderValueSelector(state);
};
var getFindStoresEntities = createSelector(getFindStoresState, ɵ1$s);
var ɵ2$j = function (state) {
    return loaderLoadingSelector(state);
};
var getStoresLoading = createSelector(getFindStoresState, ɵ2$j);

var ɵ0$J = function (storesState) { return storesState.viewAllStores; };
var getViewAllStoresState = createSelector(getStoreFinderState, ɵ0$J);
var ɵ1$t = function (state) {
    return loaderValueSelector(state);
};
var getViewAllStoresEntities = createSelector(getViewAllStoresState, ɵ1$t);
var ɵ2$k = function (state) {
    return loaderLoadingSelector(state);
};
var getViewAllStoresLoading = createSelector(getViewAllStoresState, ɵ2$k);



var storeFinderGroup_selectors = /*#__PURE__*/Object.freeze({
    __proto__: null,
    getFindStoresState: getFindStoresState,
    getFindStoresEntities: getFindStoresEntities,
    getStoresLoading: getStoresLoading,
    ɵ0: ɵ0$I,
    ɵ1: ɵ1$s,
    ɵ2: ɵ2$j,
    getViewAllStoresState: getViewAllStoresState,
    getViewAllStoresEntities: getViewAllStoresEntities,
    getViewAllStoresLoading: getViewAllStoresLoading
});

var StoreFinderService = /** @class */ (function () {
    function StoreFinderService(store, winRef, globalMessageService, routingService) {
        this.store = store;
        this.winRef = winRef;
        this.globalMessageService = globalMessageService;
        this.routingService = routingService;
        this.geolocationWatchId = null;
    }
    /**
     * Returns boolean observable for store's loading state
     */
    StoreFinderService.prototype.getStoresLoading = function () {
        return this.store.pipe(select(getStoresLoading));
    };
    /**
     * Returns observable for store's entities
     */
    StoreFinderService.prototype.getFindStoresEntities = function () {
        return this.store.pipe(select(getFindStoresEntities));
    };
    /**
     * Returns boolean observable for view all store's loading state
     */
    StoreFinderService.prototype.getViewAllStoresLoading = function () {
        return this.store.pipe(select(getViewAllStoresLoading));
    };
    /**
     * Returns observable for view all store's entities
     */
    StoreFinderService.prototype.getViewAllStoresEntities = function () {
        return this.store.pipe(select(getViewAllStoresEntities));
    };
    /**
     * Store finding action functionality
     * @param queryText text query
     * @param searchConfig search configuration
     * @param longitudeLatitude longitude and latitude coordinates
     * @param countryIsoCode country ISO code
     * @param useMyLocation current location coordinates
     * @param radius radius of the scope from the center point
     */
    StoreFinderService.prototype.findStoresAction = function (queryText, searchConfig, longitudeLatitude, countryIsoCode, useMyLocation, radius) {
        var _this = this;
        if (useMyLocation && this.winRef.nativeWindow) {
            this.clearWatchGeolocation(new FindStoresOnHold());
            this.geolocationWatchId = this.winRef.nativeWindow.navigator.geolocation.watchPosition(function (pos) {
                var position = {
                    longitude: pos.coords.longitude,
                    latitude: pos.coords.latitude,
                };
                _this.clearWatchGeolocation(new FindStores({
                    queryText: queryText,
                    searchConfig: searchConfig,
                    longitudeLatitude: position,
                    countryIsoCode: countryIsoCode,
                    radius: radius,
                }));
            }, function () {
                _this.globalMessageService.add({ key: 'storeFinder.geolocationNotEnabled' }, GlobalMessageType.MSG_TYPE_ERROR);
                _this.routingService.go(['/store-finder']);
            });
        }
        else {
            this.clearWatchGeolocation(new FindStores({
                queryText: queryText,
                searchConfig: searchConfig,
                longitudeLatitude: longitudeLatitude,
                countryIsoCode: countryIsoCode,
                radius: radius,
            }));
        }
    };
    /**
     * View all stores
     */
    StoreFinderService.prototype.viewAllStores = function () {
        this.clearWatchGeolocation(new ViewAllStores());
    };
    /**
     * View all stores by id
     * @param storeId store id
     */
    StoreFinderService.prototype.viewStoreById = function (storeId) {
        this.clearWatchGeolocation(new FindStoreById({ storeId: storeId }));
    };
    StoreFinderService.prototype.clearWatchGeolocation = function (callbackAction) {
        if (this.geolocationWatchId !== null) {
            this.winRef.nativeWindow.navigator.geolocation.clearWatch(this.geolocationWatchId);
            this.geolocationWatchId = null;
        }
        this.store.dispatch(callbackAction);
    };
    StoreFinderService.ctorParameters = function () { return [
        { type: Store },
        { type: WindowRef },
        { type: GlobalMessageService },
        { type: RoutingService }
    ]; };
    StoreFinderService.ɵprov = ɵɵdefineInjectable({ factory: function StoreFinderService_Factory() { return new StoreFinderService(ɵɵinject(Store), ɵɵinject(WindowRef), ɵɵinject(GlobalMessageService), ɵɵinject(RoutingService)); }, token: StoreFinderService, providedIn: "root" });
    StoreFinderService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], StoreFinderService);
    return StoreFinderService;
}());

var StoreDataService = /** @class */ (function () {
    function StoreDataService() {
        this.weekDays = {
            0: 'Sun',
            1: 'Mon',
            2: 'Tue',
            3: 'Wed',
            4: 'Thu',
            5: 'Fri',
            6: 'Sat',
        };
    }
    /**
     * Returns store latitude
     * @param location store location
     */
    StoreDataService.prototype.getStoreLatitude = function (location) {
        return location.geoPoint.latitude;
    };
    /**
     * Returns store longitude
     * @param location store location
     */
    StoreDataService.prototype.getStoreLongitude = function (location) {
        return location.geoPoint.longitude;
    };
    /**
     * Returns store closing time
     * @param location store location
     * @param date date to compare
     */
    StoreDataService.prototype.getStoreClosingTime = function (location, date) {
        var requestedDaySchedule = this.getSchedule(location, date);
        if (requestedDaySchedule) {
            if (requestedDaySchedule.closed && requestedDaySchedule.closed === true) {
                return 'closed';
            }
            if (requestedDaySchedule.closingTime) {
                return requestedDaySchedule.closingTime.formattedHour;
            }
        }
    };
    /**
     * Returns store opening time
     * @param location store location
     * @param date date to compare
     */
    StoreDataService.prototype.getStoreOpeningTime = function (location, date) {
        var requestedDaySchedule = this.getSchedule(location, date);
        if (requestedDaySchedule) {
            if (requestedDaySchedule.closed && requestedDaySchedule.closed === true) {
                return 'closed';
            }
            if (requestedDaySchedule.openingTime) {
                return requestedDaySchedule.openingTime.formattedHour;
            }
        }
    };
    /**
     * Extracts schedule from the given location for the given date
     * @param location location
     * @param date date
     *
     * @returns payload describing the store's schedule for the given day.
     */
    StoreDataService.prototype.getSchedule = function (location, date) {
        var weekday = this.weekDays[date.getDay()];
        return location.openingHours.weekDayOpeningList.find(function (weekDayOpeningListItem) { return weekDayOpeningListItem.weekDay === weekday; });
    };
    StoreDataService.ɵprov = ɵɵdefineInjectable({ factory: function StoreDataService_Factory() { return new StoreDataService(); }, token: StoreDataService, providedIn: "root" });
    StoreDataService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], StoreDataService);
    return StoreDataService;
}());

var ExternalJsFileLoader = /** @class */ (function () {
    function ExternalJsFileLoader(document) {
        this.document = document;
    }
    /**
     * Loads a javascript from an external URL
     * @param src URL for the script to be loaded
     * @param params additional parameters to be attached to the given URL
     * @param callback a function to be invoked after the script has been loaded
     */
    ExternalJsFileLoader.prototype.load = function (src, params, callback) {
        var script = this.document.createElement('script');
        script.type = 'text/javascript';
        if (params) {
            script.src = src + this.parseParams(params);
        }
        else {
            script.src = src;
        }
        script.async = true;
        script.defer = true;
        if (callback) {
            script.addEventListener('load', callback);
        }
        document.head.appendChild(script);
    };
    /**
     * Parses the given object with parameters to a string "param1=value1&param2=value2"
     * @param params object containing parameters
     */
    ExternalJsFileLoader.prototype.parseParams = function (params) {
        var result = '';
        var keysArray = Object.keys(params);
        if (keysArray.length > 0) {
            result =
                '?' +
                    keysArray
                        .map(function (key) { return encodeURI(key) + '=' + encodeURI(params[key]); })
                        .join('&');
        }
        return result;
    };
    ExternalJsFileLoader.ctorParameters = function () { return [
        { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] }
    ]; };
    ExternalJsFileLoader.ɵprov = ɵɵdefineInjectable({ factory: function ExternalJsFileLoader_Factory() { return new ExternalJsFileLoader(ɵɵinject(DOCUMENT)); }, token: ExternalJsFileLoader, providedIn: "root" });
    ExternalJsFileLoader = __decorate([
        Injectable({
            providedIn: 'root',
        }),
        __param(0, Inject(DOCUMENT))
    ], ExternalJsFileLoader);
    return ExternalJsFileLoader;
}());

var GoogleMapRendererService = /** @class */ (function () {
    function GoogleMapRendererService(config, externalJsFileLoader, storeDataService) {
        this.config = config;
        this.externalJsFileLoader = externalJsFileLoader;
        this.storeDataService = storeDataService;
        this.googleMap = null;
    }
    /**
     * Renders google map on the given element and draws markers on it.
     * If map already exists it will use an existing map otherwise it will create one
     * @param mapElement HTML element inside of which the map will be displayed
     * @param locations array containign geo data to be displayed on the map
     * @param selectMarkerHandler function to handle whenever a marker on a map is clicked
     */
    GoogleMapRendererService.prototype.renderMap = function (mapElement, locations, selectMarkerHandler) {
        var _this = this;
        if (this.googleMap === null) {
            this.externalJsFileLoader.load(this.config.googleMaps.apiUrl, { key: this.config.googleMaps.apiKey }, function () {
                _this.drawMap(mapElement, locations, selectMarkerHandler);
            });
        }
        else {
            this.drawMap(mapElement, locations, selectMarkerHandler);
        }
    };
    /**
     * Centers the map to the given point
     * @param latitute latitude of the new center
     * @param longitude longitude of the new center
     */
    GoogleMapRendererService.prototype.centerMap = function (latitute, longitude) {
        this.googleMap.panTo({ lat: latitute, lng: longitude });
        this.googleMap.setZoom(this.config.googleMaps.selectedMarkerScale);
    };
    /**
     * Defines and returns {@link google.maps.LatLng} representing a point where the map will be centered
     * @param locations list of locations
     */
    GoogleMapRendererService.prototype.defineMapCenter = function (locations) {
        return new google.maps.LatLng(this.storeDataService.getStoreLatitude(locations[0]), this.storeDataService.getStoreLongitude(locations[0]));
    };
    /**
     * Creates google map inside if the given HTML element centered to the given point
     * @param mapElement {@link HTMLElement} inside of which the map will be created
     * @param mapCenter {@link google.maps.LatLng} the point where the map will be centered
     */
    GoogleMapRendererService.prototype.initMap = function (mapElement, mapCenter) {
        var gestureOption = 'greedy';
        var mapProp = {
            center: mapCenter,
            zoom: this.config.googleMaps.scale,
            mapTypeId: google.maps.MapTypeId.ROADMAP,
            gestureHandling: gestureOption,
        };
        this.googleMap = new google.maps.Map(mapElement, mapProp);
    };
    /**
     * Erases the current map's markers and create a new one based on the given locations
     * @param locations array of locations to be displayed on the map
     * @param selectMarkerHandler function to handle whenever a marker on a map is clicked
     */
    GoogleMapRendererService.prototype.createMarkers = function (locations, selectMarkerHandler) {
        var _this = this;
        this.markers = [];
        locations.forEach(function (element, index) {
            var marker = new google.maps.Marker({
                position: new google.maps.LatLng(_this.storeDataService.getStoreLatitude(element), _this.storeDataService.getStoreLongitude(element)),
                label: index + 1 + '',
            });
            _this.markers.push(marker);
            marker.setMap(_this.googleMap);
            marker.addListener('mouseover', function () {
                marker.setAnimation(google.maps.Animation.BOUNCE);
            });
            marker.addListener('mouseout', function () {
                marker.setAnimation(null);
            });
            if (selectMarkerHandler) {
                marker.addListener('click', function () {
                    selectMarkerHandler(index);
                });
            }
        });
    };
    /**
     * Initialize and draw the map
     * @param mapElement {@link HTMLElement} inside of which the map will be drawn
     * @param locations array of locations to be displayed on the map
     * @param selectMarkerHandler function to handle whenever a marker on a map is clicked
     */
    GoogleMapRendererService.prototype.drawMap = function (mapElement, locations, selectMarkerHandler) {
        this.initMap(mapElement, this.defineMapCenter(locations));
        this.createMarkers(locations, selectMarkerHandler);
    };
    GoogleMapRendererService.ctorParameters = function () { return [
        { type: StoreFinderConfig },
        { type: ExternalJsFileLoader },
        { type: StoreDataService }
    ]; };
    GoogleMapRendererService.ɵprov = ɵɵdefineInjectable({ factory: function GoogleMapRendererService_Factory() { return new GoogleMapRendererService(ɵɵinject(StoreFinderConfig), ɵɵinject(ExternalJsFileLoader), ɵɵinject(StoreDataService)); }, token: GoogleMapRendererService, providedIn: "root" });
    GoogleMapRendererService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], GoogleMapRendererService);
    return GoogleMapRendererService;
}());

var defaultStoreFinderConfig = {
    googleMaps: {
        apiUrl: 'https://maps.googleapis.com/maps/api/js',
        apiKey: '',
        scale: 5,
        selectedMarkerScale: 17,
        radius: 50000,
    },
};

function getReducers$b() {
    return {
        findStores: loaderReducer(STORE_FINDER_DATA),
        viewAllStores: loaderReducer(STORE_FINDER_DATA),
    };
}
var reducerToken$b = new InjectionToken('StoreFinderReducers');
var reducerProvider$b = {
    provide: reducerToken$b,
    useFactory: getReducers$b,
};
var metaReducers$6 = [];

var FindStoresEffect = /** @class */ (function () {
    function FindStoresEffect(actions$, storeFinderConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.storeFinderConnector = storeFinderConnector;
        this.findStores$ = this.actions$.pipe(ofType(FIND_STORES), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            return _this.storeFinderConnector
                .search(payload.queryText, payload.searchConfig, payload.longitudeLatitude, payload.radius)
                .pipe(map(function (data) {
                if (payload.countryIsoCode) {
                    data.stores = data.stores.filter(function (store) {
                        return store.address.country.isocode === payload.countryIsoCode;
                    });
                    data.stores.sort(function (a, b) {
                        return a.name < b.name ? -1 : a.name > b.name ? 1 : 0;
                    });
                }
                return new FindStoresSuccess(data);
            }), catchError(function (error) {
                return of(new FindStoresFail(makeErrorSerializable(error)));
            }));
        }));
        this.findStoreById$ = this.actions$.pipe(ofType(FIND_STORE_BY_ID), map(function (action) { return action.payload; }), switchMap(function (payload) {
            return _this.storeFinderConnector.get(payload.storeId).pipe(map(function (data) { return new FindStoreByIdSuccess(data); }), catchError(function (error) {
                return of(new FindStoreByIdFail(makeErrorSerializable(error)));
            }));
        }));
    }
    FindStoresEffect.ctorParameters = function () { return [
        { type: Actions },
        { type: StoreFinderConnector }
    ]; };
    __decorate([
        Effect()
    ], FindStoresEffect.prototype, "findStores$", void 0);
    __decorate([
        Effect()
    ], FindStoresEffect.prototype, "findStoreById$", void 0);
    FindStoresEffect = __decorate([
        Injectable()
    ], FindStoresEffect);
    return FindStoresEffect;
}());

var ViewAllStoresEffect = /** @class */ (function () {
    function ViewAllStoresEffect(actions$, storeFinderConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.storeFinderConnector = storeFinderConnector;
        this.viewAllStores$ = this.actions$.pipe(ofType(VIEW_ALL_STORES), switchMap(function () {
            return _this.storeFinderConnector.getCounts().pipe(map(function (data) {
                data.sort(function (a, b) { return (a.name < b.name ? -1 : a.name > b.name ? 1 : 0); });
                return new ViewAllStoresSuccess(data);
            }), catchError(function (error) {
                return of(new ViewAllStoresFail(makeErrorSerializable(error)));
            }));
        }));
    }
    ViewAllStoresEffect.ctorParameters = function () { return [
        { type: Actions },
        { type: StoreFinderConnector }
    ]; };
    __decorate([
        Effect()
    ], ViewAllStoresEffect.prototype, "viewAllStores$", void 0);
    ViewAllStoresEffect = __decorate([
        Injectable()
    ], ViewAllStoresEffect);
    return ViewAllStoresEffect;
}());

var effects$a = [FindStoresEffect, ViewAllStoresEffect];

var StoreFinderStoreModule = /** @class */ (function () {
    function StoreFinderStoreModule() {
    }
    StoreFinderStoreModule = __decorate([
        NgModule({
            imports: [
                CommonModule,
                HttpClientModule,
                StoreModule.forFeature(STORE_FINDER_FEATURE, reducerToken$b),
                EffectsModule.forFeature(effects$a),
            ],
            providers: [reducerProvider$b],
        })
    ], StoreFinderStoreModule);
    return StoreFinderStoreModule;
}());

var StoreFinderCoreModule = /** @class */ (function () {
    function StoreFinderCoreModule() {
    }
    StoreFinderCoreModule = __decorate([
        NgModule({
            imports: [StoreFinderStoreModule],
            providers: [provideDefaultConfig(defaultStoreFinderConfig)],
        })
    ], StoreFinderCoreModule);
    return StoreFinderCoreModule;
}());

var UserConnector = /** @class */ (function () {
    function UserConnector(adapter) {
        this.adapter = adapter;
    }
    UserConnector.prototype.get = function (userId) {
        return this.adapter.load(userId);
    };
    UserConnector.prototype.update = function (username, user) {
        return this.adapter.update(username, user);
    };
    UserConnector.prototype.register = function (user) {
        return this.adapter.register(user);
    };
    UserConnector.prototype.registerGuest = function (guid, password) {
        return this.adapter.registerGuest(guid, password);
    };
    UserConnector.prototype.requestForgotPasswordEmail = function (userEmailAddress) {
        return this.adapter.requestForgotPasswordEmail(userEmailAddress);
    };
    UserConnector.prototype.resetPassword = function (token, newPassword) {
        return this.adapter.resetPassword(token, newPassword);
    };
    UserConnector.prototype.updateEmail = function (userId, currentPassword, newUserId) {
        return this.adapter.updateEmail(userId, currentPassword, newUserId);
    };
    UserConnector.prototype.updatePassword = function (userId, oldPassword, newPassword) {
        return this.adapter.updatePassword(userId, oldPassword, newPassword);
    };
    UserConnector.prototype.remove = function (userId) {
        return this.adapter.remove(userId);
    };
    UserConnector.prototype.getTitles = function () {
        return this.adapter.loadTitles();
    };
    UserConnector.ctorParameters = function () { return [
        { type: UserAdapter }
    ]; };
    UserConnector.ɵprov = ɵɵdefineInjectable({ factory: function UserConnector_Factory() { return new UserConnector(ɵɵinject(UserAdapter)); }, token: UserConnector, providedIn: "root" });
    UserConnector = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], UserConnector);
    return UserConnector;
}());

var UserConsentConnector = /** @class */ (function () {
    function UserConsentConnector(adapter) {
        this.adapter = adapter;
    }
    UserConsentConnector.prototype.loadConsents = function (userId) {
        return this.adapter.loadConsents(userId);
    };
    UserConsentConnector.prototype.giveConsent = function (userId, consentTemplateId, consentTemplateVersion) {
        return this.adapter.giveConsent(userId, consentTemplateId, consentTemplateVersion);
    };
    UserConsentConnector.prototype.withdrawConsent = function (userId, consentCode) {
        return this.adapter.withdrawConsent(userId, consentCode);
    };
    UserConsentConnector.ctorParameters = function () { return [
        { type: UserConsentAdapter }
    ]; };
    UserConsentConnector.ɵprov = ɵɵdefineInjectable({ factory: function UserConsentConnector_Factory() { return new UserConsentConnector(ɵɵinject(UserConsentAdapter)); }, token: UserConsentConnector, providedIn: "root" });
    UserConsentConnector = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], UserConsentConnector);
    return UserConsentConnector;
}());

var UserPaymentConnector = /** @class */ (function () {
    function UserPaymentConnector(adapter) {
        this.adapter = adapter;
    }
    UserPaymentConnector.prototype.getAll = function (userId) {
        return this.adapter.loadAll(userId);
    };
    UserPaymentConnector.prototype.delete = function (userId, paymentMethodID) {
        return this.adapter.delete(userId, paymentMethodID);
    };
    UserPaymentConnector.prototype.setDefault = function (userId, paymentMethodID) {
        return this.adapter.setDefault(userId, paymentMethodID);
    };
    UserPaymentConnector.ctorParameters = function () { return [
        { type: UserPaymentAdapter }
    ]; };
    UserPaymentConnector.ɵprov = ɵɵdefineInjectable({ factory: function UserPaymentConnector_Factory() { return new UserPaymentConnector(ɵɵinject(UserPaymentAdapter)); }, token: UserPaymentConnector, providedIn: "root" });
    UserPaymentConnector = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], UserPaymentConnector);
    return UserPaymentConnector;
}());

var UserOrderConnector = /** @class */ (function () {
    function UserOrderConnector(adapter) {
        this.adapter = adapter;
    }
    UserOrderConnector.prototype.get = function (userId, orderCode) {
        return this.adapter.load(userId, orderCode);
    };
    UserOrderConnector.prototype.getHistory = function (userId, pageSize, currentPage, sort) {
        return this.adapter.loadHistory(userId, pageSize, currentPage, sort);
    };
    UserOrderConnector.prototype.getConsignmentTracking = function (orderCode, consignmentCode, userId) {
        return this.adapter.getConsignmentTracking(orderCode, consignmentCode, userId);
    };
    UserOrderConnector.prototype.cancel = function (userId, orderCode, cancelRequestInput) {
        return this.adapter.cancel(userId, orderCode, cancelRequestInput);
    };
    UserOrderConnector.prototype.return = function (userId, returnRequestInput) {
        return this.adapter.createReturnRequest(userId, returnRequestInput);
    };
    UserOrderConnector.prototype.getReturnRequestDetail = function (userId, returnRequestCode) {
        return this.adapter.loadReturnRequestDetail(userId, returnRequestCode);
    };
    UserOrderConnector.prototype.getReturnRequestList = function (userId, pageSize, currentPage, sort) {
        return this.adapter.loadReturnRequestList(userId, pageSize, currentPage, sort);
    };
    UserOrderConnector.prototype.cancelReturnRequest = function (userId, returnRequestCode, returnRequestModification) {
        return this.adapter.cancelReturnRequest(userId, returnRequestCode, returnRequestModification);
    };
    UserOrderConnector.ctorParameters = function () { return [
        { type: UserOrderAdapter }
    ]; };
    UserOrderConnector.ɵprov = ɵɵdefineInjectable({ factory: function UserOrderConnector_Factory() { return new UserOrderConnector(ɵɵinject(UserOrderAdapter)); }, token: UserOrderConnector, providedIn: "root" });
    UserOrderConnector = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], UserOrderConnector);
    return UserOrderConnector;
}());

var CustomerCouponConnector = /** @class */ (function () {
    function CustomerCouponConnector(adapter) {
        this.adapter = adapter;
    }
    CustomerCouponConnector.prototype.getCustomerCoupons = function (userId, pageSize, currentPage, sort) {
        return this.adapter.getCustomerCoupons(userId, pageSize, currentPage, sort);
    };
    CustomerCouponConnector.prototype.turnOnNotification = function (userId, couponCode) {
        return this.adapter.turnOnNotification(userId, couponCode);
    };
    CustomerCouponConnector.prototype.turnOffNotification = function (userId, couponCode) {
        return this.adapter.turnOffNotification(userId, couponCode);
    };
    CustomerCouponConnector.prototype.claimCustomerCoupon = function (userId, couponCode) {
        return this.adapter.claimCustomerCoupon(userId, couponCode);
    };
    CustomerCouponConnector.ctorParameters = function () { return [
        { type: CustomerCouponAdapter }
    ]; };
    CustomerCouponConnector.ɵprov = ɵɵdefineInjectable({ factory: function CustomerCouponConnector_Factory() { return new CustomerCouponConnector(ɵɵinject(CustomerCouponAdapter)); }, token: CustomerCouponConnector, providedIn: "root" });
    CustomerCouponConnector = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], CustomerCouponConnector);
    return CustomerCouponConnector;
}());

var UserInterestsConnector = /** @class */ (function () {
    function UserInterestsConnector(adapter) {
        this.adapter = adapter;
    }
    UserInterestsConnector.prototype.getInterests = function (userId, pageSize, currentPage, sort, productCode, notificationType) {
        return this.adapter.getInterests(userId, pageSize, currentPage, sort, productCode, notificationType);
    };
    UserInterestsConnector.prototype.removeInterest = function (userId, item) {
        return this.adapter.removeInterest(userId, item);
    };
    UserInterestsConnector.prototype.addInterest = function (userId, productCode, notificationType) {
        return this.adapter.addInterest(userId, productCode, notificationType);
    };
    UserInterestsConnector.ctorParameters = function () { return [
        { type: UserInterestsAdapter }
    ]; };
    UserInterestsConnector.ɵprov = ɵɵdefineInjectable({ factory: function UserInterestsConnector_Factory() { return new UserInterestsConnector(ɵɵinject(UserInterestsAdapter)); }, token: UserInterestsConnector, providedIn: "root" });
    UserInterestsConnector = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], UserInterestsConnector);
    return UserInterestsConnector;
}());

/**
 * Unified facade for both anonymous and registered user consents.
 */
var ConsentService = /** @class */ (function () {
    function ConsentService(anonymousConsentsService, userConsentService) {
        this.anonymousConsentsService = anonymousConsentsService;
        this.userConsentService = userConsentService;
    }
    /**
     * Returns either anonymous consent or registered consent as they are emmited.
     * @param templateCode for which to return either anonymous or registered consent.
     */
    ConsentService.prototype.getConsent = function (templateCode) {
        return merge(this.userConsentService.getConsent(templateCode), this.anonymousConsentsService.getConsent(templateCode));
    };
    /**
     * Checks if the `templateId`'s template has a given consent.
     * The method returns `false` if the consent doesn't exist or if it's withdrawn. Otherwise, `true` is returned.
     *
     * @param templateId of a template which's consent should be checked
     */
    ConsentService.prototype.checkConsentGivenByTemplateId = function (templateId) {
        var _this = this;
        return this.getConsent(templateId).pipe(map(function (consent) {
            if (!consent) {
                return false;
            }
            return _this.isAnonymousConsentType(consent)
                ? _this.anonymousConsentsService.isConsentGiven(consent)
                : _this.userConsentService.isConsentGiven(consent);
        }), distinctUntilChanged());
    };
    /**
     * Checks if the `templateId`'s template has a withdrawn consent.
     * The method returns `true` if the consent doesn't exist or if it's withdrawn. Otherwise, `false` is returned.
     *
     * @param templateId of a template which's consent should be checked
     */
    ConsentService.prototype.checkConsentWithdrawnByTemplateId = function (templateId) {
        var _this = this;
        return this.getConsent(templateId).pipe(map(function (consent) {
            if (!consent) {
                return true;
            }
            return _this.isAnonymousConsentType(consent)
                ? _this.anonymousConsentsService.isConsentWithdrawn(consent)
                : _this.userConsentService.isConsentWithdrawn(consent);
        }), distinctUntilChanged());
    };
    /**
     *
     * Checks the provided `consent`'s type and delegates to an appropriate method - `anonymousConsentsService.isConsentGiven(consent)` or `this.userConsentService.isConsentGiven`
     *
     * @param consent a consent to check
     */
    ConsentService.prototype.isConsentGiven = function (consent) {
        return this.isAnonymousConsentType(consent)
            ? this.anonymousConsentsService.isConsentGiven(consent)
            : this.userConsentService.isConsentGiven(consent);
    };
    /**
     *
     * Checks the provided `consent`'s type and delegates to an appropriate method - `anonymousConsentsService.isConsentWithdrawn(consent)` or `this.userConsentService.isConsentWithdrawn`
     *
     * @param consent a consent to check
     */
    ConsentService.prototype.isConsentWithdrawn = function (consent) {
        return this.isAnonymousConsentType(consent)
            ? this.anonymousConsentsService.isConsentWithdrawn(consent)
            : this.userConsentService.isConsentWithdrawn(consent);
    };
    /**
     * Returns `true` if the provided consent is of type `AnonymousConsent`. Otherwise, `false` is returned.
     */
    ConsentService.prototype.isAnonymousConsentType = function (consent) {
        if (!consent) {
            return false;
        }
        return consent.templateCode !== undefined;
    };
    /**
     * Returns `true` if the provided consent is of type `Consent`. Otherwise, `false` is returned.
     */
    ConsentService.prototype.isConsentType = function (consent) {
        if (!consent) {
            return false;
        }
        return consent.code !== undefined;
    };
    ConsentService.ctorParameters = function () { return [
        { type: AnonymousConsentsService },
        { type: UserConsentService }
    ]; };
    ConsentService.ɵprov = ɵɵdefineInjectable({ factory: function ConsentService_Factory() { return new ConsentService(ɵɵinject(AnonymousConsentsService), ɵɵinject(UserConsentService)); }, token: ConsentService, providedIn: "root" });
    ConsentService = __decorate([
        Injectable({ providedIn: 'root' })
    ], ConsentService);
    return ConsentService;
}());

var UserAddressService = /** @class */ (function () {
    function UserAddressService(store, authService) {
        this.store = store;
        this.authService = authService;
    }
    /**
     * Retrieves user's addresses
     */
    UserAddressService.prototype.loadAddresses = function () {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new LoadUserAddresses(userId));
        });
    };
    /**
     * Adds user address
     * @param address a user address
     */
    UserAddressService.prototype.addUserAddress = function (address) {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new AddUserAddress({
                userId: userId,
                address: address,
            }));
        });
    };
    /**
     * Sets user address as default
     * @param addressId a user address ID
     */
    UserAddressService.prototype.setAddressAsDefault = function (addressId) {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new UpdateUserAddress({
                userId: userId,
                addressId: addressId,
                address: { defaultAddress: true },
            }));
        });
    };
    /**
     * Updates existing user address
     * @param addressId a user address ID
     * @param address a user address
     */
    UserAddressService.prototype.updateUserAddress = function (addressId, address) {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new UpdateUserAddress({
                userId: userId,
                addressId: addressId,
                address: address,
            }));
        });
    };
    /**
     * Deletes existing user address
     * @param addressId a user address ID
     */
    UserAddressService.prototype.deleteUserAddress = function (addressId) {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new DeleteUserAddress({
                userId: userId,
                addressId: addressId,
            }));
        });
    };
    /**
     * Returns addresses
     */
    UserAddressService.prototype.getAddresses = function () {
        return this.store.pipe(select(getAddresses));
    };
    /**
     * Returns a loading flag for addresses
     */
    UserAddressService.prototype.getAddressesLoading = function () {
        return this.store.pipe(select(getAddressesLoading));
    };
    UserAddressService.prototype.getAddressesLoadedSuccess = function () {
        return this.store.pipe(select(getAddressesLoadedSuccess));
    };
    /**
     * Retrieves delivery countries
     */
    UserAddressService.prototype.loadDeliveryCountries = function () {
        this.store.dispatch(new LoadDeliveryCountries());
    };
    /**
     * Returns all delivery countries
     */
    UserAddressService.prototype.getDeliveryCountries = function () {
        return this.store.pipe(select(getAllDeliveryCountries));
    };
    /**
     * Returns a country based on the provided `isocode`
     * @param isocode an isocode for a country
     */
    UserAddressService.prototype.getCountry = function (isocode) {
        return this.store.pipe(select(countrySelectorFactory(isocode)));
    };
    /**
     * Retrieves regions for specified country by `countryIsoCode`
     * @param countryIsoCode
     */
    UserAddressService.prototype.loadRegions = function (countryIsoCode) {
        this.store.dispatch(new LoadRegions(countryIsoCode));
    };
    /**
     * Clear regions in store - useful when changing country
     */
    UserAddressService.prototype.clearRegions = function () {
        this.store.dispatch(new ClearRegions());
    };
    /**
     * Returns all regions
     */
    UserAddressService.prototype.getRegions = function (countryIsoCode) {
        var _this = this;
        return this.store.pipe(select(getRegionsDataAndLoading), map(function (_a) {
            var regions = _a.regions, country = _a.country, loading = _a.loading, loaded = _a.loaded;
            if (!countryIsoCode && (loading || loaded)) {
                _this.clearRegions();
                return [];
            }
            else if (loading && !loaded) {
                // don't interrupt loading
                return [];
            }
            else if (!loading && countryIsoCode !== country && countryIsoCode) {
                // country changed - clear store and load new regions
                if (country) {
                    _this.clearRegions();
                }
                _this.loadRegions(countryIsoCode);
                return [];
            }
            return regions;
        }));
    };
    UserAddressService.ctorParameters = function () { return [
        { type: Store },
        { type: AuthService }
    ]; };
    UserAddressService.ɵprov = ɵɵdefineInjectable({ factory: function UserAddressService_Factory() { return new UserAddressService(ɵɵinject(Store), ɵɵinject(AuthService)); }, token: UserAddressService, providedIn: "root" });
    UserAddressService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], UserAddressService);
    return UserAddressService;
}());

var UserOrderService = /** @class */ (function () {
    function UserOrderService(store, authService) {
        this.store = store;
        this.authService = authService;
    }
    /**
     * Returns an order's detail
     */
    UserOrderService.prototype.getOrderDetails = function () {
        return this.store.pipe(select(getOrderDetails));
    };
    /**
     * Retrieves order's details
     *
     * @param orderCode an order code
     */
    UserOrderService.prototype.loadOrderDetails = function (orderCode) {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new LoadOrderDetails({
                userId: userId,
                orderCode: orderCode,
            }));
        });
    };
    /**
     * Clears order's details
     */
    UserOrderService.prototype.clearOrderDetails = function () {
        this.store.dispatch(new ClearOrderDetails());
    };
    /**
     * Returns order history list
     */
    UserOrderService.prototype.getOrderHistoryList = function (pageSize) {
        var _this = this;
        return this.store.pipe(select(getOrdersState), tap(function (orderListState) {
            var attemptedLoad = orderListState.loading ||
                orderListState.success ||
                orderListState.error;
            if (!attemptedLoad) {
                _this.loadOrderList(pageSize);
            }
        }), map(function (orderListState) { return orderListState.value; }));
    };
    /**
     * Returns a loaded flag for order history list
     */
    UserOrderService.prototype.getOrderHistoryListLoaded = function () {
        return this.store.pipe(select(getOrdersLoaded));
    };
    /**
     * Retrieves an order list
     * @param pageSize page size
     * @param currentPage current page
     * @param sort sort
     */
    UserOrderService.prototype.loadOrderList = function (pageSize, currentPage, sort) {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new LoadUserOrders({
                userId: userId,
                pageSize: pageSize,
                currentPage: currentPage,
                sort: sort,
            }));
        });
    };
    /**
     * Cleaning order list
     */
    UserOrderService.prototype.clearOrderList = function () {
        this.store.dispatch(new ClearUserOrders());
    };
    /**
     *  Returns a consignment tracking detail
     */
    UserOrderService.prototype.getConsignmentTracking = function () {
        return this.store.pipe(select(getConsignmentTracking));
    };
    /**
     * Retrieves consignment tracking details
     * @param orderCode an order code
     * @param consignmentCode a consignment code
     */
    UserOrderService.prototype.loadConsignmentTracking = function (orderCode, consignmentCode) {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new LoadConsignmentTracking({
                userId: userId,
                orderCode: orderCode,
                consignmentCode: consignmentCode,
            }));
        });
    };
    /**
     * Cleaning consignment tracking
     */
    UserOrderService.prototype.clearConsignmentTracking = function () {
        this.store.dispatch(new ClearConsignmentTracking());
    };
    /*
     * Cancel an order
     */
    UserOrderService.prototype.cancelOrder = function (orderCode, cancelRequestInput) {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new CancelOrder({
                userId: userId,
                orderCode: orderCode,
                cancelRequestInput: cancelRequestInput,
            }));
        });
    };
    /**
     * Returns the cancel order loading flag
     */
    UserOrderService.prototype.getCancelOrderLoading = function () {
        return this.store.pipe(select(getProcessLoadingFactory(CANCEL_ORDER_PROCESS_ID)));
    };
    /**
     * Returns the cancel order success flag
     */
    UserOrderService.prototype.getCancelOrderSuccess = function () {
        return this.store.pipe(select(getProcessSuccessFactory(CANCEL_ORDER_PROCESS_ID)));
    };
    /**
     * Resets the cancel order process flags
     */
    UserOrderService.prototype.resetCancelOrderProcessState = function () {
        return this.store.dispatch(new ResetCancelOrderProcess());
    };
    UserOrderService.ctorParameters = function () { return [
        { type: Store },
        { type: AuthService }
    ]; };
    UserOrderService.ɵprov = ɵɵdefineInjectable({ factory: function UserOrderService_Factory() { return new UserOrderService(ɵɵinject(Store), ɵɵinject(AuthService)); }, token: UserOrderService, providedIn: "root" });
    UserOrderService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], UserOrderService);
    return UserOrderService;
}());

var CustomerCouponService = /** @class */ (function () {
    function CustomerCouponService(store, authService) {
        this.store = store;
        this.authService = authService;
    }
    /**
     * Retrieves customer's coupons
     * @param pageSize page size
     * @param currentPage current page
     * @param sort sort
     */
    CustomerCouponService.prototype.loadCustomerCoupons = function (pageSize, currentPage, sort) {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new LoadCustomerCoupons({
                userId: userId,
                pageSize: pageSize,
                currentPage: currentPage,
                sort: sort,
            }));
        });
    };
    /**
     * Returns customer coupon search result
     * @param pageSize page size
     */
    CustomerCouponService.prototype.getCustomerCoupons = function (pageSize) {
        var _this = this;
        return combineLatest([
            this.store.pipe(select(getCustomerCouponsState)),
            this.getClaimCustomerCouponResultLoading(),
        ]).pipe(filter(function (_a) {
            var _b = __read(_a, 2), loading = _b[1];
            return !loading;
        }), tap(function (_a) {
            var _b = __read(_a, 1), customerCouponsState = _b[0];
            var attemptedLoad = customerCouponsState.loading ||
                customerCouponsState.success ||
                customerCouponsState.error;
            if (!attemptedLoad) {
                _this.loadCustomerCoupons(pageSize);
            }
        }), map(function (_a) {
            var _b = __read(_a, 1), customerCouponsState = _b[0];
            return customerCouponsState.value;
        }));
    };
    /**
     * Returns a loaded flag for customer coupons
     */
    CustomerCouponService.prototype.getCustomerCouponsLoaded = function () {
        return this.store.pipe(select(getCustomerCouponsLoaded));
    };
    /**
     * Returns a loading flag for customer coupons
     */
    CustomerCouponService.prototype.getCustomerCouponsLoading = function () {
        return this.store.pipe(select(getCustomerCouponsLoading));
    };
    /**
     * Subscribe a CustomerCoupon Notification
     * @param couponCode a customer coupon code
     */
    CustomerCouponService.prototype.subscribeCustomerCoupon = function (couponCode) {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new SubscribeCustomerCoupon({
                userId: userId,
                couponCode: couponCode,
            }));
        });
    };
    /**
     * Returns the subscribe customer coupon notification process loading flag
     */
    CustomerCouponService.prototype.getSubscribeCustomerCouponResultLoading = function () {
        return this.store.pipe(select(getProcessLoadingFactory(SUBSCRIBE_CUSTOMER_COUPON_PROCESS_ID)));
    };
    /**
     * Returns the subscribe customer coupon notification process success flag
     */
    CustomerCouponService.prototype.getSubscribeCustomerCouponResultSuccess = function () {
        return this.store.pipe(select(getProcessSuccessFactory(SUBSCRIBE_CUSTOMER_COUPON_PROCESS_ID)));
    };
    /**
     * Returns the subscribe customer coupon notification process error flag
     */
    CustomerCouponService.prototype.getSubscribeCustomerCouponResultError = function () {
        return this.store.pipe(select(getProcessErrorFactory(SUBSCRIBE_CUSTOMER_COUPON_PROCESS_ID)));
    };
    /**
     * Unsubscribe a CustomerCoupon Notification
     * @param couponCode a customer coupon code
     */
    CustomerCouponService.prototype.unsubscribeCustomerCoupon = function (couponCode) {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new UnsubscribeCustomerCoupon({
                userId: userId,
                couponCode: couponCode,
            }));
        });
    };
    /**
     * Returns the unsubscribe customer coupon notification process loading flag
     */
    CustomerCouponService.prototype.getUnsubscribeCustomerCouponResultLoading = function () {
        return this.store.pipe(select(getProcessLoadingFactory(UNSUBSCRIBE_CUSTOMER_COUPON_PROCESS_ID)));
    };
    /**
     * Returns the unsubscribe customer coupon notification process success flag
     */
    CustomerCouponService.prototype.getUnsubscribeCustomerCouponResultSuccess = function () {
        return this.store.pipe(select(getProcessSuccessFactory(UNSUBSCRIBE_CUSTOMER_COUPON_PROCESS_ID)));
    };
    /**
     * Returns the unsubscribe customer coupon notification process error flag
     */
    CustomerCouponService.prototype.getUnsubscribeCustomerCouponResultError = function () {
        return this.store.pipe(select(getProcessErrorFactory(UNSUBSCRIBE_CUSTOMER_COUPON_PROCESS_ID)));
    };
    /**
     * Claim a CustomerCoupon
     * @param couponCode a customer coupon code
     */
    CustomerCouponService.prototype.claimCustomerCoupon = function (couponCode) {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new ClaimCustomerCoupon({
                userId: userId,
                couponCode: couponCode,
            }));
        });
    };
    /**
     * Returns the claim customer coupon notification process success flag
     */
    CustomerCouponService.prototype.getClaimCustomerCouponResultSuccess = function () {
        return this.store.pipe(select(getProcessSuccessFactory(CLAIM_CUSTOMER_COUPON_PROCESS_ID)));
    };
    /**
     * Returns the claim customer coupon notification process loading flag
     */
    CustomerCouponService.prototype.getClaimCustomerCouponResultLoading = function () {
        return this.store.pipe(select(getProcessLoadingFactory(CLAIM_CUSTOMER_COUPON_PROCESS_ID)));
    };
    CustomerCouponService.ctorParameters = function () { return [
        { type: Store },
        { type: AuthService }
    ]; };
    CustomerCouponService.ɵprov = ɵɵdefineInjectable({ factory: function CustomerCouponService_Factory() { return new CustomerCouponService(ɵɵinject(Store), ɵɵinject(AuthService)); }, token: CustomerCouponService, providedIn: "root" });
    CustomerCouponService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], CustomerCouponService);
    return CustomerCouponService;
}());

var UserPaymentService = /** @class */ (function () {
    function UserPaymentService(store, authService) {
        this.store = store;
        this.authService = authService;
    }
    /**
     * Loads all user's payment methods.
     */
    UserPaymentService.prototype.loadPaymentMethods = function () {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new LoadUserPaymentMethods(userId));
        });
    };
    /**
     * Returns all user's payment methods
     */
    UserPaymentService.prototype.getPaymentMethods = function () {
        return this.store.pipe(select(getPaymentMethods));
    };
    /**
     * Returns a loading flag for payment methods
     */
    UserPaymentService.prototype.getPaymentMethodsLoading = function () {
        return this.store.pipe(select(getPaymentMethodsLoading));
    };
    UserPaymentService.prototype.getPaymentMethodsLoadedSuccess = function () {
        return this.store.pipe(select(getPaymentMethodsLoadedSuccess));
    };
    /**
     * Sets the payment as a default one
     * @param paymentMethodId a payment method ID
     */
    UserPaymentService.prototype.setPaymentMethodAsDefault = function (paymentMethodId) {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new SetDefaultUserPaymentMethod({
                userId: userId,
                paymentMethodId: paymentMethodId,
            }));
        });
    };
    /**
     * Deletes the payment method
     *
     * @param paymentMethodId a payment method ID
     */
    UserPaymentService.prototype.deletePaymentMethod = function (paymentMethodId) {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new DeleteUserPaymentMethod({
                userId: userId,
                paymentMethodId: paymentMethodId,
            }));
        });
    };
    /**
     * Returns all billing countries
     */
    UserPaymentService.prototype.getAllBillingCountries = function () {
        return this.store.pipe(select(getAllBillingCountries));
    };
    /**
     * Retrieves billing countries
     */
    UserPaymentService.prototype.loadBillingCountries = function () {
        this.store.dispatch(new LoadBillingCountries());
    };
    UserPaymentService.ctorParameters = function () { return [
        { type: Store },
        { type: AuthService }
    ]; };
    UserPaymentService.ɵprov = ɵɵdefineInjectable({ factory: function UserPaymentService_Factory() { return new UserPaymentService(ɵɵinject(Store), ɵɵinject(AuthService)); }, token: UserPaymentService, providedIn: "root" });
    UserPaymentService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], UserPaymentService);
    return UserPaymentService;
}());

var OrderReturnRequestService = /** @class */ (function () {
    function OrderReturnRequestService(store, authService) {
        this.store = store;
        this.authService = authService;
    }
    /**
     * Create order return request
     * @param orderCode an order code
     * @param returnRequestInput order return request entry input
     */
    OrderReturnRequestService.prototype.createOrderReturnRequest = function (returnRequestInput) {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new CreateOrderReturnRequest({
                userId: userId,
                returnRequestInput: returnRequestInput,
            }));
        });
    };
    /**
     * Return an order return request
     */
    OrderReturnRequestService.prototype.getOrderReturnRequest = function () {
        return this.store.pipe(select(getOrderReturnRequest));
    };
    /**
     * Gets order return request list
     */
    OrderReturnRequestService.prototype.getOrderReturnRequestList = function (pageSize) {
        var _this = this;
        return this.store.pipe(select(getOrderReturnRequestListState), tap(function (returnListState) {
            var attemptedLoad = returnListState.loading ||
                returnListState.success ||
                returnListState.error;
            if (!attemptedLoad) {
                _this.loadOrderReturnRequestList(pageSize);
            }
        }), map(function (returnListState) { return returnListState.value; }));
    };
    /**
     * Loads order return request detail
     * @param returnRequestCode
     */
    OrderReturnRequestService.prototype.loadOrderReturnRequestDetail = function (returnRequestCode) {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new LoadOrderReturnRequest({
                userId: userId,
                returnRequestCode: returnRequestCode,
            }));
        });
    };
    /**
     * Loads order return request list
     * @param pageSize page size
     * @param currentPage current page
     * @param sort sort
     */
    OrderReturnRequestService.prototype.loadOrderReturnRequestList = function (pageSize, currentPage, sort) {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new LoadOrderReturnRequestList({
                userId: userId,
                pageSize: pageSize,
                currentPage: currentPage,
                sort: sort,
            }));
        });
    };
    /**
     * Cleaning order return request list
     */
    OrderReturnRequestService.prototype.clearOrderReturnRequestList = function () {
        this.store.dispatch(new ClearOrderReturnRequestList());
    };
    /**
     * Get the order return request loading flag
     */
    OrderReturnRequestService.prototype.getReturnRequestLoading = function () {
        return this.store.pipe(select(getOrderReturnRequestLoading));
    };
    /**
     * Get the order return request success flag
     */
    OrderReturnRequestService.prototype.getReturnRequestSuccess = function () {
        return this.store.pipe(select(getOrderReturnRequestSuccess));
    };
    /**
     * Cleaning order return request details
     */
    OrderReturnRequestService.prototype.clearOrderReturnRequestDetail = function () {
        this.store.dispatch(new ClearOrderReturnRequest());
    };
    /*
     * Cancel order return request
     */
    OrderReturnRequestService.prototype.cancelOrderReturnRequest = function (returnRequestCode, returnRequestModification) {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new CancelOrderReturnRequest({
                userId: userId,
                returnRequestCode: returnRequestCode,
                returnRequestModification: returnRequestModification,
            }));
        });
    };
    /**
     * Returns the cancel return request loading flag
     */
    OrderReturnRequestService.prototype.getCancelReturnRequestLoading = function () {
        return this.store.pipe(select(getProcessLoadingFactory(CANCEL_RETURN_PROCESS_ID)));
    };
    /**
     * Returns the cancel return request success flag
     */
    OrderReturnRequestService.prototype.getCancelReturnRequestSuccess = function () {
        return this.store.pipe(select(getProcessSuccessFactory(CANCEL_RETURN_PROCESS_ID)));
    };
    /**
     * Resets the cancel return request process flags
     */
    OrderReturnRequestService.prototype.resetCancelReturnRequestProcessState = function () {
        return this.store.dispatch(new ResetCancelReturnProcess());
    };
    OrderReturnRequestService.ctorParameters = function () { return [
        { type: Store },
        { type: AuthService }
    ]; };
    OrderReturnRequestService.ɵprov = ɵɵdefineInjectable({ factory: function OrderReturnRequestService_Factory() { return new OrderReturnRequestService(ɵɵinject(Store), ɵɵinject(AuthService)); }, token: OrderReturnRequestService, providedIn: "root" });
    OrderReturnRequestService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], OrderReturnRequestService);
    return OrderReturnRequestService;
}());

var UserNotificationPreferenceService = /** @class */ (function () {
    function UserNotificationPreferenceService(store, authService) {
        this.store = store;
        this.authService = authService;
    }
    /**
     * Returns all notification preferences.
     */
    UserNotificationPreferenceService.prototype.getPreferences = function () {
        return this.store.pipe(select(getPreferences));
    };
    /**
     * Returns all enabled notification preferences.
     */
    UserNotificationPreferenceService.prototype.getEnabledPreferences = function () {
        return this.store.pipe(select(getEnabledPreferences));
    };
    /**
     * Loads all notification preferences.
     */
    UserNotificationPreferenceService.prototype.loadPreferences = function () {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new LoadNotificationPreferences(userId));
        });
    };
    /**
     * Clear all notification preferences.
     */
    UserNotificationPreferenceService.prototype.clearPreferences = function () {
        this.store.dispatch(new ClearNotificationPreferences());
    };
    /**
     * Returns a loading flag for notification preferences.
     */
    UserNotificationPreferenceService.prototype.getPreferencesLoading = function () {
        return this.store.pipe(select(getPreferencesLoading));
    };
    /**
     * Updating notification preferences.
     * @param preferences a preference list
     */
    UserNotificationPreferenceService.prototype.updatePreferences = function (preferences) {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new UpdateNotificationPreferences({
                userId: userId,
                preferences: preferences,
            }));
        });
    };
    /**
     * Returns a loading flag for updating preferences.
     */
    UserNotificationPreferenceService.prototype.getUpdatePreferencesResultLoading = function () {
        return this.store.select(getProcessLoadingFactory(UPDATE_NOTIFICATION_PREFERENCES_PROCESS_ID));
    };
    /**
     * Resets the update notification preferences process state. The state needs to be
     * reset after the process concludes, regardless if it's a success or an error.
     */
    UserNotificationPreferenceService.prototype.resetNotificationPreferences = function () {
        this.store.dispatch(new ResetNotificationPreferences());
    };
    UserNotificationPreferenceService.ctorParameters = function () { return [
        { type: Store },
        { type: AuthService }
    ]; };
    UserNotificationPreferenceService.ɵprov = ɵɵdefineInjectable({ factory: function UserNotificationPreferenceService_Factory() { return new UserNotificationPreferenceService(ɵɵinject(Store), ɵɵinject(AuthService)); }, token: UserNotificationPreferenceService, providedIn: "root" });
    UserNotificationPreferenceService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], UserNotificationPreferenceService);
    return UserNotificationPreferenceService;
}());

var UserInterestsService = /** @class */ (function () {
    function UserInterestsService(store, authService) {
        this.store = store;
        this.authService = authService;
    }
    /**
     * Retrieves an product interest list
     * @param pageSize page size
     * @param currentPage current page
     * @param sort sort
     */
    UserInterestsService.prototype.loadProductInterests = function (pageSize, currentPage, sort, productCode, notificationType) {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new LoadProductInterests({
                userId: userId,
                pageSize: pageSize,
                currentPage: currentPage,
                sort: sort,
                productCode: productCode,
                notificationType: notificationType,
            }));
        });
    };
    /**
     * Returns product interests
     */
    UserInterestsService.prototype.getProductInterests = function () {
        return this.store.pipe(select(getInterests));
    };
    /**
     * Returns product interests
     * @param pageSize the page size
     */
    UserInterestsService.prototype.getAndLoadProductInterests = function (pageSize) {
        var _this = this;
        return this.store.pipe(select(getInterestsState), tap(function (interestListState) {
            var attemptedLoad = interestListState.loading ||
                interestListState.success ||
                interestListState.error;
            if (!attemptedLoad) {
                _this.loadProductInterests(pageSize);
            }
        }), map(function (interestListState) { return interestListState.value; }));
    };
    /**
     * Returns a loading flag for product interests
     */
    UserInterestsService.prototype.getProdutInterestsLoading = function () {
        return this.store.pipe(select(getInterestsLoading));
    };
    /**
     * Removes a ProductInterestRelation
     * @param item product interest relation item
     * @param singleDelete flag to delete only one interest
     */
    UserInterestsService.prototype.removeProdutInterest = function (item, singleDelete) {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new RemoveProductInterest({
                userId: userId,
                item: item,
                singleDelete: singleDelete,
            }));
        });
    };
    /**
     * Returns a loading flag for removing product interests.
     */
    UserInterestsService.prototype.getRemoveProdutInterestLoading = function () {
        return this.store.pipe(select(getProcessLoadingFactory(REMOVE_PRODUCT_INTERESTS_PROCESS_ID)));
    };
    /**
     * Returns a success flag for removing a product interests.
     */
    UserInterestsService.prototype.getRemoveProdutInterestSuccess = function () {
        return this.store.pipe(select(getProcessSuccessFactory(REMOVE_PRODUCT_INTERESTS_PROCESS_ID)));
    };
    /**
     * Add a new product interest.
     *
     * @param productCode the product code
     * @param notificationType the notification type
     */
    UserInterestsService.prototype.addProductInterest = function (productCode, notificationType) {
        var _this = this;
        this.authService.invokeWithUserId(function (userId) {
            _this.store.dispatch(new AddProductInterest({
                userId: userId,
                productCode: productCode,
                notificationType: notificationType,
            }));
        });
    };
    /**
     * Returns a success flag for adding a product interest.
     */
    UserInterestsService.prototype.getAddProductInterestSuccess = function () {
        return this.store.pipe(select(getProcessSuccessFactory(ADD_PRODUCT_INTEREST_PROCESS_ID)));
    };
    /**
     * Returns a error flag for adding a product interest.
     */
    UserInterestsService.prototype.getAddProductInterestError = function () {
        return this.store.pipe(select(getProcessErrorFactory(ADD_PRODUCT_INTEREST_PROCESS_ID)));
    };
    /**
     * Reset product interest adding state.
     */
    UserInterestsService.prototype.resetAddInterestState = function () {
        this.store.dispatch(new ResetAddInterestState());
    };
    /**
     * Reset product interest removing state.
     */
    UserInterestsService.prototype.resetRemoveInterestState = function () {
        this.store.dispatch(new ResetRemoveInterestState());
    };
    /**
     * Clears product interests
     */
    UserInterestsService.prototype.clearProductInterests = function () {
        this.store.dispatch(new ClearProductInterests());
    };
    UserInterestsService.ctorParameters = function () { return [
        { type: Store },
        { type: AuthService }
    ]; };
    UserInterestsService.ɵprov = ɵɵdefineInjectable({ factory: function UserInterestsService_Factory() { return new UserInterestsService(ɵɵinject(Store), ɵɵinject(AuthService)); }, token: UserInterestsService, providedIn: "root" });
    UserInterestsService = __decorate([
        Injectable({
            providedIn: 'root',
        })
    ], UserInterestsService);
    return UserInterestsService;
}());

var initialState$k = {
    entities: {},
};
function reducer$k(state, action) {
    if (state === void 0) { state = initialState$k; }
    switch (action.type) {
        case LOAD_BILLING_COUNTRIES_SUCCESS: {
            var billingCountries = action.payload;
            var entities = billingCountries.reduce(function (countryEntities, name) {
                var _a;
                return __assign(__assign({}, countryEntities), (_a = {}, _a[name.isocode] = name, _a));
            }, __assign({}, state.entities));
            return __assign(__assign({}, state), { entities: entities });
        }
        case CLEAR_USER_MISCS_DATA: {
            return initialState$k;
        }
    }
    return state;
}

var initialState$l = {};
function reducer$l(state, action) {
    if (state === void 0) { state = initialState$l; }
    switch (action.type) {
        case LOAD_CONSIGNMENT_TRACKING_SUCCESS: {
            var tracking = action.payload;
            return {
                tracking: tracking,
            };
        }
        case CLEAR_CONSIGNMENT_TRACKING: {
            return initialState$l;
        }
    }
    return state;
}

var initialState$m = {
    entities: {},
};
function reducer$m(state, action) {
    if (state === void 0) { state = initialState$m; }
    switch (action.type) {
        case LOAD_DELIVERY_COUNTRIES_SUCCESS: {
            var deliveryCountries = action.payload;
            var entities = deliveryCountries.reduce(function (countryEntities, country) {
                var _a;
                return __assign(__assign({}, countryEntities), (_a = {}, _a[country.isocode] = country, _a));
            }, __assign({}, state.entities));
            return __assign(__assign({}, state), { entities: entities });
        }
        case CLEAR_USER_MISCS_DATA: {
            return initialState$m;
        }
    }
    return state;
}

var initialState$n = [];
function reducer$n(state, action) {
    if (state === void 0) { state = initialState$n; }
    switch (action.type) {
        case LOAD_NOTIFICATION_PREFERENCES_FAIL: {
            return initialState$n;
        }
        case LOAD_NOTIFICATION_PREFERENCES_SUCCESS:
        case UPDATE_NOTIFICATION_PREFERENCES_SUCCESS: {
            return action.payload ? action.payload : initialState$n;
        }
    }
    return state;
}

var initialState$o = {};
function reducer$o(state, action) {
    if (state === void 0) { state = initialState$o; }
    switch (action.type) {
        case LOAD_ORDER_DETAILS_SUCCESS: {
            var order = action.payload;
            return order;
        }
    }
    return state;
}

var initialState$p = [];
function reducer$p(state, action) {
    if (state === void 0) { state = initialState$p; }
    switch (action.type) {
        case LOAD_USER_PAYMENT_METHODS_SUCCESS: {
            return action.payload ? action.payload : initialState$p;
        }
        case LOAD_USER_PAYMENT_METHODS_FAIL: {
            return initialState$p;
        }
    }
    return state;
}

var initialState$q = {
    entities: [],
    country: null,
};
function reducer$q(state, action) {
    if (state === void 0) { state = initialState$q; }
    switch (action.type) {
        case LOAD_REGIONS_SUCCESS: {
            var entities = action.payload.entities;
            var country = action.payload.country;
            if (entities || country) {
                return __assign(__assign({}, state), { entities: entities,
                    country: country });
            }
            return initialState$q;
        }
    }
    return state;
}

var initialState$r = false;
function reducer$r(state, action) {
    if (state === void 0) { state = initialState$r; }
    switch (action.type) {
        case RESET_PASSWORD_SUCCESS: {
            return true;
        }
    }
    return state;
}

var initialState$s = {
    entities: {},
};
function reducer$s(state, action) {
    if (state === void 0) { state = initialState$s; }
    switch (action.type) {
        case LOAD_TITLES_SUCCESS: {
            var titles = action.payload;
            var entities = titles.reduce(function (titleEntities, name) {
                var _a;
                return __assign(__assign({}, titleEntities), (_a = {}, _a[name.code] = name, _a));
            }, __assign({}, state.entities));
            return __assign(__assign({}, state), { entities: entities });
        }
        case CLEAR_USER_MISCS_DATA: {
            return initialState$s;
        }
    }
    return state;
}

var initialState$t = [];
function reducer$t(state, action) {
    if (state === void 0) { state = initialState$t; }
    switch (action.type) {
        case LOAD_USER_ADDRESSES_FAIL: {
            return initialState$t;
        }
        case LOAD_USER_ADDRESSES_SUCCESS: {
            return action.payload ? action.payload : initialState$t;
        }
    }
    return state;
}

var initialState$u = [];
function reducer$u(state, action) {
    if (state === void 0) { state = initialState$u; }
    switch (action.type) {
        case LOAD_USER_CONSENTS_SUCCESS: {
            var consents = action.payload;
            return consents ? consents : initialState$u;
        }
        case GIVE_USER_CONSENT_SUCCESS: {
            var updatedConsentTemplate_1 = action.consentTemplate;
            return state.map(function (consentTemplate) {
                return consentTemplate.id === updatedConsentTemplate_1.id
                    ? updatedConsentTemplate_1
                    : consentTemplate;
            });
        }
    }
    return state;
}

var initialState$v = {};
function reducer$v(state, action) {
    if (state === void 0) { state = initialState$v; }
    switch (action.type) {
        case LOAD_USER_DETAILS_SUCCESS: {
            return action.payload;
        }
        case UPDATE_USER_DETAILS_SUCCESS: {
            var updatedDetails = __assign(__assign({}, state), action.userUpdates);
            return __assign(__assign({}, updatedDetails), { name: updatedDetails.firstName + " " + updatedDetails.lastName });
        }
    }
    return state;
}

var initialState$w = {
    orders: [],
    pagination: {},
    sorts: [],
};
function reducer$w(state, action) {
    if (state === void 0) { state = initialState$w; }
    switch (action.type) {
        case LOAD_USER_ORDERS_SUCCESS: {
            return action.payload ? action.payload : initialState$w;
        }
        case LOAD_USER_ORDERS_FAIL: {
            return initialState$w;
        }
    }
    return state;
}

var initialState$x = {
    coupons: [],
    sorts: [],
    pagination: {},
};
function reducer$x(state, action) {
    if (state === void 0) { state = initialState$x; }
    switch (action.type) {
        case LOAD_CUSTOMER_COUPONS_SUCCESS: {
            return action.payload;
        }
        case SUBSCRIBE_CUSTOMER_COUPON_SUCCESS: {
            var updatedCustomerCoupon_1 = action.payload.coupon;
            var customerCoupons_1 = new Array(state.coupons.length);
            state.coupons.forEach(function (customerCoupon, index) {
                return customerCoupon.couponId === updatedCustomerCoupon_1.couponId
                    ? (customerCoupons_1[index] = updatedCustomerCoupon_1)
                    : (customerCoupons_1[index] = customerCoupon);
            });
            return __assign(__assign({}, state), { coupons: customerCoupons_1 });
        }
        case UNSUBSCRIBE_CUSTOMER_COUPON_SUCCESS: {
            var updatedCouponCode_1 = action.payload;
            var customerCoupons_2 = new Array(state.coupons.length);
            state.coupons.forEach(function (customerCoupon, index) {
                return customerCoupon.couponId === updatedCouponCode_1
                    ? (customerCoupons_2[index] = __assign(__assign({}, customerCoupon), { notificationOn: false }))
                    : (customerCoupons_2[index] = customerCoupon);
            });
            return __assign(__assign({}, state), { coupons: customerCoupons_2 });
        }
    }
    return state;
}

var initialState$y = {
    results: [],
    pagination: {},
    sorts: [],
};
function reducer$y(state, action) {
    if (state === void 0) { state = initialState$y; }
    switch (action.type) {
        case LOAD_PRODUCT_INTERESTS_SUCCESS: {
            return action.payload ? action.payload : initialState$y;
        }
        case LOAD_PRODUCT_INTERESTS_FAIL: {
            return initialState$y;
        }
    }
    return state;
}

var initialState$z = {
    returnRequests: [],
    pagination: {},
    sorts: [],
};
function reducer$z(state, action) {
    if (state === void 0) { state = initialState$z; }
    switch (action.type) {
        case LOAD_ORDER_RETURN_REQUEST_LIST_SUCCESS: {
            return action.payload ? action.payload : initialState$z;
        }
    }
    return state;
}

function getReducers$c() {
    return {
        account: combineReducers({
            details: reducer$v,
        }),
        addresses: loaderReducer(USER_ADDRESSES, reducer$t),
        billingCountries: reducer$k,
        consents: loaderReducer(USER_CONSENTS, reducer$u),
        payments: loaderReducer(USER_PAYMENT_METHODS, reducer$p),
        orders: loaderReducer(USER_ORDERS, reducer$w),
        order: loaderReducer(USER_ORDER_DETAILS, reducer$o),
        orderReturn: loaderReducer(USER_RETURN_REQUEST_DETAILS),
        orderReturnList: loaderReducer(USER_RETURN_REQUESTS, reducer$z),
        countries: reducer$m,
        titles: reducer$s,
        regions: loaderReducer(REGIONS, reducer$q),
        resetPassword: reducer$r,
        consignmentTracking: reducer$l,
        customerCoupons: loaderReducer(CUSTOMER_COUPONS, reducer$x),
        notificationPreferences: loaderReducer(NOTIFICATION_PREFERENCES, reducer$n),
        productInterests: loaderReducer(PRODUCT_INTERESTS, reducer$y),
    };
}
var reducerToken$c = new InjectionToken('UserReducers');
var reducerProvider$c = {
    provide: reducerToken$c,
    useFactory: getReducers$c,
};
function clearUserState(reducer) {
    return function (state, action) {
        if (action.type === LOGOUT) {
            state = undefined;
        }
        return reducer(state, action);
    };
}
var metaReducers$7 = [clearUserState];

var BillingCountriesEffect = /** @class */ (function () {
    function BillingCountriesEffect(actions$, siteConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.siteConnector = siteConnector;
        this.loadBillingCountries$ = this.actions$.pipe(ofType(LOAD_BILLING_COUNTRIES), switchMap(function () {
            return _this.siteConnector.getCountries(CountryType.BILLING).pipe(map(function (countries) { return new LoadBillingCountriesSuccess(countries); }), catchError(function (error) {
                return of(new LoadBillingCountriesFail(makeErrorSerializable(error)));
            }));
        }));
    }
    BillingCountriesEffect.ctorParameters = function () { return [
        { type: Actions },
        { type: SiteConnector }
    ]; };
    __decorate([
        Effect()
    ], BillingCountriesEffect.prototype, "loadBillingCountries$", void 0);
    BillingCountriesEffect = __decorate([
        Injectable()
    ], BillingCountriesEffect);
    return BillingCountriesEffect;
}());

var ClearMiscsDataEffect = /** @class */ (function () {
    function ClearMiscsDataEffect(actions$) {
        this.actions$ = actions$;
        this.clearMiscsData$ = this.actions$.pipe(ofType(LANGUAGE_CHANGE, CURRENCY_CHANGE), map(function () {
            return new ClearUserMiscsData();
        }));
    }
    ClearMiscsDataEffect.ctorParameters = function () { return [
        { type: Actions }
    ]; };
    __decorate([
        Effect()
    ], ClearMiscsDataEffect.prototype, "clearMiscsData$", void 0);
    ClearMiscsDataEffect = __decorate([
        Injectable()
    ], ClearMiscsDataEffect);
    return ClearMiscsDataEffect;
}());

var ConsignmentTrackingEffects = /** @class */ (function () {
    function ConsignmentTrackingEffects(actions$, userOrderConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.userOrderConnector = userOrderConnector;
        this.loadConsignmentTracking$ = this.actions$.pipe(ofType(LOAD_CONSIGNMENT_TRACKING), map(function (action) { return action.payload; }), switchMap(function (payload) {
            return _this.userOrderConnector
                .getConsignmentTracking(payload.orderCode, payload.consignmentCode, payload.userId)
                .pipe(map(function (tracking) {
                return new LoadConsignmentTrackingSuccess(tracking);
            }), catchError(function (error) {
                return of(new LoadConsignmentTrackingFail(makeErrorSerializable(error)));
            }));
        }));
    }
    ConsignmentTrackingEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: UserOrderConnector }
    ]; };
    __decorate([
        Effect()
    ], ConsignmentTrackingEffects.prototype, "loadConsignmentTracking$", void 0);
    ConsignmentTrackingEffects = __decorate([
        Injectable()
    ], ConsignmentTrackingEffects);
    return ConsignmentTrackingEffects;
}());

var DeliveryCountriesEffects = /** @class */ (function () {
    function DeliveryCountriesEffects(actions$, siteConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.siteConnector = siteConnector;
        this.loadDeliveryCountries$ = this.actions$.pipe(ofType(LOAD_DELIVERY_COUNTRIES), switchMap(function () {
            return _this.siteConnector.getCountries(CountryType.SHIPPING).pipe(map(function (countries) { return new LoadDeliveryCountriesSuccess(countries); }), catchError(function (error) {
                return of(new LoadDeliveryCountriesFail(makeErrorSerializable(error)));
            }));
        }));
    }
    DeliveryCountriesEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: SiteConnector }
    ]; };
    __decorate([
        Effect()
    ], DeliveryCountriesEffects.prototype, "loadDeliveryCountries$", void 0);
    DeliveryCountriesEffects = __decorate([
        Injectable()
    ], DeliveryCountriesEffects);
    return DeliveryCountriesEffects;
}());

var ForgotPasswordEffects = /** @class */ (function () {
    function ForgotPasswordEffects(actions$, userAccountConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.userAccountConnector = userAccountConnector;
        this.requestForgotPasswordEmail$ = this.actions$.pipe(ofType(FORGOT_PASSWORD_EMAIL_REQUEST), map(function (action) {
            return action.payload;
        }), concatMap(function (userEmailAddress) {
            return _this.userAccountConnector
                .requestForgotPasswordEmail(userEmailAddress)
                .pipe(switchMap(function () { return [
                new ForgotPasswordEmailRequestSuccess(),
                new AddMessage({
                    text: { key: 'forgottenPassword.passwordResetEmailSent' },
                    type: GlobalMessageType.MSG_TYPE_CONFIRMATION,
                }),
            ]; }), catchError(function (error) {
                return of(new ForgotPasswordEmailRequestFail(makeErrorSerializable(error)));
            }));
        }));
    }
    ForgotPasswordEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: UserConnector }
    ]; };
    __decorate([
        Effect()
    ], ForgotPasswordEffects.prototype, "requestForgotPasswordEmail$", void 0);
    ForgotPasswordEffects = __decorate([
        Injectable()
    ], ForgotPasswordEffects);
    return ForgotPasswordEffects;
}());

var NotificationPreferenceEffects = /** @class */ (function () {
    function NotificationPreferenceEffects(actions$, connector) {
        var _this = this;
        this.actions$ = actions$;
        this.connector = connector;
        this.loadPreferences$ = this.actions$.pipe(ofType(LOAD_NOTIFICATION_PREFERENCES), map(function (action) { return action.payload; }), switchMap(function (payload) {
            return _this.connector.loadAll(payload).pipe(map(function (preferences) {
                return new LoadNotificationPreferencesSuccess(preferences);
            }), catchError(function (error) {
                return of(new LoadNotificationPreferencesFail(makeErrorSerializable(error)));
            }));
        }));
        this.updatePreferences$ = this.actions$.pipe(ofType(UPDATE_NOTIFICATION_PREFERENCES), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            return _this.connector.update(payload.userId, payload.preferences).pipe(map(function () {
                return new UpdateNotificationPreferencesSuccess(payload.preferences);
            }), catchError(function (error) {
                return of(new UpdateNotificationPreferencesFail(makeErrorSerializable(error)));
            }));
        }));
    }
    NotificationPreferenceEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: UserNotificationPreferenceConnector }
    ]; };
    __decorate([
        Effect()
    ], NotificationPreferenceEffects.prototype, "loadPreferences$", void 0);
    __decorate([
        Effect()
    ], NotificationPreferenceEffects.prototype, "updatePreferences$", void 0);
    NotificationPreferenceEffects = __decorate([
        Injectable()
    ], NotificationPreferenceEffects);
    return NotificationPreferenceEffects;
}());

var OrderDetailsEffect = /** @class */ (function () {
    function OrderDetailsEffect(actions$, orderConnector, globalMessageService) {
        var _this = this;
        this.actions$ = actions$;
        this.orderConnector = orderConnector;
        this.globalMessageService = globalMessageService;
        this.loadOrderDetails$ = this.actions$.pipe(ofType(LOAD_ORDER_DETAILS), map(function (action) { return action.payload; }), switchMap(function (payload) {
            return _this.orderConnector.get(payload.userId, payload.orderCode).pipe(map(function (order) {
                return new LoadOrderDetailsSuccess(order);
            }), catchError(function (error) {
                return of(new LoadOrderDetailsFail(makeErrorSerializable(error)));
            }));
        }));
        this.cancelOrder$ = this.actions$.pipe(ofType(CANCEL_ORDER), map(function (action) { return action.payload; }), switchMap(function (payload) {
            return _this.orderConnector
                .cancel(payload.userId, payload.orderCode, payload.cancelRequestInput)
                .pipe(map(function () { return new CancelOrderSuccess(); }), catchError(function (error) {
                var _a;
                (_a = error.error) === null || _a === void 0 ? void 0 : _a.errors.forEach(function (err) {
                    return _this.globalMessageService.add(err.message, GlobalMessageType.MSG_TYPE_ERROR);
                });
                return of(new CancelOrderFail(makeErrorSerializable(error)));
            }));
        }));
    }
    OrderDetailsEffect.ctorParameters = function () { return [
        { type: Actions },
        { type: UserOrderConnector },
        { type: GlobalMessageService }
    ]; };
    __decorate([
        Effect()
    ], OrderDetailsEffect.prototype, "loadOrderDetails$", void 0);
    __decorate([
        Effect()
    ], OrderDetailsEffect.prototype, "cancelOrder$", void 0);
    OrderDetailsEffect = __decorate([
        Injectable()
    ], OrderDetailsEffect);
    return OrderDetailsEffect;
}());

var OrderReturnRequestEffect = /** @class */ (function () {
    function OrderReturnRequestEffect(actions$, orderConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.orderConnector = orderConnector;
        this.createReturnRequest$ = this.actions$.pipe(ofType(CREATE_ORDER_RETURN_REQUEST), map(function (action) { return action.payload; }), switchMap(function (payload) {
            return _this.orderConnector
                .return(payload.userId, payload.returnRequestInput)
                .pipe(map(function (returnRequest) {
                return new CreateOrderReturnRequestSuccess(returnRequest);
            }), catchError(function (error) {
                return of(new CreateOrderReturnRequestFail(makeErrorSerializable(error)));
            }));
        }));
        this.loadReturnRequest$ = this.actions$.pipe(ofType(LOAD_ORDER_RETURN_REQUEST), map(function (action) { return action.payload; }), switchMap(function (payload) {
            return _this.orderConnector
                .getReturnRequestDetail(payload.userId, payload.returnRequestCode)
                .pipe(map(function (returnRequest) {
                return new LoadOrderReturnRequestSuccess(returnRequest);
            }), catchError(function (error) {
                return of(new LoadOrderReturnRequestFail(makeErrorSerializable(error)));
            }));
        }));
        this.cancelReturnRequest$ = this.actions$.pipe(ofType(CANCEL_ORDER_RETURN_REQUEST), map(function (action) { return action.payload; }), switchMap(function (payload) {
            return _this.orderConnector
                .cancelReturnRequest(payload.userId, payload.returnRequestCode, payload.returnRequestModification)
                .pipe(map(function () { return new CancelOrderReturnRequestSuccess(); }), catchError(function (error) {
                return of(new CancelOrderReturnRequestFail(makeErrorSerializable(error)));
            }));
        }));
        this.loadReturnRequestList$ = this.actions$.pipe(ofType(LOAD_ORDER_RETURN_REQUEST_LIST), map(function (action) { return action.payload; }), switchMap(function (payload) {
            return _this.orderConnector
                .getReturnRequestList(payload.userId, payload.pageSize, payload.currentPage, payload.sort)
                .pipe(map(function (returnRequestList) {
                return new LoadOrderReturnRequestListSuccess(returnRequestList);
            }), catchError(function (error) {
                return of(new LoadOrderReturnRequestListFail(makeErrorSerializable(error)));
            }));
        }));
    }
    OrderReturnRequestEffect.ctorParameters = function () { return [
        { type: Actions },
        { type: UserOrderConnector }
    ]; };
    __decorate([
        Effect()
    ], OrderReturnRequestEffect.prototype, "createReturnRequest$", void 0);
    __decorate([
        Effect()
    ], OrderReturnRequestEffect.prototype, "loadReturnRequest$", void 0);
    __decorate([
        Effect()
    ], OrderReturnRequestEffect.prototype, "cancelReturnRequest$", void 0);
    __decorate([
        Effect()
    ], OrderReturnRequestEffect.prototype, "loadReturnRequestList$", void 0);
    OrderReturnRequestEffect = __decorate([
        Injectable()
    ], OrderReturnRequestEffect);
    return OrderReturnRequestEffect;
}());

var UserPaymentMethodsEffects = /** @class */ (function () {
    function UserPaymentMethodsEffects(actions$, userPaymentMethodConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.userPaymentMethodConnector = userPaymentMethodConnector;
        this.loadUserPaymentMethods$ = this.actions$.pipe(ofType(LOAD_USER_PAYMENT_METHODS), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            return _this.userPaymentMethodConnector.getAll(payload).pipe(map(function (payments) {
                return new LoadUserPaymentMethodsSuccess(payments);
            }), catchError(function (error) {
                return of(new LoadUserPaymentMethodsFail(makeErrorSerializable(error)));
            }));
        }));
        this.setDefaultUserPaymentMethod$ = this.actions$.pipe(ofType(SET_DEFAULT_USER_PAYMENT_METHOD), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            return _this.userPaymentMethodConnector
                .setDefault(payload.userId, payload.paymentMethodId)
                .pipe(switchMap(function (data) { return [
                new SetDefaultUserPaymentMethodSuccess(data),
                new LoadUserPaymentMethods(payload.userId),
            ]; }), catchError(function (error) {
                return of(new SetDefaultUserPaymentMethodFail(makeErrorSerializable(error)));
            }));
        }));
        this.deleteUserPaymentMethod$ = this.actions$.pipe(ofType(DELETE_USER_PAYMENT_METHOD), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            return _this.userPaymentMethodConnector
                .delete(payload.userId, payload.paymentMethodId)
                .pipe(switchMap(function (data) { return [
                new DeleteUserPaymentMethodSuccess(data),
                new LoadUserPaymentMethods(payload.userId),
            ]; }), catchError(function (error) {
                return of(new DeleteUserPaymentMethodFail(makeErrorSerializable(error)));
            }));
        }));
    }
    UserPaymentMethodsEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: UserPaymentConnector }
    ]; };
    __decorate([
        Effect()
    ], UserPaymentMethodsEffects.prototype, "loadUserPaymentMethods$", void 0);
    __decorate([
        Effect()
    ], UserPaymentMethodsEffects.prototype, "setDefaultUserPaymentMethod$", void 0);
    __decorate([
        Effect()
    ], UserPaymentMethodsEffects.prototype, "deleteUserPaymentMethod$", void 0);
    UserPaymentMethodsEffects = __decorate([
        Injectable()
    ], UserPaymentMethodsEffects);
    return UserPaymentMethodsEffects;
}());

var RegionsEffects = /** @class */ (function () {
    function RegionsEffects(actions$, siteConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.siteConnector = siteConnector;
        this.loadRegions$ = this.actions$.pipe(ofType(LOAD_REGIONS), map(function (action) {
            return action.payload;
        }), switchMap(function (countryCode) {
            return _this.siteConnector.getRegions(countryCode).pipe(map(function (regions) {
                return new LoadRegionsSuccess({
                    entities: regions,
                    country: countryCode,
                });
            }), catchError(function (error) {
                return of(new LoadRegionsFail(makeErrorSerializable(error)));
            }));
        }));
        this.resetRegions$ = this.actions$.pipe(ofType(CLEAR_USER_MISCS_DATA, CLEAR_REGIONS), map(function () {
            return new LoaderResetAction(REGIONS);
        }));
    }
    RegionsEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: SiteConnector }
    ]; };
    __decorate([
        Effect()
    ], RegionsEffects.prototype, "loadRegions$", void 0);
    __decorate([
        Effect()
    ], RegionsEffects.prototype, "resetRegions$", void 0);
    RegionsEffects = __decorate([
        Injectable()
    ], RegionsEffects);
    return RegionsEffects;
}());

var ResetPasswordEffects = /** @class */ (function () {
    function ResetPasswordEffects(actions$, userAccountConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.userAccountConnector = userAccountConnector;
        this.resetPassword$ = this.actions$.pipe(ofType(RESET_PASSWORD), map(function (action) { return action.payload; }), switchMap(function (_a) {
            var token = _a.token, password = _a.password;
            return _this.userAccountConnector.resetPassword(token, password).pipe(switchMap(function () { return [
                new ResetPasswordSuccess(),
                new AddMessage({
                    text: { key: 'forgottenPassword.passwordResetSuccess' },
                    type: GlobalMessageType.MSG_TYPE_CONFIRMATION,
                }),
            ]; }), catchError(function (error) {
                var _a;
                var actions = [new ResetPasswordFail(makeErrorSerializable(error))];
                if ((_a = error === null || error === void 0 ? void 0 : error.error) === null || _a === void 0 ? void 0 : _a.errors) {
                    error.error.errors.forEach(function (err) {
                        if (err.message) {
                            actions.push(new AddMessage({
                                text: { raw: err.message },
                                type: GlobalMessageType.MSG_TYPE_ERROR,
                            }));
                        }
                    });
                }
                return from(actions);
            }));
        }));
    }
    ResetPasswordEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: UserConnector }
    ]; };
    __decorate([
        Effect()
    ], ResetPasswordEffects.prototype, "resetPassword$", void 0);
    ResetPasswordEffects = __decorate([
        Injectable()
    ], ResetPasswordEffects);
    return ResetPasswordEffects;
}());

var TitlesEffects = /** @class */ (function () {
    function TitlesEffects(actions$, userAccountConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.userAccountConnector = userAccountConnector;
        this.loadTitles$ = this.actions$.pipe(ofType(LOAD_TITLES), switchMap(function () {
            return _this.userAccountConnector.getTitles().pipe(map(function (titles) {
                return new LoadTitlesSuccess(titles);
            }), catchError(function (error) {
                return of(new LoadTitlesFail(makeErrorSerializable(error)));
            }));
        }));
    }
    TitlesEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: UserConnector }
    ]; };
    __decorate([
        Effect()
    ], TitlesEffects.prototype, "loadTitles$", void 0);
    TitlesEffects = __decorate([
        Injectable()
    ], TitlesEffects);
    return TitlesEffects;
}());

var UpdateEmailEffects = /** @class */ (function () {
    function UpdateEmailEffects(actions$, userAccountConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.userAccountConnector = userAccountConnector;
        this.updateEmail$ = this.actions$.pipe(ofType(UPDATE_EMAIL), map(function (action) { return action.payload; }), concatMap(function (payload) {
            return _this.userAccountConnector
                .updateEmail(payload.uid, payload.password, payload.newUid)
                .pipe(map(function () { return new UpdateEmailSuccessAction(payload.newUid); }), catchError(function (error) {
                return of(new UpdateEmailErrorAction(makeErrorSerializable(error)));
            }));
        }));
    }
    UpdateEmailEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: UserConnector }
    ]; };
    __decorate([
        Effect()
    ], UpdateEmailEffects.prototype, "updateEmail$", void 0);
    UpdateEmailEffects = __decorate([
        Injectable()
    ], UpdateEmailEffects);
    return UpdateEmailEffects;
}());

var UpdatePasswordEffects = /** @class */ (function () {
    function UpdatePasswordEffects(actions$, userAccountConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.userAccountConnector = userAccountConnector;
        this.updatePassword$ = this.actions$.pipe(ofType(UPDATE_PASSWORD), map(function (action) { return action.payload; }), concatMap(function (payload) {
            return _this.userAccountConnector
                .updatePassword(payload.userId, payload.oldPassword, payload.newPassword)
                .pipe(map(function () { return new UpdatePasswordSuccess(); }), catchError(function (error) {
                return of(new UpdatePasswordFail(makeErrorSerializable(error)));
            }));
        }));
    }
    UpdatePasswordEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: UserConnector }
    ]; };
    __decorate([
        Effect()
    ], UpdatePasswordEffects.prototype, "updatePassword$", void 0);
    UpdatePasswordEffects = __decorate([
        Injectable()
    ], UpdatePasswordEffects);
    return UpdatePasswordEffects;
}());

var UserAddressesEffects = /** @class */ (function () {
    function UserAddressesEffects(actions$, userAddressConnector, userAddressService, messageService) {
        var _this = this;
        this.actions$ = actions$;
        this.userAddressConnector = userAddressConnector;
        this.userAddressService = userAddressService;
        this.messageService = messageService;
        this.loadUserAddresses$ = this.actions$.pipe(ofType(LOAD_USER_ADDRESSES), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            return _this.userAddressConnector.getAll(payload).pipe(map(function (addresses) {
                return new LoadUserAddressesSuccess(addresses);
            }), catchError(function (error) {
                return of(new LoadUserAddressesFail(makeErrorSerializable(error)));
            }));
        }));
        this.addUserAddress$ = this.actions$.pipe(ofType(ADD_USER_ADDRESS), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            return _this.userAddressConnector
                .add(payload.userId, payload.address)
                .pipe(map(function (data) {
                return new AddUserAddressSuccess(data);
            }), catchError(function (error) {
                return of(new AddUserAddressFail(makeErrorSerializable(error)));
            }));
        }));
        this.updateUserAddress$ = this.actions$.pipe(ofType(UPDATE_USER_ADDRESS), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            return _this.userAddressConnector
                .update(payload.userId, payload.addressId, payload.address)
                .pipe(map(function (data) {
                // don't show the message if just setting address as default
                if (payload.address &&
                    Object.keys(payload.address).length === 1 &&
                    payload.address.defaultAddress) {
                    return new LoadUserAddresses(payload.userId);
                }
                else {
                    return new UpdateUserAddressSuccess(data);
                }
            }), catchError(function (error) {
                return of(new UpdateUserAddressFail(makeErrorSerializable(error)));
            }));
        }));
        this.deleteUserAddress$ = this.actions$.pipe(ofType(DELETE_USER_ADDRESS), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            return _this.userAddressConnector
                .delete(payload.userId, payload.addressId)
                .pipe(map(function (data) {
                return new DeleteUserAddressSuccess(data);
            }), catchError(function (error) {
                return of(new DeleteUserAddressFail(makeErrorSerializable(error)));
            }));
        }));
        /**
         *  Reload addresses and notify about add success
         */
        this.showGlobalMessageOnAddSuccess$ = this.actions$.pipe(ofType(ADD_USER_ADDRESS_SUCCESS), tap(function () {
            _this.loadAddresses();
            _this.showGlobalMessage('addressForm.userAddressAddSuccess');
        }));
        /**
         *  Reload addresses and notify about update success
         */
        this.showGlobalMessageOnUpdateSuccess$ = this.actions$.pipe(ofType(UPDATE_USER_ADDRESS_SUCCESS), tap(function () {
            _this.loadAddresses();
            _this.showGlobalMessage('addressForm.userAddressUpdateSuccess');
        }));
        /**
         *  Reload addresses and notify about delete success
         */
        this.showGlobalMessageOnDeleteSuccess$ = this.actions$.pipe(ofType(DELETE_USER_ADDRESS_SUCCESS), tap(function () {
            _this.loadAddresses();
            _this.showGlobalMessage('addressForm.userAddressDeleteSuccess');
        }));
    }
    /**
     * Show global confirmation message with provided text
     */
    UserAddressesEffects.prototype.showGlobalMessage = function (text) {
        this.messageService.add({ key: text }, GlobalMessageType.MSG_TYPE_CONFIRMATION);
    };
    UserAddressesEffects.prototype.loadAddresses = function () {
        this.userAddressService.loadAddresses();
    };
    UserAddressesEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: UserAddressConnector },
        { type: UserAddressService },
        { type: GlobalMessageService }
    ]; };
    __decorate([
        Effect()
    ], UserAddressesEffects.prototype, "loadUserAddresses$", void 0);
    __decorate([
        Effect()
    ], UserAddressesEffects.prototype, "addUserAddress$", void 0);
    __decorate([
        Effect()
    ], UserAddressesEffects.prototype, "updateUserAddress$", void 0);
    __decorate([
        Effect()
    ], UserAddressesEffects.prototype, "deleteUserAddress$", void 0);
    __decorate([
        Effect({ dispatch: false })
    ], UserAddressesEffects.prototype, "showGlobalMessageOnAddSuccess$", void 0);
    __decorate([
        Effect({ dispatch: false })
    ], UserAddressesEffects.prototype, "showGlobalMessageOnUpdateSuccess$", void 0);
    __decorate([
        Effect({ dispatch: false })
    ], UserAddressesEffects.prototype, "showGlobalMessageOnDeleteSuccess$", void 0);
    UserAddressesEffects = __decorate([
        Injectable()
    ], UserAddressesEffects);
    return UserAddressesEffects;
}());

var UserConsentsEffect = /** @class */ (function () {
    function UserConsentsEffect(actions$, userConsentConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.userConsentConnector = userConsentConnector;
        this.resetConsents$ = this.actions$.pipe(ofType(LANGUAGE_CHANGE), map(function () { return new ResetLoadUserConsents(); }));
        this.getConsents$ = this.actions$.pipe(ofType(LOAD_USER_CONSENTS), map(function (action) { return action.payload; }), concatMap(function (userId) {
            return _this.userConsentConnector.loadConsents(userId).pipe(map(function (consents) { return new LoadUserConsentsSuccess(consents); }), catchError(function (error) {
                return of(new LoadUserConsentsFail(makeErrorSerializable(error)));
            }));
        }));
        this.giveConsent$ = this.actions$.pipe(ofType(GIVE_USER_CONSENT, TRANSFER_ANONYMOUS_CONSENT), concatMap(function (action) {
            return _this.userConsentConnector
                .giveConsent(action.payload.userId, action.payload.consentTemplateId, action.payload.consentTemplateVersion)
                .pipe(map(function (consent) { return new GiveUserConsentSuccess(consent); }), catchError(function (error) {
                var errors = [
                    new GiveUserConsentFail(makeErrorSerializable(error)),
                ];
                if (action.type === TRANSFER_ANONYMOUS_CONSENT &&
                    error.status === 409) {
                    errors.push(new RemoveMessagesByType(GlobalMessageType.MSG_TYPE_ERROR));
                }
                return of.apply(void 0, __spread(errors));
            }));
        }));
        this.withdrawConsent$ = this.actions$.pipe(ofType(WITHDRAW_USER_CONSENT), map(function (action) { return action.payload; }), concatMap(function (_a) {
            var userId = _a.userId, consentCode = _a.consentCode;
            return _this.userConsentConnector.withdrawConsent(userId, consentCode).pipe(map(function () { return new WithdrawUserConsentSuccess(); }), catchError(function (error) {
                return of(new WithdrawUserConsentFail(makeErrorSerializable(error)));
            }));
        }));
    }
    UserConsentsEffect.ctorParameters = function () { return [
        { type: Actions },
        { type: UserConsentConnector }
    ]; };
    __decorate([
        Effect()
    ], UserConsentsEffect.prototype, "resetConsents$", void 0);
    __decorate([
        Effect()
    ], UserConsentsEffect.prototype, "getConsents$", void 0);
    __decorate([
        Effect()
    ], UserConsentsEffect.prototype, "giveConsent$", void 0);
    __decorate([
        Effect()
    ], UserConsentsEffect.prototype, "withdrawConsent$", void 0);
    UserConsentsEffect = __decorate([
        Injectable()
    ], UserConsentsEffect);
    return UserConsentsEffect;
}());

var UserDetailsEffects = /** @class */ (function () {
    function UserDetailsEffects(actions$, userConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.userConnector = userConnector;
        this.loadUserDetails$ = this.actions$.pipe(ofType(LOAD_USER_DETAILS), map(function (action) { return action.payload; }), mergeMap(function (userId) {
            return _this.userConnector.get(userId).pipe(map(function (user) {
                return new LoadUserDetailsSuccess(user);
            }), catchError(function (error) {
                return of(new LoadUserDetailsFail(makeErrorSerializable(error)));
            }));
        }));
        this.updateUserDetails$ = this.actions$.pipe(ofType(UPDATE_USER_DETAILS), map(function (action) { return action.payload; }), concatMap(function (payload) {
            return _this.userConnector.update(payload.username, payload.userDetails).pipe(map(function () { return new UpdateUserDetailsSuccess(payload.userDetails); }), catchError(function (error) {
                return of(new UpdateUserDetailsFail(makeErrorSerializable(error)));
            }));
        }));
    }
    UserDetailsEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: UserConnector }
    ]; };
    __decorate([
        Effect()
    ], UserDetailsEffects.prototype, "loadUserDetails$", void 0);
    __decorate([
        Effect()
    ], UserDetailsEffects.prototype, "updateUserDetails$", void 0);
    UserDetailsEffects = __decorate([
        Injectable()
    ], UserDetailsEffects);
    return UserDetailsEffects;
}());

var UserOrdersEffect = /** @class */ (function () {
    function UserOrdersEffect(actions$, orderConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.orderConnector = orderConnector;
        this.loadUserOrders$ = this.actions$.pipe(ofType(LOAD_USER_ORDERS), map(function (action) { return action.payload; }), switchMap(function (payload) {
            return _this.orderConnector
                .getHistory(payload.userId, payload.pageSize, payload.currentPage, payload.sort)
                .pipe(map(function (orders) {
                return new LoadUserOrdersSuccess(orders);
            }), catchError(function (error) {
                return of(new LoadUserOrdersFail(makeErrorSerializable(error)));
            }));
        }));
        this.resetUserOrders$ = this.actions$.pipe(ofType(LANGUAGE_CHANGE), map(function () {
            return new ClearUserOrders();
        }));
    }
    UserOrdersEffect.ctorParameters = function () { return [
        { type: Actions },
        { type: UserOrderConnector }
    ]; };
    __decorate([
        Effect()
    ], UserOrdersEffect.prototype, "loadUserOrders$", void 0);
    __decorate([
        Effect()
    ], UserOrdersEffect.prototype, "resetUserOrders$", void 0);
    UserOrdersEffect = __decorate([
        Injectable()
    ], UserOrdersEffect);
    return UserOrdersEffect;
}());

var UserRegisterEffects = /** @class */ (function () {
    function UserRegisterEffects(actions$, userConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.userConnector = userConnector;
        this.registerUser$ = this.actions$.pipe(ofType(REGISTER_USER), map(function (action) { return action.payload; }), mergeMap(function (user) {
            return _this.userConnector.register(user).pipe(map(function () { return new RegisterUserSuccess(); }), catchError(function (error) {
                return of(new RegisterUserFail(makeErrorSerializable(error)));
            }));
        }));
        this.registerGuest$ = this.actions$.pipe(ofType(REGISTER_GUEST), map(function (action) { return action.payload; }), mergeMap(function (_a) {
            var guid = _a.guid, password = _a.password;
            return _this.userConnector.registerGuest(guid, password).pipe(switchMap(function (user) { return [
                new LoadUserToken({
                    userId: user.uid,
                    password: password,
                }),
                new RegisterGuestSuccess(),
            ]; }), catchError(function (error) {
                return of(new RegisterGuestFail(makeErrorSerializable(error)));
            }));
        }));
        this.removeUser$ = this.actions$.pipe(ofType(REMOVE_USER), map(function (action) { return action.payload; }), mergeMap(function (userId) {
            return _this.userConnector.remove(userId).pipe(switchMap(function () { return [
                new RemoveUserSuccess(),
                new Logout(),
            ]; }), catchError(function (error) {
                return of(new RemoveUserFail(makeErrorSerializable(error)));
            }));
        }));
    }
    UserRegisterEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: UserConnector }
    ]; };
    __decorate([
        Effect()
    ], UserRegisterEffects.prototype, "registerUser$", void 0);
    __decorate([
        Effect()
    ], UserRegisterEffects.prototype, "registerGuest$", void 0);
    __decorate([
        Effect()
    ], UserRegisterEffects.prototype, "removeUser$", void 0);
    UserRegisterEffects = __decorate([
        Injectable()
    ], UserRegisterEffects);
    return UserRegisterEffects;
}());

var CustomerCouponEffects = /** @class */ (function () {
    function CustomerCouponEffects(actions$, customerCouponConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.customerCouponConnector = customerCouponConnector;
        this.loadCustomerCoupons$ = this.actions$.pipe(ofType(LOAD_CUSTOMER_COUPONS), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            return _this.customerCouponConnector
                .getCustomerCoupons(payload.userId, payload.pageSize, payload.currentPage, payload.sort)
                .pipe(map(function (coupons) {
                return new LoadCustomerCouponsSuccess(coupons);
            }), catchError(function (error) {
                return of(new LoadCustomerCouponsFail(makeErrorSerializable(error)));
            }));
        }));
        this.subscribeCustomerCoupon$ = this.actions$.pipe(ofType(SUBSCRIBE_CUSTOMER_COUPON), map(function (action) {
            return action.payload;
        }), mergeMap(function (payload) {
            return _this.customerCouponConnector
                .turnOnNotification(payload.userId, payload.couponCode)
                .pipe(map(function (data) {
                return new SubscribeCustomerCouponSuccess(data);
            }), catchError(function (error) {
                return of(new SubscribeCustomerCouponFail(makeErrorSerializable(error)));
            }));
        }));
        this.unsubscribeCustomerCoupon$ = this.actions$.pipe(ofType(UNSUBSCRIBE_CUSTOMER_COUPON), map(function (action) {
            return action.payload;
        }), mergeMap(function (payload) {
            return _this.customerCouponConnector
                .turnOffNotification(payload.userId, payload.couponCode)
                .pipe(map(function () {
                return new UnsubscribeCustomerCouponSuccess(payload.couponCode);
            }), catchError(function (error) {
                return of(new UnsubscribeCustomerCouponFail(makeErrorSerializable(error)));
            }));
        }));
        this.claimCustomerCoupon$ = this.actions$.pipe(ofType(CLAIM_CUSTOMER_COUPON), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            return _this.customerCouponConnector
                .claimCustomerCoupon(payload.userId, payload.couponCode)
                .pipe(map(function (data) {
                return new ClaimCustomerCouponSuccess(data);
            }), catchError(function (error) {
                return of(new ClaimCustomerCouponFail(makeErrorSerializable(error)));
            }));
        }));
    }
    CustomerCouponEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: CustomerCouponConnector }
    ]; };
    __decorate([
        Effect()
    ], CustomerCouponEffects.prototype, "loadCustomerCoupons$", void 0);
    __decorate([
        Effect()
    ], CustomerCouponEffects.prototype, "subscribeCustomerCoupon$", void 0);
    __decorate([
        Effect()
    ], CustomerCouponEffects.prototype, "unsubscribeCustomerCoupon$", void 0);
    __decorate([
        Effect()
    ], CustomerCouponEffects.prototype, "claimCustomerCoupon$", void 0);
    CustomerCouponEffects = __decorate([
        Injectable()
    ], CustomerCouponEffects);
    return CustomerCouponEffects;
}());

var ProductInterestsEffect = /** @class */ (function () {
    function ProductInterestsEffect(actions$, userInterestsConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.userInterestsConnector = userInterestsConnector;
        this.loadProductInteres$ = this.actions$.pipe(ofType(LOAD_PRODUCT_INTERESTS), map(function (action) { return action.payload; }), switchMap(function (payload) {
            return _this.userInterestsConnector
                .getInterests(payload.userId, payload.pageSize, payload.currentPage, payload.sort, payload.productCode, payload.notificationType)
                .pipe(map(function (interests) {
                return new LoadProductInterestsSuccess(interests);
            }), catchError(function (error) {
                return of(new LoadProductInterestsFail(makeErrorSerializable(error)));
            }));
        }));
        this.removeProductInterest$ = this.actions$.pipe(ofType(REMOVE_PRODUCT_INTEREST), map(function (action) { return action.payload; }), switchMap(function (payload) {
            return _this.userInterestsConnector
                .removeInterest(payload.userId, payload.item)
                .pipe(switchMap(function (data) { return [
                new LoadProductInterests(payload.singleDelete
                    ? {
                        userId: payload.userId,
                        productCode: payload.item.product.code,
                        notificationType: payload.item.productInterestEntry[0].interestType,
                    }
                    : { userId: payload.userId }),
                new RemoveProductInterestSuccess(data),
            ]; }), catchError(function (error) {
                return of(new RemoveProductInterestFail(makeErrorSerializable(error)));
            }));
        }));
        this.addProductInterest$ = this.actions$.pipe(ofType(ADD_PRODUCT_INTEREST), map(function (action) { return action.payload; }), switchMap(function (payload) {
            return _this.userInterestsConnector
                .addInterest(payload.userId, payload.productCode, payload.notificationType)
                .pipe(switchMap(function (res) { return [
                new LoadProductInterests({
                    userId: payload.userId,
                    productCode: payload.productCode,
                    notificationType: payload.notificationType,
                }),
                new AddProductInterestSuccess(res),
            ]; }), catchError(function (error) {
                return of(new AddProductInterestFail(makeErrorSerializable(error)));
            }));
        }));
    }
    ProductInterestsEffect.ctorParameters = function () { return [
        { type: Actions },
        { type: UserInterestsConnector }
    ]; };
    __decorate([
        Effect()
    ], ProductInterestsEffect.prototype, "loadProductInteres$", void 0);
    __decorate([
        Effect()
    ], ProductInterestsEffect.prototype, "removeProductInterest$", void 0);
    __decorate([
        Effect()
    ], ProductInterestsEffect.prototype, "addProductInterest$", void 0);
    ProductInterestsEffect = __decorate([
        Injectable()
    ], ProductInterestsEffect);
    return ProductInterestsEffect;
}());

var effects$b = [
    ClearMiscsDataEffect,
    DeliveryCountriesEffects,
    RegionsEffects,
    TitlesEffects,
    UserDetailsEffects,
    UserAddressesEffects,
    UserPaymentMethodsEffects,
    UserRegisterEffects,
    UserOrdersEffect,
    OrderDetailsEffect,
    BillingCountriesEffect,
    ResetPasswordEffects,
    ForgotPasswordEffects,
    UpdateEmailEffects,
    UpdatePasswordEffects,
    UserConsentsEffect,
    ConsignmentTrackingEffects,
    CustomerCouponEffects,
    NotificationPreferenceEffects,
    ProductInterestsEffect,
    OrderReturnRequestEffect,
];

var UserStoreModule = /** @class */ (function () {
    function UserStoreModule() {
    }
    UserStoreModule = __decorate([
        NgModule({
            imports: [
                CommonModule,
                StateModule,
                StoreModule.forFeature(USER_FEATURE, reducerToken$c, { metaReducers: metaReducers$7 }),
                EffectsModule.forFeature(effects$b),
                RouterModule,
            ],
            providers: [reducerProvider$c],
        })
    ], UserStoreModule);
    return UserStoreModule;
}());

var UserModule = /** @class */ (function () {
    function UserModule() {
    }
    UserModule_1 = UserModule;
    UserModule.forRoot = function () {
        return {
            ngModule: UserModule_1,
        };
    };
    var UserModule_1;
    UserModule = UserModule_1 = __decorate([
        NgModule({
            imports: [UserStoreModule],
        })
    ], UserModule);
    return UserModule;
}());

/*
 * Public API Surface of core
 */

/**
 * Generated bundle index. Do not edit.
 */

export { ADDRESS_NORMALIZER, ADDRESS_SERIALIZER, ADDRESS_VALIDATION_NORMALIZER, ADD_PRODUCT_INTEREST_PROCESS_ID, ADD_VOUCHER_PROCESS_ID, ANONYMOUS_CONSENTS, ANONYMOUS_CONSENTS_STORE_FEATURE, ANONYMOUS_CONSENT_STATUS, ASM_FEATURE, AUTH_FEATURE, ActiveCartService, AnonymousConsentTemplatesAdapter, AnonymousConsentTemplatesConnector, anonymousConsentsGroup as AnonymousConsentsActions, AnonymousConsentsConfig, AnonymousConsentsModule, anonymousConsentsGroup_selectors as AnonymousConsentsSelectors, AnonymousConsentsService, customerGroup_actions as AsmActions, AsmAdapter, AsmAuthService, AsmConfig, AsmConnector, AsmModule, AsmOccModule, asmGroup_selectors as AsmSelectors, AsmService, authGroup_actions as AuthActions, AuthConfig, AuthGuard, AuthModule, AuthRedirectService, authGroup_selectors as AuthSelectors, AuthService, BASE_SITE_CONTEXT_ID, BadGatewayHandler, BadRequestHandler, BaseSiteService, CANCEL_ORDER_PROCESS_ID, CANCEL_RETURN_PROCESS_ID, CARD_TYPE_NORMALIZER, CART_MODIFICATION_NORMALIZER, CART_NORMALIZER, CART_VOUCHER_NORMALIZER, CHECKOUT_DETAILS, CHECKOUT_FEATURE, CLAIM_CUSTOMER_COUPON_PROCESS_ID, CLIENT_TOKEN_DATA, CMS_COMPONENT_NORMALIZER, CMS_FEATURE, CMS_FLEX_COMPONENT_TYPE, CMS_PAGE_NORMALIZER, COMPONENT_ENTITY, CONFIG_INITIALIZER, CONSENT_TEMPLATE_NORMALIZER, CONSIGNMENT_TRACKING_NORMALIZER, COUNTRY_NORMALIZER, CSAGENT_TOKEN_DATA, CURRENCY_CONTEXT_ID, CURRENCY_NORMALIZER, CUSTOMER_COUPONS, CUSTOMER_COUPON_SEARCH_RESULT_NORMALIZER, CUSTOMER_SEARCH_DATA, CUSTOMER_SEARCH_PAGE_NORMALIZER, cartGroup_actions as CartActions, CartAdapter, CartAddEntryEvent, CartAddEntryFailEvent, CartAddEntrySuccessEvent, CartConfig, CartConfigService, CartConnector, CartEntryAdapter, CartEntryConnector, CartEventBuilder, CartEventModule, CartModule, CartOccModule, CartVoucherAdapter, CartVoucherConnector, CartVoucherService, CategoryPageMetaResolver, checkoutGroup_actions as CheckoutActions, CheckoutAdapter, CheckoutConnector, CheckoutDeliveryAdapter, CheckoutDeliveryConnector, CheckoutDeliveryService, CheckoutModule, CheckoutOccModule, CheckoutPageMetaResolver, CheckoutPaymentAdapter, CheckoutPaymentConnector, CheckoutPaymentService, checkoutGroup_selectors as CheckoutSelectors, CheckoutService, cmsGroup_actions as CmsActions, CmsBannerCarouselEffect, CmsComponentAdapter, CmsComponentConnector, CmsConfig, CmsModule, CmsOccModule, CmsPageAdapter, CmsPageConnector, CmsPageTitleModule, cmsGroup_selectors as CmsSelectors, CmsService, CmsStructureConfig, CmsStructureConfigService, Config, ConfigChunk, ConfigInitializerModule, ConfigInitializerService, ConfigModule, ConfigValidatorModule, ConfigValidatorToken, ConfigurableRoutesService, ConflictHandler, ConsentService, ContentPageMetaResolver, ContextServiceMap, ConverterService, CountryType, CurrencyService, CustomerCouponAdapter, CustomerCouponConnector, CustomerCouponService, CustomerSupportAgentTokenInterceptor, CxDatePipe, DEFAULT_LOCAL_STORAGE_KEY, DEFAULT_SCOPE, DEFAULT_SESSION_STORAGE_KEY, DEFAULT_URL_MATCHER, DELIVERY_MODE_NORMALIZER, DefaultConfigChunk, DeferLoadingStrategy, DynamicAttributeService, EMAIL_PATTERN, EXTERNAL_CONFIG_TRANSFER_ID, EventService, ExternalJsFileLoader, ExternalRoutesConfig, ExternalRoutesGuard, ExternalRoutesModule, ExternalRoutesService, FeatureConfigService, FeatureDirective, FeatureLevelDirective, FeaturesConfig, FeaturesConfigModule, ForbiddenHandler, GIVE_CONSENT_PROCESS_ID, GLOBAL_MESSAGE_FEATURE, GatewayTimeoutHandler, GlobService, globalMessageGroup_actions as GlobalMessageActions, GlobalMessageConfig, GlobalMessageModule, globalMessageGroup_selectors as GlobalMessageSelectors, GlobalMessageService, GlobalMessageType, GoogleMapRendererService, HttpErrorHandler, I18nConfig, I18nModule, I18nTestingModule, I18nextTranslationService, ImageType, InterceptorUtil, InternalServerErrorHandler, JSP_INCLUDE_CMS_COMPONENT_TYPE, JavaRegExpConverter, KYMA_FEATURE, kymaGroup_actions as KymaActions, KymaConfig, KymaModule, kymaGroup_selectors as KymaSelectors, KymaService, LANGUAGE_CONTEXT_ID, LANGUAGE_NORMALIZER, LanguageService, LoadingScopesService, MEDIA_BASE_URL_META_TAG_NAME, MEDIA_BASE_URL_META_TAG_PLACEHOLDER, MULTI_CART_DATA, MULTI_CART_FEATURE, MockDatePipe, MockTranslatePipe, multiCartGroup_selectors as MultiCartSelectors, MultiCartService, MultiCartStatePersistenceService, NAVIGATION_DETAIL_ENTITY, NOTIFICATION_PREFERENCES, NgExpressEngineDecorator, NotAuthGuard, NotFoundHandler, NotificationType, OCC_BASE_URL_META_TAG_NAME, OCC_BASE_URL_META_TAG_PLACEHOLDER, OCC_CART_ID_CURRENT, OCC_USER_ID_ANONYMOUS, OCC_USER_ID_CURRENT, OCC_USER_ID_GUEST, OPEN_ID_TOKEN_DATA, ORDER_HISTORY_NORMALIZER, ORDER_NORMALIZER, ORDER_RETURNS_NORMALIZER, ORDER_RETURN_REQUEST_INPUT_SERIALIZER, ORDER_RETURN_REQUEST_NORMALIZER, Occ, OccAnonymousConsentTemplatesAdapter, OccAsmAdapter, OccCartAdapter, OccCartEntryAdapter, OccCartNormalizer, OccCartVoucherAdapter, OccCheckoutAdapter, OccCheckoutDeliveryAdapter, OccCheckoutPaymentAdapter, OccCmsComponentAdapter, OccCmsPageAdapter, OccCmsPageNormalizer, OccConfig, OccConfigLoaderModule, OccConfigLoaderService, OccCustomerCouponAdapter, OccEndpointsService, OccFieldsService, OccLoadedConfigConverter, OccModule, OccOrderNormalizer, OccProductAdapter, OccProductReferencesAdapter, OccProductReferencesListNormalizer, OccProductReviewsAdapter, OccProductSearchAdapter, OccProductSearchPageNormalizer, OccRequestsOptimizerService, OccReturnRequestNormalizer, OccSiteAdapter, OccSitesConfigLoader, OccStoreFinderAdapter, OccUserAdapter, OccUserAddressAdapter, OccUserConsentAdapter, OccUserInterestsAdapter, OccUserInterestsNormalizer, OccUserNotificationPreferenceAdapter, OccUserOrderAdapter, OccUserPaymentAdapter, OpenIdAuthenticationTokenService, OrderReturnRequestService, PASSWORD_PATTERN, PAYMENT_DETAILS_NORMALIZER, PAYMENT_DETAILS_SERIALIZER, POINT_OF_SERVICE_NORMALIZER, PROCESS_FEATURE, PRODUCT_DETAIL_ENTITY, PRODUCT_FEATURE, PRODUCT_INTERESTS, PRODUCT_INTERESTS_NORMALIZER, PRODUCT_NORMALIZER, PRODUCT_REFERENCES_NORMALIZER, PRODUCT_REVIEW_NORMALIZER, PRODUCT_REVIEW_SERIALIZER, PRODUCT_SEARCH_PAGE_NORMALIZER, PRODUCT_SUGGESTION_NORMALIZER, PageContext, PageMetaResolver, PageMetaService, PageRobotsMeta, PageType, PersonalizationConfig, PersonalizationContextService, PersonalizationModule, PriceType, ProcessModule, process_selectors as ProcessSelectors, productGroup_actions as ProductActions, ProductAdapter, ProductConnector, ProductImageNormalizer, ProductLoadingService, ProductModule, ProductNameNormalizer, ProductOccModule, ProductPageMetaResolver, ProductReferenceNormalizer, ProductReferenceService, ProductReferencesAdapter, ProductReferencesConnector, ProductReviewService, ProductReviewsAdapter, ProductReviewsConnector, ProductScope, ProductSearchAdapter, ProductSearchConnector, ProductSearchService, productGroup_selectors as ProductSelectors, ProductService, ProductURLPipe, PromotionLocation, ProtectedRoutesGuard, ProtectedRoutesService, REGIONS, REGION_NORMALIZER, REGISTER_USER_PROCESS_ID, REMOVE_PRODUCT_INTERESTS_PROCESS_ID, REMOVE_USER_PROCESS_ID, ROUTING_FEATURE, routingGroup_actions as RoutingActions, RoutingConfig, RoutingConfigService, RoutingModule, routingGroup_selectors as RoutingSelector, RoutingService, SERVER_REQUEST_ORIGIN, SERVER_REQUEST_URL, SET_DELIVERY_ADDRESS_PROCESS_ID, SET_DELIVERY_MODE_PROCESS_ID, SET_PAYMENT_DETAILS_PROCESS_ID, SET_SUPPORTED_DELIVERY_MODE_PROCESS_ID, SITE_CONTEXT_FEATURE, STORE_COUNT_NORMALIZER, STORE_FINDER_DATA, STORE_FINDER_FEATURE, STORE_FINDER_SEARCH_PAGE_NORMALIZER, SUBSCRIBE_CUSTOMER_COUPON_PROCESS_ID, SearchPageMetaResolver, SearchboxService, SelectiveCartService, SemanticPathService, SiteAdapter, SiteConnector, siteContextGroup_actions as SiteContextActions, SiteContextConfig, SiteContextInterceptor, SiteContextModule, SiteContextOccModule, siteContextGroup_selectors as SiteContextSelectors, SmartEditModule, SmartEditService, StateConfig, StateEventService, StateModule, StatePersistenceService, StateTransferType, utilsGroup as StateUtils, StorageSyncType, StoreDataService, storeFinderGroup_actions as StoreFinderActions, StoreFinderAdapter, StoreFinderConfig, StoreFinderConnector, StoreFinderCoreModule, StoreFinderOccModule, storeFinderGroup_selectors as StoreFinderSelectors, StoreFinderService, TITLE_NORMALIZER, TOKEN_REVOCATION_HEADER, TestConfigModule, TranslatePipe, TranslationChunkService, TranslationService, UNSUBSCRIBE_CUSTOMER_COUPON_PROCESS_ID, UPDATE_EMAIL_PROCESS_ID, UPDATE_NOTIFICATION_PREFERENCES_PROCESS_ID, UPDATE_PASSWORD_PROCESS_ID, UPDATE_USER_DETAILS_PROCESS_ID, USER_ADDRESSES, USER_CONSENTS, USER_FEATURE, USER_NORMALIZER, USER_ORDERS, USER_ORDER_DETAILS, USER_PAYMENT_METHODS, USER_RETURN_REQUESTS, USER_RETURN_REQUEST_DETAILS, USER_SERIALIZER, USER_SIGN_UP_SERIALIZER, USE_CLIENT_TOKEN, USE_CUSTOMER_SUPPORT_AGENT_TOKEN, UnauthorizedErrorHandler, UnknownErrorHandler, UrlMatcherService, UrlModule, UrlPipe, userGroup_actions as UserActions, UserAdapter, UserAddressAdapter, UserAddressConnector, UserAddressService, UserConnector, UserConsentAdapter, UserConsentConnector, UserConsentService, UserInterestsAdapter, UserInterestsConnector, UserInterestsService, UserModule, UserNotificationPreferenceService, UserOccModule, UserOrderAdapter, UserOrderConnector, UserOrderService, UserPaymentAdapter, UserPaymentConnector, UserPaymentService, UserService, usersGroup_selectors as UsersSelectors, VariantQualifier, VariantType, WITHDRAW_CONSENT_PROCESS_ID, WindowRef, WishListService, WithCredentialsInterceptor, configInitializerFactory, configValidatorFactory, configurationFactory, contextServiceMapProvider, createFrom, defaultAnonymousConsentsConfig, defaultCmsModuleConfig, defaultOccConfig, defaultStateConfig, errorHandlers, getServerRequestProviders, httpErrorInterceptors, initConfigurableRoutes, isFeatureEnabled, isFeatureLevel, mediaServerConfigFromMetaTagFactory, occConfigValidator, occServerConfigFromMetaTagFactory, provideConfig, provideConfigFactory, provideConfigFromMetaTags, provideConfigValidator, provideDefaultConfig, provideDefaultConfigFactory, resolveApplicable, serviceMapFactory, testestsd, validateConfig, withdrawOn, cartStatePersistenceFactory as ɵa, TEST_CONFIG_COOKIE_NAME as ɵb, AsmStoreModule as ɵba, getReducers$3 as ɵbb, reducerToken$3 as ɵbc, reducerProvider$3 as ɵbd, clearCustomerSupportAgentAsmState as ɵbe, metaReducers$2 as ɵbf, effects$3 as ɵbg, CustomerEffects as ɵbh, CustomerSupportAgentTokenEffects as ɵbi, UserAuthenticationTokenService as ɵbj, reducer$7 as ɵbk, interceptors$2 as ɵbl, CustomerSupportAgentAuthErrorInterceptor as ɵbm, CustomerSupportAgentErrorHandlingService as ɵbn, defaultAsmConfig as ɵbo, authStoreConfigFactory as ɵbp, AuthStoreModule as ɵbq, getReducers as ɵbr, reducerToken as ɵbs, reducerProvider as ɵbt, clearAuthState as ɵbu, metaReducers as ɵbv, effects as ɵbw, ClientTokenEffect as ɵbx, UserTokenEffects as ɵby, ClientAuthenticationTokenService as ɵbz, configFromCookieFactory as ɵc, reducer as ɵca, defaultAuthConfig as ɵcb, interceptors as ɵcc, ClientTokenInterceptor as ɵcd, UserTokenInterceptor as ɵce, AuthErrorInterceptor as ɵcf, UserErrorHandlingService as ɵcg, UrlParsingService as ɵch, ClientErrorHandlingService as ɵci, TokenRevocationInterceptor as ɵcj, MultiCartStoreModule as ɵck, clearMultiCartState as ɵcl, multiCartMetaReducers as ɵcm, multiCartReducerToken as ɵcn, getMultiCartReducers as ɵco, multiCartReducerProvider as ɵcp, CartEffects as ɵcq, CartEntryEffects as ɵcr, CartVoucherEffects as ɵcs, WishListEffects as ɵct, SaveCartConnector as ɵcu, SaveCartAdapter as ɵcv, MultiCartEffects as ɵcw, entityProcessesLoaderReducer as ɵcx, entityReducer as ɵcy, processesLoaderReducer as ɵcz, CONFIG_INITIALIZER_FORROOT_GUARD as ɵd, activeCartReducer as ɵda, cartEntitiesReducer as ɵdb, wishListReducer as ɵdc, CartPageMetaResolver as ɵdd, SiteContextParamsService as ɵde, CheckoutStoreModule as ɵdf, getReducers$5 as ɵdg, reducerToken$5 as ɵdh, reducerProvider$5 as ɵdi, effects$5 as ɵdj, AddressVerificationEffect as ɵdk, CardTypesEffects as ɵdl, CheckoutEffects as ɵdm, reducer$b as ɵdn, reducer$a as ɵdo, reducer$9 as ɵdp, cmsStoreConfigFactory as ɵdq, CmsStoreModule as ɵdr, getReducers$7 as ɵds, reducerToken$7 as ɵdt, reducerProvider$7 as ɵdu, clearCmsState as ɵdv, metaReducers$3 as ɵdw, effects$7 as ɵdx, ComponentsEffects as ɵdy, NavigationEntryItemEffects as ɵdz, initConfig as ɵe, PageEffects as ɵea, Config as ɵeb, reducer$f as ɵec, entityLoaderReducer as ɵed, reducer$g as ɵee, reducer$d as ɵef, reducer$e as ɵeg, GlobalMessageStoreModule as ɵeh, getReducers$4 as ɵei, reducerToken$4 as ɵej, reducerProvider$4 as ɵek, reducer$8 as ɵel, GlobalMessageEffect as ɵem, defaultGlobalMessageConfigFactory as ɵen, HttpErrorInterceptor as ɵeo, defaultI18nConfig as ɵep, i18nextProviders as ɵeq, i18nextInit as ɵer, MockTranslationService as ɵes, kymaStoreConfigFactory as ɵet, KymaStoreModule as ɵeu, getReducers$8 as ɵev, reducerToken$8 as ɵew, reducerProvider$8 as ɵex, clearKymaState as ɵey, metaReducers$4 as ɵez, anonymousConsentsStoreConfigFactory as ɵf, effects$8 as ɵfa, OpenIdTokenEffect as ɵfb, defaultKymaConfig as ɵfc, defaultOccAsmConfig as ɵfd, defaultOccCartConfig as ɵfe, OccSaveCartAdapter as ɵff, defaultOccProductConfig as ɵfg, defaultOccSiteContextConfig as ɵfh, defaultOccStoreFinderConfig as ɵfi, defaultOccUserConfig as ɵfj, UserNotificationPreferenceAdapter as ɵfk, defaultPersonalizationConfig as ɵfl, interceptors$3 as ɵfm, OccPersonalizationIdInterceptor as ɵfn, OccPersonalizationTimeInterceptor as ɵfo, ProcessStoreModule as ɵfp, getReducers$9 as ɵfq, reducerToken$9 as ɵfr, reducerProvider$9 as ɵfs, productStoreConfigFactory as ɵft, ProductStoreModule as ɵfu, getReducers$a as ɵfv, reducerToken$a as ɵfw, reducerProvider$a as ɵfx, clearProductsState as ɵfy, metaReducers$5 as ɵfz, AnonymousConsentsStoreModule as ɵg, effects$9 as ɵga, ProductReferencesEffects as ɵgb, ProductReviewsEffects as ɵgc, ProductsSearchEffects as ɵgd, ProductEffects as ɵge, reducer$h as ɵgf, entityScopedLoaderReducer as ɵgg, scopedLoaderReducer as ɵgh, reducer$j as ɵgi, reducer$i as ɵgj, PageMetaResolver as ɵgk, CouponSearchPageResolver as ɵgl, PageMetaResolver as ɵgm, addExternalRoutesFactory as ɵgn, getReducers$6 as ɵgo, reducer$c as ɵgp, reducerToken$6 as ɵgq, reducerProvider$6 as ɵgr, CustomSerializer as ɵgs, effects$6 as ɵgt, RouterEffects as ɵgu, siteContextStoreConfigFactory as ɵgv, SiteContextStoreModule as ɵgw, getReducers$1 as ɵgx, reducerToken$1 as ɵgy, reducerProvider$1 as ɵgz, TRANSFER_STATE_META_REDUCER as ɵh, effects$2 as ɵha, LanguagesEffects as ɵhb, CurrenciesEffects as ɵhc, BaseSiteEffects as ɵhd, reducer$3 as ɵhe, reducer$2 as ɵhf, reducer$1 as ɵhg, defaultSiteContextConfigFactory as ɵhh, initializeContext as ɵhi, contextServiceProviders as ɵhj, SiteContextRoutesHandler as ɵhk, SiteContextUrlSerializer as ɵhl, siteContextParamsProviders as ɵhm, baseSiteConfigValidator as ɵhn, interceptors$4 as ɵho, CmsTicketInterceptor as ɵhp, StoreFinderStoreModule as ɵhq, getReducers$b as ɵhr, reducerToken$b as ɵhs, reducerProvider$b as ɵht, effects$a as ɵhu, FindStoresEffect as ɵhv, ViewAllStoresEffect as ɵhw, defaultStoreFinderConfig as ɵhx, UserStoreModule as ɵhy, getReducers$c as ɵhz, STORAGE_SYNC_META_REDUCER as ɵi, reducerToken$c as ɵia, reducerProvider$c as ɵib, clearUserState as ɵic, metaReducers$7 as ɵid, effects$b as ɵie, BillingCountriesEffect as ɵif, ClearMiscsDataEffect as ɵig, ConsignmentTrackingEffects as ɵih, DeliveryCountriesEffects as ɵii, NotificationPreferenceEffects as ɵij, OrderDetailsEffect as ɵik, OrderReturnRequestEffect as ɵil, UserPaymentMethodsEffects as ɵim, RegionsEffects as ɵin, ResetPasswordEffects as ɵio, TitlesEffects as ɵip, UserAddressesEffects as ɵiq, UserConsentsEffect as ɵir, UserDetailsEffects as ɵis, UserOrdersEffect as ɵit, UserRegisterEffects as ɵiu, CustomerCouponEffects as ɵiv, ProductInterestsEffect as ɵiw, ForgotPasswordEffects as ɵix, UpdateEmailEffects as ɵiy, UpdatePasswordEffects as ɵiz, stateMetaReducers as ɵj, UserNotificationPreferenceConnector as ɵja, reducer$v as ɵjb, reducer$t as ɵjc, reducer$k as ɵjd, reducer$u as ɵje, reducer$p as ɵjf, reducer$w as ɵjg, reducer$o as ɵjh, reducer$z as ɵji, reducer$m as ɵjj, reducer$s as ɵjk, reducer$q as ɵjl, reducer$r as ɵjm, reducer$l as ɵjn, reducer$x as ɵjo, reducer$n as ɵjp, reducer$y as ɵjq, getStorageSyncReducer as ɵk, getTransferStateReducer as ɵl, getReducers$2 as ɵm, reducerToken$2 as ɵn, reducerProvider$2 as ɵo, clearAnonymousConsentTemplates as ɵp, metaReducers$1 as ɵq, effects$1 as ɵr, AnonymousConsentsEffects as ɵs, loaderReducer as ɵt, reducer$6 as ɵu, reducer$4 as ɵv, reducer$5 as ɵw, interceptors$1 as ɵx, AnonymousConsentsInterceptor as ɵy, asmStoreConfigFactory as ɵz };
//# sourceMappingURL=spartacus-core.js.map
