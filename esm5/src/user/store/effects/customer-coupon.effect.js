import { __decorate } from "tslib";
import { Injectable } from '@angular/core';
import { Actions, Effect, ofType } from '@ngrx/effects';
import { of } from 'rxjs';
import { catchError, map, mergeMap } from 'rxjs/operators';
import * as fromCustomerCouponsAction from '../actions/customer-coupon.action';
import { CustomerCouponConnector } from '../../connectors/customer-coupon/customer-coupon.connector';
import { makeErrorSerializable } from '../../../util/serialization-utils';
var CustomerCouponEffects = /** @class */ (function () {
    function CustomerCouponEffects(actions$, customerCouponConnector) {
        var _this = this;
        this.actions$ = actions$;
        this.customerCouponConnector = customerCouponConnector;
        this.loadCustomerCoupons$ = this.actions$.pipe(ofType(fromCustomerCouponsAction.LOAD_CUSTOMER_COUPONS), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            return _this.customerCouponConnector
                .getCustomerCoupons(payload.userId, payload.pageSize, payload.currentPage, payload.sort)
                .pipe(map(function (coupons) {
                return new fromCustomerCouponsAction.LoadCustomerCouponsSuccess(coupons);
            }), catchError(function (error) {
                return of(new fromCustomerCouponsAction.LoadCustomerCouponsFail(makeErrorSerializable(error)));
            }));
        }));
        this.subscribeCustomerCoupon$ = this.actions$.pipe(ofType(fromCustomerCouponsAction.SUBSCRIBE_CUSTOMER_COUPON), map(function (action) {
            return action.payload;
        }), mergeMap(function (payload) {
            return _this.customerCouponConnector
                .turnOnNotification(payload.userId, payload.couponCode)
                .pipe(map(function (data) {
                return new fromCustomerCouponsAction.SubscribeCustomerCouponSuccess(data);
            }), catchError(function (error) {
                return of(new fromCustomerCouponsAction.SubscribeCustomerCouponFail(makeErrorSerializable(error)));
            }));
        }));
        this.unsubscribeCustomerCoupon$ = this.actions$.pipe(ofType(fromCustomerCouponsAction.UNSUBSCRIBE_CUSTOMER_COUPON), map(function (action) {
            return action.payload;
        }), mergeMap(function (payload) {
            return _this.customerCouponConnector
                .turnOffNotification(payload.userId, payload.couponCode)
                .pipe(map(function () {
                return new fromCustomerCouponsAction.UnsubscribeCustomerCouponSuccess(payload.couponCode);
            }), catchError(function (error) {
                return of(new fromCustomerCouponsAction.UnsubscribeCustomerCouponFail(makeErrorSerializable(error)));
            }));
        }));
        this.claimCustomerCoupon$ = this.actions$.pipe(ofType(fromCustomerCouponsAction.CLAIM_CUSTOMER_COUPON), map(function (action) { return action.payload; }), mergeMap(function (payload) {
            return _this.customerCouponConnector
                .claimCustomerCoupon(payload.userId, payload.couponCode)
                .pipe(map(function (data) {
                return new fromCustomerCouponsAction.ClaimCustomerCouponSuccess(data);
            }), catchError(function (error) {
                return of(new fromCustomerCouponsAction.ClaimCustomerCouponFail(makeErrorSerializable(error)));
            }));
        }));
    }
    CustomerCouponEffects.ctorParameters = function () { return [
        { type: Actions },
        { type: CustomerCouponConnector }
    ]; };
    __decorate([
        Effect()
    ], CustomerCouponEffects.prototype, "loadCustomerCoupons$", void 0);
    __decorate([
        Effect()
    ], CustomerCouponEffects.prototype, "subscribeCustomerCoupon$", void 0);
    __decorate([
        Effect()
    ], CustomerCouponEffects.prototype, "unsubscribeCustomerCoupon$", void 0);
    __decorate([
        Effect()
    ], CustomerCouponEffects.prototype, "claimCustomerCoupon$", void 0);
    CustomerCouponEffects = __decorate([
        Injectable()
    ], CustomerCouponEffects);
    return CustomerCouponEffects;
}());
export { CustomerCouponEffects };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3VzdG9tZXItY291cG9uLmVmZmVjdC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BzcGFydGFjdXMvY29yZS8iLCJzb3VyY2VzIjpbInNyYy91c2VyL3N0b3JlL2VmZmVjdHMvY3VzdG9tZXItY291cG9uLmVmZmVjdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDeEQsT0FBTyxFQUFjLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN0QyxPQUFPLEVBQUUsVUFBVSxFQUFFLEdBQUcsRUFBRSxRQUFRLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUMzRCxPQUFPLEtBQUsseUJBQXlCLE1BQU0sbUNBQW1DLENBQUM7QUFDL0UsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sNERBQTRELENBQUM7QUFFckcsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFHMUU7SUF3SEUsK0JBQ1UsUUFBaUIsRUFDakIsdUJBQWdEO1FBRjFELGlCQUdJO1FBRk0sYUFBUSxHQUFSLFFBQVEsQ0FBUztRQUNqQiw0QkFBdUIsR0FBdkIsdUJBQXVCLENBQXlCO1FBeEgxRCx5QkFBb0IsR0FFaEIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQ3BCLE1BQU0sQ0FBQyx5QkFBeUIsQ0FBQyxxQkFBcUIsQ0FBQyxFQUN2RCxHQUFHLENBQ0QsVUFBQyxNQUFxRCxJQUFLLE9BQUEsTUFBTSxDQUFDLE9BQU8sRUFBZCxDQUFjLENBQzFFLEVBQ0QsUUFBUSxDQUFDLFVBQUMsT0FBTztZQUNmLE9BQU8sS0FBSSxDQUFDLHVCQUF1QjtpQkFDaEMsa0JBQWtCLENBQ2pCLE9BQU8sQ0FBQyxNQUFNLEVBQ2QsT0FBTyxDQUFDLFFBQVEsRUFDaEIsT0FBTyxDQUFDLFdBQVcsRUFDbkIs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QixDQUFDLEtBQUssQ0FBQyxDQUM3QixDQUNGO1lBSkQsQ0FJQyxDQUNGLENBQ0YsQ0FBQztRQUNOLENBQUMsQ0FBQyxDQUNILENBQUM7SUFLQyxDQUFDOztnQkFGZ0IsT0FBTztnQkFDUSx1QkFBdUI7O0lBeEgxRDtRQURDLE1BQU0sRUFBRTt1RUErQlA7SUFHRjtRQURDLE1BQU0sRUFBRTsyRUEyQlA7SUFHRjtRQURDLE1BQU0sRUFBRTs2RUEyQlA7SUFHRjtRQURDLE1BQU0sRUFBRTt1RUEwQlA7SUF0SFMscUJBQXFCO1FBRGpDLFVBQVUsRUFBRTtPQUNBLHFCQUFxQixDQTRIakM7SUFBRCw0QkFBQztDQUFBLEFBNUhELElBNEhDO1NBNUhZLHFCQUFxQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFjdGlvbnMsIEVmZmVjdCwgb2ZUeXBlIH0gZnJvbSAnQG5ncngvZWZmZWN0cyc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBvZiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgY2F0Y2hFcnJvciwgbWFwLCBtZXJnZU1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCAqIGFzIGZyb21DdXN0b21lckNvdXBvbnNBY3Rpb24gZnJvbSAnLi4vYWN0aW9ucy9jdXN0b21lci1jb3Vwb24uYWN0aW9uJztcbmltcG9ydCB7IEN1c3RvbWVyQ291cG9uQ29ubmVjdG9yIH0gZnJvbSAnLi4vLi4vY29ubmVjdG9ycy9jdXN0b21lci1jb3Vwb24vY3VzdG9tZXItY291cG9uLmNvbm5lY3Rvcic7XG5pbXBvcnQgeyBDdXN0b21lckNvdXBvblNlYXJjaFJlc3VsdCB9IGZyb20gJy4uLy4uLy4uL21vZGVsL2N1c3RvbWVyLWNvdXBvbi5tb2RlbCc7XG5pbXBvcnQgeyBtYWtlRXJyb3JTZXJpYWxpemFibGUgfSBmcm9tICcuLi8uLi8uLi91dGlsL3NlcmlhbGl6YXRpb24tdXRpbHMnO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgQ3VzdG9tZXJDb3Vwb25FZmZlY3RzIHtcbiAgQEVmZmVjdCgpXG4gIGxvYWRDdXN0b21lckNvdXBvbnMkOiBPYnNlcnZhYmxlPFxuICAgIGZyb21DdXN0b21lckNvdXBvbnNBY3Rpb24uQ3VzdG9tZXJDb3Vwb25BY3Rpb25cbiAgPiA9IHRoaXMuYWN0aW9ucyQucGlwZShcbiAgICBvZlR5cGUoZnJvbUN1c3RvbWVyQ291cG9uc0FjdGlvbi5MT0FEX0NVU1RPTUVSX0NPVVBPTlMpLFxuICAgIG1hcChcbiAgICAgIChhY3Rpb246IGZyb21DdXN0b21lckNvdXBvbnNBY3Rpb24uTG9hZEN1c3RvbWVyQ291cG9ucykgPT4gYWN0aW9uLnBheWxvYWRcbiAgICApLFxuICAgIG1lcmdlTWFwKChwYXlsb2FkKSA9PiB7XG4gICAgICByZXR1cm4gdGhpcy5jdXN0b21lckNvdXBvbkNvbm5lY3RvclxuICAgICAgICAuZ2V0Q3VzdG9tZXJDb3Vwb25zKFxuICAgICAgICAgIHBheWxvYWQudXNlcklkLFxuICAgICAgICAgIHBheWxvYWQucGFnZVNpemUsXG4gICAgICAgICAgcGF5bG9hZC5jdXJyZW50UGFnZSxcbiAgICAgICAgICBwYXlsb2FkLnNvcnRcbiAgICAgICAgKVxuICAgICAgICAucGlwZShcbiAgICAgICAgICBtYXAoKGNvdXBvbnM6IEN1c3RvbWVyQ291cG9uU2VhcmNoUmVzdWx0KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IGZyb21DdXN0b21lckNvdXBvbnNBY3Rpb24uTG9hZEN1c3RvbWVyQ291cG9uc1N1Y2Nlc3MoXG4gICAgICAgICAgICAgIGNvdXBvbnNcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSksXG4gICAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3IpID0+XG4gICAgICAgICAgICBvZihcbiAgICAgICAgICAgICAgbmV3IGZyb21DdXN0b21lckNvdXBvbnNBY3Rpb24uTG9hZEN1c3RvbWVyQ291cG9uc0ZhaWwoXG4gICAgICAgICAgICAgICAgbWFrZUVycm9yU2VyaWFsaXphYmxlKGVycm9yKVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICAgICApO1xuICAgIH0pXG4gICk7XG5cbiAgQEVmZmVjdCgpXG4gIHN1YnNjcmliZUN1c3RvbWVyQ291cG9uJDogT2JzZXJ2YWJsZTxcbiAgICBmcm9tQ3VzdG9tZXJDb3Vwb25zQWN0aW9uLkN1c3RvbWVyQ291cG9uQWN0aW9uXG4gID4gPSB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgb2ZUeXBlKGZyb21DdXN0b21lckNvdXBvbnNBY3Rpb24uU1VCU0NSSUJFX0NVU1RPTUVSX0NPVVBPTiksXG4gICAgbWFwKFxuICAgICAgKGFjdGlvbjogZnJvbUN1c3RvbWVyQ291cG9uc0FjdGlvbi5TdWJzY3JpYmVDdXN0b21lckNvdXBvbikgPT5cbiAgICAgICAgYWN0aW9uLnBheWxvYWRcbiAgICApLFxuICAgIG1lcmdlTWFwKChwYXlsb2FkKSA9PiB7XG4gICAgICByZXR1cm4gdGhpcy5jdXN0b21lckNvdXBvbkNvbm5lY3RvclxuICAgICAgICAudHVybk9uTm90aWZpY2F0aW9uKHBheWxvYWQudXNlcklkLCBwYXlsb2FkLmNvdXBvbkNvZGUpXG4gICAgICAgIC5waXBlKFxuICAgICAgICAgIG1hcCgoZGF0YTogYW55KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IGZyb21DdXN0b21lckNvdXBvbnNBY3Rpb24uU3Vic2NyaWJlQ3VzdG9tZXJDb3Vwb25TdWNjZXNzKFxuICAgICAgICAgICAgICBkYXRhXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yKSA9PlxuICAgICAgICAgICAgb2YoXG4gICAgICAgICAgICAgIG5ldyBmcm9tQ3VzdG9tZXJDb3Vwb25zQWN0aW9uLlN1YnNjcmliZUN1c3RvbWVyQ291cG9uRmFpbChcbiAgICAgICAgICAgICAgICBtYWtlRXJyb3JTZXJpYWxpemFibGUoZXJyb3IpXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgfSlcbiAgKTtcblxuICBARWZmZWN0KClcbiAgdW5zdWJzY3JpYmVDdXN0b21lckNvdXBvbiQ6IE9ic2VydmFibGU8XG4gICAgZnJvbUN1c3RvbWVyQ291cG9uc0FjdGlvbi5DdXN0b21lckNvdXBvbkFjdGlvblxuICA+ID0gdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgIG9mVHlwZShmcm9tQ3VzdG9tZXJDb3Vwb25zQWN0aW9uLlVOU1VCU0NSSUJFX0NVU1RPTUVSX0NPVVBPTiksXG4gICAgbWFwKFxuICAgICAgKGFjdGlvbjogZnJvbUN1c3RvbWVyQ291cG9uc0FjdGlvbi5VbnN1YnNjcmliZUN1c3RvbWVyQ291cG9uKSA9PlxuICAgICAgICBhY3Rpb24ucGF5bG9hZFxuICAgICksXG4gICAgbWVyZ2VNYXAoKHBheWxvYWQpID0+IHtcbiAgICAgIHJldHVybiB0aGlzLmN1c3RvbWVyQ291cG9uQ29ubmVjdG9yXG4gICAgICAgIC50dXJuT2ZmTm90aWZpY2F0aW9uKHBheWxvYWQudXNlcklkLCBwYXlsb2FkLmNvdXBvbkNvZGUpXG4gICAgICAgIC5waXBlKFxuICAgICAgICAgIG1hcCgoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IGZyb21DdXN0b21lckNvdXBvbnNBY3Rpb24uVW5zdWJzY3JpYmVDdXN0b21lckNvdXBvblN1Y2Nlc3MoXG4gICAgICAgICAgICAgIHBheWxvYWQuY291cG9uQ29kZVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcikgPT5cbiAgICAgICAgICAgIG9mKFxuICAgICAgICAgICAgICBuZXcgZnJvbUN1c3RvbWVyQ291cG9uc0FjdGlvbi5VbnN1YnNjcmliZUN1c3RvbWVyQ291cG9uRmFpbChcbiAgICAgICAgICAgICAgICBtYWtlRXJyb3JTZXJpYWxpemFibGUoZXJyb3IpXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgfSlcbiAgKTtcblxuICBARWZmZWN0KClcbiAgY2xhaW1DdXN0b21lckNvdXBvbiQ6IE9ic2VydmFibGU8XG4gICAgZnJvbUN1c3RvbWVyQ291cG9uc0FjdGlvbi5DdXN0b21lckNvdXBvbkFjdGlvblxuICA+ID0gdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgIG9mVHlwZShmcm9tQ3VzdG9tZXJDb3Vwb25zQWN0aW9uLkNMQUlNX0NVU1RPTUVSX0NPVVBPTiksXG4gICAgbWFwKFxuICAgICAgKGFjdGlvbjogZnJvbUN1c3RvbWVyQ291cG9uc0FjdGlvbi5DbGFpbUN1c3RvbWVyQ291cG9uKSA9PiBhY3Rpb24ucGF5bG9hZFxuICAgICksXG4gICAgbWVyZ2VNYXAoKHBheWxvYWQpID0+IHtcbiAgICAgIHJldHVybiB0aGlzLmN1c3RvbWVyQ291cG9uQ29ubmVjdG9yXG4gICAgICAgIC5jbGFpbUN1c3RvbWVyQ291cG9uKHBheWxvYWQudXNlcklkLCBwYXlsb2FkLmNvdXBvbkNvZGUpXG4gICAgICAgIC5waXBlKFxuICAgICAgICAgIG1hcCgoZGF0YSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBmcm9tQ3VzdG9tZXJDb3Vwb25zQWN0aW9uLkNsYWltQ3VzdG9tZXJDb3Vwb25TdWNjZXNzKFxuICAgICAgICAgICAgICBkYXRhXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yKSA9PlxuICAgICAgICAgICAgb2YoXG4gICAgICAgICAgICAgIG5ldyBmcm9tQ3VzdG9tZXJDb3Vwb25zQWN0aW9uLkNsYWltQ3VzdG9tZXJDb3Vwb25GYWlsKFxuICAgICAgICAgICAgICAgIG1ha2VFcnJvclNlcmlhbGl6YWJsZShlcnJvcilcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICB9KVxuICApO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgYWN0aW9ucyQ6IEFjdGlvbnMsXG4gICAgcHJpdmF0ZSBjdXN0b21lckNvdXBvbkNvbm5lY3RvcjogQ3VzdG9tZXJDb3Vwb25Db25uZWN0b3JcbiAgKSB7fVxufVxuIl19